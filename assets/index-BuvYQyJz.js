(function(){const _=document.createElement("link").relList;if(_&&_.supports&&_.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))y(w);new MutationObserver(w=>{for(const M of w)if(M.type==="childList")for(const B of M.addedNodes)B.tagName==="LINK"&&B.rel==="modulepreload"&&y(B)}).observe(document,{childList:!0,subtree:!0});function T(w){const M={};return w.integrity&&(M.integrity=w.integrity),w.referrerPolicy&&(M.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?M.credentials="include":w.crossOrigin==="anonymous"?M.credentials="omit":M.credentials="same-origin",M}function y(w){if(w.ep)return;w.ep=!0;const M=T(w);fetch(w.href,M)}})();var wO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function SK(E){return E&&E.__esModule&&Object.prototype.hasOwnProperty.call(E,"default")?E.default:E}var OO={exports:{}},rS={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VV;function TK(){if(VV)return rS;VV=1;var E=Symbol.for("react.transitional.element"),_=Symbol.for("react.fragment");function T(y,w,M){var B=null;if(M!==void 0&&(B=""+M),w.key!==void 0&&(B=""+w.key),"key"in w){M={};for(var q in w)q!=="key"&&(M[q]=w[q])}else M=w;return w=M.ref,{$$typeof:E,type:y,key:B,ref:w!==void 0?w:null,props:M}}return rS.Fragment=_,rS.jsx=T,rS.jsxs=T,rS}var BV;function RK(){return BV||(BV=1,OO.exports=TK()),OO.exports}var ee=RK(),NO={exports:{}},qe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FV;function yK(){if(FV)return qe;FV=1;var E=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),M=Symbol.for("react.consumer"),B=Symbol.for("react.context"),q=Symbol.for("react.forward_ref"),Y=Symbol.for("react.suspense"),H=Symbol.for("react.memo"),tt=Symbol.for("react.lazy"),rt=Symbol.iterator;function ht($){return $===null||typeof $!="object"?null:($=rt&&$[rt]||$["@@iterator"],typeof $=="function"?$:null)}var Mt={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},st=Object.assign,Ut={};function mt($,Ft,fe){this.props=$,this.context=Ft,this.refs=Ut,this.updater=fe||Mt}mt.prototype.isReactComponent={},mt.prototype.setState=function($,Ft){if(typeof $!="object"&&typeof $!="function"&&$!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,$,Ft,"setState")},mt.prototype.forceUpdate=function($){this.updater.enqueueForceUpdate(this,$,"forceUpdate")};function vt(){}vt.prototype=mt.prototype;function Gt($,Ft,fe){this.props=$,this.context=Ft,this.refs=Ut,this.updater=fe||Mt}var Vt=Gt.prototype=new vt;Vt.constructor=Gt,st(Vt,mt.prototype),Vt.isPureReactComponent=!0;var Ce=Array.isArray,Jt={H:null,A:null,T:null,S:null},$e=Object.prototype.hasOwnProperty;function je($,Ft,fe,_e,zt,en){return fe=en.ref,{$$typeof:E,type:$,key:Ft,ref:fe!==void 0?fe:null,props:en}}function Gn($,Ft){return je($.type,Ft,void 0,void 0,void 0,$.props)}function Pt($){return typeof $=="object"&&$!==null&&$.$$typeof===E}function Zt($){var Ft={"=":"=0",":":"=2"};return"$"+$.replace(/[=:]/g,function(fe){return Ft[fe]})}var Ie=/\/+/g;function Qn($,Ft){return typeof $=="object"&&$!==null&&$.key!=null?Zt(""+$.key):Ft.toString(36)}function qi(){}function tn($){switch($.status){case"fulfilled":return $.value;case"rejected":throw $.reason;default:switch(typeof $.status=="string"?$.then(qi,qi):($.status="pending",$.then(function(Ft){$.status==="pending"&&($.status="fulfilled",$.value=Ft)},function(Ft){$.status==="pending"&&($.status="rejected",$.reason=Ft)})),$.status){case"fulfilled":return $.value;case"rejected":throw $.reason}}throw $}function be($,Ft,fe,_e,zt){var en=typeof $;(en==="undefined"||en==="boolean")&&($=null);var we=!1;if($===null)we=!0;else switch(en){case"bigint":case"string":case"number":we=!0;break;case"object":switch($.$$typeof){case E:case _:we=!0;break;case tt:return we=$._init,be(we($._payload),Ft,fe,_e,zt)}}if(we)return zt=zt($),we=_e===""?"."+Qn($,0):_e,Ce(zt)?(fe="",we!=null&&(fe=we.replace(Ie,"$&/")+"/"),be(zt,Ft,fe,"",function(ui){return ui})):zt!=null&&(Pt(zt)&&(zt=Gn(zt,fe+(zt.key==null||$&&$.key===zt.key?"":(""+zt.key).replace(Ie,"$&/")+"/")+we)),Ft.push(zt)),1;we=0;var _r=_e===""?".":_e+":";if(Ce($))for(var Cn=0;Cn<$.length;Cn++)_e=$[Cn],en=_r+Qn(_e,Cn),we+=be(_e,Ft,fe,en,zt);else if(Cn=ht($),typeof Cn=="function")for($=Cn.call($),Cn=0;!(_e=$.next()).done;)_e=_e.value,en=_r+Qn(_e,Cn++),we+=be(_e,Ft,fe,en,zt);else if(en==="object"){if(typeof $.then=="function")return be(tn($),Ft,fe,_e,zt);throw Ft=String($),Error("Objects are not valid as a React child (found: "+(Ft==="[object Object]"?"object with keys {"+Object.keys($).join(", ")+"}":Ft)+"). If you meant to render a collection of children, use an array instead.")}return we}function Bt($,Ft,fe){if($==null)return $;var _e=[],zt=0;return be($,_e,"","",function(en){return Ft.call(fe,en,zt++)}),_e}function $t($){if($._status===-1){var Ft=$._result;Ft=Ft(),Ft.then(function(fe){($._status===0||$._status===-1)&&($._status=1,$._result=fe)},function(fe){($._status===0||$._status===-1)&&($._status=2,$._result=fe)}),$._status===-1&&($._status=0,$._result=Ft)}if($._status===1)return $._result.default;throw $._result}var re=typeof reportError=="function"?reportError:function($){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ft=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof $=="object"&&$!==null&&typeof $.message=="string"?String($.message):String($),error:$});if(!window.dispatchEvent(Ft))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",$);return}console.error($)};function pe(){}return qe.Children={map:Bt,forEach:function($,Ft,fe){Bt($,function(){Ft.apply(this,arguments)},fe)},count:function($){var Ft=0;return Bt($,function(){Ft++}),Ft},toArray:function($){return Bt($,function(Ft){return Ft})||[]},only:function($){if(!Pt($))throw Error("React.Children.only expected to receive a single React element child.");return $}},qe.Component=mt,qe.Fragment=T,qe.Profiler=w,qe.PureComponent=Gt,qe.StrictMode=y,qe.Suspense=Y,qe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Jt,qe.act=function(){throw Error("act(...) is not supported in production builds of React.")},qe.cache=function($){return function(){return $.apply(null,arguments)}},qe.cloneElement=function($,Ft,fe){if($==null)throw Error("The argument must be a React element, but you passed "+$+".");var _e=st({},$.props),zt=$.key,en=void 0;if(Ft!=null)for(we in Ft.ref!==void 0&&(en=void 0),Ft.key!==void 0&&(zt=""+Ft.key),Ft)!$e.call(Ft,we)||we==="key"||we==="__self"||we==="__source"||we==="ref"&&Ft.ref===void 0||(_e[we]=Ft[we]);var we=arguments.length-2;if(we===1)_e.children=fe;else if(1<we){for(var _r=Array(we),Cn=0;Cn<we;Cn++)_r[Cn]=arguments[Cn+2];_e.children=_r}return je($.type,zt,void 0,void 0,en,_e)},qe.createContext=function($){return $={$$typeof:B,_currentValue:$,_currentValue2:$,_threadCount:0,Provider:null,Consumer:null},$.Provider=$,$.Consumer={$$typeof:M,_context:$},$},qe.createElement=function($,Ft,fe){var _e,zt={},en=null;if(Ft!=null)for(_e in Ft.key!==void 0&&(en=""+Ft.key),Ft)$e.call(Ft,_e)&&_e!=="key"&&_e!=="__self"&&_e!=="__source"&&(zt[_e]=Ft[_e]);var we=arguments.length-2;if(we===1)zt.children=fe;else if(1<we){for(var _r=Array(we),Cn=0;Cn<we;Cn++)_r[Cn]=arguments[Cn+2];zt.children=_r}if($&&$.defaultProps)for(_e in we=$.defaultProps,we)zt[_e]===void 0&&(zt[_e]=we[_e]);return je($,en,void 0,void 0,null,zt)},qe.createRef=function(){return{current:null}},qe.forwardRef=function($){return{$$typeof:q,render:$}},qe.isValidElement=Pt,qe.lazy=function($){return{$$typeof:tt,_payload:{_status:-1,_result:$},_init:$t}},qe.memo=function($,Ft){return{$$typeof:H,type:$,compare:Ft===void 0?null:Ft}},qe.startTransition=function($){var Ft=Jt.T,fe={};Jt.T=fe;try{var _e=$(),zt=Jt.S;zt!==null&&zt(fe,_e),typeof _e=="object"&&_e!==null&&typeof _e.then=="function"&&_e.then(pe,re)}catch(en){re(en)}finally{Jt.T=Ft}},qe.unstable_useCacheRefresh=function(){return Jt.H.useCacheRefresh()},qe.use=function($){return Jt.H.use($)},qe.useActionState=function($,Ft,fe){return Jt.H.useActionState($,Ft,fe)},qe.useCallback=function($,Ft){return Jt.H.useCallback($,Ft)},qe.useContext=function($){return Jt.H.useContext($)},qe.useDebugValue=function(){},qe.useDeferredValue=function($,Ft){return Jt.H.useDeferredValue($,Ft)},qe.useEffect=function($,Ft){return Jt.H.useEffect($,Ft)},qe.useId=function(){return Jt.H.useId()},qe.useImperativeHandle=function($,Ft,fe){return Jt.H.useImperativeHandle($,Ft,fe)},qe.useInsertionEffect=function($,Ft){return Jt.H.useInsertionEffect($,Ft)},qe.useLayoutEffect=function($,Ft){return Jt.H.useLayoutEffect($,Ft)},qe.useMemo=function($,Ft){return Jt.H.useMemo($,Ft)},qe.useOptimistic=function($,Ft){return Jt.H.useOptimistic($,Ft)},qe.useReducer=function($,Ft,fe){return Jt.H.useReducer($,Ft,fe)},qe.useRef=function($){return Jt.H.useRef($)},qe.useState=function($){return Jt.H.useState($)},qe.useSyncExternalStore=function($,Ft,fe){return Jt.H.useSyncExternalStore($,Ft,fe)},qe.useTransition=function(){return Jt.H.useTransition()},qe.version="19.0.0",qe}var jV;function a0(){return jV||(jV=1,NO.exports=yK()),NO.exports}var gt=a0(),DO={exports:{}},sS={},LO={exports:{}},PO={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GV;function vK(){return GV||(GV=1,function(E){function _(Bt,$t){var re=Bt.length;Bt.push($t);t:for(;0<re;){var pe=re-1>>>1,$=Bt[pe];if(0<w($,$t))Bt[pe]=$t,Bt[re]=$,re=pe;else break t}}function T(Bt){return Bt.length===0?null:Bt[0]}function y(Bt){if(Bt.length===0)return null;var $t=Bt[0],re=Bt.pop();if(re!==$t){Bt[0]=re;t:for(var pe=0,$=Bt.length,Ft=$>>>1;pe<Ft;){var fe=2*(pe+1)-1,_e=Bt[fe],zt=fe+1,en=Bt[zt];if(0>w(_e,re))zt<$&&0>w(en,_e)?(Bt[pe]=en,Bt[zt]=re,pe=zt):(Bt[pe]=_e,Bt[fe]=re,pe=fe);else if(zt<$&&0>w(en,re))Bt[pe]=en,Bt[zt]=re,pe=zt;else break t}}return $t}function w(Bt,$t){var re=Bt.sortIndex-$t.sortIndex;return re!==0?re:Bt.id-$t.id}if(E.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var M=performance;E.unstable_now=function(){return M.now()}}else{var B=Date,q=B.now();E.unstable_now=function(){return B.now()-q}}var Y=[],H=[],tt=1,rt=null,ht=3,Mt=!1,st=!1,Ut=!1,mt=typeof setTimeout=="function"?setTimeout:null,vt=typeof clearTimeout=="function"?clearTimeout:null,Gt=typeof setImmediate<"u"?setImmediate:null;function Vt(Bt){for(var $t=T(H);$t!==null;){if($t.callback===null)y(H);else if($t.startTime<=Bt)y(H),$t.sortIndex=$t.expirationTime,_(Y,$t);else break;$t=T(H)}}function Ce(Bt){if(Ut=!1,Vt(Bt),!st)if(T(Y)!==null)st=!0,tn();else{var $t=T(H);$t!==null&&be(Ce,$t.startTime-Bt)}}var Jt=!1,$e=-1,je=5,Gn=-1;function Pt(){return!(E.unstable_now()-Gn<je)}function Zt(){if(Jt){var Bt=E.unstable_now();Gn=Bt;var $t=!0;try{t:{st=!1,Ut&&(Ut=!1,vt($e),$e=-1),Mt=!0;var re=ht;try{e:{for(Vt(Bt),rt=T(Y);rt!==null&&!(rt.expirationTime>Bt&&Pt());){var pe=rt.callback;if(typeof pe=="function"){rt.callback=null,ht=rt.priorityLevel;var $=pe(rt.expirationTime<=Bt);if(Bt=E.unstable_now(),typeof $=="function"){rt.callback=$,Vt(Bt),$t=!0;break e}rt===T(Y)&&y(Y),Vt(Bt)}else y(Y);rt=T(Y)}if(rt!==null)$t=!0;else{var Ft=T(H);Ft!==null&&be(Ce,Ft.startTime-Bt),$t=!1}}break t}finally{rt=null,ht=re,Mt=!1}$t=void 0}}finally{$t?Ie():Jt=!1}}}var Ie;if(typeof Gt=="function")Ie=function(){Gt(Zt)};else if(typeof MessageChannel<"u"){var Qn=new MessageChannel,qi=Qn.port2;Qn.port1.onmessage=Zt,Ie=function(){qi.postMessage(null)}}else Ie=function(){mt(Zt,0)};function tn(){Jt||(Jt=!0,Ie())}function be(Bt,$t){$e=mt(function(){Bt(E.unstable_now())},$t)}E.unstable_IdlePriority=5,E.unstable_ImmediatePriority=1,E.unstable_LowPriority=4,E.unstable_NormalPriority=3,E.unstable_Profiling=null,E.unstable_UserBlockingPriority=2,E.unstable_cancelCallback=function(Bt){Bt.callback=null},E.unstable_continueExecution=function(){st||Mt||(st=!0,tn())},E.unstable_forceFrameRate=function(Bt){0>Bt||125<Bt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):je=0<Bt?Math.floor(1e3/Bt):5},E.unstable_getCurrentPriorityLevel=function(){return ht},E.unstable_getFirstCallbackNode=function(){return T(Y)},E.unstable_next=function(Bt){switch(ht){case 1:case 2:case 3:var $t=3;break;default:$t=ht}var re=ht;ht=$t;try{return Bt()}finally{ht=re}},E.unstable_pauseExecution=function(){},E.unstable_requestPaint=function(){},E.unstable_runWithPriority=function(Bt,$t){switch(Bt){case 1:case 2:case 3:case 4:case 5:break;default:Bt=3}var re=ht;ht=Bt;try{return $t()}finally{ht=re}},E.unstable_scheduleCallback=function(Bt,$t,re){var pe=E.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?pe+re:pe):re=pe,Bt){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=re+$,Bt={id:tt++,callback:$t,priorityLevel:Bt,startTime:re,expirationTime:$,sortIndex:-1},re>pe?(Bt.sortIndex=re,_(H,Bt),T(Y)===null&&Bt===T(H)&&(Ut?(vt($e),$e=-1):Ut=!0,be(Ce,re-pe))):(Bt.sortIndex=$,_(Y,Bt),st||Mt||(st=!0,tn())),Bt},E.unstable_shouldYield=Pt,E.unstable_wrapCallback=function(Bt){var $t=ht;return function(){var re=ht;ht=$t;try{return Bt.apply(this,arguments)}finally{ht=re}}}}(PO)),PO}var HV;function CK(){return HV||(HV=1,LO.exports=vK()),LO.exports}var kO={exports:{}},Kr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WV;function bK(){if(WV)return Kr;WV=1;var E=a0();function _(Y){var H="https://react.dev/errors/"+Y;if(1<arguments.length){H+="?args[]="+encodeURIComponent(arguments[1]);for(var tt=2;tt<arguments.length;tt++)H+="&args[]="+encodeURIComponent(arguments[tt])}return"Minified React error #"+Y+"; visit "+H+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function T(){}var y={d:{f:T,r:function(){throw Error(_(522))},D:T,C:T,L:T,m:T,X:T,S:T,M:T},p:0,findDOMNode:null},w=Symbol.for("react.portal");function M(Y,H,tt){var rt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:w,key:rt==null?null:""+rt,children:Y,containerInfo:H,implementation:tt}}var B=E.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function q(Y,H){if(Y==="font")return"";if(typeof H=="string")return H==="use-credentials"?H:""}return Kr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=y,Kr.createPortal=function(Y,H){var tt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!H||H.nodeType!==1&&H.nodeType!==9&&H.nodeType!==11)throw Error(_(299));return M(Y,H,null,tt)},Kr.flushSync=function(Y){var H=B.T,tt=y.p;try{if(B.T=null,y.p=2,Y)return Y()}finally{B.T=H,y.p=tt,y.d.f()}},Kr.preconnect=function(Y,H){typeof Y=="string"&&(H?(H=H.crossOrigin,H=typeof H=="string"?H==="use-credentials"?H:"":void 0):H=null,y.d.C(Y,H))},Kr.prefetchDNS=function(Y){typeof Y=="string"&&y.d.D(Y)},Kr.preinit=function(Y,H){if(typeof Y=="string"&&H&&typeof H.as=="string"){var tt=H.as,rt=q(tt,H.crossOrigin),ht=typeof H.integrity=="string"?H.integrity:void 0,Mt=typeof H.fetchPriority=="string"?H.fetchPriority:void 0;tt==="style"?y.d.S(Y,typeof H.precedence=="string"?H.precedence:void 0,{crossOrigin:rt,integrity:ht,fetchPriority:Mt}):tt==="script"&&y.d.X(Y,{crossOrigin:rt,integrity:ht,fetchPriority:Mt,nonce:typeof H.nonce=="string"?H.nonce:void 0})}},Kr.preinitModule=function(Y,H){if(typeof Y=="string")if(typeof H=="object"&&H!==null){if(H.as==null||H.as==="script"){var tt=q(H.as,H.crossOrigin);y.d.M(Y,{crossOrigin:tt,integrity:typeof H.integrity=="string"?H.integrity:void 0,nonce:typeof H.nonce=="string"?H.nonce:void 0})}}else H==null&&y.d.M(Y)},Kr.preload=function(Y,H){if(typeof Y=="string"&&typeof H=="object"&&H!==null&&typeof H.as=="string"){var tt=H.as,rt=q(tt,H.crossOrigin);y.d.L(Y,tt,{crossOrigin:rt,integrity:typeof H.integrity=="string"?H.integrity:void 0,nonce:typeof H.nonce=="string"?H.nonce:void 0,type:typeof H.type=="string"?H.type:void 0,fetchPriority:typeof H.fetchPriority=="string"?H.fetchPriority:void 0,referrerPolicy:typeof H.referrerPolicy=="string"?H.referrerPolicy:void 0,imageSrcSet:typeof H.imageSrcSet=="string"?H.imageSrcSet:void 0,imageSizes:typeof H.imageSizes=="string"?H.imageSizes:void 0,media:typeof H.media=="string"?H.media:void 0})}},Kr.preloadModule=function(Y,H){if(typeof Y=="string")if(H){var tt=q(H.as,H.crossOrigin);y.d.m(Y,{as:typeof H.as=="string"&&H.as!=="script"?H.as:void 0,crossOrigin:tt,integrity:typeof H.integrity=="string"?H.integrity:void 0})}else y.d.m(Y)},Kr.requestFormReset=function(Y){y.d.r(Y)},Kr.unstable_batchedUpdates=function(Y,H){return Y(H)},Kr.useFormState=function(Y,H,tt){return B.H.useFormState(Y,H,tt)},Kr.useFormStatus=function(){return B.H.useHostTransitionStatus()},Kr.version="19.0.0",Kr}var KV;function AK(){if(KV)return kO.exports;KV=1;function E(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(E)}catch(_){console.error(_)}}return E(),kO.exports=bK(),kO.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var YV;function IK(){if(YV)return sS;YV=1;var E=CK(),_=a0(),T=AK();function y(s){var o="https://react.dev/errors/"+s;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+s+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function w(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}var M=Symbol.for("react.element"),B=Symbol.for("react.transitional.element"),q=Symbol.for("react.portal"),Y=Symbol.for("react.fragment"),H=Symbol.for("react.strict_mode"),tt=Symbol.for("react.profiler"),rt=Symbol.for("react.provider"),ht=Symbol.for("react.consumer"),Mt=Symbol.for("react.context"),st=Symbol.for("react.forward_ref"),Ut=Symbol.for("react.suspense"),mt=Symbol.for("react.suspense_list"),vt=Symbol.for("react.memo"),Gt=Symbol.for("react.lazy"),Vt=Symbol.for("react.offscreen"),Ce=Symbol.for("react.memo_cache_sentinel"),Jt=Symbol.iterator;function $e(s){return s===null||typeof s!="object"?null:(s=Jt&&s[Jt]||s["@@iterator"],typeof s=="function"?s:null)}var je=Symbol.for("react.client.reference");function Gn(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===je?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case Y:return"Fragment";case q:return"Portal";case tt:return"Profiler";case H:return"StrictMode";case Ut:return"Suspense";case mt:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case Mt:return(s.displayName||"Context")+".Provider";case ht:return(s._context.displayName||"Context")+".Consumer";case st:var o=s.render;return s=s.displayName,s||(s=o.displayName||o.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case vt:return o=s.displayName||null,o!==null?o:Gn(s.type)||"Memo";case Gt:o=s._payload,s=s._init;try{return Gn(s(o))}catch{}}return null}var Pt=_.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Zt=Object.assign,Ie,Qn;function qi(s){if(Ie===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);Ie=o&&o[1]||"",Qn=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ie+s+Qn}var tn=!1;function be(s,o){if(!s||tn)return"";tn=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(o){var xt=function(){throw Error()};if(Object.defineProperty(xt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(xt,[])}catch(yt){var pt=yt}Reflect.construct(s,[],xt)}else{try{xt.call()}catch(yt){pt=yt}s.call(xt.prototype)}}else{try{throw Error()}catch(yt){pt=yt}(xt=s())&&typeof xt.catch=="function"&&xt.catch(function(){})}}catch(yt){if(yt&&pt&&typeof yt.stack=="string")return[yt.stack,pt.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var C=f.DetermineComponentFrameRoot(),k=C[0],j=C[1];if(k&&j){var z=k.split(`
`),nt=j.split(`
`);for(g=f=0;f<z.length&&!z[f].includes("DetermineComponentFrameRoot");)f++;for(;g<nt.length&&!nt[g].includes("DetermineComponentFrameRoot");)g++;if(f===z.length||g===nt.length)for(f=z.length-1,g=nt.length-1;1<=f&&0<=g&&z[f]!==nt[g];)g--;for(;1<=f&&0<=g;f--,g--)if(z[f]!==nt[g]){if(f!==1||g!==1)do if(f--,g--,0>g||z[f]!==nt[g]){var bt=`
`+z[f].replace(" at new "," at ");return s.displayName&&bt.includes("<anonymous>")&&(bt=bt.replace("<anonymous>",s.displayName)),bt}while(1<=f&&0<=g);break}}}finally{tn=!1,Error.prepareStackTrace=u}return(u=s?s.displayName||s.name:"")?qi(u):""}function Bt(s){switch(s.tag){case 26:case 27:case 5:return qi(s.type);case 16:return qi("Lazy");case 13:return qi("Suspense");case 19:return qi("SuspenseList");case 0:case 15:return s=be(s.type,!1),s;case 11:return s=be(s.type.render,!1),s;case 1:return s=be(s.type,!0),s;default:return""}}function $t(s){try{var o="";do o+=Bt(s),s=s.return;while(s);return o}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function re(s){var o=s,u=s;if(s.alternate)for(;o.return;)o=o.return;else{s=o;do o=s,(o.flags&4098)!==0&&(u=o.return),s=o.return;while(s)}return o.tag===3?u:null}function pe(s){if(s.tag===13){var o=s.memoizedState;if(o===null&&(s=s.alternate,s!==null&&(o=s.memoizedState)),o!==null)return o.dehydrated}return null}function $(s){if(re(s)!==s)throw Error(y(188))}function Ft(s){var o=s.alternate;if(!o){if(o=re(s),o===null)throw Error(y(188));return o!==s?null:s}for(var u=s,f=o;;){var g=u.return;if(g===null)break;var C=g.alternate;if(C===null){if(f=g.return,f!==null){u=f;continue}break}if(g.child===C.child){for(C=g.child;C;){if(C===u)return $(g),s;if(C===f)return $(g),o;C=C.sibling}throw Error(y(188))}if(u.return!==f.return)u=g,f=C;else{for(var k=!1,j=g.child;j;){if(j===u){k=!0,u=g,f=C;break}if(j===f){k=!0,f=g,u=C;break}j=j.sibling}if(!k){for(j=C.child;j;){if(j===u){k=!0,u=C,f=g;break}if(j===f){k=!0,f=C,u=g;break}j=j.sibling}if(!k)throw Error(y(189))}}if(u.alternate!==f)throw Error(y(190))}if(u.tag!==3)throw Error(y(188));return u.stateNode.current===u?s:o}function fe(s){var o=s.tag;if(o===5||o===26||o===27||o===6)return s;for(s=s.child;s!==null;){if(o=fe(s),o!==null)return o;s=s.sibling}return null}var _e=Array.isArray,zt=T.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,en={pending:!1,data:null,method:null,action:null},we=[],_r=-1;function Cn(s){return{current:s}}function ui(s){0>_r||(s.current=we[_r],we[_r]=null,_r--)}function Zn(s,o){_r++,we[_r]=s.current,s.current=o}var qr=Cn(null),ia=Cn(null),Oo=Cn(null),Mh=Cn(null);function Ma(s,o){switch(Zn(Oo,o),Zn(ia,s),Zn(qr,null),s=o.nodeType,s){case 9:case 11:o=(o=o.documentElement)&&(o=o.namespaceURI)?TR(o):0;break;default:if(s=s===8?o.parentNode:o,o=s.tagName,s=s.namespaceURI)s=TR(s),o=RR(s,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}ui(qr),Zn(qr,o)}function bl(){ui(qr),ui(ia),ui(Oo)}function Rm(s){s.memoizedState!==null&&Zn(Mh,s);var o=qr.current,u=RR(o,s.type);o!==u&&(Zn(ia,s),Zn(qr,u))}function Ls(s){ia.current===s&&(ui(qr),ui(ia)),Mh.current===s&&(ui(Mh),Fd._currentValue=en)}var Uh=Object.prototype.hasOwnProperty,ym=E.unstable_scheduleCallback,er=E.unstable_cancelCallback,zr=E.unstable_shouldYield,vm=E.unstable_requestPaint,cs=E.unstable_now,PC=E.unstable_getCurrentPriorityLevel,Cm=E.unstable_ImmediatePriority,nr=E.unstable_UserBlockingPriority,Ps=E.unstable_NormalPriority,SS=E.unstable_LowPriority,xh=E.unstable_IdlePriority,TS=E.log,RS=E.unstable_setDisableYieldValue,Al=null,Nr=null;function vc(s){if(Nr&&typeof Nr.onCommitFiberRoot=="function")try{Nr.onCommitFiberRoot(Al,s,void 0,(s.current.flags&128)===128)}catch{}}function Ua(s){if(typeof TS=="function"&&RS(s),Nr&&typeof Nr.setStrictMode=="function")try{Nr.setStrictMode(Al,s)}catch{}}var Xr=Math.clz32?Math.clz32:yS,kC=Math.log,Il=Math.LN2;function yS(s){return s>>>=0,s===0?32:31-(kC(s)/Il|0)|0}var Vh=128,Bh=4194304;function Cc(s){var o=s&42;if(o!==0)return o;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Fh(s,o){var u=s.pendingLanes;if(u===0)return 0;var f=0,g=s.suspendedLanes,C=s.pingedLanes,k=s.warmLanes;s=s.finishedLanes!==0;var j=u&134217727;return j!==0?(u=j&~g,u!==0?f=Cc(u):(C&=j,C!==0?f=Cc(C):s||(k=j&~k,k!==0&&(f=Cc(k))))):(j=u&~g,j!==0?f=Cc(j):C!==0?f=Cc(C):s||(k=u&~k,k!==0&&(f=Cc(k)))),f===0?0:o!==0&&o!==f&&(o&g)===0&&(g=f&-f,k=o&-o,g>=k||g===32&&(k&4194176)!==0)?o:f}function xa(s,o){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&o)===0}function MC(s,o){switch(s){case 1:case 2:case 4:case 8:return o+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bc(){var s=Vh;return Vh<<=1,(Vh&4194176)===0&&(Vh=128),s}function vS(){var s=Bh;return Bh<<=1,(Bh&62914560)===0&&(Bh=4194304),s}function bm(s){for(var o=[],u=0;31>u;u++)o.push(s);return o}function Gu(s,o){s.pendingLanes|=o,o!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Jr(s,o,u,f,g,C){var k=s.pendingLanes;s.pendingLanes=u,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=u,s.entangledLanes&=u,s.errorRecoveryDisabledLanes&=u,s.shellSuspendCounter=0;var j=s.entanglements,z=s.expirationTimes,nt=s.hiddenUpdates;for(u=k&~u;0<u;){var bt=31-Xr(u),xt=1<<bt;j[bt]=0,z[bt]=-1;var pt=nt[bt];if(pt!==null)for(nt[bt]=null,bt=0;bt<pt.length;bt++){var yt=pt[bt];yt!==null&&(yt.lane&=-536870913)}u&=~xt}f!==0&&CS(s,f,0),C!==0&&g===0&&s.tag!==0&&(s.suspendedLanes|=C&~(k&~o))}function CS(s,o,u){s.pendingLanes|=o,s.suspendedLanes&=~o;var f=31-Xr(o);s.entangledLanes|=o,s.entanglements[f]=s.entanglements[f]|1073741824|u&4194218}function bS(s,o){var u=s.entangledLanes|=o;for(s=s.entanglements;u;){var f=31-Xr(u),g=1<<f;g&o|s[f]&o&&(s[f]|=o),u&=~g}}function Hu(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function Am(){var s=zt.p;return s!==0?s:(s=window.event,s===void 0?32:BR(s.type))}function AS(s,o){var u=zt.p;try{return zt.p=s,o()}finally{zt.p=u}}var Va=Math.random().toString(36).slice(2),ir="__reactFiber$"+Va,Er="__reactProps$"+Va,Ac="__reactContainer$"+Va,Im="__reactEvents$"+Va,UC="__reactListeners$"+Va,IS="__reactHandles$"+Va,jh="__reactResources$"+Va,wl="__reactMarker$"+Va;function No(s){delete s[ir],delete s[Er],delete s[Im],delete s[UC],delete s[IS]}function Ic(s){var o=s[ir];if(o)return o;for(var u=s.parentNode;u;){if(o=u[Ac]||u[ir]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(s=CR(s);s!==null;){if(u=s[ir])return u;s=CR(s)}return o}s=u,u=s.parentNode}return null}function Ol(s){if(s=s[ir]||s[Ac]){var o=s.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return s}return null}function Dr(s){var o=s.tag;if(o===5||o===26||o===27||o===6)return s.stateNode;throw Error(y(33))}function Nl(s){var o=s[jh];return o||(o=s[jh]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function ji(s){s[wl]=!0}var di=new Set,wS={};function wc(s,o){Dl(s,o),Dl(s+"Capture",o)}function Dl(s,o){for(wS[s]=o,s=0;s<o.length;s++)di.add(o[s])}var Ba=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wm=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),OS={},Om={};function xC(s){return Uh.call(Om,s)?!0:Uh.call(OS,s)?!1:wm.test(s)?Om[s]=!0:(OS[s]=!0,!1)}function Gh(s,o,u){if(xC(o))if(u===null)s.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":s.removeAttribute(o);return;case"boolean":var f=o.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){s.removeAttribute(o);return}}s.setAttribute(o,""+u)}}function Hh(s,o,u){if(u===null)s.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(o);return}s.setAttribute(o,""+u)}}function Lr(s,o,u,f){if(f===null)s.removeAttribute(u);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(u);return}s.setAttributeNS(o,u,""+f)}}function Pr(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function NS(s){var o=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function In(s){var o=NS(s)?"checked":"value",u=Object.getOwnPropertyDescriptor(s.constructor.prototype,o),f=""+s[o];if(!s.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var g=u.get,C=u.set;return Object.defineProperty(s,o,{configurable:!0,get:function(){return g.call(this)},set:function(k){f=""+k,C.call(this,k)}}),Object.defineProperty(s,o,{enumerable:u.enumerable}),{getValue:function(){return f},setValue:function(k){f=""+k},stopTracking:function(){s._valueTracker=null,delete s[o]}}}}function Wh(s){s._valueTracker||(s._valueTracker=In(s))}function Nm(s){if(!s)return!1;var o=s._valueTracker;if(!o)return!0;var u=o.getValue(),f="";return s&&(f=NS(s)?s.checked?"true":"false":s.value),s=f,s!==u?(o.setValue(s),!0):!1}function Wu(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var VC=/[\n"\\]/g;function ls(s){return s.replace(VC,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Dm(s,o,u,f,g,C,k,j){s.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?s.type=k:s.removeAttribute("type"),o!=null?k==="number"?(o===0&&s.value===""||s.value!=o)&&(s.value=""+Pr(o)):s.value!==""+Pr(o)&&(s.value=""+Pr(o)):k!=="submit"&&k!=="reset"||s.removeAttribute("value"),o!=null?Lm(s,k,Pr(o)):u!=null?Lm(s,k,Pr(u)):f!=null&&s.removeAttribute("value"),g==null&&C!=null&&(s.defaultChecked=!!C),g!=null&&(s.checked=g&&typeof g!="function"&&typeof g!="symbol"),j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"?s.name=""+Pr(j):s.removeAttribute("name")}function DS(s,o,u,f,g,C,k,j){if(C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(s.type=C),o!=null||u!=null){if(!(C!=="submit"&&C!=="reset"||o!=null))return;u=u!=null?""+Pr(u):"",o=o!=null?""+Pr(o):u,j||o===s.value||(s.value=o),s.defaultValue=o}f=f??g,f=typeof f!="function"&&typeof f!="symbol"&&!!f,s.checked=j?s.checked:!!f,s.defaultChecked=!!f,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(s.name=k)}function Lm(s,o,u){o==="number"&&Wu(s.ownerDocument)===s||s.defaultValue===""+u||(s.defaultValue=""+u)}function Ll(s,o,u,f){if(s=s.options,o){o={};for(var g=0;g<u.length;g++)o["$"+u[g]]=!0;for(u=0;u<s.length;u++)g=o.hasOwnProperty("$"+s[u].value),s[u].selected!==g&&(s[u].selected=g),g&&f&&(s[u].defaultSelected=!0)}else{for(u=""+Pr(u),o=null,g=0;g<s.length;g++){if(s[g].value===u){s[g].selected=!0,f&&(s[g].defaultSelected=!0);return}o!==null||s[g].disabled||(o=s[g])}o!==null&&(o.selected=!0)}}function Ku(s,o,u){if(o!=null&&(o=""+Pr(o),o!==s.value&&(s.value=o),u==null)){s.defaultValue!==o&&(s.defaultValue=o);return}s.defaultValue=u!=null?""+Pr(u):""}function Pm(s,o,u,f){if(o==null){if(f!=null){if(u!=null)throw Error(y(92));if(_e(f)){if(1<f.length)throw Error(y(93));f=f[0]}u=f}u==null&&(u=""),o=u}u=Pr(o),s.defaultValue=u,f=s.textContent,f===u&&f!==""&&f!==null&&(s.value=f)}function Do(s,o){if(o){var u=s.firstChild;if(u&&u===s.lastChild&&u.nodeType===3){u.nodeValue=o;return}}s.textContent=o}var BC=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Kh(s,o,u){var f=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?f?s.setProperty(o,""):o==="float"?s.cssFloat="":s[o]="":f?s.setProperty(o,u):typeof u!="number"||u===0||BC.has(o)?o==="float"?s.cssFloat=u:s[o]=(""+u).trim():s[o]=u+"px"}function LS(s,o,u){if(o!=null&&typeof o!="object")throw Error(y(62));if(s=s.style,u!=null){for(var f in u)!u.hasOwnProperty(f)||o!=null&&o.hasOwnProperty(f)||(f.indexOf("--")===0?s.setProperty(f,""):f==="float"?s.cssFloat="":s[f]="");for(var g in o)f=o[g],o.hasOwnProperty(g)&&u[g]!==f&&Kh(s,g,f)}else for(var C in o)o.hasOwnProperty(C)&&Kh(s,C,o[C])}function Yh(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var FC=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),jC=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function qh(s){return jC.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var km=null;function Mm(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Pl=null,kl=null;function PS(s){var o=Ol(s);if(o&&(s=o.stateNode)){var u=s[Er]||null;t:switch(s=o.stateNode,o.type){case"input":if(Dm(s,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=s;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+ls(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var f=u[o];if(f!==s&&f.form===s.form){var g=f[Er]||null;if(!g)throw Error(y(90));Dm(f,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(o=0;o<u.length;o++)f=u[o],f.form===s.form&&Nm(f)}break t;case"textarea":Ku(s,u.value,u.defaultValue);break t;case"select":o=u.value,o!=null&&Ll(s,!!u.multiple,o,!1)}}}var zh=!1;function kS(s,o,u){if(zh)return s(o,u);zh=!0;try{var f=s(o);return f}finally{if(zh=!1,(Pl!==null||kl!==null)&&(qp(),Pl&&(o=Pl,s=kl,kl=Pl=null,PS(o),s)))for(o=0;o<s.length;o++)PS(s[o])}}function Yu(s,o){var u=s.stateNode;if(u===null)return null;var f=u[Er]||null;if(f===null)return null;u=f[o];t:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(s=s.type,f=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!f;break t;default:s=!1}if(s)return null;if(u&&typeof u!="function")throw Error(y(231,o,typeof u));return u}var Um=!1;if(Ba)try{var Fa={};Object.defineProperty(Fa,"passive",{get:function(){Um=!0}}),window.addEventListener("test",Fa,Fa),window.removeEventListener("test",Fa,Fa)}catch{Um=!1}var Lo=null,xm=null,Xh=null;function MS(){if(Xh)return Xh;var s,o=xm,u=o.length,f,g="value"in Lo?Lo.value:Lo.textContent,C=g.length;for(s=0;s<u&&o[s]===g[s];s++);var k=u-s;for(f=1;f<=k&&o[u-f]===g[C-f];f++);return Xh=g.slice(s,1<f?1-f:void 0)}function qu(s){var o=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&o===13&&(s=13)):s=o,s===10&&(s=13),32<=s||s===13?s:0}function Jh(){return!0}function US(){return!1}function kr(s){function o(u,f,g,C,k){this._reactName=u,this._targetInst=g,this.type=f,this.nativeEvent=C,this.target=k,this.currentTarget=null;for(var j in s)s.hasOwnProperty(j)&&(u=s[j],this[j]=u?u(C):C[j]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?Jh:US,this.isPropagationStopped=US,this}return Zt(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Jh)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Jh)},persist:function(){},isPersistent:Jh}),o}var Mr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gr=kr(Mr),Ml=Zt({},Mr,{view:0,detail:0}),GC=kr(Ml),Vm,Bm,Ci,Qh=Zt({},Ml,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Km,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Ci&&(Ci&&s.type==="mousemove"?(Vm=s.screenX-Ci.screenX,Bm=s.screenY-Ci.screenY):Bm=Vm=0,Ci=s),Vm)},movementY:function(s){return"movementY"in s?s.movementY:Bm}}),xS=kr(Qh),HC=Zt({},Qh,{dataTransfer:0}),Zh=kr(HC),VS=Zt({},Ml,{relatedTarget:0}),Fm=kr(VS),jm=Zt({},Mr,{animationName:0,elapsedTime:0,pseudoElement:0}),WC=kr(jm),Gm=Zt({},Mr,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Hm=kr(Gm),Wm=Zt({},Mr,{data:0}),BS=kr(Wm),KC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Po={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$h={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function YC(s){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(s):(s=$h[s])?!!o[s]:!1}function Km(){return YC}var qC=Zt({},Ml,{key:function(s){if(s.key){var o=KC[s.key]||s.key;if(o!=="Unidentified")return o}return s.type==="keypress"?(s=qu(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Po[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Km,charCode:function(s){return s.type==="keypress"?qu(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?qu(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),zC=kr(qC),XC=Zt({},Qh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Oc=kr(XC),JC=Zt({},Ml,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Km}),Ul=kr(JC),FS=Zt({},Mr,{propertyName:0,elapsedTime:0,pseudoElement:0}),QC=kr(FS),Ue=Zt({},Qh,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),ZC=kr(Ue),$C=Zt({},Mr,{newState:0,oldState:0}),tb=kr($C),eb=[9,13,27,32],zu=Ba&&"CompositionEvent"in window,Xu=null;Ba&&"documentMode"in document&&(Xu=document.documentMode);var nb=Ba&&"TextEvent"in window&&!Xu,jS=Ba&&(!zu||Xu&&8<Xu&&11>=Xu),tp=" ",GS=!1;function HS(s,o){switch(s){case"keyup":return eb.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ym(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var xl=!1;function ja(s,o){switch(s){case"compositionend":return Ym(o);case"keypress":return o.which!==32?null:(GS=!0,tp);case"textInput":return s=o.data,s===tp&&GS?null:s;default:return null}}function ib(s,o){if(xl)return s==="compositionend"||!zu&&HS(s,o)?(s=MS(),Xh=xm=Lo=null,xl=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return jS&&o.locale!=="ko"?null:o.data;default:return null}}var rb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function WS(s){var o=s&&s.nodeName&&s.nodeName.toLowerCase();return o==="input"?!!rb[s.type]:o==="textarea"}function qm(s,o,u,f){Pl?kl?kl.push(f):kl=[f]:Pl=f,o=Ud(o,"onChange"),0<o.length&&(u=new gr("onChange","change",null,u,f),s.push({event:u,listeners:o}))}var Nc=null,Ju=null;function sb(s){SR(s,0)}function Sr(s){var o=Dr(s);if(Nm(o))return s}function KS(s,o){if(s==="change")return o}var YS=!1;if(Ba){var zm;if(Ba){var Xm="oninput"in document;if(!Xm){var Jm=document.createElement("div");Jm.setAttribute("oninput","return;"),Xm=typeof Jm.oninput=="function"}zm=Xm}else zm=!1;YS=zm&&(!document.documentMode||9<document.documentMode)}function qS(){Nc&&(Nc.detachEvent("onpropertychange",zS),Ju=Nc=null)}function zS(s){if(s.propertyName==="value"&&Sr(Ju)){var o=[];qm(o,Ju,s,Mm(s)),kS(sb,o)}}function XS(s,o,u){s==="focusin"?(qS(),Nc=o,Ju=u,Nc.attachEvent("onpropertychange",zS)):s==="focusout"&&qS()}function Qm(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Sr(Ju)}function ab(s,o){if(s==="click")return Sr(o)}function ob(s,o){if(s==="input"||s==="change")return Sr(o)}function ep(s,o){return s===o&&(s!==0||1/s===1/o)||s!==s&&o!==o}var Qr=typeof Object.is=="function"?Object.is:ep;function Qu(s,o){if(Qr(s,o))return!0;if(typeof s!="object"||s===null||typeof o!="object"||o===null)return!1;var u=Object.keys(s),f=Object.keys(o);if(u.length!==f.length)return!1;for(f=0;f<u.length;f++){var g=u[f];if(!Uh.call(o,g)||!Qr(s[g],o[g]))return!1}return!0}function JS(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function ks(s,o){var u=JS(s);s=0;for(var f;u;){if(u.nodeType===3){if(f=s+u.textContent.length,s<=o&&f>=o)return{node:u,offset:o-s};s=f}t:{for(;u;){if(u.nextSibling){u=u.nextSibling;break t}u=u.parentNode}u=void 0}u=JS(u)}}function QS(s,o){return s&&o?s===o?!0:s&&s.nodeType===3?!1:o&&o.nodeType===3?QS(s,o.parentNode):"contains"in s?s.contains(o):s.compareDocumentPosition?!!(s.compareDocumentPosition(o)&16):!1:!1}function ZS(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var o=Wu(s.document);o instanceof s.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)s=o.contentWindow;else break;o=Wu(s.document)}return o}function Tr(s){var o=s&&s.nodeName&&s.nodeName.toLowerCase();return o&&(o==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||o==="textarea"||s.contentEditable==="true")}function cb(s,o){var u=ZS(o);o=s.focusedElem;var f=s.selectionRange;if(u!==o&&o&&o.ownerDocument&&QS(o.ownerDocument.documentElement,o)){if(f!==null&&Tr(o)){if(s=f.start,u=f.end,u===void 0&&(u=s),"selectionStart"in o)o.selectionStart=s,o.selectionEnd=Math.min(u,o.value.length);else if(u=(s=o.ownerDocument||document)&&s.defaultView||window,u.getSelection){u=u.getSelection();var g=o.textContent.length,C=Math.min(f.start,g);f=f.end===void 0?C:Math.min(f.end,g),!u.extend&&C>f&&(g=f,f=C,C=g),g=ks(o,C);var k=ks(o,f);g&&k&&(u.rangeCount!==1||u.anchorNode!==g.node||u.anchorOffset!==g.offset||u.focusNode!==k.node||u.focusOffset!==k.offset)&&(s=s.createRange(),s.setStart(g.node,g.offset),u.removeAllRanges(),C>f?(u.addRange(s),u.extend(k.node,k.offset)):(s.setEnd(k.node,k.offset),u.addRange(s)))}}for(s=[],u=o;u=u.parentNode;)u.nodeType===1&&s.push({element:u,left:u.scrollLeft,top:u.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<s.length;o++)u=s[o],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}}var lb=Ba&&"documentMode"in document&&11>=document.documentMode,Vl=null,Zm=null,Bl=null,$m=!1;function $S(s,o,u){var f=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;$m||Vl==null||Vl!==Wu(f)||(f=Vl,"selectionStart"in f&&Tr(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Bl&&Qu(Bl,f)||(Bl=f,f=Ud(Zm,"onSelect"),0<f.length&&(o=new gr("onSelect","select",null,o,u),s.push({event:o,listeners:f}),o.target=Vl)))}function Dc(s,o){var u={};return u[s.toLowerCase()]=o.toLowerCase(),u["Webkit"+s]="webkit"+o,u["Moz"+s]="moz"+o,u}var Lc={animationend:Dc("Animation","AnimationEnd"),animationiteration:Dc("Animation","AnimationIteration"),animationstart:Dc("Animation","AnimationStart"),transitionrun:Dc("Transition","TransitionRun"),transitionstart:Dc("Transition","TransitionStart"),transitioncancel:Dc("Transition","TransitionCancel"),transitionend:Dc("Transition","TransitionEnd")},t_={},tT={};Ba&&(tT=document.createElement("div").style,"AnimationEvent"in window||(delete Lc.animationend.animation,delete Lc.animationiteration.animation,delete Lc.animationstart.animation),"TransitionEvent"in window||delete Lc.transitionend.transition);function Ga(s){if(t_[s])return t_[s];if(!Lc[s])return s;var o=Lc[s],u;for(u in o)if(o.hasOwnProperty(u)&&u in tT)return t_[s]=o[u];return s}var np=Ga("animationend"),eT=Ga("animationiteration"),_t=Ga("animationstart"),ub=Ga("transitionrun"),db=Ga("transitionstart"),hb=Ga("transitioncancel"),nT=Ga("transitionend"),iT=new Map,rT="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function Ms(s,o){iT.set(s,o),wc(o,[s])}var us=[],Ha=0,ko=0;function ip(){for(var s=Ha,o=ko=Ha=0;o<s;){var u=us[o];us[o++]=null;var f=us[o];us[o++]=null;var g=us[o];us[o++]=null;var C=us[o];if(us[o++]=null,f!==null&&g!==null){var k=f.pending;k===null?g.next=g:(g.next=k.next,k.next=g),f.pending=g}C!==0&&sp(u,g,C)}}function rp(s,o,u,f){us[Ha++]=s,us[Ha++]=o,us[Ha++]=u,us[Ha++]=f,ko|=f,s.lanes|=f,s=s.alternate,s!==null&&(s.lanes|=f)}function e_(s,o,u,f){return rp(s,o,u,f),ap(s)}function Mo(s,o){return rp(s,null,null,o),ap(s)}function sp(s,o,u){s.lanes|=u;var f=s.alternate;f!==null&&(f.lanes|=u);for(var g=!1,C=s.return;C!==null;)C.childLanes|=u,f=C.alternate,f!==null&&(f.childLanes|=u),C.tag===22&&(s=C.stateNode,s===null||s._visibility&1||(g=!0)),s=C,C=C.return;g&&o!==null&&s.tag===3&&(C=s.stateNode,g=31-Xr(u),C=C.hiddenUpdates,s=C[g],s===null?C[g]=[o]:s.push(o),o.lane=u|536870912)}function ap(s){if(50<Xc)throw Xc=0,nu=null,Error(y(185));for(var o=s.return;o!==null;)s=o,o=s.return;return s.tag===3?s.stateNode:null}var Pc={},ds=new WeakMap;function hs(s,o){if(typeof s=="object"&&s!==null){var u=ds.get(s);return u!==void 0?u:(o={value:s,source:o,stack:$t(o)},ds.set(s,o),o)}return{value:s,source:o,stack:$t(o)}}var ra=[],Fl=0,op=null,cp=0,Zr=[],ps=0,kc=null,Wa=1,Us="";function Mc(s,o){ra[Fl++]=cp,ra[Fl++]=op,op=s,cp=o}function n_(s,o,u){Zr[ps++]=Wa,Zr[ps++]=Us,Zr[ps++]=kc,kc=s;var f=Wa;s=Us;var g=32-Xr(f)-1;f&=~(1<<g),u+=1;var C=32-Xr(o)+g;if(30<C){var k=g-g%5;C=(f&(1<<k)-1).toString(32),f>>=k,g-=k,Wa=1<<32-Xr(o)+g|u<<g|f,Us=C+s}else Wa=1<<C|u<<g|f,Us=s}function lp(s){s.return!==null&&(Mc(s,1),n_(s,1,0))}function i_(s){for(;s===op;)op=ra[--Fl],ra[Fl]=null,cp=ra[--Fl],ra[Fl]=null;for(;s===kc;)kc=Zr[--ps],Zr[ps]=null,Us=Zr[--ps],Zr[ps]=null,Wa=Zr[--ps],Zr[ps]=null}var rr=null,bi=null,fn=!1,xs=null,sa=!1,r_=Error(y(519));function Uc(s){var o=Error(y(418,""));throw $u(hs(o,s)),r_}function s_(s){var o=s.stateNode,u=s.type,f=s.memoizedProps;switch(o[ir]=s,o[Er]=f,u){case"dialog":an("cancel",o),an("close",o);break;case"iframe":case"object":case"embed":an("load",o);break;case"video":case"audio":for(u=0;u<$c.length;u++)an($c[u],o);break;case"source":an("error",o);break;case"img":case"image":case"link":an("error",o),an("load",o);break;case"details":an("toggle",o);break;case"input":an("invalid",o),DS(o,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0),Wh(o);break;case"select":an("invalid",o);break;case"textarea":an("invalid",o),Pm(o,f.value,f.defaultValue,f.children),Wh(o)}u=f.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||f.suppressHydrationWarning===!0||wE(o.textContent,u)?(f.popover!=null&&(an("beforetoggle",o),an("toggle",o)),f.onScroll!=null&&an("scroll",o),f.onScrollEnd!=null&&an("scrollend",o),f.onClick!=null&&(o.onclick=rf),o=!0):o=!1,o||Uc(s)}function up(s){for(rr=s.return;rr;)switch(rr.tag){case 3:case 27:sa=!0;return;case 5:case 13:sa=!1;return;default:rr=rr.return}}function Zu(s){if(s!==rr)return!1;if(!fn)return up(s),fn=!0,!1;var o=!1,u;if((u=s.tag!==3&&s.tag!==27)&&((u=s.tag===5)&&(u=s.type,u=!(u!=="form"&&u!=="button")||LE(s.type,s.memoizedProps)),u=!u),u&&(o=!0),o&&bi&&Uc(s),up(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(y(317));t:{for(s=s.nextSibling,o=0;s;){if(s.nodeType===8)if(u=s.data,u==="/$"){if(o===0){bi=Es(s.nextSibling);break t}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++;s=s.nextSibling}bi=null}}else bi=rr?Es(s.stateNode.nextSibling):null;return!0}function xc(){bi=rr=null,fn=!1}function $u(s){xs===null?xs=[s]:xs.push(s)}var td=Error(y(460)),sT=Error(y(474)),a_={then:function(){}};function aT(s){return s=s.status,s==="fulfilled"||s==="rejected"}function dp(){}function oT(s,o,u){switch(u=s[u],u===void 0?s.push(o):u!==o&&(o.then(dp,dp),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw s=o.reason,s===td?Error(y(483)):s;default:if(typeof o.status=="string")o.then(dp,dp);else{if(s=Ln,s!==null&&100<s.shellSuspendCounter)throw Error(y(482));s=o,s.status="pending",s.then(function(f){if(o.status==="pending"){var g=o;g.status="fulfilled",g.value=f}},function(f){if(o.status==="pending"){var g=o;g.status="rejected",g.reason=f}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw s=o.reason,s===td?Error(y(483)):s}throw ed=o,td}}var ed=null;function cT(){if(ed===null)throw Error(y(459));var s=ed;return ed=null,s}var Ka=null,Uo=0;function jl(s){var o=Uo;return Uo+=1,Ka===null&&(Ka=[]),oT(Ka,s,o)}function nd(s,o){o=o.props.ref,s.ref=o!==void 0?o:null}function hp(s,o){throw o.$$typeof===M?Error(y(525)):(s=Object.prototype.toString.call(o),Error(y(31,s==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":s)))}function lT(s){var o=s._init;return o(s._payload)}function o_(s){function o(ot,et){if(s){var ut=ot.deletions;ut===null?(ot.deletions=[et],ot.flags|=16):ut.push(et)}}function u(ot,et){if(!s)return null;for(;et!==null;)o(ot,et),et=et.sibling;return null}function f(ot){for(var et=new Map;ot!==null;)ot.key!==null?et.set(ot.key,ot):et.set(ot.index,ot),ot=ot.sibling;return et}function g(ot,et){return ot=so(ot,et),ot.index=0,ot.sibling=null,ot}function C(ot,et,ut){return ot.index=ut,s?(ut=ot.alternate,ut!==null?(ut=ut.index,ut<et?(ot.flags|=33554434,et):ut):(ot.flags|=33554434,et)):(ot.flags|=1048576,et)}function k(ot){return s&&ot.alternate===null&&(ot.flags|=33554434),ot}function j(ot,et,ut,Nt){return et===null||et.tag!==6?(et=lE(ut,ot.mode,Nt),et.return=ot,et):(et=g(et,ut),et.return=ot,et)}function z(ot,et,ut,Nt){var ne=ut.type;return ne===Y?bt(ot,et,ut.props.children,Nt,ut.key):et!==null&&(et.elementType===ne||typeof ne=="object"&&ne!==null&&ne.$$typeof===Gt&&lT(ne)===et.type)?(et=g(et,ut.props),nd(et,ut),et.return=ot,et):(et=Bp(ut.type,ut.key,ut.props,null,ot.mode,Nt),nd(et,ut),et.return=ot,et)}function nt(ot,et,ut,Nt){return et===null||et.tag!==4||et.stateNode.containerInfo!==ut.containerInfo||et.stateNode.implementation!==ut.implementation?(et=uE(ut,ot.mode,Nt),et.return=ot,et):(et=g(et,ut.children||[]),et.return=ot,et)}function bt(ot,et,ut,Nt,ne){return et===null||et.tag!==7?(et=qo(ut,ot.mode,Nt,ne),et.return=ot,et):(et=g(et,ut),et.return=ot,et)}function xt(ot,et,ut){if(typeof et=="string"&&et!==""||typeof et=="number"||typeof et=="bigint")return et=lE(""+et,ot.mode,ut),et.return=ot,et;if(typeof et=="object"&&et!==null){switch(et.$$typeof){case B:return ut=Bp(et.type,et.key,et.props,null,ot.mode,ut),nd(ut,et),ut.return=ot,ut;case q:return et=uE(et,ot.mode,ut),et.return=ot,et;case Gt:var Nt=et._init;return et=Nt(et._payload),xt(ot,et,ut)}if(_e(et)||$e(et))return et=qo(et,ot.mode,ut,null),et.return=ot,et;if(typeof et.then=="function")return xt(ot,jl(et),ut);if(et.$$typeof===Mt)return xt(ot,Sd(ot,et),ut);hp(ot,et)}return null}function pt(ot,et,ut,Nt){var ne=et!==null?et.key:null;if(typeof ut=="string"&&ut!==""||typeof ut=="number"||typeof ut=="bigint")return ne!==null?null:j(ot,et,""+ut,Nt);if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case B:return ut.key===ne?z(ot,et,ut,Nt):null;case q:return ut.key===ne?nt(ot,et,ut,Nt):null;case Gt:return ne=ut._init,ut=ne(ut._payload),pt(ot,et,ut,Nt)}if(_e(ut)||$e(ut))return ne!==null?null:bt(ot,et,ut,Nt,null);if(typeof ut.then=="function")return pt(ot,et,jl(ut),Nt);if(ut.$$typeof===Mt)return pt(ot,et,Sd(ot,ut),Nt);hp(ot,ut)}return null}function yt(ot,et,ut,Nt,ne){if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number"||typeof Nt=="bigint")return ot=ot.get(ut)||null,j(et,ot,""+Nt,ne);if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case B:return ot=ot.get(Nt.key===null?ut:Nt.key)||null,z(et,ot,Nt,ne);case q:return ot=ot.get(Nt.key===null?ut:Nt.key)||null,nt(et,ot,Nt,ne);case Gt:var me=Nt._init;return Nt=me(Nt._payload),yt(ot,et,ut,Nt,ne)}if(_e(Nt)||$e(Nt))return ot=ot.get(ut)||null,bt(et,ot,Nt,ne,null);if(typeof Nt.then=="function")return yt(ot,et,ut,jl(Nt),ne);if(Nt.$$typeof===Mt)return yt(ot,et,ut,Sd(et,Nt),ne);hp(et,Nt)}return null}function se(ot,et,ut,Nt){for(var ne=null,me=null,oe=et,Ee=et=0,wi=null;oe!==null&&Ee<ut.length;Ee++){oe.index>Ee?(wi=oe,oe=null):wi=oe.sibling;var mn=pt(ot,oe,ut[Ee],Nt);if(mn===null){oe===null&&(oe=wi);break}s&&oe&&mn.alternate===null&&o(ot,oe),et=C(mn,et,Ee),me===null?ne=mn:me.sibling=mn,me=mn,oe=wi}if(Ee===ut.length)return u(ot,oe),fn&&Mc(ot,Ee),ne;if(oe===null){for(;Ee<ut.length;Ee++)oe=xt(ot,ut[Ee],Nt),oe!==null&&(et=C(oe,et,Ee),me===null?ne=oe:me.sibling=oe,me=oe);return fn&&Mc(ot,Ee),ne}for(oe=f(oe);Ee<ut.length;Ee++)wi=yt(oe,ot,Ee,ut[Ee],Nt),wi!==null&&(s&&wi.alternate!==null&&oe.delete(wi.key===null?Ee:wi.key),et=C(wi,et,Ee),me===null?ne=wi:me.sibling=wi,me=wi);return s&&oe.forEach(function(is){return o(ot,is)}),fn&&Mc(ot,Ee),ne}function Le(ot,et,ut,Nt){if(ut==null)throw Error(y(151));for(var ne=null,me=null,oe=et,Ee=et=0,wi=null,mn=ut.next();oe!==null&&!mn.done;Ee++,mn=ut.next()){oe.index>Ee?(wi=oe,oe=null):wi=oe.sibling;var is=pt(ot,oe,mn.value,Nt);if(is===null){oe===null&&(oe=wi);break}s&&oe&&is.alternate===null&&o(ot,oe),et=C(is,et,Ee),me===null?ne=is:me.sibling=is,me=is,oe=wi}if(mn.done)return u(ot,oe),fn&&Mc(ot,Ee),ne;if(oe===null){for(;!mn.done;Ee++,mn=ut.next())mn=xt(ot,mn.value,Nt),mn!==null&&(et=C(mn,et,Ee),me===null?ne=mn:me.sibling=mn,me=mn);return fn&&Mc(ot,Ee),ne}for(oe=f(oe);!mn.done;Ee++,mn=ut.next())mn=yt(oe,ot,Ee,mn.value,Nt),mn!==null&&(s&&mn.alternate!==null&&oe.delete(mn.key===null?Ee:mn.key),et=C(mn,et,Ee),me===null?ne=mn:me.sibling=mn,me=mn);return s&&oe.forEach(function(Zb){return o(ot,Zb)}),fn&&Mc(ot,Ee),ne}function ti(ot,et,ut,Nt){if(typeof ut=="object"&&ut!==null&&ut.type===Y&&ut.key===null&&(ut=ut.props.children),typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case B:t:{for(var ne=ut.key;et!==null;){if(et.key===ne){if(ne=ut.type,ne===Y){if(et.tag===7){u(ot,et.sibling),Nt=g(et,ut.props.children),Nt.return=ot,ot=Nt;break t}}else if(et.elementType===ne||typeof ne=="object"&&ne!==null&&ne.$$typeof===Gt&&lT(ne)===et.type){u(ot,et.sibling),Nt=g(et,ut.props),nd(Nt,ut),Nt.return=ot,ot=Nt;break t}u(ot,et);break}else o(ot,et);et=et.sibling}ut.type===Y?(Nt=qo(ut.props.children,ot.mode,Nt,ut.key),Nt.return=ot,ot=Nt):(Nt=Bp(ut.type,ut.key,ut.props,null,ot.mode,Nt),nd(Nt,ut),Nt.return=ot,ot=Nt)}return k(ot);case q:t:{for(ne=ut.key;et!==null;){if(et.key===ne)if(et.tag===4&&et.stateNode.containerInfo===ut.containerInfo&&et.stateNode.implementation===ut.implementation){u(ot,et.sibling),Nt=g(et,ut.children||[]),Nt.return=ot,ot=Nt;break t}else{u(ot,et);break}else o(ot,et);et=et.sibling}Nt=uE(ut,ot.mode,Nt),Nt.return=ot,ot=Nt}return k(ot);case Gt:return ne=ut._init,ut=ne(ut._payload),ti(ot,et,ut,Nt)}if(_e(ut))return se(ot,et,ut,Nt);if($e(ut)){if(ne=$e(ut),typeof ne!="function")throw Error(y(150));return ut=ne.call(ut),Le(ot,et,ut,Nt)}if(typeof ut.then=="function")return ti(ot,et,jl(ut),Nt);if(ut.$$typeof===Mt)return ti(ot,et,Sd(ot,ut),Nt);hp(ot,ut)}return typeof ut=="string"&&ut!==""||typeof ut=="number"||typeof ut=="bigint"?(ut=""+ut,et!==null&&et.tag===6?(u(ot,et.sibling),Nt=g(et,ut),Nt.return=ot,ot=Nt):(u(ot,et),Nt=lE(ut,ot.mode,Nt),Nt.return=ot,ot=Nt),k(ot)):u(ot,et)}return function(ot,et,ut,Nt){try{Uo=0;var ne=ti(ot,et,ut,Nt);return Ka=null,ne}catch(oe){if(oe===td)throw oe;var me=es(29,oe,null,ot.mode);return me.lanes=Nt,me.return=ot,me}finally{}}}var xo=o_(!0),pp=o_(!1),Gl=Cn(null),fp=Cn(0);function Hl(s,o){s=Hs,Zn(fp,s),Zn(Gl,o),Hs=s|o.baseLanes}function c_(){Zn(fp,Hs),Zn(Gl,Gl.current)}function l_(){Hs=fp.current,ui(Gl),ui(fp)}var fs=Cn(null),aa=null;function Vo(s){var o=s.alternate;Zn(Mi,Mi.current&1),Zn(fs,s),aa===null&&(o===null||Gl.current!==null||o.memoizedState!==null)&&(aa=s)}function uT(s){if(s.tag===22){if(Zn(Mi,Mi.current),Zn(fs,s),aa===null){var o=s.alternate;o!==null&&o.memoizedState!==null&&(aa=s)}}else Ya()}function Ya(){Zn(Mi,Mi.current),Zn(fs,fs.current)}function qa(s){ui(fs),aa===s&&(aa=null),ui(Mi)}var Mi=Cn(0);function mp(s){for(var o=s;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var u_=typeof AbortController<"u"?AbortController:function(){var s=[],o=this.signal={aborted:!1,addEventListener:function(u,f){s.push(f)}};this.abort=function(){o.aborted=!0,s.forEach(function(u){return u()})}},pb=E.unstable_scheduleCallback,fb=E.unstable_NormalPriority,hi={$$typeof:Mt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function d_(){return{controller:new u_,data:new Map,refCount:0}}function id(s){s.refCount--,s.refCount===0&&pb(fb,function(){s.controller.abort()})}var rd=null,h_=0,Wl=0,Kl=null;function _p(s,o){if(rd===null){var u=rd=[];h_=0,Wl=yE(),Kl={status:"pending",value:void 0,then:function(f){u.push(f)}}}return h_++,o.then(p_,p_),o}function p_(){if(--h_===0&&rd!==null){Kl!==null&&(Kl.status="fulfilled");var s=rd;rd=null,Wl=0,Kl=null;for(var o=0;o<s.length;o++)(0,s[o])()}}function mb(s,o){var u=[],f={status:"pending",value:null,reason:null,then:function(g){u.push(g)}};return s.then(function(){f.status="fulfilled",f.value=o;for(var g=0;g<u.length;g++)(0,u[g])(o)},function(g){for(f.status="rejected",f.reason=g,g=0;g<u.length;g++)(0,u[g])(void 0)}),f}var dT=Pt.S;Pt.S=function(s,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&_p(s,o),dT!==null&&dT(s,o)};var Bo=Cn(null);function f_(){var s=Bo.current;return s!==null?s:Ln.pooledCache}function Ep(s,o){o===null?Zn(Bo,Bo.current):Zn(Bo,o.pool)}function hT(){var s=f_();return s===null?null:{parent:hi._currentValue,pool:s}}var oa=0,Ve=null,wn=null,pi=null,sd=!1,Vc=!1,ca=!1,Fo=0,ad=0,Yl=null,pT=0;function Ei(){throw Error(y(321))}function m_(s,o){if(o===null)return!1;for(var u=0;u<o.length&&u<s.length;u++)if(!Qr(s[u],o[u]))return!1;return!0}function gp(s,o,u,f,g,C){return oa=C,Ve=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Pt.H=s===null||s.memoizedState===null?Bc:jo,ca=!1,C=u(f,g),ca=!1,Vc&&(C=mT(o,u,f,g)),fT(s),C}function fT(s){Pt.H=Vs;var o=wn!==null&&wn.next!==null;if(oa=0,pi=wn=Ve=null,sd=!1,ad=0,Yl=null,o)throw Error(y(300));s===null||Ui||(s=s.dependencies,s!==null&&kp(s)&&(Ui=!0))}function mT(s,o,u,f){Ve=s;var g=0;do{if(Vc&&(Yl=null),ad=0,Vc=!1,25<=g)throw Error(y(301));if(g+=1,pi=wn=null,s.updateQueue!=null){var C=s.updateQueue;C.lastEffect=null,C.events=null,C.stores=null,C.memoCache!=null&&(C.memoCache.index=0)}Pt.H=Ja,C=o(u,f)}while(Vc);return C}function _b(){var s=Pt.H,o=s.useState()[0];return o=typeof o.then=="function"?od(o):o,s=s.useState()[0],(wn!==null?wn.memoizedState:null)!==s&&(Ve.flags|=1024),o}function __(){var s=Fo!==0;return Fo=0,s}function E_(s,o,u){o.updateQueue=s.updateQueue,o.flags&=-2053,s.lanes&=~u}function g_(s){if(sd){for(s=s.memoizedState;s!==null;){var o=s.queue;o!==null&&(o.pending=null),s=s.next}sd=!1}oa=0,pi=wn=Ve=null,Vc=!1,ad=Fo=0,Yl=null}function Rr(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pi===null?Ve.memoizedState=pi=s:pi=pi.next=s,pi}function Hn(){if(wn===null){var s=Ve.alternate;s=s!==null?s.memoizedState:null}else s=wn.next;var o=pi===null?Ve.memoizedState:pi.next;if(o!==null)pi=o,wn=s;else{if(s===null)throw Ve.alternate===null?Error(y(467)):Error(y(310));wn=s,s={memoizedState:wn.memoizedState,baseState:wn.baseState,baseQueue:wn.baseQueue,queue:wn.queue,next:null},pi===null?Ve.memoizedState=pi=s:pi=pi.next=s}return pi}var Sp;Sp=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function od(s){var o=ad;return ad+=1,Yl===null&&(Yl=[]),s=oT(Yl,s,o),o=Ve,(pi===null?o.memoizedState:pi.next)===null&&(o=o.alternate,Pt.H=o===null||o.memoizedState===null?Bc:jo),s}function Tp(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return od(s);if(s.$$typeof===Mt)return zi(s)}throw Error(y(438,String(s)))}function Rp(s){var o=null,u=Ve.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var f=Ve.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(o={data:f.data.map(function(g){return g.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=Sp(),Ve.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(s),f=0;f<s;f++)u[f]=Ce;return o.index++,u}function za(s,o){return typeof o=="function"?o(s):o}function cd(s){var o=Hn();return S_(o,wn,s)}function S_(s,o,u){var f=s.queue;if(f===null)throw Error(y(311));f.lastRenderedReducer=u;var g=s.baseQueue,C=f.pending;if(C!==null){if(g!==null){var k=g.next;g.next=C.next,C.next=k}o.baseQueue=g=C,f.pending=null}if(C=s.baseState,g===null)s.memoizedState=C;else{o=g.next;var j=k=null,z=null,nt=o,bt=!1;do{var xt=nt.lane&-536870913;if(xt!==nt.lane?(sn&xt)===xt:(oa&xt)===xt){var pt=nt.revertLane;if(pt===0)z!==null&&(z=z.next={lane:0,revertLane:0,action:nt.action,hasEagerState:nt.hasEagerState,eagerState:nt.eagerState,next:null}),xt===Wl&&(bt=!0);else if((oa&pt)===pt){nt=nt.next,pt===Wl&&(bt=!0);continue}else xt={lane:0,revertLane:nt.revertLane,action:nt.action,hasEagerState:nt.hasEagerState,eagerState:nt.eagerState,next:null},z===null?(j=z=xt,k=C):z=z.next=xt,Ve.lanes|=pt,ao|=pt;xt=nt.action,ca&&u(C,xt),C=nt.hasEagerState?nt.eagerState:u(C,xt)}else pt={lane:xt,revertLane:nt.revertLane,action:nt.action,hasEagerState:nt.hasEagerState,eagerState:nt.eagerState,next:null},z===null?(j=z=pt,k=C):z=z.next=pt,Ve.lanes|=xt,ao|=xt;nt=nt.next}while(nt!==null&&nt!==o);if(z===null?k=C:z.next=j,!Qr(C,s.memoizedState)&&(Ui=!0,bt&&(u=Kl,u!==null)))throw u;s.memoizedState=C,s.baseState=k,s.baseQueue=z,f.lastRenderedState=C}return g===null&&(f.lanes=0),[s.memoizedState,f.dispatch]}function T_(s){var o=Hn(),u=o.queue;if(u===null)throw Error(y(311));u.lastRenderedReducer=s;var f=u.dispatch,g=u.pending,C=o.memoizedState;if(g!==null){u.pending=null;var k=g=g.next;do C=s(C,k.action),k=k.next;while(k!==g);Qr(C,o.memoizedState)||(Ui=!0),o.memoizedState=C,o.baseQueue===null&&(o.baseState=C),u.lastRenderedState=C}return[C,f]}function _T(s,o,u){var f=Ve,g=Hn(),C=fn;if(C){if(u===void 0)throw Error(y(407));u=u()}else u=o();var k=!Qr((wn||g).memoizedState,u);if(k&&(g.memoizedState=u,Ui=!0),g=g.queue,Cp(gT.bind(null,f,g,s),[s]),g.getSnapshot!==o||k||pi!==null&&pi.memoizedState.tag&1){if(f.flags|=2048,ql(9,ET.bind(null,f,g,u,o),{destroy:void 0},null),Ln===null)throw Error(y(349));C||(oa&60)!==0||ld(f,o,u)}return u}function ld(s,o,u){s.flags|=16384,s={getSnapshot:o,value:u},o=Ve.updateQueue,o===null?(o=Sp(),Ve.updateQueue=o,o.stores=[s]):(u=o.stores,u===null?o.stores=[s]:u.push(s))}function ET(s,o,u,f){o.value=u,o.getSnapshot=f,ST(o)&&TT(s)}function gT(s,o,u){return u(function(){ST(o)&&TT(s)})}function ST(s){var o=s.getSnapshot;s=s.value;try{var u=o();return!Qr(s,u)}catch{return!0}}function TT(s){var o=Mo(s,2);o!==null&&Ii(o,s,2)}function R_(s){var o=Rr();if(typeof s=="function"){var u=s;if(s=u(),ca){Ua(!0);try{u()}finally{Ua(!1)}}}return o.memoizedState=o.baseState=s,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:za,lastRenderedState:s},o}function RT(s,o,u,f){return s.baseState=u,S_(s,wn,typeof f=="function"?f:za)}function y_(s,o,u,f,g){if(wp(s))throw Error(y(485));if(s=o.action,s!==null){var C={payload:g,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){C.listeners.push(k)}};Pt.T!==null?u(!0):C.isTransition=!1,f(C),u=o.pending,u===null?(C.next=o.pending=C,yT(o,C)):(C.next=u.next,o.pending=u.next=C)}}function yT(s,o){var u=o.action,f=o.payload,g=s.state;if(o.isTransition){var C=Pt.T,k={};Pt.T=k;try{var j=u(g,f),z=Pt.S;z!==null&&z(k,j),v_(s,o,j)}catch(nt){yp(s,o,nt)}finally{Pt.T=C}}else try{C=u(g,f),v_(s,o,C)}catch(nt){yp(s,o,nt)}}function v_(s,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(f){vT(s,o,f)},function(f){return yp(s,o,f)}):vT(s,o,u)}function vT(s,o,u){o.status="fulfilled",o.value=u,CT(o),s.state=u,o=s.pending,o!==null&&(u=o.next,u===o?s.pending=null:(u=u.next,o.next=u,yT(s,u)))}function yp(s,o,u){var f=s.pending;if(s.pending=null,f!==null){f=f.next;do o.status="rejected",o.reason=u,CT(o),o=o.next;while(o!==f)}s.action=null}function CT(s){s=s.listeners;for(var o=0;o<s.length;o++)(0,s[o])()}function bT(s,o){return o}function AT(s,o){if(fn){var u=Ln.formState;if(u!==null){t:{var f=Ve;if(fn){if(bi){e:{for(var g=bi,C=sa;g.nodeType!==8;){if(!C){g=null;break e}if(g=Es(g.nextSibling),g===null){g=null;break e}}C=g.data,g=C==="F!"||C==="F"?g:null}if(g){bi=Es(g.nextSibling),f=g.data==="F!";break t}}Uc(f)}f=!1}f&&(o=u[0])}}return u=Rr(),u.memoizedState=u.baseState=o,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:bT,lastRenderedState:o},u.queue=f,u=fd.bind(null,Ve,f),f.dispatch=u,f=R_(!1),C=Jl.bind(null,Ve,!1,f.queue),f=Rr(),g={state:o,dispatch:null,action:s,pending:null},f.queue=g,u=y_.bind(null,Ve,g,C,u),g.dispatch=u,f.memoizedState=s,[o,u,!1]}function IT(s){var o=Hn();return wT(o,wn,s)}function wT(s,o,u){o=S_(s,o,bT)[0],s=cd(za)[0],o=typeof o=="object"&&o!==null&&typeof o.then=="function"?od(o):o;var f=Hn(),g=f.queue,C=g.dispatch;return u!==f.memoizedState&&(Ve.flags|=2048,ql(9,Eb.bind(null,g,u),{destroy:void 0},null)),[o,C,s]}function Eb(s,o){s.action=o}function C_(s){var o=Hn(),u=wn;if(u!==null)return wT(o,u,s);Hn(),o=o.memoizedState,u=Hn();var f=u.queue.dispatch;return u.memoizedState=s,[o,f,!1]}function ql(s,o,u,f){return s={tag:s,create:o,inst:u,deps:f,next:null},o=Ve.updateQueue,o===null&&(o=Sp(),Ve.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=s.next=s:(f=u.next,u.next=s,s.next=f,o.lastEffect=s),s}function OT(){return Hn().memoizedState}function ud(s,o,u,f){var g=Rr();Ve.flags|=s,g.memoizedState=ql(1|o,u,{destroy:void 0},f===void 0?null:f)}function vp(s,o,u,f){var g=Hn();f=f===void 0?null:f;var C=g.memoizedState.inst;wn!==null&&f!==null&&m_(f,wn.memoizedState.deps)?g.memoizedState=ql(o,u,C,f):(Ve.flags|=s,g.memoizedState=ql(1|o,u,C,f))}function dd(s,o){ud(8390656,8,s,o)}function Cp(s,o){vp(2048,8,s,o)}function zl(s,o){return vp(4,2,s,o)}function NT(s,o){return vp(4,4,s,o)}function DT(s,o){if(typeof o=="function"){s=s();var u=o(s);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return s=s(),o.current=s,function(){o.current=null}}function LT(s,o,u){u=u!=null?u.concat([s]):null,vp(4,4,DT.bind(null,o,s),u)}function b_(){}function hd(s,o){var u=Hn();o=o===void 0?null:o;var f=u.memoizedState;return o!==null&&m_(o,f[1])?f[0]:(u.memoizedState=[s,o],s)}function PT(s,o){var u=Hn();o=o===void 0?null:o;var f=u.memoizedState;if(o!==null&&m_(o,f[1]))return f[0];if(f=s(),ca){Ua(!0);try{s()}finally{Ua(!1)}}return u.memoizedState=[f,o],f}function bp(s,o,u){return u===void 0||(oa&1073741824)!==0?s.memoizedState=o:(s.memoizedState=u,s=fE(),Ve.lanes|=s,ao|=s,u)}function Ap(s,o,u,f){return Qr(u,o)?u:Gl.current!==null?(s=bp(s,u,f),Qr(s,o)||(Ui=!0),s):(oa&42)===0?(Ui=!0,s.memoizedState=u):(s=fE(),Ve.lanes|=s,ao|=s,o)}function Ip(s,o,u,f,g){var C=zt.p;zt.p=C!==0&&8>C?C:8;var k=Pt.T,j={};Pt.T=j,Jl(s,!1,o,u);try{var z=g(),nt=Pt.S;if(nt!==null&&nt(j,z),z!==null&&typeof z=="object"&&typeof z.then=="function"){var bt=mb(z,f);Xa(s,o,bt,cr(s))}else Xa(s,o,f,cr(s))}catch(xt){Xa(s,o,{then:function(){},status:"rejected",reason:xt},cr())}finally{zt.p=C,Pt.T=k}}function gb(){}function A_(s,o,u,f){if(s.tag!==5)throw Error(y(476));var g=kT(s).queue;Ip(s,g,o,en,u===null?gb:function(){return MT(s),u(f)})}function kT(s){var o=s.memoizedState;if(o!==null)return o;o={memoizedState:en,baseState:en,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:za,lastRenderedState:en},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:za,lastRenderedState:u},next:null},s.memoizedState=o,s=s.alternate,s!==null&&(s.memoizedState=o),o}function MT(s){var o=kT(s).next.queue;Xa(s,o,{},cr())}function I_(){return zi(Fd)}function pd(){return Hn().memoizedState}function UT(){return Hn().memoizedState}function Xl(s){for(var o=s.return;o!==null;){switch(o.tag){case 24:case 3:var u=cr();s=no(u);var f=Fs(o,s,u);f!==null&&(Ii(f,o,u),Zl(f,o,u)),o={cache:d_()},s.payload=o;return}o=o.return}}function w_(s,o,u){var f=cr();u={lane:f,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},wp(s)?O_(o,u):(u=e_(s,o,u,f),u!==null&&(Ii(u,s,f),xT(u,o,f)))}function fd(s,o,u){var f=cr();Xa(s,o,u,f)}function Xa(s,o,u,f){var g={lane:f,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(wp(s))O_(o,g);else{var C=s.alternate;if(s.lanes===0&&(C===null||C.lanes===0)&&(C=o.lastRenderedReducer,C!==null))try{var k=o.lastRenderedState,j=C(k,u);if(g.hasEagerState=!0,g.eagerState=j,Qr(j,k))return rp(s,o,g,0),Ln===null&&ip(),!1}catch{}finally{}if(u=e_(s,o,g,f),u!==null)return Ii(u,s,f),xT(u,o,f),!0}return!1}function Jl(s,o,u,f){if(f={lane:2,revertLane:yE(),action:f,hasEagerState:!1,eagerState:null,next:null},wp(s)){if(o)throw Error(y(479))}else o=e_(s,u,f,2),o!==null&&Ii(o,s,2)}function wp(s){var o=s.alternate;return s===Ve||o!==null&&o===Ve}function O_(s,o){Vc=sd=!0;var u=s.pending;u===null?o.next=o:(o.next=u.next,u.next=o),s.pending=o}function xT(s,o,u){if((u&4194176)!==0){var f=o.lanes;f&=s.pendingLanes,u|=f,o.lanes=u,bS(s,u)}}var Vs={readContext:zi,use:Tp,useCallback:Ei,useContext:Ei,useEffect:Ei,useImperativeHandle:Ei,useLayoutEffect:Ei,useInsertionEffect:Ei,useMemo:Ei,useReducer:Ei,useRef:Ei,useState:Ei,useDebugValue:Ei,useDeferredValue:Ei,useTransition:Ei,useSyncExternalStore:Ei,useId:Ei};Vs.useCacheRefresh=Ei,Vs.useMemoCache=Ei,Vs.useHostTransitionStatus=Ei,Vs.useFormState=Ei,Vs.useActionState=Ei,Vs.useOptimistic=Ei;var Bc={readContext:zi,use:Tp,useCallback:function(s,o){return Rr().memoizedState=[s,o===void 0?null:o],s},useContext:zi,useEffect:dd,useImperativeHandle:function(s,o,u){u=u!=null?u.concat([s]):null,ud(4194308,4,DT.bind(null,o,s),u)},useLayoutEffect:function(s,o){return ud(4194308,4,s,o)},useInsertionEffect:function(s,o){ud(4,2,s,o)},useMemo:function(s,o){var u=Rr();o=o===void 0?null:o;var f=s();if(ca){Ua(!0);try{s()}finally{Ua(!1)}}return u.memoizedState=[f,o],f},useReducer:function(s,o,u){var f=Rr();if(u!==void 0){var g=u(o);if(ca){Ua(!0);try{u(o)}finally{Ua(!1)}}}else g=o;return f.memoizedState=f.baseState=g,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:g},f.queue=s,s=s.dispatch=w_.bind(null,Ve,s),[f.memoizedState,s]},useRef:function(s){var o=Rr();return s={current:s},o.memoizedState=s},useState:function(s){s=R_(s);var o=s.queue,u=fd.bind(null,Ve,o);return o.dispatch=u,[s.memoizedState,u]},useDebugValue:b_,useDeferredValue:function(s,o){var u=Rr();return bp(u,s,o)},useTransition:function(){var s=R_(!1);return s=Ip.bind(null,Ve,s.queue,!0,!1),Rr().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,o,u){var f=Ve,g=Rr();if(fn){if(u===void 0)throw Error(y(407));u=u()}else{if(u=o(),Ln===null)throw Error(y(349));(sn&60)!==0||ld(f,o,u)}g.memoizedState=u;var C={value:u,getSnapshot:o};return g.queue=C,dd(gT.bind(null,f,C,s),[s]),f.flags|=2048,ql(9,ET.bind(null,f,C,u,o),{destroy:void 0},null),u},useId:function(){var s=Rr(),o=Ln.identifierPrefix;if(fn){var u=Us,f=Wa;u=(f&~(1<<32-Xr(f)-1)).toString(32)+u,o=":"+o+"R"+u,u=Fo++,0<u&&(o+="H"+u.toString(32)),o+=":"}else u=pT++,o=":"+o+"r"+u.toString(32)+":";return s.memoizedState=o},useCacheRefresh:function(){return Rr().memoizedState=Xl.bind(null,Ve)}};Bc.useMemoCache=Rp,Bc.useHostTransitionStatus=I_,Bc.useFormState=AT,Bc.useActionState=AT,Bc.useOptimistic=function(s){var o=Rr();o.memoizedState=o.baseState=s;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=Jl.bind(null,Ve,!0,u),u.dispatch=o,[s,o]};var jo={readContext:zi,use:Tp,useCallback:hd,useContext:zi,useEffect:Cp,useImperativeHandle:LT,useInsertionEffect:zl,useLayoutEffect:NT,useMemo:PT,useReducer:cd,useRef:OT,useState:function(){return cd(za)},useDebugValue:b_,useDeferredValue:function(s,o){var u=Hn();return Ap(u,wn.memoizedState,s,o)},useTransition:function(){var s=cd(za)[0],o=Hn().memoizedState;return[typeof s=="boolean"?s:od(s),o]},useSyncExternalStore:_T,useId:pd};jo.useCacheRefresh=UT,jo.useMemoCache=Rp,jo.useHostTransitionStatus=I_,jo.useFormState=IT,jo.useActionState=IT,jo.useOptimistic=function(s,o){var u=Hn();return RT(u,wn,s,o)};var Ja={readContext:zi,use:Tp,useCallback:hd,useContext:zi,useEffect:Cp,useImperativeHandle:LT,useInsertionEffect:zl,useLayoutEffect:NT,useMemo:PT,useReducer:T_,useRef:OT,useState:function(){return T_(za)},useDebugValue:b_,useDeferredValue:function(s,o){var u=Hn();return wn===null?bp(u,s,o):Ap(u,wn.memoizedState,s,o)},useTransition:function(){var s=T_(za)[0],o=Hn().memoizedState;return[typeof s=="boolean"?s:od(s),o]},useSyncExternalStore:_T,useId:pd};Ja.useCacheRefresh=UT,Ja.useMemoCache=Rp,Ja.useHostTransitionStatus=I_,Ja.useFormState=C_,Ja.useActionState=C_,Ja.useOptimistic=function(s,o){var u=Hn();return wn!==null?RT(u,wn,s,o):(u.baseState=s,[s,u.queue.dispatch])};function md(s,o,u,f){o=s.memoizedState,u=u(f,o),u=u==null?o:Zt({},o,u),s.memoizedState=u,s.lanes===0&&(s.updateQueue.baseState=u)}var N_={isMounted:function(s){return(s=s._reactInternals)?re(s)===s:!1},enqueueSetState:function(s,o,u){s=s._reactInternals;var f=cr(),g=no(f);g.payload=o,u!=null&&(g.callback=u),o=Fs(s,g,f),o!==null&&(Ii(o,s,f),Zl(o,s,f))},enqueueReplaceState:function(s,o,u){s=s._reactInternals;var f=cr(),g=no(f);g.tag=1,g.payload=o,u!=null&&(g.callback=u),o=Fs(s,g,f),o!==null&&(Ii(o,s,f),Zl(o,s,f))},enqueueForceUpdate:function(s,o){s=s._reactInternals;var u=cr(),f=no(u);f.tag=2,o!=null&&(f.callback=o),o=Fs(s,f,u),o!==null&&(Ii(o,s,u),Zl(o,s,u))}};function VT(s,o,u,f,g,C,k){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(f,C,k):o.prototype&&o.prototype.isPureReactComponent?!Qu(u,f)||!Qu(g,C):!0}function D_(s,o,u,f){s=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,f),o.state!==s&&N_.enqueueReplaceState(o,o.state,null)}function Qa(s,o){var u=o;if("ref"in o){u={};for(var f in o)f!=="ref"&&(u[f]=o[f])}if(s=s.defaultProps){u===o&&(u=Zt({},u));for(var g in s)u[g]===void 0&&(u[g]=s[g])}return u}var Op=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function Bs(s){Op(s)}function Fc(s){console.error(s)}function Go(s){Op(s)}function _d(s,o){try{var u=s.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(f){setTimeout(function(){throw f})}}function L_(s,o,u){try{var f=s.onCaughtError;f(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function Za(s,o,u){return u=no(u),u.tag=3,u.payload={element:null},u.callback=function(){_d(s,o)},u}function Np(s){return s=no(s),s.tag=3,s}function BT(s,o,u,f){var g=u.type.getDerivedStateFromError;if(typeof g=="function"){var C=f.value;s.payload=function(){return g(C)},s.callback=function(){L_(o,u,f)}}var k=u.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(s.callback=function(){L_(o,u,f),typeof g!="function"&&(pa===null?pa=new Set([this]):pa.add(this));var j=f.stack;this.componentDidCatch(f.value,{componentStack:j!==null?j:""})})}function FT(s,o,u,f,g){if(u.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(o=u.alternate,o!==null&&gd(o,u,g,!0),u=fs.current,u!==null){switch(u.tag){case 13:return aa===null?Dd():u.alternate===null&&ii===0&&(ii=3),u.flags&=-257,u.flags|=65536,u.lanes=g,f===a_?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([f]):o.add(f),_E(s,f,g)),!1;case 22:return u.flags|=65536,f===a_?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([f])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([f]):u.add(f)),_E(s,f,g)),!1}throw Error(y(435,u.tag))}return _E(s,f,g),Dd(),!1}if(fn)return o=fs.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=g,f!==r_&&(s=Error(y(422),{cause:f}),$u(hs(s,u)))):(f!==r_&&(o=Error(y(423),{cause:f}),$u(hs(o,u))),s=s.current.alternate,s.flags|=65536,g&=-g,s.lanes|=g,f=hs(f,u),g=Za(s.stateNode,f,g),K_(s,g),ii!==4&&(ii=2)),!1;var C=Error(y(520),{cause:f});if(C=hs(C,u),Od===null?Od=[C]:Od.push(C),ii!==4&&(ii=2),o===null)return!0;f=hs(f,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,s=g&-g,u.lanes|=s,s=Za(u.stateNode,f,s),K_(u,s),!1;case 1:if(o=u.type,C=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(pa===null||!pa.has(C))))return u.flags|=65536,g&=-g,u.lanes|=g,g=Np(g),BT(g,s,u,f),K_(u,g),!1}u=u.return}while(u!==null);return!1}var jT=Error(y(461)),Ui=!1;function Gi(s,o,u,f){o.child=s===null?pp(o,null,u,f):xo(o,s.child,u,f)}function GT(s,o,u,f,g){u=u.render;var C=o.ref;if("ref"in f){var k={};for(var j in f)j!=="ref"&&(k[j]=f[j])}else k=f;return Gc(o),f=gp(s,o,u,k,C,g),j=__(),s!==null&&!Ui?(E_(s,o,g),sr(s,o,g)):(fn&&j&&lp(o),o.flags|=1,Gi(s,o,f,g),o.child)}function $a(s,o,u,f,g){if(s===null){var C=u.type;return typeof C=="function"&&!oE(C)&&C.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=C,HT(s,o,C,f,g)):(s=Bp(u.type,null,f,o,o.mode,g),s.ref=o.ref,s.return=o,o.child=s)}if(C=s.child,!j_(s,g)){var k=C.memoizedProps;if(u=u.compare,u=u!==null?u:Qu,u(k,f)&&s.ref===o.ref)return sr(s,o,g)}return o.flags|=1,s=so(C,f),s.ref=o.ref,s.return=o,o.child=s}function HT(s,o,u,f,g){if(s!==null){var C=s.memoizedProps;if(Qu(C,f)&&s.ref===o.ref)if(Ui=!1,o.pendingProps=f=C,j_(s,g))(s.flags&131072)!==0&&(Ui=!0);else return o.lanes=s.lanes,sr(s,o,g)}return Dp(s,o,u,f,g)}function WT(s,o,u){var f=o.pendingProps,g=f.children,C=(o.stateNode._pendingVisibility&2)!==0,k=s!==null?s.memoizedState:null;if(Ed(s,o),f.mode==="hidden"||C){if((o.flags&128)!==0){if(f=k!==null?k.baseLanes|u:u,s!==null){for(g=o.child=s.child,C=0;g!==null;)C=C|g.lanes|g.childLanes,g=g.sibling;o.childLanes=C&~f}else o.childLanes=0,o.child=null;return KT(s,o,f,u)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},s!==null&&Ep(o,k!==null?k.cachePool:null),k!==null?Hl(o,k):c_(),uT(o);else return o.lanes=o.childLanes=536870912,KT(s,o,k!==null?k.baseLanes|u:u,u)}else k!==null?(Ep(o,k.cachePool),Hl(o,k),Ya(),o.memoizedState=null):(s!==null&&Ep(o,null),c_(),Ya());return Gi(s,o,g,u),o.child}function KT(s,o,u,f){var g=f_();return g=g===null?null:{parent:hi._currentValue,pool:g},o.memoizedState={baseLanes:u,cachePool:g},s!==null&&Ep(o,null),c_(),uT(o),s!==null&&gd(s,o,f,!0),null}function Ed(s,o){var u=o.ref;if(u===null)s!==null&&s.ref!==null&&(o.flags|=2097664);else{if(typeof u!="function"&&typeof u!="object")throw Error(y(284));(s===null||s.ref!==u)&&(o.flags|=2097664)}}function Dp(s,o,u,f,g){return Gc(o),u=gp(s,o,u,f,void 0,g),f=__(),s!==null&&!Ui?(E_(s,o,g),sr(s,o,g)):(fn&&f&&lp(o),o.flags|=1,Gi(s,o,u,g),o.child)}function YT(s,o,u,f,g,C){return Gc(o),o.updateQueue=null,u=mT(o,f,u,g),fT(s),f=__(),s!==null&&!Ui?(E_(s,o,C),sr(s,o,C)):(fn&&f&&lp(o),o.flags|=1,Gi(s,o,u,C),o.child)}function Lp(s,o,u,f,g){if(Gc(o),o.stateNode===null){var C=Pc,k=u.contextType;typeof k=="object"&&k!==null&&(C=zi(k)),C=new u(f,C),o.memoizedState=C.state!==null&&C.state!==void 0?C.state:null,C.updater=N_,o.stateNode=C,C._reactInternals=o,C=o.stateNode,C.props=f,C.state=o.memoizedState,C.refs={},Ql(o),k=u.contextType,C.context=typeof k=="object"&&k!==null?zi(k):Pc,C.state=o.memoizedState,k=u.getDerivedStateFromProps,typeof k=="function"&&(md(o,u,k,f),C.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof C.getSnapshotBeforeUpdate=="function"||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(k=C.state,typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount(),k!==C.state&&N_.enqueueReplaceState(C,C.state,null),Rd(o,f,C,g),Hc(),C.state=o.memoizedState),typeof C.componentDidMount=="function"&&(o.flags|=4194308),f=!0}else if(s===null){C=o.stateNode;var j=o.memoizedProps,z=Qa(u,j);C.props=z;var nt=C.context,bt=u.contextType;k=Pc,typeof bt=="object"&&bt!==null&&(k=zi(bt));var xt=u.getDerivedStateFromProps;bt=typeof xt=="function"||typeof C.getSnapshotBeforeUpdate=="function",j=o.pendingProps!==j,bt||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(j||nt!==k)&&D_(o,C,f,k),Ho=!1;var pt=o.memoizedState;C.state=pt,Rd(o,f,C,g),Hc(),nt=o.memoizedState,j||pt!==nt||Ho?(typeof xt=="function"&&(md(o,u,xt,f),nt=o.memoizedState),(z=Ho||VT(o,u,z,f,pt,nt,k))?(bt||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(o.flags|=4194308)):(typeof C.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=nt),C.props=f,C.state=nt,C.context=k,f=z):(typeof C.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{C=o.stateNode,Td(s,o),k=o.memoizedProps,bt=Qa(u,k),C.props=bt,xt=o.pendingProps,pt=C.context,nt=u.contextType,z=Pc,typeof nt=="object"&&nt!==null&&(z=zi(nt)),j=u.getDerivedStateFromProps,(nt=typeof j=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(k!==xt||pt!==z)&&D_(o,C,f,z),Ho=!1,pt=o.memoizedState,C.state=pt,Rd(o,f,C,g),Hc();var yt=o.memoizedState;k!==xt||pt!==yt||Ho||s!==null&&s.dependencies!==null&&kp(s.dependencies)?(typeof j=="function"&&(md(o,u,j,f),yt=o.memoizedState),(bt=Ho||VT(o,u,bt,f,pt,yt,z)||s!==null&&s.dependencies!==null&&kp(s.dependencies))?(nt||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(f,yt,z),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(f,yt,z)),typeof C.componentDidUpdate=="function"&&(o.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof C.componentDidUpdate!="function"||k===s.memoizedProps&&pt===s.memoizedState||(o.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||k===s.memoizedProps&&pt===s.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=yt),C.props=f,C.state=yt,C.context=z,f=bt):(typeof C.componentDidUpdate!="function"||k===s.memoizedProps&&pt===s.memoizedState||(o.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||k===s.memoizedProps&&pt===s.memoizedState||(o.flags|=1024),f=!1)}return C=f,Ed(s,o),f=(o.flags&128)!==0,C||f?(C=o.stateNode,u=f&&typeof u.getDerivedStateFromError!="function"?null:C.render(),o.flags|=1,s!==null&&f?(o.child=xo(o,s.child,null,g),o.child=xo(o,null,u,g)):Gi(s,o,u,g),o.memoizedState=C.state,s=o.child):s=sr(s,o,g),s}function P_(s,o,u,f){return xc(),o.flags|=256,Gi(s,o,u,f),o.child}var k_={dehydrated:null,treeContext:null,retryLane:0};function Pp(s){return{baseLanes:s,cachePool:hT()}}function M_(s,o,u){return s=s!==null?s.childLanes&~u:0,o&&(s|=Wi),s}function qT(s,o,u){var f=o.pendingProps,g=!1,C=(o.flags&128)!==0,k;if((k=C)||(k=s!==null&&s.memoizedState===null?!1:(Mi.current&2)!==0),k&&(g=!0,o.flags&=-129),k=(o.flags&32)!==0,o.flags&=-33,s===null){if(fn){if(g?Vo(o):Ya(),fn){var j=bi,z;if(z=j){t:{for(z=j,j=sa;z.nodeType!==8;){if(!j){j=null;break t}if(z=Es(z.nextSibling),z===null){j=null;break t}}j=z}j!==null?(o.memoizedState={dehydrated:j,treeContext:kc!==null?{id:Wa,overflow:Us}:null,retryLane:536870912},z=es(18,null,null,0),z.stateNode=j,z.return=o,o.child=z,rr=o,bi=null,z=!0):z=!1}z||Uc(o)}if(j=o.memoizedState,j!==null&&(j=j.dehydrated,j!==null))return j.data==="$!"?o.lanes=16:o.lanes=536870912,null;qa(o)}return j=f.children,f=f.fallback,g?(Ya(),g=o.mode,j=x_({mode:"hidden",children:j},g),f=qo(f,g,u,null),j.return=o,f.return=o,j.sibling=f,o.child=j,g=o.child,g.memoizedState=Pp(u),g.childLanes=M_(s,k,u),o.memoizedState=k_,f):(Vo(o),U_(o,j))}if(z=s.memoizedState,z!==null&&(j=z.dehydrated,j!==null)){if(C)o.flags&256?(Vo(o),o.flags&=-257,o=V_(s,o,u)):o.memoizedState!==null?(Ya(),o.child=s.child,o.flags|=128,o=null):(Ya(),g=f.fallback,j=o.mode,f=x_({mode:"visible",children:f.children},j),g=qo(g,j,u,null),g.flags|=2,f.return=o,g.return=o,f.sibling=g,o.child=f,xo(o,s.child,null,u),f=o.child,f.memoizedState=Pp(u),f.childLanes=M_(s,k,u),o.memoizedState=k_,o=g);else if(Vo(o),j.data==="$!"){if(k=j.nextSibling&&j.nextSibling.dataset,k)var nt=k.dgst;k=nt,f=Error(y(419)),f.stack="",f.digest=k,$u({value:f,source:null,stack:null}),o=V_(s,o,u)}else if(Ui||gd(s,o,u,!1),k=(u&s.childLanes)!==0,Ui||k){if(k=Ln,k!==null){if(f=u&-u,(f&42)!==0)f=1;else switch(f){case 2:f=1;break;case 8:f=4;break;case 32:f=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:f=64;break;case 268435456:f=134217728;break;default:f=0}if(f=(f&(k.suspendedLanes|u))!==0?0:f,f!==0&&f!==z.retryLane)throw z.retryLane=f,Mo(s,f),Ii(k,s,f),jT}j.data==="$?"||Dd(),o=V_(s,o,u)}else j.data==="$?"?(o.flags|=128,o.child=s.child,o=Ib.bind(null,s),j._reactRetry=o,o=null):(s=z.treeContext,bi=Es(j.nextSibling),rr=o,fn=!0,xs=null,sa=!1,s!==null&&(Zr[ps++]=Wa,Zr[ps++]=Us,Zr[ps++]=kc,Wa=s.id,Us=s.overflow,kc=o),o=U_(o,f.children),o.flags|=4096);return o}return g?(Ya(),g=f.fallback,j=o.mode,z=s.child,nt=z.sibling,f=so(z,{mode:"hidden",children:f.children}),f.subtreeFlags=z.subtreeFlags&31457280,nt!==null?g=so(nt,g):(g=qo(g,j,u,null),g.flags|=2),g.return=o,f.return=o,f.sibling=g,o.child=f,f=g,g=o.child,j=s.child.memoizedState,j===null?j=Pp(u):(z=j.cachePool,z!==null?(nt=hi._currentValue,z=z.parent!==nt?{parent:nt,pool:nt}:z):z=hT(),j={baseLanes:j.baseLanes|u,cachePool:z}),g.memoizedState=j,g.childLanes=M_(s,k,u),o.memoizedState=k_,f):(Vo(o),u=s.child,s=u.sibling,u=so(u,{mode:"visible",children:f.children}),u.return=o,u.sibling=null,s!==null&&(k=o.deletions,k===null?(o.deletions=[s],o.flags|=16):k.push(s)),o.child=u,o.memoizedState=null,u)}function U_(s,o){return o=x_({mode:"visible",children:o},s.mode),o.return=s,s.child=o}function x_(s,o){return rR(s,o,0,null)}function V_(s,o,u){return xo(o,s.child,null,u),s=U_(o,o.pendingProps.children),s.flags|=2,o.memoizedState=null,s}function zT(s,o,u){s.lanes|=o;var f=s.alternate;f!==null&&(f.lanes|=o),H_(s.return,o,u)}function B_(s,o,u,f,g){var C=s.memoizedState;C===null?s.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:u,tailMode:g}:(C.isBackwards=o,C.rendering=null,C.renderingStartTime=0,C.last=f,C.tail=u,C.tailMode=g)}function F_(s,o,u){var f=o.pendingProps,g=f.revealOrder,C=f.tail;if(Gi(s,o,f.children,u),f=Mi.current,(f&2)!==0)f=f&1|2,o.flags|=128;else{if(s!==null&&(s.flags&128)!==0)t:for(s=o.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&zT(s,u,o);else if(s.tag===19)zT(s,u,o);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===o)break t;for(;s.sibling===null;){if(s.return===null||s.return===o)break t;s=s.return}s.sibling.return=s.return,s=s.sibling}f&=1}switch(Zn(Mi,f),g){case"forwards":for(u=o.child,g=null;u!==null;)s=u.alternate,s!==null&&mp(s)===null&&(g=u),u=u.sibling;u=g,u===null?(g=o.child,o.child=null):(g=u.sibling,u.sibling=null),B_(o,!1,g,u,C);break;case"backwards":for(u=null,g=o.child,o.child=null;g!==null;){if(s=g.alternate,s!==null&&mp(s)===null){o.child=g;break}s=g.sibling,g.sibling=u,u=g,g=s}B_(o,!0,u,null,C);break;case"together":B_(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function sr(s,o,u){if(s!==null&&(o.dependencies=s.dependencies),ao|=o.lanes,(u&o.childLanes)===0)if(s!==null){if(gd(s,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(s!==null&&o.child!==s.child)throw Error(y(153));if(o.child!==null){for(s=o.child,u=so(s,s.pendingProps),o.child=u,u.return=o;s.sibling!==null;)s=s.sibling,u=u.sibling=so(s,s.pendingProps),u.return=o;u.sibling=null}return o.child}function j_(s,o){return(s.lanes&o)!==0?!0:(s=s.dependencies,!!(s!==null&&kp(s)))}function Sb(s,o,u){switch(o.tag){case 3:Ma(o,o.stateNode.containerInfo),la(o,hi,s.memoizedState.cache),xc();break;case 27:case 5:Rm(o);break;case 4:Ma(o,o.stateNode.containerInfo);break;case 10:la(o,o.type,o.memoizedProps.value);break;case 13:var f=o.memoizedState;if(f!==null)return f.dehydrated!==null?(Vo(o),o.flags|=128,null):(u&o.child.childLanes)!==0?qT(s,o,u):(Vo(o),s=sr(s,o,u),s!==null?s.sibling:null);Vo(o);break;case 19:var g=(s.flags&128)!==0;if(f=(u&o.childLanes)!==0,f||(gd(s,o,u,!1),f=(u&o.childLanes)!==0),g){if(f)return F_(s,o,u);o.flags|=128}if(g=o.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),Zn(Mi,Mi.current),f)break;return null;case 22:case 23:return o.lanes=0,WT(s,o,u);case 24:la(o,hi,s.memoizedState.cache)}return sr(s,o,u)}function XT(s,o,u){if(s!==null)if(s.memoizedProps!==o.pendingProps)Ui=!0;else{if(!j_(s,u)&&(o.flags&128)===0)return Ui=!1,Sb(s,o,u);Ui=(s.flags&131072)!==0}else Ui=!1,fn&&(o.flags&1048576)!==0&&n_(o,cp,o.index);switch(o.lanes=0,o.tag){case 16:t:{s=o.pendingProps;var f=o.elementType,g=f._init;if(f=g(f._payload),o.type=f,typeof f=="function")oE(f)?(s=Qa(f,s),o.tag=1,o=Lp(null,o,f,s,u)):(o.tag=0,o=Dp(null,o,f,s,u));else{if(f!=null){if(g=f.$$typeof,g===st){o.tag=11,o=GT(null,o,f,s,u);break t}else if(g===vt){o.tag=14,o=$a(null,o,f,s,u);break t}}throw o=Gn(f)||f,Error(y(306,o,""))}}return o;case 0:return Dp(s,o,o.type,o.pendingProps,u);case 1:return f=o.type,g=Qa(f,o.pendingProps),Lp(s,o,f,g,u);case 3:t:{if(Ma(o,o.stateNode.containerInfo),s===null)throw Error(y(387));var C=o.pendingProps;g=o.memoizedState,f=g.element,Td(s,o),Rd(o,C,null,u);var k=o.memoizedState;if(C=k.cache,la(o,hi,C),C!==g.cache&&W_(o,[hi],u,!0),Hc(),C=k.element,g.isDehydrated)if(g={element:C,isDehydrated:!1,cache:k.cache},o.updateQueue.baseState=g,o.memoizedState=g,o.flags&256){o=P_(s,o,C,u);break t}else if(C!==f){f=hs(Error(y(424)),o),$u(f),o=P_(s,o,C,u);break t}else for(bi=Es(o.stateNode.containerInfo.firstChild),rr=o,fn=!0,xs=null,sa=!0,u=pp(o,null,C,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(xc(),C===f){o=sr(s,o,u);break t}Gi(s,o,C,u)}o=o.child}return o;case 26:return Ed(s,o),s===null?(u=UE(o.type,null,o.pendingProps,null))?o.memoizedState=u:fn||(u=o.type,s=o.pendingProps,f=af(Oo.current).createElement(u),f[ir]=o,f[Er]=s,Xi(f,u,s),ji(f),o.stateNode=f):o.memoizedState=UE(o.type,s.memoizedProps,o.pendingProps,s.memoizedState),null;case 27:return Rm(o),s===null&&fn&&(f=o.stateNode=bR(o.type,o.pendingProps,Oo.current),rr=o,sa=!0,bi=Es(f.firstChild)),f=o.pendingProps.children,s!==null||fn?Gi(s,o,f,u):o.child=xo(o,null,f,u),Ed(s,o),o.child;case 5:return s===null&&fn&&((g=f=bi)&&(f=kb(f,o.type,o.pendingProps,sa),f!==null?(o.stateNode=f,rr=o,bi=Es(f.firstChild),sa=!1,g=!0):g=!1),g||Uc(o)),Rm(o),g=o.type,C=o.pendingProps,k=s!==null?s.memoizedProps:null,f=C.children,LE(g,C)?f=null:k!==null&&LE(g,k)&&(o.flags|=32),o.memoizedState!==null&&(g=gp(s,o,_b,null,null,u),Fd._currentValue=g),Ed(s,o),Gi(s,o,f,u),o.child;case 6:return s===null&&fn&&((s=u=bi)&&(u=Mb(u,o.pendingProps,sa),u!==null?(o.stateNode=u,rr=o,bi=null,s=!0):s=!1),s||Uc(o)),null;case 13:return qT(s,o,u);case 4:return Ma(o,o.stateNode.containerInfo),f=o.pendingProps,s===null?o.child=xo(o,null,f,u):Gi(s,o,f,u),o.child;case 11:return GT(s,o,o.type,o.pendingProps,u);case 7:return Gi(s,o,o.pendingProps,u),o.child;case 8:return Gi(s,o,o.pendingProps.children,u),o.child;case 12:return Gi(s,o,o.pendingProps.children,u),o.child;case 10:return f=o.pendingProps,la(o,o.type,f.value),Gi(s,o,f.children,u),o.child;case 9:return g=o.type._context,f=o.pendingProps.children,Gc(o),g=zi(g),f=f(g),o.flags|=1,Gi(s,o,f,u),o.child;case 14:return $a(s,o,o.type,o.pendingProps,u);case 15:return HT(s,o,o.type,o.pendingProps,u);case 19:return F_(s,o,u);case 22:return WT(s,o,u);case 24:return Gc(o),f=zi(hi),s===null?(g=f_(),g===null&&(g=Ln,C=d_(),g.pooledCache=C,C.refCount++,C!==null&&(g.pooledCacheLanes|=u),g=C),o.memoizedState={parent:f,cache:g},Ql(o),la(o,hi,g)):((s.lanes&u)!==0&&(Td(s,o),Rd(o,null,null,u),Hc()),g=s.memoizedState,C=o.memoizedState,g.parent!==f?(g={parent:f,cache:f},o.memoizedState=g,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=g),la(o,hi,f)):(f=C.cache,la(o,hi,f),f!==g.cache&&W_(o,[hi],u,!0))),Gi(s,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(y(156,o.tag))}var G_=Cn(null),jc=null,to=null;function la(s,o,u){Zn(G_,o._currentValue),o._currentValue=u}function eo(s){s._currentValue=G_.current,ui(G_)}function H_(s,o,u){for(;s!==null;){var f=s.alternate;if((s.childLanes&o)!==o?(s.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),s===u)break;s=s.return}}function W_(s,o,u,f){var g=s.child;for(g!==null&&(g.return=s);g!==null;){var C=g.dependencies;if(C!==null){var k=g.child;C=C.firstContext;t:for(;C!==null;){var j=C;C=g;for(var z=0;z<o.length;z++)if(j.context===o[z]){C.lanes|=u,j=C.alternate,j!==null&&(j.lanes|=u),H_(C.return,u,s),f||(k=null);break t}C=j.next}}else if(g.tag===18){if(k=g.return,k===null)throw Error(y(341));k.lanes|=u,C=k.alternate,C!==null&&(C.lanes|=u),H_(k,u,s),k=null}else k=g.child;if(k!==null)k.return=g;else for(k=g;k!==null;){if(k===s){k=null;break}if(g=k.sibling,g!==null){g.return=k.return,k=g;break}k=k.return}g=k}}function gd(s,o,u,f){s=null;for(var g=o,C=!1;g!==null;){if(!C){if((g.flags&524288)!==0)C=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var k=g.alternate;if(k===null)throw Error(y(387));if(k=k.memoizedProps,k!==null){var j=g.type;Qr(g.pendingProps.value,k.value)||(s!==null?s.push(j):s=[j])}}else if(g===Mh.current){if(k=g.alternate,k===null)throw Error(y(387));k.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(s!==null?s.push(Fd):s=[Fd])}g=g.return}s!==null&&W_(o,s,u,f),o.flags|=262144}function kp(s){for(s=s.firstContext;s!==null;){if(!Qr(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function Gc(s){jc=s,to=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function zi(s){return JT(jc,s)}function Sd(s,o){return jc===null&&Gc(s),JT(s,o)}function JT(s,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},to===null){if(s===null)throw Error(y(308));to=o,s.dependencies={lanes:0,firstContext:o},s.flags|=524288}else to=to.next=o;return u}var Ho=!1;function Ql(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Td(s,o){s=s.updateQueue,o.updateQueue===s&&(o.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function no(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Fs(s,o,u){var f=s.updateQueue;if(f===null)return null;if(f=f.shared,(zn&2)!==0){var g=f.pending;return g===null?o.next=o:(o.next=g.next,g.next=o),f.pending=o,o=ap(s),sp(s,null,u),o}return rp(s,f,o,u),ap(s)}function Zl(s,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194176)!==0)){var f=o.lanes;f&=s.pendingLanes,u|=f,o.lanes=u,bS(s,u)}}function K_(s,o){var u=s.updateQueue,f=s.alternate;if(f!==null&&(f=f.updateQueue,u===f)){var g=null,C=null;if(u=u.firstBaseUpdate,u!==null){do{var k={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};C===null?g=C=k:C=C.next=k,u=u.next}while(u!==null);C===null?g=C=o:C=C.next=o}else g=C=o;u={baseState:f.baseState,firstBaseUpdate:g,lastBaseUpdate:C,shared:f.shared,callbacks:f.callbacks},s.updateQueue=u;return}s=u.lastBaseUpdate,s===null?u.firstBaseUpdate=o:s.next=o,u.lastBaseUpdate=o}var Mp=!1;function Hc(){if(Mp){var s=Kl;if(s!==null)throw s}}function Rd(s,o,u,f){Mp=!1;var g=s.updateQueue;Ho=!1;var C=g.firstBaseUpdate,k=g.lastBaseUpdate,j=g.shared.pending;if(j!==null){g.shared.pending=null;var z=j,nt=z.next;z.next=null,k===null?C=nt:k.next=nt,k=z;var bt=s.alternate;bt!==null&&(bt=bt.updateQueue,j=bt.lastBaseUpdate,j!==k&&(j===null?bt.firstBaseUpdate=nt:j.next=nt,bt.lastBaseUpdate=z))}if(C!==null){var xt=g.baseState;k=0,bt=nt=z=null,j=C;do{var pt=j.lane&-536870913,yt=pt!==j.lane;if(yt?(sn&pt)===pt:(f&pt)===pt){pt!==0&&pt===Wl&&(Mp=!0),bt!==null&&(bt=bt.next={lane:0,tag:j.tag,payload:j.payload,callback:null,next:null});t:{var se=s,Le=j;pt=o;var ti=u;switch(Le.tag){case 1:if(se=Le.payload,typeof se=="function"){xt=se.call(ti,xt,pt);break t}xt=se;break t;case 3:se.flags=se.flags&-65537|128;case 0:if(se=Le.payload,pt=typeof se=="function"?se.call(ti,xt,pt):se,pt==null)break t;xt=Zt({},xt,pt);break t;case 2:Ho=!0}}pt=j.callback,pt!==null&&(s.flags|=64,yt&&(s.flags|=8192),yt=g.callbacks,yt===null?g.callbacks=[pt]:yt.push(pt))}else yt={lane:pt,tag:j.tag,payload:j.payload,callback:j.callback,next:null},bt===null?(nt=bt=yt,z=xt):bt=bt.next=yt,k|=pt;if(j=j.next,j===null){if(j=g.shared.pending,j===null)break;yt=j,j=yt.next,yt.next=null,g.lastBaseUpdate=yt,g.shared.pending=null}}while(!0);bt===null&&(z=xt),g.baseState=z,g.firstBaseUpdate=nt,g.lastBaseUpdate=bt,C===null&&(g.shared.lanes=0),ao|=k,s.lanes=k,s.memoizedState=xt}}function Y_(s,o){if(typeof s!="function")throw Error(y(191,s));s.call(o)}function q_(s,o){var u=s.callbacks;if(u!==null)for(s.callbacks=null,s=0;s<u.length;s++)Y_(u[s],o)}function yd(s,o){try{var u=o.updateQueue,f=u!==null?u.lastEffect:null;if(f!==null){var g=f.next;u=g;do{if((u.tag&s)===s){f=void 0;var C=u.create,k=u.inst;f=C(),k.destroy=f}u=u.next}while(u!==g)}}catch(j){gn(o,o.return,j)}}function io(s,o,u){try{var f=o.updateQueue,g=f!==null?f.lastEffect:null;if(g!==null){var C=g.next;f=C;do{if((f.tag&s)===s){var k=f.inst,j=k.destroy;if(j!==void 0){k.destroy=void 0,g=o;var z=u;try{j()}catch(nt){gn(g,z,nt)}}}f=f.next}while(f!==C)}}catch(nt){gn(o,o.return,nt)}}function z_(s){var o=s.updateQueue;if(o!==null){var u=s.stateNode;try{q_(o,u)}catch(f){gn(s,s.return,f)}}}function QT(s,o,u){u.props=Qa(s.type,s.memoizedProps),u.state=s.memoizedState;try{u.componentWillUnmount()}catch(f){gn(s,o,f)}}function Wc(s,o){try{var u=s.ref;if(u!==null){var f=s.stateNode;switch(s.tag){case 26:case 27:case 5:var g=f;break;default:g=f}typeof u=="function"?s.refCleanup=u(g):u.current=g}}catch(C){gn(s,o,C)}}function $r(s,o){var u=s.ref,f=s.refCleanup;if(u!==null)if(typeof f=="function")try{f()}catch(g){gn(s,o,g)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(g){gn(s,o,g)}else u.current=null}function vd(s){var o=s.type,u=s.memoizedProps,f=s.stateNode;try{t:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&f.focus();break t;case"img":u.src?f.src=u.src:u.srcSet&&(f.srcset=u.srcSet)}}catch(g){gn(s,s.return,g)}}function ZT(s,o,u){try{var f=s.stateNode;sf(f,s.type,u,o),f[Er]=o}catch(g){gn(s,s.return,g)}}function $T(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27||s.tag===4}function X_(s){t:for(;;){for(;s.sibling===null;){if(s.return===null||$T(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==27&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue t;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Up(s,o,u){var f=s.tag;if(f===5||f===6)s=s.stateNode,o?u.nodeType===8?u.parentNode.insertBefore(s,o):u.insertBefore(s,o):(u.nodeType===8?(o=u.parentNode,o.insertBefore(s,u)):(o=u,o.appendChild(s)),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=rf));else if(f!==4&&f!==27&&(s=s.child,s!==null))for(Up(s,o,u),s=s.sibling;s!==null;)Up(s,o,u),s=s.sibling}function xp(s,o,u){var f=s.tag;if(f===5||f===6)s=s.stateNode,o?u.insertBefore(s,o):u.appendChild(s);else if(f!==4&&f!==27&&(s=s.child,s!==null))for(xp(s,o,u),s=s.sibling;s!==null;)xp(s,o,u),s=s.sibling}var ro=!1,$n=!1,J_=!1,Vp=typeof WeakSet=="function"?WeakSet:Set,Hi=null,Q_=!1;function Tb(s,o){if(s=s.containerInfo,NE=jd,s=ZS(s),Tr(s)){if("selectionStart"in s)var u={start:s.selectionStart,end:s.selectionEnd};else t:{u=(u=s.ownerDocument)&&u.defaultView||window;var f=u.getSelection&&u.getSelection();if(f&&f.rangeCount!==0){u=f.anchorNode;var g=f.anchorOffset,C=f.focusNode;f=f.focusOffset;try{u.nodeType,C.nodeType}catch{u=null;break t}var k=0,j=-1,z=-1,nt=0,bt=0,xt=s,pt=null;e:for(;;){for(var yt;xt!==u||g!==0&&xt.nodeType!==3||(j=k+g),xt!==C||f!==0&&xt.nodeType!==3||(z=k+f),xt.nodeType===3&&(k+=xt.nodeValue.length),(yt=xt.firstChild)!==null;)pt=xt,xt=yt;for(;;){if(xt===s)break e;if(pt===u&&++nt===g&&(j=k),pt===C&&++bt===f&&(z=k),(yt=xt.nextSibling)!==null)break;xt=pt,pt=xt.parentNode}xt=yt}u=j===-1||z===-1?null:{start:j,end:z}}else u=null}u=u||{start:0,end:0}}else u=null;for(DE={focusedElem:s,selectionRange:u},jd=!1,Hi=o;Hi!==null;)if(o=Hi,s=o.child,(o.subtreeFlags&1028)!==0&&s!==null)s.return=o,Hi=s;else for(;Hi!==null;){switch(o=Hi,C=o.alternate,s=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((s&1024)!==0&&C!==null){s=void 0,u=o,g=C.memoizedProps,C=C.memoizedState,f=u.stateNode;try{var se=Qa(u.type,g,u.elementType===u.type);s=f.getSnapshotBeforeUpdate(se,C),f.__reactInternalSnapshotBeforeUpdate=s}catch(Le){gn(u,u.return,Le)}}break;case 3:if((s&1024)!==0){if(s=o.stateNode.containerInfo,u=s.nodeType,u===9)ME(s);else if(u===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":ME(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(y(163))}if(s=o.sibling,s!==null){s.return=o.return,Hi=s;break}Hi=o.return}return se=Q_,Q_=!1,se}function tR(s,o,u){var f=u.flags;switch(u.tag){case 0:case 11:case 15:da(s,u),f&4&&yd(5,u);break;case 1:if(da(s,u),f&4)if(s=u.stateNode,o===null)try{s.componentDidMount()}catch(j){gn(u,u.return,j)}else{var g=Qa(u.type,o.memoizedProps);o=o.memoizedState;try{s.componentDidUpdate(g,o,s.__reactInternalSnapshotBeforeUpdate)}catch(j){gn(u,u.return,j)}}f&64&&z_(u),f&512&&Wc(u,u.return);break;case 3:if(da(s,u),f&64&&(f=u.updateQueue,f!==null)){if(s=null,u.child!==null)switch(u.child.tag){case 27:case 5:s=u.child.stateNode;break;case 1:s=u.child.stateNode}try{q_(f,s)}catch(j){gn(u,u.return,j)}}break;case 26:da(s,u),f&512&&Wc(u,u.return);break;case 27:case 5:da(s,u),o===null&&f&4&&vd(u),f&512&&Wc(u,u.return);break;case 12:da(s,u);break;case 13:da(s,u),f&4&&$_(s,u);break;case 22:if(g=u.memoizedState!==null||ro,!g){o=o!==null&&o.memoizedState!==null||$n;var C=ro,k=$n;ro=g,($n=o)&&!k?js(s,u,(u.subtreeFlags&8772)!==0):da(s,u),ro=C,$n=k}f&512&&(u.memoizedProps.mode==="manual"?Wc(u,u.return):$r(u,u.return));break;default:da(s,u)}}function Z_(s){var o=s.alternate;o!==null&&(s.alternate=null,Z_(o)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(o=s.stateNode,o!==null&&No(o)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Ai=null,ts=!1;function ua(s,o,u){for(u=u.child;u!==null;)eR(s,o,u),u=u.sibling}function eR(s,o,u){if(Nr&&typeof Nr.onCommitFiberUnmount=="function")try{Nr.onCommitFiberUnmount(Al,u)}catch{}switch(u.tag){case 26:$n||$r(u,o),ua(s,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:$n||$r(u,o);var f=Ai,g=ts;for(Ai=u.stateNode,ua(s,o,u),u=u.stateNode,o=u.attributes;o.length;)u.removeAttributeNode(o[0]);No(u),Ai=f,ts=g;break;case 5:$n||$r(u,o);case 6:g=Ai;var C=ts;if(Ai=null,ua(s,o,u),Ai=g,ts=C,Ai!==null)if(ts)try{s=Ai,f=u.stateNode,s.nodeType===8?s.parentNode.removeChild(f):s.removeChild(f)}catch(k){gn(u,o,k)}else try{Ai.removeChild(u.stateNode)}catch(k){gn(u,o,k)}break;case 18:Ai!==null&&(ts?(o=Ai,u=u.stateNode,o.nodeType===8?kE(o.parentNode,u):o.nodeType===1&&kE(o,u),Yd(o)):kE(Ai,u.stateNode));break;case 4:f=Ai,g=ts,Ai=u.stateNode.containerInfo,ts=!0,ua(s,o,u),Ai=f,ts=g;break;case 0:case 11:case 14:case 15:$n||io(2,u,o),$n||io(4,u,o),ua(s,o,u);break;case 1:$n||($r(u,o),f=u.stateNode,typeof f.componentWillUnmount=="function"&&QT(u,o,f)),ua(s,o,u);break;case 21:ua(s,o,u);break;case 22:$n||$r(u,o),$n=(f=$n)||u.memoizedState!==null,ua(s,o,u),$n=f;break;default:ua(s,o,u)}}function $_(s,o){if(o.memoizedState===null&&(s=o.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Yd(s)}catch(u){gn(o,o.return,u)}}function tE(s){switch(s.tag){case 13:case 19:var o=s.stateNode;return o===null&&(o=s.stateNode=new Vp),o;case 22:return s=s.stateNode,o=s._retryCache,o===null&&(o=s._retryCache=new Vp),o;default:throw Error(y(435,s.tag))}}function eE(s,o){var u=tE(s);o.forEach(function(f){var g=EE.bind(null,s,f);u.has(f)||(u.add(f),f.then(g,g))})}function ms(s,o){var u=o.deletions;if(u!==null)for(var f=0;f<u.length;f++){var g=u[f],C=s,k=o,j=k;t:for(;j!==null;){switch(j.tag){case 27:case 5:Ai=j.stateNode,ts=!1;break t;case 3:Ai=j.stateNode.containerInfo,ts=!0;break t;case 4:Ai=j.stateNode.containerInfo,ts=!0;break t}j=j.return}if(Ai===null)throw Error(y(160));eR(C,k,g),Ai=null,ts=!1,C=g.alternate,C!==null&&(C.return=null),g.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)nE(o,s),o=o.sibling}var yr=null;function nE(s,o){var u=s.alternate,f=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:ms(o,s),ar(s),f&4&&(io(3,s,s.return),yd(3,s),io(5,s,s.return));break;case 1:ms(o,s),ar(s),f&512&&($n||u===null||$r(u,u.return)),f&64&&ro&&(s=s.updateQueue,s!==null&&(f=s.callbacks,f!==null&&(u=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=u===null?f:u.concat(f))));break;case 26:var g=yr;if(ms(o,s),ar(s),f&512&&($n||u===null||$r(u,u.return)),f&4){var C=u!==null?u.memoizedState:null;if(f=s.memoizedState,u===null)if(f===null)if(s.stateNode===null){t:{f=s.type,u=s.memoizedProps,g=g.ownerDocument||g;e:switch(f){case"title":C=g.getElementsByTagName("title")[0],(!C||C[wl]||C[ir]||C.namespaceURI==="http://www.w3.org/2000/svg"||C.hasAttribute("itemprop"))&&(C=g.createElement(f),g.head.insertBefore(C,g.querySelector("head > title"))),Xi(C,f,u),C[ir]=s,ji(C),f=C;break t;case"link":var k=OR("link","href",g).get(f+(u.href||""));if(k){for(var j=0;j<k.length;j++)if(C=k[j],C.getAttribute("href")===(u.href==null?null:u.href)&&C.getAttribute("rel")===(u.rel==null?null:u.rel)&&C.getAttribute("title")===(u.title==null?null:u.title)&&C.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){k.splice(j,1);break e}}C=g.createElement(f),Xi(C,f,u),g.head.appendChild(C);break;case"meta":if(k=OR("meta","content",g).get(f+(u.content||""))){for(j=0;j<k.length;j++)if(C=k[j],C.getAttribute("content")===(u.content==null?null:""+u.content)&&C.getAttribute("name")===(u.name==null?null:u.name)&&C.getAttribute("property")===(u.property==null?null:u.property)&&C.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&C.getAttribute("charset")===(u.charSet==null?null:u.charSet)){k.splice(j,1);break e}}C=g.createElement(f),Xi(C,f,u),g.head.appendChild(C);break;default:throw Error(y(468,f))}C[ir]=s,ji(C),f=C}s.stateNode=f}else NR(g,s.type,s.stateNode);else s.stateNode=xE(g,f,s.memoizedProps);else C!==f?(C===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):C.count--,f===null?NR(g,s.type,s.stateNode):xE(g,f,s.memoizedProps)):f===null&&s.stateNode!==null&&ZT(s,s.memoizedProps,u.memoizedProps)}break;case 27:if(f&4&&s.alternate===null){g=s.stateNode,C=s.memoizedProps;try{for(var z=g.firstChild;z;){var nt=z.nextSibling,bt=z.nodeName;z[wl]||bt==="HEAD"||bt==="BODY"||bt==="SCRIPT"||bt==="STYLE"||bt==="LINK"&&z.rel.toLowerCase()==="stylesheet"||g.removeChild(z),z=nt}for(var xt=s.type,pt=g.attributes;pt.length;)g.removeAttributeNode(pt[0]);Xi(g,xt,C),g[ir]=s,g[Er]=C}catch(se){gn(s,s.return,se)}}case 5:if(ms(o,s),ar(s),f&512&&($n||u===null||$r(u,u.return)),s.flags&32){g=s.stateNode;try{Do(g,"")}catch(se){gn(s,s.return,se)}}f&4&&s.stateNode!=null&&(g=s.memoizedProps,ZT(s,g,u!==null?u.memoizedProps:g)),f&1024&&(J_=!0);break;case 6:if(ms(o,s),ar(s),f&4){if(s.stateNode===null)throw Error(y(162));f=s.memoizedProps,u=s.stateNode;try{u.nodeValue=f}catch(se){gn(s,s.return,se)}}break;case 3:if(lf=null,g=yr,yr=of(o.containerInfo),ms(o,s),yr=g,ar(s),f&4&&u!==null&&u.memoizedState.isDehydrated)try{Yd(o.containerInfo)}catch(se){gn(s,s.return,se)}J_&&(J_=!1,Kc(s));break;case 4:f=yr,yr=of(s.stateNode.containerInfo),ms(o,s),ar(s),yr=f;break;case 12:ms(o,s),ar(s);break;case 13:ms(o,s),ar(s),s.child.flags&8192&&s.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(pE=cs()),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,eE(s,f)));break;case 22:if(f&512&&($n||u===null||$r(u,u.return)),z=s.memoizedState!==null,nt=u!==null&&u.memoizedState!==null,bt=ro,xt=$n,ro=bt||z,$n=xt||nt,ms(o,s),$n=xt,ro=bt,ar(s),o=s.stateNode,o._current=s,o._visibility&=-3,o._visibility|=o._pendingVisibility&2,f&8192&&(o._visibility=z?o._visibility&-2:o._visibility|1,z&&(o=ro||$n,u===null||nt||o||Wo(s)),s.memoizedProps===null||s.memoizedProps.mode!=="manual"))t:for(u=null,o=s;;){if(o.tag===5||o.tag===26||o.tag===27){if(u===null){nt=u=o;try{if(g=nt.stateNode,z)C=g.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none";else{k=nt.stateNode,j=nt.memoizedProps.style;var yt=j!=null&&j.hasOwnProperty("display")?j.display:null;k.style.display=yt==null||typeof yt=="boolean"?"":(""+yt).trim()}}catch(se){gn(nt,nt.return,se)}}}else if(o.tag===6){if(u===null){nt=o;try{nt.stateNode.nodeValue=z?"":nt.memoizedProps}catch(se){gn(nt,nt.return,se)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===s)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break t;for(;o.sibling===null;){if(o.return===null||o.return===s)break t;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}f&4&&(f=s.updateQueue,f!==null&&(u=f.retryQueue,u!==null&&(f.retryQueue=null,eE(s,u))));break;case 19:ms(o,s),ar(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,eE(s,f)));break;case 21:break;default:ms(o,s),ar(s)}}function ar(s){var o=s.flags;if(o&2){try{if(s.tag!==27){t:{for(var u=s.return;u!==null;){if($T(u)){var f=u;break t}u=u.return}throw Error(y(160))}switch(f.tag){case 27:var g=f.stateNode,C=X_(s);xp(s,C,g);break;case 5:var k=f.stateNode;f.flags&32&&(Do(k,""),f.flags&=-33);var j=X_(s);xp(s,j,k);break;case 3:case 4:var z=f.stateNode.containerInfo,nt=X_(s);Up(s,nt,z);break;default:throw Error(y(161))}}}catch(bt){gn(s,s.return,bt)}s.flags&=-3}o&4096&&(s.flags&=-4097)}function Kc(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var o=s;Kc(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),s=s.sibling}}function da(s,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)tR(s,o.alternate,o),o=o.sibling}function Wo(s){for(s=s.child;s!==null;){var o=s;switch(o.tag){case 0:case 11:case 14:case 15:io(4,o,o.return),Wo(o);break;case 1:$r(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&QT(o,o.return,u),Wo(o);break;case 26:case 27:case 5:$r(o,o.return),Wo(o);break;case 22:$r(o,o.return),o.memoizedState===null&&Wo(o);break;default:Wo(o)}s=s.sibling}}function js(s,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var f=o.alternate,g=s,C=o,k=C.flags;switch(C.tag){case 0:case 11:case 15:js(g,C,u),yd(4,C);break;case 1:if(js(g,C,u),f=C,g=f.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(nt){gn(f,f.return,nt)}if(f=C,g=f.updateQueue,g!==null){var j=f.stateNode;try{var z=g.shared.hiddenCallbacks;if(z!==null)for(g.shared.hiddenCallbacks=null,g=0;g<z.length;g++)Y_(z[g],j)}catch(nt){gn(f,f.return,nt)}}u&&k&64&&z_(C),Wc(C,C.return);break;case 26:case 27:case 5:js(g,C,u),u&&f===null&&k&4&&vd(C),Wc(C,C.return);break;case 12:js(g,C,u);break;case 13:js(g,C,u),u&&k&4&&$_(g,C);break;case 22:C.memoizedState===null&&js(g,C,u),Wc(C,C.return);break;default:js(g,C,u)}o=o.sibling}}function iE(s,o){var u=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),s=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(s=o.memoizedState.cachePool.pool),s!==u&&(s!=null&&s.refCount++,u!=null&&id(u))}function rE(s,o){s=null,o.alternate!==null&&(s=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==s&&(o.refCount++,s!=null&&id(s))}function Ko(s,o,u,f){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)sE(s,o,u,f),o=o.sibling}function sE(s,o,u,f){var g=o.flags;switch(o.tag){case 0:case 11:case 15:Ko(s,o,u,f),g&2048&&yd(9,o);break;case 3:Ko(s,o,u,f),g&2048&&(s=null,o.alternate!==null&&(s=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==s&&(o.refCount++,s!=null&&id(s)));break;case 12:if(g&2048){Ko(s,o,u,f),s=o.stateNode;try{var C=o.memoizedProps,k=C.id,j=C.onPostCommit;typeof j=="function"&&j(k,o.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(z){gn(o,o.return,z)}}else Ko(s,o,u,f);break;case 23:break;case 22:C=o.stateNode,o.memoizedState!==null?C._visibility&4?Ko(s,o,u,f):Cd(s,o):C._visibility&4?Ko(s,o,u,f):(C._visibility|=4,$l(s,o,u,f,(o.subtreeFlags&10256)!==0)),g&2048&&iE(o.alternate,o);break;case 24:Ko(s,o,u,f),g&2048&&rE(o.alternate,o);break;default:Ko(s,o,u,f)}}function $l(s,o,u,f,g){for(g=g&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var C=s,k=o,j=u,z=f,nt=k.flags;switch(k.tag){case 0:case 11:case 15:$l(C,k,j,z,g),yd(8,k);break;case 23:break;case 22:var bt=k.stateNode;k.memoizedState!==null?bt._visibility&4?$l(C,k,j,z,g):Cd(C,k):(bt._visibility|=4,$l(C,k,j,z,g)),g&&nt&2048&&iE(k.alternate,k);break;case 24:$l(C,k,j,z,g),g&&nt&2048&&rE(k.alternate,k);break;default:$l(C,k,j,z,g)}o=o.sibling}}function Cd(s,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=s,f=o,g=f.flags;switch(f.tag){case 22:Cd(u,f),g&2048&&iE(f.alternate,f);break;case 24:Cd(u,f),g&2048&&rE(f.alternate,f);break;default:Cd(u,f)}o=o.sibling}}var bd=8192;function Yo(s){if(s.subtreeFlags&bd)for(s=s.child;s!==null;)Ad(s),s=s.sibling}function Ad(s){switch(s.tag){case 26:Yo(s),s.flags&bd&&s.memoizedState!==null&&Yb(yr,s.memoizedState,s.memoizedProps);break;case 5:Yo(s);break;case 3:case 4:var o=yr;yr=of(s.stateNode.containerInfo),Yo(s),yr=o;break;case 22:s.memoizedState===null&&(o=s.alternate,o!==null&&o.memoizedState!==null?(o=bd,bd=16777216,Yo(s),bd=o):Yo(s));break;default:Yo(s)}}function nR(s){var o=s.alternate;if(o!==null&&(s=o.child,s!==null)){o.child=null;do o=s.sibling,s.sibling=null,s=o;while(s!==null)}}function ha(s){var o=s.deletions;if((s.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var f=o[u];Hi=f,iR(f,s)}nR(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)aE(s),s=s.sibling}function aE(s){switch(s.tag){case 0:case 11:case 15:ha(s),s.flags&2048&&io(9,s,s.return);break;case 3:ha(s);break;case 12:ha(s);break;case 22:var o=s.stateNode;s.memoizedState!==null&&o._visibility&4&&(s.return===null||s.return.tag!==13)?(o._visibility&=-5,or(s)):ha(s);break;default:ha(s)}}function or(s){var o=s.deletions;if((s.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var f=o[u];Hi=f,iR(f,s)}nR(s)}for(s=s.child;s!==null;){switch(o=s,o.tag){case 0:case 11:case 15:io(8,o,o.return),or(o);break;case 22:u=o.stateNode,u._visibility&4&&(u._visibility&=-5,or(o));break;default:or(o)}s=s.sibling}}function iR(s,o){for(;Hi!==null;){var u=Hi;switch(u.tag){case 0:case 11:case 15:io(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var f=u.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:id(u.memoizedState.cache)}if(f=u.child,f!==null)f.return=u,Hi=f;else t:for(u=s;Hi!==null;){f=Hi;var g=f.sibling,C=f.return;if(Z_(f),f===u){Hi=null;break t}if(g!==null){g.return=C,Hi=g;break t}Hi=C}}}function Rb(s,o,u,f){this.tag=s,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function es(s,o,u,f){return new Rb(s,o,u,f)}function oE(s){return s=s.prototype,!(!s||!s.isReactComponent)}function so(s,o){var u=s.alternate;return u===null?(u=es(s.tag,o,s.key,s.mode),u.elementType=s.elementType,u.type=s.type,u.stateNode=s.stateNode,u.alternate=s,s.alternate=u):(u.pendingProps=o,u.type=s.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=s.flags&31457280,u.childLanes=s.childLanes,u.lanes=s.lanes,u.child=s.child,u.memoizedProps=s.memoizedProps,u.memoizedState=s.memoizedState,u.updateQueue=s.updateQueue,o=s.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=s.sibling,u.index=s.index,u.ref=s.ref,u.refCleanup=s.refCleanup,u}function cE(s,o){s.flags&=31457282;var u=s.alternate;return u===null?(s.childLanes=0,s.lanes=o,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=u.childLanes,s.lanes=u.lanes,s.child=u.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=u.memoizedProps,s.memoizedState=u.memoizedState,s.updateQueue=u.updateQueue,s.type=u.type,o=u.dependencies,s.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),s}function Bp(s,o,u,f,g,C){var k=0;if(f=s,typeof s=="function")oE(s)&&(k=1);else if(typeof s=="string")k=DR(s,u,qr.current)?26:s==="html"||s==="head"||s==="body"?27:5;else t:switch(s){case Y:return qo(u.children,g,C,o);case H:k=8,g|=24;break;case tt:return s=es(12,u,o,g|2),s.elementType=tt,s.lanes=C,s;case Ut:return s=es(13,u,o,g),s.elementType=Ut,s.lanes=C,s;case mt:return s=es(19,u,o,g),s.elementType=mt,s.lanes=C,s;case Vt:return rR(u,g,C,o);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case rt:case Mt:k=10;break t;case ht:k=9;break t;case st:k=11;break t;case vt:k=14;break t;case Gt:k=16,f=null;break t}k=29,u=Error(y(130,s===null?"null":typeof s,"")),f=null}return o=es(k,u,o,g),o.elementType=s,o.type=f,o.lanes=C,o}function qo(s,o,u,f){return s=es(7,s,f,o),s.lanes=u,s}function rR(s,o,u,f){s=es(22,s,f,o),s.elementType=Vt,s.lanes=u;var g={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var C=g._current;if(C===null)throw Error(y(456));if((g._pendingVisibility&2)===0){var k=Mo(C,2);k!==null&&(g._pendingVisibility|=2,Ii(k,C,2))}},attach:function(){var C=g._current;if(C===null)throw Error(y(456));if((g._pendingVisibility&2)!==0){var k=Mo(C,2);k!==null&&(g._pendingVisibility&=-3,Ii(k,C,2))}}};return s.stateNode=g,s}function lE(s,o,u){return s=es(6,s,null,o),s.lanes=u,s}function uE(s,o,u){return o=es(4,s.children!==null?s.children:[],s.key,o),o.lanes=u,o.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},o}function Gs(s){s.flags|=4}function Fp(s,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!LR(o)){if(o=fs.current,o!==null&&((sn&4194176)===sn?aa!==null:(sn&62914560)!==sn&&(sn&536870912)===0||o!==aa))throw ed=a_,sT;s.flags|=8192}}function jp(s,o){o!==null&&(s.flags|=4),s.flags&16384&&(o=s.tag!==22?vS():536870912,s.lanes|=o,zc|=o)}function Yc(s,o){if(!fn)switch(s.tailMode){case"hidden":o=s.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?s.tail=null:u.sibling=null;break;case"collapsed":u=s.tail;for(var f=null;u!==null;)u.alternate!==null&&(f=u),u=u.sibling;f===null?o||s.tail===null?s.tail=null:s.tail.sibling=null:f.sibling=null}}function ni(s){var o=s.alternate!==null&&s.alternate.child===s.child,u=0,f=0;if(o)for(var g=s.child;g!==null;)u|=g.lanes|g.childLanes,f|=g.subtreeFlags&31457280,f|=g.flags&31457280,g.return=s,g=g.sibling;else for(g=s.child;g!==null;)u|=g.lanes|g.childLanes,f|=g.subtreeFlags,f|=g.flags,g.return=s,g=g.sibling;return s.subtreeFlags|=f,s.childLanes=u,o}function sR(s,o,u){var f=o.pendingProps;switch(i_(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ni(o),null;case 1:return ni(o),null;case 3:return u=o.stateNode,f=null,s!==null&&(f=s.memoizedState.cache),o.memoizedState.cache!==f&&(o.flags|=2048),eo(hi),bl(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(s===null||s.child===null)&&(Zu(o)?Gs(o):s===null||s.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,xs!==null&&(Yp(xs),xs=null))),ni(o),null;case 26:return u=o.memoizedState,s===null?(Gs(o),u!==null?(ni(o),Fp(o,u)):(ni(o),o.flags&=-16777217)):u?u!==s.memoizedState?(Gs(o),ni(o),Fp(o,u)):(ni(o),o.flags&=-16777217):(s.memoizedProps!==f&&Gs(o),ni(o),o.flags&=-16777217),null;case 27:Ls(o),u=Oo.current;var g=o.type;if(s!==null&&o.stateNode!=null)s.memoizedProps!==f&&Gs(o);else{if(!f){if(o.stateNode===null)throw Error(y(166));return ni(o),null}s=qr.current,Zu(o)?s_(o):(s=bR(g,f,u),o.stateNode=s,Gs(o))}return ni(o),null;case 5:if(Ls(o),u=o.type,s!==null&&o.stateNode!=null)s.memoizedProps!==f&&Gs(o);else{if(!f){if(o.stateNode===null)throw Error(y(166));return ni(o),null}if(s=qr.current,Zu(o))s_(o);else{switch(g=af(Oo.current),s){case 1:s=g.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:s=g.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":s=g.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":s=g.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":s=g.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof f.is=="string"?g.createElement("select",{is:f.is}):g.createElement("select"),f.multiple?s.multiple=!0:f.size&&(s.size=f.size);break;default:s=typeof f.is=="string"?g.createElement(u,{is:f.is}):g.createElement(u)}}s[ir]=o,s[Er]=f;t:for(g=o.child;g!==null;){if(g.tag===5||g.tag===6)s.appendChild(g.stateNode);else if(g.tag!==4&&g.tag!==27&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===o)break t;for(;g.sibling===null;){if(g.return===null||g.return===o)break t;g=g.return}g.sibling.return=g.return,g=g.sibling}o.stateNode=s;t:switch(Xi(s,u,f),u){case"button":case"input":case"select":case"textarea":s=!!f.autoFocus;break t;case"img":s=!0;break t;default:s=!1}s&&Gs(o)}}return ni(o),o.flags&=-16777217,null;case 6:if(s&&o.stateNode!=null)s.memoizedProps!==f&&Gs(o);else{if(typeof f!="string"&&o.stateNode===null)throw Error(y(166));if(s=Oo.current,Zu(o)){if(s=o.stateNode,u=o.memoizedProps,f=null,g=rr,g!==null)switch(g.tag){case 27:case 5:f=g.memoizedProps}s[ir]=o,s=!!(s.nodeValue===u||f!==null&&f.suppressHydrationWarning===!0||wE(s.nodeValue,u)),s||Uc(o)}else s=af(s).createTextNode(f),s[ir]=o,o.stateNode=s}return ni(o),null;case 13:if(f=o.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(g=Zu(o),f!==null&&f.dehydrated!==null){if(s===null){if(!g)throw Error(y(318));if(g=o.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(y(317));g[ir]=o}else xc(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;ni(o),g=!1}else xs!==null&&(Yp(xs),xs=null),g=!0;if(!g)return o.flags&256?(qa(o),o):(qa(o),null)}if(qa(o),(o.flags&128)!==0)return o.lanes=u,o;if(u=f!==null,s=s!==null&&s.memoizedState!==null,u){f=o.child,g=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(g=f.alternate.memoizedState.cachePool.pool);var C=null;f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(C=f.memoizedState.cachePool.pool),C!==g&&(f.flags|=2048)}return u!==s&&u&&(o.child.flags|=8192),jp(o,o.updateQueue),ni(o),null;case 4:return bl(),s===null&&ef(o.stateNode.containerInfo),ni(o),null;case 10:return eo(o.type),ni(o),null;case 19:if(ui(Mi),g=o.memoizedState,g===null)return ni(o),null;if(f=(o.flags&128)!==0,C=g.rendering,C===null)if(f)Yc(g,!1);else{if(ii!==0||s!==null&&(s.flags&128)!==0)for(s=o.child;s!==null;){if(C=mp(s),C!==null){for(o.flags|=128,Yc(g,!1),s=C.updateQueue,o.updateQueue=s,jp(o,s),o.subtreeFlags=0,s=u,u=o.child;u!==null;)cE(u,s),u=u.sibling;return Zn(Mi,Mi.current&1|2),o.child}s=s.sibling}g.tail!==null&&cs()>Hp&&(o.flags|=128,f=!0,Yc(g,!1),o.lanes=4194304)}else{if(!f)if(s=mp(C),s!==null){if(o.flags|=128,f=!0,s=s.updateQueue,o.updateQueue=s,jp(o,s),Yc(g,!0),g.tail===null&&g.tailMode==="hidden"&&!C.alternate&&!fn)return ni(o),null}else 2*cs()-g.renderingStartTime>Hp&&u!==536870912&&(o.flags|=128,f=!0,Yc(g,!1),o.lanes=4194304);g.isBackwards?(C.sibling=o.child,o.child=C):(s=g.last,s!==null?s.sibling=C:o.child=C,g.last=C)}return g.tail!==null?(o=g.tail,g.rendering=o,g.tail=o.sibling,g.renderingStartTime=cs(),o.sibling=null,s=Mi.current,Zn(Mi,f?s&1|2:s&1),o):(ni(o),null);case 22:case 23:return qa(o),l_(),f=o.memoizedState!==null,s!==null?s.memoizedState!==null!==f&&(o.flags|=8192):f&&(o.flags|=8192),f?(u&536870912)!==0&&(o.flags&128)===0&&(ni(o),o.subtreeFlags&6&&(o.flags|=8192)):ni(o),u=o.updateQueue,u!==null&&jp(o,u.retryQueue),u=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),f=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),f!==u&&(o.flags|=2048),s!==null&&ui(Bo),null;case 24:return u=null,s!==null&&(u=s.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),eo(hi),ni(o),null;case 25:return null}throw Error(y(156,o.tag))}function yb(s,o){switch(i_(o),o.tag){case 1:return s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 3:return eo(hi),bl(),s=o.flags,(s&65536)!==0&&(s&128)===0?(o.flags=s&-65537|128,o):null;case 26:case 27:case 5:return Ls(o),null;case 13:if(qa(o),s=o.memoizedState,s!==null&&s.dehydrated!==null){if(o.alternate===null)throw Error(y(340));xc()}return s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 19:return ui(Mi),null;case 4:return bl(),null;case 10:return eo(o.type),null;case 22:case 23:return qa(o),l_(),s!==null&&ui(Bo),s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 24:return eo(hi),null;case 25:return null;default:return null}}function Gp(s,o){switch(i_(o),o.tag){case 3:eo(hi),bl();break;case 26:case 27:case 5:Ls(o);break;case 4:bl();break;case 13:qa(o);break;case 19:ui(Mi);break;case 10:eo(o.type);break;case 22:case 23:qa(o),l_(),s!==null&&ui(Bo);break;case 24:eo(hi)}}var Id={getCacheForType:function(s){var o=zi(hi),u=o.data.get(s);return u===void 0&&(u=s(),o.data.set(s,u)),u}},aR=typeof WeakMap=="function"?WeakMap:Map,zn=0,Ln=null,ze=null,sn=0,On=0,Ur=null,xr=!1,zo=!1,wd=!1,Hs=0,ii=0,ao=0,qc=0,dE=0,Wi=0,zc=0,Od=null,_s=null,hE=!1,pE=0,Hp=1/0,Wp=null,pa=null,Nd=!1,Xo=null,tu=0,eu=0,Kp=null,Xc=0,nu=null;function cr(){if((zn&2)!==0&&sn!==0)return sn&-sn;if(Pt.T!==null){var s=Wl;return s!==0?s:yE()}return Am()}function fE(){Wi===0&&(Wi=(sn&536870912)===0||fn?bc():536870912);var s=fs.current;return s!==null&&(s.flags|=32),Wi}function Ii(s,o,u){(s===Ln&&On===2||s.cancelPendingCommit!==null)&&(iu(s,0),ns(s,sn,Wi,!1)),Gu(s,u),((zn&2)===0||s!==Ln)&&(s===Ln&&((zn&2)===0&&(qc|=u),ii===4&&ns(s,sn,Wi,!1)),fa(s))}function Jo(s,o,u){if((zn&6)!==0)throw Error(y(327));var f=!u&&(o&60)===0&&(o&s.expiredLanes)===0||xa(s,o),g=f?dR(s,o):zp(s,o,!0),C=f;do{if(g===0){zo&&!f&&ns(s,o,0,!1);break}else if(g===6)ns(s,o,0,!xr);else{if(u=s.current.alternate,C&&!vb(u)){g=zp(s,o,!1),C=!1;continue}if(g===2){if(C=o,s.errorRecoveryDisabledLanes&C)var k=0;else k=s.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){o=k;t:{var j=s;g=Od;var z=j.current.memoizedState.isDehydrated;if(z&&(iu(j,k).flags|=256),k=zp(j,k,!1),k!==2){if(wd&&!z){j.errorRecoveryDisabledLanes|=C,qc|=C,g=4;break t}C=_s,_s=g,C!==null&&Yp(C)}g=k}if(C=!1,g!==2)continue}}if(g===1){iu(s,0),ns(s,o,0,!0);break}t:{switch(f=s,g){case 0:case 1:throw Error(y(345));case 4:if((o&4194176)===o){ns(f,o,Wi,!xr);break t}break;case 2:_s=null;break;case 3:case 5:break;default:throw Error(y(329))}if(f.finishedWork=u,f.finishedLanes=o,(o&62914560)===o&&(C=pE+300-cs(),10<C)){if(ns(f,o,Wi,!xr),Fh(f,0)!==0)break t;f.timeoutHandle=yR(oR.bind(null,f,u,_s,Wp,hE,o,Wi,qc,zc,xr,2,-0,0),C);break t}oR(f,u,_s,Wp,hE,o,Wi,qc,zc,xr,0,-0,0)}}break}while(!0);fa(s)}function Yp(s){_s===null?_s=s:_s.push.apply(_s,s)}function oR(s,o,u,f,g,C,k,j,z,nt,bt,xt,pt){var yt=o.subtreeFlags;if((yt&8192||(yt&16785408)===16785408)&&(pu={stylesheets:null,count:0,unsuspend:BE},Ad(o),o=qb(),o!==null)){s.cancelPendingCommit=o(Jp.bind(null,s,u,f,g,k,j,z,1,xt,pt)),ns(s,C,k,!nt);return}Jp(s,u,f,g,k,j,z,bt,xt,pt)}function vb(s){for(var o=s;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var f=0;f<u.length;f++){var g=u[f],C=g.getSnapshot;g=g.value;try{if(!Qr(C(),g))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function ns(s,o,u,f){o&=~dE,o&=~qc,s.suspendedLanes|=o,s.pingedLanes&=~o,f&&(s.warmLanes|=o),f=s.expirationTimes;for(var g=o;0<g;){var C=31-Xr(g),k=1<<C;f[C]=-1,g&=~k}u!==0&&CS(s,u,o)}function qp(){return(zn&6)===0?(ou(0),!1):!0}function mE(){if(ze!==null){if(On===0)var s=ze.return;else s=ze,to=jc=null,g_(s),Ka=null,Uo=0,s=ze;for(;s!==null;)Gp(s.alternate,s),s=s.return;ze=null}}function iu(s,o){s.finishedWork=null,s.finishedLanes=0;var u=s.timeoutHandle;u!==-1&&(s.timeoutHandle=-1,Db(u)),u=s.cancelPendingCommit,u!==null&&(s.cancelPendingCommit=null,u()),mE(),Ln=s,ze=u=so(s.current,null),sn=o,On=0,Ur=null,xr=!1,zo=xa(s,o),wd=!1,zc=Wi=dE=qc=ao=ii=0,_s=Od=null,hE=!1,(o&8)!==0&&(o|=o&32);var f=s.entangledLanes;if(f!==0)for(s=s.entanglements,f&=o;0<f;){var g=31-Xr(f),C=1<<g;o|=s[g],f&=~C}return Hs=o,ip(),u}function cR(s,o){Ve=null,Pt.H=Vs,o===td?(o=cT(),On=3):o===sT?(o=cT(),On=4):On=o===jT?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,Ur=o,ze===null&&(ii=1,_d(s,hs(o,s.current)))}function lR(){var s=Pt.H;return Pt.H=Vs,s===null?Vs:s}function uR(){var s=Pt.A;return Pt.A=Id,s}function Dd(){ii=4,xr||(sn&4194176)!==sn&&fs.current!==null||(zo=!0),(ao&134217727)===0&&(qc&134217727)===0||Ln===null||ns(Ln,sn,Wi,!1)}function zp(s,o,u){var f=zn;zn|=2;var g=lR(),C=uR();(Ln!==s||sn!==o)&&(Wp=null,iu(s,o)),o=!1;var k=ii;t:do try{if(On!==0&&ze!==null){var j=ze,z=Ur;switch(On){case 8:mE(),k=6;break t;case 3:case 2:case 6:fs.current===null&&(o=!0);var nt=On;if(On=0,Ur=null,Jc(s,j,z,nt),u&&zo){k=0;break t}break;default:nt=On,On=0,Ur=null,Jc(s,j,z,nt)}}Cb(),k=ii;break}catch(bt){cR(s,bt)}while(!0);return o&&s.shellSuspendCounter++,to=jc=null,zn=f,Pt.H=g,Pt.A=C,ze===null&&(Ln=null,sn=0,ip()),k}function Cb(){for(;ze!==null;)ru(ze)}function dR(s,o){var u=zn;zn|=2;var f=lR(),g=uR();Ln!==s||sn!==o?(Wp=null,Hp=cs()+500,iu(s,o)):zo=xa(s,o);t:do try{if(On!==0&&ze!==null){o=ze;var C=Ur;e:switch(On){case 1:On=0,Ur=null,Jc(s,o,C,1);break;case 2:if(aT(C)){On=0,Ur=null,Ws(o);break}o=function(){On===2&&Ln===s&&(On=7),fa(s)},C.then(o,o);break t;case 3:On=7;break t;case 4:On=5;break t;case 7:aT(C)?(On=0,Ur=null,Ws(o)):(On=0,Ur=null,Jc(s,o,C,7));break;case 5:var k=null;switch(ze.tag){case 26:k=ze.memoizedState;case 5:case 27:var j=ze;if(!k||LR(k)){On=0,Ur=null;var z=j.sibling;if(z!==null)ze=z;else{var nt=j.return;nt!==null?(ze=nt,Xp(nt)):ze=null}break e}}On=0,Ur=null,Jc(s,o,C,5);break;case 6:On=0,Ur=null,Jc(s,o,C,6);break;case 8:mE(),ii=6;break t;default:throw Error(y(462))}}bb();break}catch(bt){cR(s,bt)}while(!0);return to=jc=null,Pt.H=f,Pt.A=g,zn=u,ze!==null?0:(Ln=null,sn=0,ip(),ii)}function bb(){for(;ze!==null&&!zr();)ru(ze)}function ru(s){var o=XT(s.alternate,s,Hs);s.memoizedProps=s.pendingProps,o===null?Xp(s):ze=o}function Ws(s){var o=s,u=o.alternate;switch(o.tag){case 15:case 0:o=YT(u,o,o.pendingProps,o.type,void 0,sn);break;case 11:o=YT(u,o,o.pendingProps,o.type.render,o.ref,sn);break;case 5:g_(o);default:Gp(u,o),o=ze=cE(o,Hs),o=XT(u,o,Hs)}s.memoizedProps=s.pendingProps,o===null?Xp(s):ze=o}function Jc(s,o,u,f){to=jc=null,g_(o),Ka=null,Uo=0;var g=o.return;try{if(FT(s,g,o,u,sn)){ii=1,_d(s,hs(u,s.current)),ze=null;return}}catch(C){if(g!==null)throw ze=g,C;ii=1,_d(s,hs(u,s.current)),ze=null;return}o.flags&32768?(fn||f===1?s=!0:zo||(sn&536870912)!==0?s=!1:(xr=s=!0,(f===2||f===3||f===6)&&(f=fs.current,f!==null&&f.tag===13&&(f.flags|=16384))),hR(o,s)):Xp(o)}function Xp(s){var o=s;do{if((o.flags&32768)!==0){hR(o,xr);return}s=o.return;var u=sR(o.alternate,o,Hs);if(u!==null){ze=u;return}if(o=o.sibling,o!==null){ze=o;return}ze=o=s}while(o!==null);ii===0&&(ii=5)}function hR(s,o){do{var u=yb(s.alternate,s);if(u!==null){u.flags&=32767,ze=u;return}if(u=s.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(s=s.sibling,s!==null)){ze=s;return}ze=s=u}while(s!==null);ii=6,ze=null}function Jp(s,o,u,f,g,C,k,j,z,nt){var bt=Pt.T,xt=zt.p;try{zt.p=2,Pt.T=null,pR(s,o,u,f,xt,g,C,k,j,z,nt)}finally{Pt.T=bt,zt.p=xt}}function pR(s,o,u,f,g,C,k,j){do oo();while(Xo!==null);if((zn&6)!==0)throw Error(y(327));var z=s.finishedWork;if(f=s.finishedLanes,z===null)return null;if(s.finishedWork=null,s.finishedLanes=0,z===s.current)throw Error(y(177));s.callbackNode=null,s.callbackPriority=0,s.cancelPendingCommit=null;var nt=z.lanes|z.childLanes;if(nt|=ko,Jr(s,f,nt,C,k,j),s===Ln&&(ze=Ln=null,sn=0),(z.subtreeFlags&10256)===0&&(z.flags&10256)===0||Nd||(Nd=!0,eu=nt,Kp=u,wb(Ps,function(){return oo(),null})),u=(z.flags&15990)!==0,(z.subtreeFlags&15990)!==0||u?(u=Pt.T,Pt.T=null,C=zt.p,zt.p=2,k=zn,zn|=4,Tb(s,z),nE(z,s),cb(DE,s.containerInfo),jd=!!NE,DE=NE=null,s.current=z,tR(s,z.alternate,z),vm(),zn=k,zt.p=C,Pt.T=u):s.current=z,Nd?(Nd=!1,Xo=s,tu=f):fR(s,nt),nt=s.pendingLanes,nt===0&&(pa=null),vc(z.stateNode),fa(s),o!==null)for(g=s.onRecoverableError,z=0;z<o.length;z++)nt=o[z],g(nt.value,{componentStack:nt.stack});return(tu&3)!==0&&oo(),nt=s.pendingLanes,(f&4194218)!==0&&(nt&42)!==0?s===nu?Xc++:(Xc=0,nu=s):Xc=0,ou(0),null}function fR(s,o){(s.pooledCacheLanes&=o)===0&&(o=s.pooledCache,o!=null&&(s.pooledCache=null,id(o)))}function oo(){if(Xo!==null){var s=Xo,o=eu;eu=0;var u=Hu(tu),f=Pt.T,g=zt.p;try{if(zt.p=32>u?32:u,Pt.T=null,Xo===null)var C=!1;else{u=Kp,Kp=null;var k=Xo,j=tu;if(Xo=null,tu=0,(zn&6)!==0)throw Error(y(331));var z=zn;if(zn|=4,aE(k.current),sE(k,k.current,j,u),zn=z,ou(0,!1),Nr&&typeof Nr.onPostCommitFiberRoot=="function")try{Nr.onPostCommitFiberRoot(Al,k)}catch{}C=!0}return C}finally{zt.p=g,Pt.T=f,fR(s,o)}}return!1}function co(s,o,u){o=hs(u,o),o=Za(s.stateNode,o,2),s=Fs(s,o,2),s!==null&&(Gu(s,2),fa(s))}function gn(s,o,u){if(s.tag===3)co(s,s,u);else for(;o!==null;){if(o.tag===3){co(o,s,u);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(pa===null||!pa.has(f))){s=hs(u,s),u=Np(2),f=Fs(o,u,2),f!==null&&(BT(u,f,o,s),Gu(f,2),fa(f));break}}o=o.return}}function _E(s,o,u){var f=s.pingCache;if(f===null){f=s.pingCache=new aR;var g=new Set;f.set(o,g)}else g=f.get(o),g===void 0&&(g=new Set,f.set(o,g));g.has(u)||(wd=!0,g.add(u),s=Ab.bind(null,s,o,u),o.then(s,s))}function Ab(s,o,u){var f=s.pingCache;f!==null&&f.delete(o),s.pingedLanes|=s.suspendedLanes&u,s.warmLanes&=~u,Ln===s&&(sn&u)===u&&(ii===4||ii===3&&(sn&62914560)===sn&&300>cs()-pE?(zn&2)===0&&iu(s,0):dE|=u,zc===sn&&(zc=0)),fa(s)}function mR(s,o){o===0&&(o=vS()),s=Mo(s,o),s!==null&&(Gu(s,o),fa(s))}function Ib(s){var o=s.memoizedState,u=0;o!==null&&(u=o.retryLane),mR(s,u)}function EE(s,o){var u=0;switch(s.tag){case 13:var f=s.stateNode,g=s.memoizedState;g!==null&&(u=g.retryLane);break;case 19:f=s.stateNode;break;case 22:f=s.stateNode._retryCache;break;default:throw Error(y(314))}f!==null&&f.delete(o),mR(s,u)}function wb(s,o){return ym(s,o)}var Qp=null,su=null,Zp=!1,au=!1,gE=!1,Qc=0;function fa(s){s!==su&&s.next===null&&(su===null?Qp=su=s:su=su.next=s),au=!0,Zp||(Zp=!0,_R(SE))}function ou(s,o){if(!gE&&au){gE=!0;do for(var u=!1,f=Qp;f!==null;){if(s!==0){var g=f.pendingLanes;if(g===0)var C=0;else{var k=f.suspendedLanes,j=f.pingedLanes;C=(1<<31-Xr(42|s)+1)-1,C&=g&~(k&~j),C=C&201326677?C&201326677|1:C?C|2:0}C!==0&&(u=!0,Ld(f,C))}else C=sn,C=Fh(f,f===Ln?C:0),(C&3)===0||xa(f,C)||(u=!0,Ld(f,C));f=f.next}while(u);gE=!1}}function SE(){au=Zp=!1;var s=0;Qc!==0&&(Nb()&&(s=Qc),Qc=0);for(var o=cs(),u=null,f=Qp;f!==null;){var g=f.next,C=TE(f,o);C===0?(f.next=null,u===null?Qp=g:u.next=g,g===null&&(su=u)):(u=f,(s!==0||(C&3)!==0)&&(au=!0)),f=g}ou(s)}function TE(s,o){for(var u=s.suspendedLanes,f=s.pingedLanes,g=s.expirationTimes,C=s.pendingLanes&-62914561;0<C;){var k=31-Xr(C),j=1<<k,z=g[k];z===-1?((j&u)===0||(j&f)!==0)&&(g[k]=MC(j,o)):z<=o&&(s.expiredLanes|=j),C&=~j}if(o=Ln,u=sn,u=Fh(s,s===o?u:0),f=s.callbackNode,u===0||s===o&&On===2||s.cancelPendingCommit!==null)return f!==null&&f!==null&&er(f),s.callbackNode=null,s.callbackPriority=0;if((u&3)===0||xa(s,u)){if(o=u&-u,o===s.callbackPriority)return o;switch(f!==null&&er(f),Hu(u)){case 2:case 8:u=nr;break;case 32:u=Ps;break;case 268435456:u=xh;break;default:u=Ps}return f=RE.bind(null,s),u=ym(u,f),s.callbackPriority=o,s.callbackNode=u,o}return f!==null&&f!==null&&er(f),s.callbackPriority=2,s.callbackNode=null,2}function RE(s,o){var u=s.callbackNode;if(oo()&&s.callbackNode!==u)return null;var f=sn;return f=Fh(s,s===Ln?f:0),f===0?null:(Jo(s,f,o),TE(s,cs()),s.callbackNode!=null&&s.callbackNode===u?RE.bind(null,s):null)}function Ld(s,o){if(oo())return null;Jo(s,o,!0)}function _R(s){Lb(function(){(zn&6)!==0?ym(Cm,s):s()})}function yE(){return Qc===0&&(Qc=bc()),Qc}function $p(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:qh(""+s)}function ER(s,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,s.id&&u.setAttribute("form",s.id),o.parentNode.insertBefore(u,o),s=new FormData(s),u.parentNode.removeChild(u),s}function Ob(s,o,u,f,g){if(o==="submit"&&u&&u.stateNode===g){var C=$p((g[Er]||null).action),k=f.submitter;k&&(o=(o=k[Er]||null)?$p(o.formAction):k.getAttribute("formAction"),o!==null&&(C=o,k=null));var j=new gr("action","action",null,f,g);s.push({event:j,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Qc!==0){var z=k?ER(g,k):new FormData(g);A_(u,{pending:!0,data:z,method:g.method,action:C},null,z)}}else typeof C=="function"&&(j.preventDefault(),z=k?ER(g,k):new FormData(g),A_(u,{pending:!0,data:z,method:g.method,action:C},C,z))},currentTarget:g}]})}}for(var Zc=0;Zc<rT.length;Zc++){var Pd=rT[Zc],gR=Pd.toLowerCase(),vE=Pd[0].toUpperCase()+Pd.slice(1);Ms(gR,"on"+vE)}Ms(np,"onAnimationEnd"),Ms(eT,"onAnimationIteration"),Ms(_t,"onAnimationStart"),Ms("dblclick","onDoubleClick"),Ms("focusin","onFocus"),Ms("focusout","onBlur"),Ms(ub,"onTransitionRun"),Ms(db,"onTransitionStart"),Ms(hb,"onTransitionCancel"),Ms(nT,"onTransitionEnd"),Dl("onMouseEnter",["mouseout","mouseover"]),Dl("onMouseLeave",["mouseout","mouseover"]),Dl("onPointerEnter",["pointerout","pointerover"]),Dl("onPointerLeave",["pointerout","pointerover"]),wc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),wc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),wc("onBeforeInput",["compositionend","keypress","textInput","paste"]),wc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),wc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),wc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $c="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),CE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat($c));function SR(s,o){o=(o&4)!==0;for(var u=0;u<s.length;u++){var f=s[u],g=f.event;f=f.listeners;t:{var C=void 0;if(o)for(var k=f.length-1;0<=k;k--){var j=f[k],z=j.instance,nt=j.currentTarget;if(j=j.listener,z!==C&&g.isPropagationStopped())break t;C=j,g.currentTarget=nt;try{C(g)}catch(bt){Op(bt)}g.currentTarget=null,C=z}else for(k=0;k<f.length;k++){if(j=f[k],z=j.instance,nt=j.currentTarget,j=j.listener,z!==C&&g.isPropagationStopped())break t;C=j,g.currentTarget=nt;try{C(g)}catch(bt){Op(bt)}g.currentTarget=null,C=z}}}}function an(s,o){var u=o[Im];u===void 0&&(u=o[Im]=new Set);var f=s+"__bubble";u.has(f)||(bE(o,s,2,!1),u.add(f))}function tf(s,o,u){var f=0;o&&(f|=4),bE(u,s,f,o)}var kd="_reactListening"+Math.random().toString(36).slice(2);function ef(s){if(!s[kd]){s[kd]=!0,di.forEach(function(u){u!=="selectionchange"&&(CE.has(u)||tf(u,!1,s),tf(u,!0,s))});var o=s.nodeType===9?s:s.ownerDocument;o===null||o[kd]||(o[kd]=!0,tf("selectionchange",!1,o))}}function bE(s,o,u,f){switch(BR(o)){case 2:var g=GE;break;case 8:g=VR;break;default:g=Gd}u=g.bind(null,o,u,s),g=void 0,!Um||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(g=!0),f?g!==void 0?s.addEventListener(o,u,{capture:!0,passive:g}):s.addEventListener(o,u,!0):g!==void 0?s.addEventListener(o,u,{passive:g}):s.addEventListener(o,u,!1)}function nf(s,o,u,f,g){var C=f;if((o&1)===0&&(o&2)===0&&f!==null)t:for(;;){if(f===null)return;var k=f.tag;if(k===3||k===4){var j=f.stateNode.containerInfo;if(j===g||j.nodeType===8&&j.parentNode===g)break;if(k===4)for(k=f.return;k!==null;){var z=k.tag;if((z===3||z===4)&&(z=k.stateNode.containerInfo,z===g||z.nodeType===8&&z.parentNode===g))return;k=k.return}for(;j!==null;){if(k=Ic(j),k===null)return;if(z=k.tag,z===5||z===6||z===26||z===27){f=C=k;continue t}j=j.parentNode}}f=f.return}kS(function(){var nt=C,bt=Mm(u),xt=[];t:{var pt=iT.get(s);if(pt!==void 0){var yt=gr,se=s;switch(s){case"keypress":if(qu(u)===0)break t;case"keydown":case"keyup":yt=zC;break;case"focusin":se="focus",yt=Fm;break;case"focusout":se="blur",yt=Fm;break;case"beforeblur":case"afterblur":yt=Fm;break;case"click":if(u.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":yt=xS;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":yt=Zh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":yt=Ul;break;case np:case eT:case _t:yt=WC;break;case nT:yt=QC;break;case"scroll":case"scrollend":yt=GC;break;case"wheel":yt=ZC;break;case"copy":case"cut":case"paste":yt=Hm;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":yt=Oc;break;case"toggle":case"beforetoggle":yt=tb}var Le=(o&4)!==0,ti=!Le&&(s==="scroll"||s==="scrollend"),ot=Le?pt!==null?pt+"Capture":null:pt;Le=[];for(var et=nt,ut;et!==null;){var Nt=et;if(ut=Nt.stateNode,Nt=Nt.tag,Nt!==5&&Nt!==26&&Nt!==27||ut===null||ot===null||(Nt=Yu(et,ot),Nt!=null&&Le.push(Md(et,Nt,ut))),ti)break;et=et.return}0<Le.length&&(pt=new yt(pt,se,null,u,bt),xt.push({event:pt,listeners:Le}))}}if((o&7)===0){t:{if(pt=s==="mouseover"||s==="pointerover",yt=s==="mouseout"||s==="pointerout",pt&&u!==km&&(se=u.relatedTarget||u.fromElement)&&(Ic(se)||se[Ac]))break t;if((yt||pt)&&(pt=bt.window===bt?bt:(pt=bt.ownerDocument)?pt.defaultView||pt.parentWindow:window,yt?(se=u.relatedTarget||u.toElement,yt=nt,se=se?Ic(se):null,se!==null&&(ti=re(se),Le=se.tag,se!==ti||Le!==5&&Le!==27&&Le!==6)&&(se=null)):(yt=null,se=nt),yt!==se)){if(Le=xS,Nt="onMouseLeave",ot="onMouseEnter",et="mouse",(s==="pointerout"||s==="pointerover")&&(Le=Oc,Nt="onPointerLeave",ot="onPointerEnter",et="pointer"),ti=yt==null?pt:Dr(yt),ut=se==null?pt:Dr(se),pt=new Le(Nt,et+"leave",yt,u,bt),pt.target=ti,pt.relatedTarget=ut,Nt=null,Ic(bt)===nt&&(Le=new Le(ot,et+"enter",se,u,bt),Le.target=ut,Le.relatedTarget=ti,Nt=Le),ti=Nt,yt&&se)e:{for(Le=yt,ot=se,et=0,ut=Le;ut;ut=cu(ut))et++;for(ut=0,Nt=ot;Nt;Nt=cu(Nt))ut++;for(;0<et-ut;)Le=cu(Le),et--;for(;0<ut-et;)ot=cu(ot),ut--;for(;et--;){if(Le===ot||ot!==null&&Le===ot.alternate)break e;Le=cu(Le),ot=cu(ot)}Le=null}else Le=null;yt!==null&&tl(xt,pt,yt,Le,!1),se!==null&&ti!==null&&tl(xt,ti,se,Le,!0)}}t:{if(pt=nt?Dr(nt):window,yt=pt.nodeName&&pt.nodeName.toLowerCase(),yt==="select"||yt==="input"&&pt.type==="file")var ne=KS;else if(WS(pt))if(YS)ne=ob;else{ne=Qm;var me=XS}else yt=pt.nodeName,!yt||yt.toLowerCase()!=="input"||pt.type!=="checkbox"&&pt.type!=="radio"?nt&&Yh(nt.elementType)&&(ne=KS):ne=ab;if(ne&&(ne=ne(s,nt))){qm(xt,ne,u,bt);break t}me&&me(s,pt,nt),s==="focusout"&&nt&&pt.type==="number"&&nt.memoizedProps.value!=null&&Lm(pt,"number",pt.value)}switch(me=nt?Dr(nt):window,s){case"focusin":(WS(me)||me.contentEditable==="true")&&(Vl=me,Zm=nt,Bl=null);break;case"focusout":Bl=Zm=Vl=null;break;case"mousedown":$m=!0;break;case"contextmenu":case"mouseup":case"dragend":$m=!1,$S(xt,u,bt);break;case"selectionchange":if(lb)break;case"keydown":case"keyup":$S(xt,u,bt)}var oe;if(zu)t:{switch(s){case"compositionstart":var Ee="onCompositionStart";break t;case"compositionend":Ee="onCompositionEnd";break t;case"compositionupdate":Ee="onCompositionUpdate";break t}Ee=void 0}else xl?HS(s,u)&&(Ee="onCompositionEnd"):s==="keydown"&&u.keyCode===229&&(Ee="onCompositionStart");Ee&&(jS&&u.locale!=="ko"&&(xl||Ee!=="onCompositionStart"?Ee==="onCompositionEnd"&&xl&&(oe=MS()):(Lo=bt,xm="value"in Lo?Lo.value:Lo.textContent,xl=!0)),me=Ud(nt,Ee),0<me.length&&(Ee=new BS(Ee,s,null,u,bt),xt.push({event:Ee,listeners:me}),oe?Ee.data=oe:(oe=Ym(u),oe!==null&&(Ee.data=oe)))),(oe=nb?ja(s,u):ib(s,u))&&(Ee=Ud(nt,"onBeforeInput"),0<Ee.length&&(me=new BS("onBeforeInput","beforeinput",null,u,bt),xt.push({event:me,listeners:Ee}),me.data=oe)),Ob(xt,s,nt,u,bt)}SR(xt,o)})}function Md(s,o,u){return{instance:s,listener:o,currentTarget:u}}function Ud(s,o){for(var u=o+"Capture",f=[];s!==null;){var g=s,C=g.stateNode;g=g.tag,g!==5&&g!==26&&g!==27||C===null||(g=Yu(s,u),g!=null&&f.unshift(Md(s,g,C)),g=Yu(s,o),g!=null&&f.push(Md(s,g,C))),s=s.return}return f}function cu(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function tl(s,o,u,f,g){for(var C=o._reactName,k=[];u!==null&&u!==f;){var j=u,z=j.alternate,nt=j.stateNode;if(j=j.tag,z!==null&&z===f)break;j!==5&&j!==26&&j!==27||nt===null||(z=nt,g?(nt=Yu(u,C),nt!=null&&k.unshift(Md(u,nt,z))):g||(nt=Yu(u,C),nt!=null&&k.push(Md(u,nt,z)))),u=u.return}k.length!==0&&s.push({event:o,listeners:k})}var lu=/\r\n?/g,AE=/\u0000|\uFFFD/g;function IE(s){return(typeof s=="string"?s:""+s).replace(lu,`
`).replace(AE,"")}function wE(s,o){return o=IE(o),IE(s)===o}function rf(){}function Nn(s,o,u,f,g,C){switch(u){case"children":typeof f=="string"?o==="body"||o==="textarea"&&f===""||Do(s,f):(typeof f=="number"||typeof f=="bigint")&&o!=="body"&&Do(s,""+f);break;case"className":Hh(s,"class",f);break;case"tabIndex":Hh(s,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Hh(s,u,f);break;case"style":LS(s,f,C);break;case"data":if(o!=="object"){Hh(s,"data",f);break}case"src":case"href":if(f===""&&(o!=="a"||u!=="href")){s.removeAttribute(u);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(u);break}f=qh(""+f),s.setAttribute(u,f);break;case"action":case"formAction":if(typeof f=="function"){s.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof C=="function"&&(u==="formAction"?(o!=="input"&&Nn(s,o,"name",g.name,g,null),Nn(s,o,"formEncType",g.formEncType,g,null),Nn(s,o,"formMethod",g.formMethod,g,null),Nn(s,o,"formTarget",g.formTarget,g,null)):(Nn(s,o,"encType",g.encType,g,null),Nn(s,o,"method",g.method,g,null),Nn(s,o,"target",g.target,g,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(u);break}f=qh(""+f),s.setAttribute(u,f);break;case"onClick":f!=null&&(s.onclick=rf);break;case"onScroll":f!=null&&an("scroll",s);break;case"onScrollEnd":f!=null&&an("scrollend",s);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(y(61));if(u=f.__html,u!=null){if(g.children!=null)throw Error(y(60));s.innerHTML=u}}break;case"multiple":s.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":s.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){s.removeAttribute("xlink:href");break}u=qh(""+f),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(u,""+f):s.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(u,""):s.removeAttribute(u);break;case"capture":case"download":f===!0?s.setAttribute(u,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(u,f):s.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?s.setAttribute(u,f):s.removeAttribute(u);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?s.removeAttribute(u):s.setAttribute(u,f);break;case"popover":an("beforetoggle",s),an("toggle",s),Gh(s,"popover",f);break;case"xlinkActuate":Lr(s,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Lr(s,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Lr(s,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Lr(s,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Lr(s,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Lr(s,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Lr(s,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Lr(s,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Lr(s,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Gh(s,"is",f);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=FC.get(u)||u,Gh(s,u,f))}}function OE(s,o,u,f,g,C){switch(u){case"style":LS(s,f,C);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(y(61));if(u=f.__html,u!=null){if(g.children!=null)throw Error(y(60));s.innerHTML=u}}break;case"children":typeof f=="string"?Do(s,f):(typeof f=="number"||typeof f=="bigint")&&Do(s,""+f);break;case"onScroll":f!=null&&an("scroll",s);break;case"onScrollEnd":f!=null&&an("scrollend",s);break;case"onClick":f!=null&&(s.onclick=rf);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!wS.hasOwnProperty(u))t:{if(u[0]==="o"&&u[1]==="n"&&(g=u.endsWith("Capture"),o=u.slice(2,g?u.length-7:void 0),C=s[Er]||null,C=C!=null?C[u]:null,typeof C=="function"&&s.removeEventListener(o,C,g),typeof f=="function")){typeof C!="function"&&C!==null&&(u in s?s[u]=null:s.hasAttribute(u)&&s.removeAttribute(u)),s.addEventListener(o,f,g);break t}u in s?s[u]=f:f===!0?s.setAttribute(u,""):Gh(s,u,f)}}}function Xi(s,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":an("error",s),an("load",s);var f=!1,g=!1,C;for(C in u)if(u.hasOwnProperty(C)){var k=u[C];if(k!=null)switch(C){case"src":f=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(y(137,o));default:Nn(s,o,C,k,u,null)}}g&&Nn(s,o,"srcSet",u.srcSet,u,null),f&&Nn(s,o,"src",u.src,u,null);return;case"input":an("invalid",s);var j=C=k=g=null,z=null,nt=null;for(f in u)if(u.hasOwnProperty(f)){var bt=u[f];if(bt!=null)switch(f){case"name":g=bt;break;case"type":k=bt;break;case"checked":z=bt;break;case"defaultChecked":nt=bt;break;case"value":C=bt;break;case"defaultValue":j=bt;break;case"children":case"dangerouslySetInnerHTML":if(bt!=null)throw Error(y(137,o));break;default:Nn(s,o,f,bt,u,null)}}DS(s,C,j,z,nt,k,g,!1),Wh(s);return;case"select":an("invalid",s),f=k=C=null;for(g in u)if(u.hasOwnProperty(g)&&(j=u[g],j!=null))switch(g){case"value":C=j;break;case"defaultValue":k=j;break;case"multiple":f=j;default:Nn(s,o,g,j,u,null)}o=C,u=k,s.multiple=!!f,o!=null?Ll(s,!!f,o,!1):u!=null&&Ll(s,!!f,u,!0);return;case"textarea":an("invalid",s),C=g=f=null;for(k in u)if(u.hasOwnProperty(k)&&(j=u[k],j!=null))switch(k){case"value":f=j;break;case"defaultValue":g=j;break;case"children":C=j;break;case"dangerouslySetInnerHTML":if(j!=null)throw Error(y(91));break;default:Nn(s,o,k,j,u,null)}Pm(s,f,g,C),Wh(s);return;case"option":for(z in u)if(u.hasOwnProperty(z)&&(f=u[z],f!=null))switch(z){case"selected":s.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:Nn(s,o,z,f,u,null)}return;case"dialog":an("cancel",s),an("close",s);break;case"iframe":case"object":an("load",s);break;case"video":case"audio":for(f=0;f<$c.length;f++)an($c[f],s);break;case"image":an("error",s),an("load",s);break;case"details":an("toggle",s);break;case"embed":case"source":case"link":an("error",s),an("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(nt in u)if(u.hasOwnProperty(nt)&&(f=u[nt],f!=null))switch(nt){case"children":case"dangerouslySetInnerHTML":throw Error(y(137,o));default:Nn(s,o,nt,f,u,null)}return;default:if(Yh(o)){for(bt in u)u.hasOwnProperty(bt)&&(f=u[bt],f!==void 0&&OE(s,o,bt,f,u,void 0));return}}for(j in u)u.hasOwnProperty(j)&&(f=u[j],f!=null&&Nn(s,o,j,f,u,null))}function sf(s,o,u,f){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,C=null,k=null,j=null,z=null,nt=null,bt=null;for(yt in u){var xt=u[yt];if(u.hasOwnProperty(yt)&&xt!=null)switch(yt){case"checked":break;case"value":break;case"defaultValue":z=xt;default:f.hasOwnProperty(yt)||Nn(s,o,yt,null,f,xt)}}for(var pt in f){var yt=f[pt];if(xt=u[pt],f.hasOwnProperty(pt)&&(yt!=null||xt!=null))switch(pt){case"type":C=yt;break;case"name":g=yt;break;case"checked":nt=yt;break;case"defaultChecked":bt=yt;break;case"value":k=yt;break;case"defaultValue":j=yt;break;case"children":case"dangerouslySetInnerHTML":if(yt!=null)throw Error(y(137,o));break;default:yt!==xt&&Nn(s,o,pt,yt,f,xt)}}Dm(s,k,j,z,nt,bt,C,g);return;case"select":yt=k=j=pt=null;for(C in u)if(z=u[C],u.hasOwnProperty(C)&&z!=null)switch(C){case"value":break;case"multiple":yt=z;default:f.hasOwnProperty(C)||Nn(s,o,C,null,f,z)}for(g in f)if(C=f[g],z=u[g],f.hasOwnProperty(g)&&(C!=null||z!=null))switch(g){case"value":pt=C;break;case"defaultValue":j=C;break;case"multiple":k=C;default:C!==z&&Nn(s,o,g,C,f,z)}o=j,u=k,f=yt,pt!=null?Ll(s,!!u,pt,!1):!!f!=!!u&&(o!=null?Ll(s,!!u,o,!0):Ll(s,!!u,u?[]:"",!1));return;case"textarea":yt=pt=null;for(j in u)if(g=u[j],u.hasOwnProperty(j)&&g!=null&&!f.hasOwnProperty(j))switch(j){case"value":break;case"children":break;default:Nn(s,o,j,null,f,g)}for(k in f)if(g=f[k],C=u[k],f.hasOwnProperty(k)&&(g!=null||C!=null))switch(k){case"value":pt=g;break;case"defaultValue":yt=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(y(91));break;default:g!==C&&Nn(s,o,k,g,f,C)}Ku(s,pt,yt);return;case"option":for(var se in u)if(pt=u[se],u.hasOwnProperty(se)&&pt!=null&&!f.hasOwnProperty(se))switch(se){case"selected":s.selected=!1;break;default:Nn(s,o,se,null,f,pt)}for(z in f)if(pt=f[z],yt=u[z],f.hasOwnProperty(z)&&pt!==yt&&(pt!=null||yt!=null))switch(z){case"selected":s.selected=pt&&typeof pt!="function"&&typeof pt!="symbol";break;default:Nn(s,o,z,pt,f,yt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Le in u)pt=u[Le],u.hasOwnProperty(Le)&&pt!=null&&!f.hasOwnProperty(Le)&&Nn(s,o,Le,null,f,pt);for(nt in f)if(pt=f[nt],yt=u[nt],f.hasOwnProperty(nt)&&pt!==yt&&(pt!=null||yt!=null))switch(nt){case"children":case"dangerouslySetInnerHTML":if(pt!=null)throw Error(y(137,o));break;default:Nn(s,o,nt,pt,f,yt)}return;default:if(Yh(o)){for(var ti in u)pt=u[ti],u.hasOwnProperty(ti)&&pt!==void 0&&!f.hasOwnProperty(ti)&&OE(s,o,ti,void 0,f,pt);for(bt in f)pt=f[bt],yt=u[bt],!f.hasOwnProperty(bt)||pt===yt||pt===void 0&&yt===void 0||OE(s,o,bt,pt,f,yt);return}}for(var ot in u)pt=u[ot],u.hasOwnProperty(ot)&&pt!=null&&!f.hasOwnProperty(ot)&&Nn(s,o,ot,null,f,pt);for(xt in f)pt=f[xt],yt=u[xt],!f.hasOwnProperty(xt)||pt===yt||pt==null&&yt==null||Nn(s,o,xt,pt,f,yt)}var NE=null,DE=null;function af(s){return s.nodeType===9?s:s.ownerDocument}function TR(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function RR(s,o){if(s===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&o==="foreignObject"?0:s}function LE(s,o){return s==="textarea"||s==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var PE=null;function Nb(){var s=window.event;return s&&s.type==="popstate"?s===PE?!1:(PE=s,!0):(PE=null,!1)}var yR=typeof setTimeout=="function"?setTimeout:void 0,Db=typeof clearTimeout=="function"?clearTimeout:void 0,vR=typeof Promise=="function"?Promise:void 0,Lb=typeof queueMicrotask=="function"?queueMicrotask:typeof vR<"u"?function(s){return vR.resolve(null).then(s).catch(Pb)}:yR;function Pb(s){setTimeout(function(){throw s})}function kE(s,o){var u=o,f=0;do{var g=u.nextSibling;if(s.removeChild(u),g&&g.nodeType===8)if(u=g.data,u==="/$"){if(f===0){s.removeChild(g),Yd(o);return}f--}else u!=="$"&&u!=="$?"&&u!=="$!"||f++;u=g}while(u);Yd(o)}function ME(s){var o=s.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":ME(u),No(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}s.removeChild(u)}}function kb(s,o,u,f){for(;s.nodeType===1;){var g=u;if(s.nodeName.toLowerCase()!==o.toLowerCase()){if(!f&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(f){if(!s[wl])switch(o){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(C=s.getAttribute("rel"),C==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(C!==g.rel||s.getAttribute("href")!==(g.href==null?null:g.href)||s.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||s.getAttribute("title")!==(g.title==null?null:g.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(C=s.getAttribute("src"),(C!==(g.src==null?null:g.src)||s.getAttribute("type")!==(g.type==null?null:g.type)||s.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&C&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(o==="input"&&s.type==="hidden"){var C=g.name==null?null:""+g.name;if(g.type==="hidden"&&s.getAttribute("name")===C)return s}else return s;if(s=Es(s.nextSibling),s===null)break}return null}function Mb(s,o,u){if(o==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!u||(s=Es(s.nextSibling),s===null))return null;return s}function Es(s){for(;s!=null;s=s.nextSibling){var o=s.nodeType;if(o===1||o===3)break;if(o===8){if(o=s.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return s}function CR(s){s=s.previousSibling;for(var o=0;s;){if(s.nodeType===8){var u=s.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return s;o--}else u==="/$"&&o++}s=s.previousSibling}return null}function bR(s,o,u){switch(o=af(u),s){case"html":if(s=o.documentElement,!s)throw Error(y(452));return s;case"head":if(s=o.head,!s)throw Error(y(453));return s;case"body":if(s=o.body,!s)throw Error(y(454));return s;default:throw Error(y(451))}}var gs=new Map,AR=new Set;function of(s){return typeof s.getRootNode=="function"?s.getRootNode():s.ownerDocument}var lo=zt.d;zt.d={f:Ub,r:xb,D:Vb,C:Bb,L:Fb,m:jb,X:Hb,S:Gb,M:Wb};function Ub(){var s=lo.f(),o=qp();return s||o}function xb(s){var o=Ol(s);o!==null&&o.tag===5&&o.type==="form"?MT(o):lo.r(s)}var uu=typeof document>"u"?null:document;function IR(s,o,u){var f=uu;if(f&&typeof o=="string"&&o){var g=ls(o);g='link[rel="'+s+'"][href="'+g+'"]',typeof u=="string"&&(g+='[crossorigin="'+u+'"]'),AR.has(g)||(AR.add(g),s={rel:s,crossOrigin:u,href:o},f.querySelector(g)===null&&(o=f.createElement("link"),Xi(o,"link",s),ji(o),f.head.appendChild(o)))}}function Vb(s){lo.D(s),IR("dns-prefetch",s,null)}function Bb(s,o){lo.C(s,o),IR("preconnect",s,o)}function Fb(s,o,u){lo.L(s,o,u);var f=uu;if(f&&s&&o){var g='link[rel="preload"][as="'+ls(o)+'"]';o==="image"&&u&&u.imageSrcSet?(g+='[imagesrcset="'+ls(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(g+='[imagesizes="'+ls(u.imageSizes)+'"]')):g+='[href="'+ls(s)+'"]';var C=g;switch(o){case"style":C=du(s);break;case"script":C=hu(s)}gs.has(C)||(s=Zt({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:s,as:o},u),gs.set(C,s),f.querySelector(g)!==null||o==="style"&&f.querySelector(el(C))||o==="script"&&f.querySelector(xd(C))||(o=f.createElement("link"),Xi(o,"link",s),ji(o),f.head.appendChild(o)))}}function jb(s,o){lo.m(s,o);var u=uu;if(u&&s){var f=o&&typeof o.as=="string"?o.as:"script",g='link[rel="modulepreload"][as="'+ls(f)+'"][href="'+ls(s)+'"]',C=g;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":C=hu(s)}if(!gs.has(C)&&(s=Zt({rel:"modulepreload",href:s},o),gs.set(C,s),u.querySelector(g)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(xd(C)))return}f=u.createElement("link"),Xi(f,"link",s),ji(f),u.head.appendChild(f)}}}function Gb(s,o,u){lo.S(s,o,u);var f=uu;if(f&&s){var g=Nl(f).hoistableStyles,C=du(s);o=o||"default";var k=g.get(C);if(!k){var j={loading:0,preload:null};if(k=f.querySelector(el(C)))j.loading=5;else{s=Zt({rel:"stylesheet",href:s,"data-precedence":o},u),(u=gs.get(C))&&Vd(s,u);var z=k=f.createElement("link");ji(z),Xi(z,"link",s),z._p=new Promise(function(nt,bt){z.onload=nt,z.onerror=bt}),z.addEventListener("load",function(){j.loading|=1}),z.addEventListener("error",function(){j.loading|=2}),j.loading|=4,cf(k,o,f)}k={type:"stylesheet",instance:k,count:1,state:j},g.set(C,k)}}}function Hb(s,o){lo.X(s,o);var u=uu;if(u&&s){var f=Nl(u).hoistableScripts,g=hu(s),C=f.get(g);C||(C=u.querySelector(xd(g)),C||(s=Zt({src:s,async:!0},o),(o=gs.get(g))&&VE(s,o),C=u.createElement("script"),ji(C),Xi(C,"link",s),u.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},f.set(g,C))}}function Wb(s,o){lo.M(s,o);var u=uu;if(u&&s){var f=Nl(u).hoistableScripts,g=hu(s),C=f.get(g);C||(C=u.querySelector(xd(g)),C||(s=Zt({src:s,async:!0,type:"module"},o),(o=gs.get(g))&&VE(s,o),C=u.createElement("script"),ji(C),Xi(C,"link",s),u.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},f.set(g,C))}}function UE(s,o,u,f){var g=(g=Oo.current)?of(g):null;if(!g)throw Error(y(446));switch(s){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=du(u.href),u=Nl(g).hoistableStyles,f=u.get(o),f||(f={type:"style",instance:null,count:0,state:null},u.set(o,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){s=du(u.href);var C=Nl(g).hoistableStyles,k=C.get(s);if(k||(g=g.ownerDocument||g,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},C.set(s,k),(C=g.querySelector(el(s)))&&!C._p&&(k.instance=C,k.state.loading=5),gs.has(s)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},gs.set(s,u),C||Kb(g,s,u,k.state))),o&&f===null)throw Error(y(528,""));return k}if(o&&f!==null)throw Error(y(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=hu(u),u=Nl(g).hoistableScripts,f=u.get(o),f||(f={type:"script",instance:null,count:0,state:null},u.set(o,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(y(444,s))}}function du(s){return'href="'+ls(s)+'"'}function el(s){return'link[rel="stylesheet"]['+s+"]"}function wR(s){return Zt({},s,{"data-precedence":s.precedence,precedence:null})}function Kb(s,o,u,f){s.querySelector('link[rel="preload"][as="style"]['+o+"]")?f.loading=1:(o=s.createElement("link"),f.preload=o,o.addEventListener("load",function(){return f.loading|=1}),o.addEventListener("error",function(){return f.loading|=2}),Xi(o,"link",u),ji(o),s.head.appendChild(o))}function hu(s){return'[src="'+ls(s)+'"]'}function xd(s){return"script[async]"+s}function xE(s,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var f=s.querySelector('style[data-href~="'+ls(u.href)+'"]');if(f)return o.instance=f,ji(f),f;var g=Zt({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return f=(s.ownerDocument||s).createElement("style"),ji(f),Xi(f,"style",g),cf(f,u.precedence,s),o.instance=f;case"stylesheet":g=du(u.href);var C=s.querySelector(el(g));if(C)return o.state.loading|=4,o.instance=C,ji(C),C;f=wR(u),(g=gs.get(g))&&Vd(f,g),C=(s.ownerDocument||s).createElement("link"),ji(C);var k=C;return k._p=new Promise(function(j,z){k.onload=j,k.onerror=z}),Xi(C,"link",f),o.state.loading|=4,cf(C,u.precedence,s),o.instance=C;case"script":return C=hu(u.src),(g=s.querySelector(xd(C)))?(o.instance=g,ji(g),g):(f=u,(g=gs.get(C))&&(f=Zt({},u),VE(f,g)),s=s.ownerDocument||s,g=s.createElement("script"),ji(g),Xi(g,"link",f),s.head.appendChild(g),o.instance=g);case"void":return null;default:throw Error(y(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(f=o.instance,o.state.loading|=4,cf(f,u.precedence,s));return o.instance}function cf(s,o,u){for(var f=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=f.length?f[f.length-1]:null,C=g,k=0;k<f.length;k++){var j=f[k];if(j.dataset.precedence===o)C=j;else if(C!==g)break}C?C.parentNode.insertBefore(s,C.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(s,o.firstChild))}function Vd(s,o){s.crossOrigin==null&&(s.crossOrigin=o.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=o.referrerPolicy),s.title==null&&(s.title=o.title)}function VE(s,o){s.crossOrigin==null&&(s.crossOrigin=o.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=o.referrerPolicy),s.integrity==null&&(s.integrity=o.integrity)}var lf=null;function OR(s,o,u){if(lf===null){var f=new Map,g=lf=new Map;g.set(u,f)}else g=lf,f=g.get(u),f||(f=new Map,g.set(u,f));if(f.has(s))return f;for(f.set(s,null),u=u.getElementsByTagName(s),g=0;g<u.length;g++){var C=u[g];if(!(C[wl]||C[ir]||s==="link"&&C.getAttribute("rel")==="stylesheet")&&C.namespaceURI!=="http://www.w3.org/2000/svg"){var k=C.getAttribute(o)||"";k=s+k;var j=f.get(k);j?j.push(C):f.set(k,[C])}}return f}function NR(s,o,u){s=s.ownerDocument||s,s.head.insertBefore(u,o==="title"?s.querySelector("head > title"):null)}function DR(s,o,u){if(u===1||o.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return s=o.disabled,typeof o.precedence=="string"&&s==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function LR(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}var pu=null;function BE(){}function Yb(s,o,u){if(pu===null)throw Error(y(475));var f=pu;if(o.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var g=du(u.href),C=s.querySelector(el(g));if(C){s=C._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(f.count++,f=Bd.bind(f),s.then(f,f)),o.state.loading|=4,o.instance=C,ji(C);return}C=s.ownerDocument||s,u=wR(u),(g=gs.get(g))&&Vd(u,g),C=C.createElement("link"),ji(C);var k=C;k._p=new Promise(function(j,z){k.onload=j,k.onerror=z}),Xi(C,"link",u),o.instance=C}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(o,s),(s=o.state.preload)&&(o.state.loading&3)===0&&(f.count++,o=Bd.bind(f),s.addEventListener("load",o),s.addEventListener("error",o))}}function qb(){if(pu===null)throw Error(y(475));var s=pu;return s.stylesheets&&s.count===0&&df(s,s.stylesheets),0<s.count?function(o){var u=setTimeout(function(){if(s.stylesheets&&df(s,s.stylesheets),s.unsuspend){var f=s.unsuspend;s.unsuspend=null,f()}},6e4);return s.unsuspend=o,function(){s.unsuspend=null,clearTimeout(u)}}:null}function Bd(){if(this.count--,this.count===0){if(this.stylesheets)df(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var uf=null;function df(s,o){s.stylesheets=null,s.unsuspend!==null&&(s.count++,uf=new Map,o.forEach(PR,s),uf=null,Bd.call(s))}function PR(s,o){if(!(o.state.loading&4)){var u=uf.get(s);if(u)var f=u.get(null);else{u=new Map,uf.set(s,u);for(var g=s.querySelectorAll("link[data-precedence],style[data-precedence]"),C=0;C<g.length;C++){var k=g[C];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(u.set(k.dataset.precedence,k),f=k)}f&&u.set(null,f)}g=o.instance,k=g.getAttribute("data-precedence"),C=u.get(k)||f,C===f&&u.set(null,g),u.set(k,g),this.count++,f=Bd.bind(this),g.addEventListener("load",f),g.addEventListener("error",f),C?C.parentNode.insertBefore(g,C.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(g,s.firstChild)),o.state.loading|=4}}var Fd={$$typeof:Mt,Provider:null,Consumer:null,_currentValue:en,_currentValue2:en,_threadCount:0};function zb(s,o,u,f,g,C,k,j){this.tag=1,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=bm(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=bm(0),this.hiddenUpdates=bm(null),this.identifierPrefix=f,this.onUncaughtError=g,this.onCaughtError=C,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=j,this.incompleteTransitions=new Map}function kR(s,o,u,f,g,C,k,j,z,nt,bt,xt){return s=new zb(s,o,u,k,j,z,nt,xt),o=1,C===!0&&(o|=24),C=es(3,null,null,o),s.current=C,C.stateNode=s,o=d_(),o.refCount++,s.pooledCache=o,o.refCount++,C.memoizedState={element:f,isDehydrated:u,cache:o},Ql(C),s}function MR(s){return s?(s=Pc,s):Pc}function UR(s,o,u,f,g,C){g=MR(g),f.context===null?f.context=g:f.pendingContext=g,f=no(o),f.payload={element:u},C=C===void 0?null:C,C!==null&&(f.callback=C),u=Fs(s,f,o),u!==null&&(Ii(u,s,o),Zl(u,s,o))}function xR(s,o){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var u=s.retryLane;s.retryLane=u!==0&&u<o?u:o}}function FE(s,o){xR(s,o),(s=s.alternate)&&xR(s,o)}function jE(s){if(s.tag===13){var o=Mo(s,67108864);o!==null&&Ii(o,s,67108864),FE(s,67108864)}}var jd=!0;function GE(s,o,u,f){var g=Pt.T;Pt.T=null;var C=zt.p;try{zt.p=2,Gd(s,o,u,f)}finally{zt.p=C,Pt.T=g}}function VR(s,o,u,f){var g=Pt.T;Pt.T=null;var C=zt.p;try{zt.p=8,Gd(s,o,u,f)}finally{zt.p=C,Pt.T=g}}function Gd(s,o,u,f){if(jd){var g=hf(f);if(g===null)nf(s,o,f,Et,u),FR(s,f);else if(Jb(g,s,o,u,f))f.stopPropagation();else if(FR(s,f),o&4&&-1<Xb.indexOf(s)){for(;g!==null;){var C=Ol(g);if(C!==null)switch(C.tag){case 3:if(C=C.stateNode,C.current.memoizedState.isDehydrated){var k=Cc(C.pendingLanes);if(k!==0){var j=C;for(j.pendingLanes|=2,j.entangledLanes|=2;k;){var z=1<<31-Xr(k);j.entanglements[1]|=z,k&=~z}fa(C),(zn&6)===0&&(Hp=cs()+500,ou(0))}}break;case 13:j=Mo(C,2),j!==null&&Ii(j,C,2),qp(),FE(C,2)}if(C=hf(f),C===null&&nf(s,o,f,Et,u),C===g)break;g=C}g!==null&&f.stopPropagation()}else nf(s,o,f,null,u)}}function hf(s){return s=Mm(s),HE(s)}var Et=null;function HE(s){if(Et=null,s=Ic(s),s!==null){var o=re(s);if(o===null)s=null;else{var u=o.tag;if(u===13){if(s=pe(o),s!==null)return s;s=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;s=null}else o!==s&&(s=null)}}return Et=s,null}function BR(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(PC()){case Cm:return 2;case nr:return 8;case Ps:case SS:return 32;case xh:return 268435456;default:return 32}default:return 32}}var WE=!1,Qo=null,Zo=null,ma=null,Hd=new Map,Wd=new Map,gi=[],Xb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function FR(s,o){switch(s){case"focusin":case"focusout":Qo=null;break;case"dragenter":case"dragleave":Zo=null;break;case"mouseover":case"mouseout":ma=null;break;case"pointerover":case"pointerout":Hd.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Wd.delete(o.pointerId)}}function nl(s,o,u,f,g,C){return s===null||s.nativeEvent!==C?(s={blockedOn:o,domEventName:u,eventSystemFlags:f,nativeEvent:C,targetContainers:[g]},o!==null&&(o=Ol(o),o!==null&&jE(o)),s):(s.eventSystemFlags|=f,o=s.targetContainers,g!==null&&o.indexOf(g)===-1&&o.push(g),s)}function Jb(s,o,u,f,g){switch(o){case"focusin":return Qo=nl(Qo,s,o,u,f,g),!0;case"dragenter":return Zo=nl(Zo,s,o,u,f,g),!0;case"mouseover":return ma=nl(ma,s,o,u,f,g),!0;case"pointerover":var C=g.pointerId;return Hd.set(C,nl(Hd.get(C)||null,s,o,u,f,g)),!0;case"gotpointercapture":return C=g.pointerId,Wd.set(C,nl(Wd.get(C)||null,s,o,u,f,g)),!0}return!1}function jR(s){var o=Ic(s.target);if(o!==null){var u=re(o);if(u!==null){if(o=u.tag,o===13){if(o=pe(u),o!==null){s.blockedOn=o,AS(s.priority,function(){if(u.tag===13){var f=cr(),g=Mo(u,f);g!==null&&Ii(g,u,f),FE(u,f)}});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){s.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}s.blockedOn=null}function pf(s){if(s.blockedOn!==null)return!1;for(var o=s.targetContainers;0<o.length;){var u=hf(s.nativeEvent);if(u===null){u=s.nativeEvent;var f=new u.constructor(u.type,u);km=f,u.target.dispatchEvent(f),km=null}else return o=Ol(u),o!==null&&jE(o),s.blockedOn=u,!1;o.shift()}return!0}function GR(s,o,u){pf(s)&&u.delete(o)}function ff(){WE=!1,Qo!==null&&pf(Qo)&&(Qo=null),Zo!==null&&pf(Zo)&&(Zo=null),ma!==null&&pf(ma)&&(ma=null),Hd.forEach(GR),Wd.forEach(GR)}function Kd(s,o){s.blockedOn===o&&(s.blockedOn=null,WE||(WE=!0,E.unstable_scheduleCallback(E.unstable_NormalPriority,ff)))}var mf=null;function HR(s){mf!==s&&(mf=s,E.unstable_scheduleCallback(E.unstable_NormalPriority,function(){mf===s&&(mf=null);for(var o=0;o<s.length;o+=3){var u=s[o],f=s[o+1],g=s[o+2];if(typeof f!="function"){if(HE(f||u)===null)continue;break}var C=Ol(u);C!==null&&(s.splice(o,3),o-=3,A_(C,{pending:!0,data:g,method:u.method,action:f},f,g))}}))}function Yd(s){function o(z){return Kd(z,s)}Qo!==null&&Kd(Qo,s),Zo!==null&&Kd(Zo,s),ma!==null&&Kd(ma,s),Hd.forEach(o),Wd.forEach(o);for(var u=0;u<gi.length;u++){var f=gi[u];f.blockedOn===s&&(f.blockedOn=null)}for(;0<gi.length&&(u=gi[0],u.blockedOn===null);)jR(u),u.blockedOn===null&&gi.shift();if(u=(s.ownerDocument||s).$$reactFormReplay,u!=null)for(f=0;f<u.length;f+=3){var g=u[f],C=u[f+1],k=g[Er]||null;if(typeof C=="function")k||HR(u);else if(k){var j=null;if(C&&C.hasAttribute("formAction")){if(g=C,k=C[Er]||null)j=k.formAction;else if(HE(g)!==null)continue}else j=k.action;typeof j=="function"?u[f+1]=j:(u.splice(f,3),f-=3),HR(u)}}}function KE(s){this._internalRoot=s}fu.prototype.render=KE.prototype.render=function(s){var o=this._internalRoot;if(o===null)throw Error(y(409));var u=o.current,f=cr();UR(u,f,s,o,null,null)},fu.prototype.unmount=KE.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var o=s.containerInfo;s.tag===0&&oo(),UR(s.current,2,null,s,null,null),qp(),o[Ac]=null}};function fu(s){this._internalRoot=s}fu.prototype.unstable_scheduleHydration=function(s){if(s){var o=Am();s={blockedOn:null,target:s,priority:o};for(var u=0;u<gi.length&&o!==0&&o<gi[u].priority;u++);gi.splice(u,0,s),u===0&&jR(s)}};var YE=_.version;if(YE!=="19.0.0")throw Error(y(527,YE,"19.0.0"));zt.findDOMNode=function(s){var o=s._reactInternals;if(o===void 0)throw typeof s.render=="function"?Error(y(188)):(s=Object.keys(s).join(","),Error(y(268,s)));return s=Ft(o),s=s!==null?fe(s):null,s=s===null?null:s.stateNode,s};var Qb={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:Pt,findFiberByHostInstance:Ic,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var mu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!mu.isDisabled&&mu.supportsFiber)try{Al=mu.inject(Qb),Nr=mu}catch{}}return sS.createRoot=function(s,o){if(!w(s))throw Error(y(299));var u=!1,f="",g=Bs,C=Fc,k=Go,j=null;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onUncaughtError!==void 0&&(g=o.onUncaughtError),o.onCaughtError!==void 0&&(C=o.onCaughtError),o.onRecoverableError!==void 0&&(k=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(j=o.unstable_transitionCallbacks)),o=kR(s,1,!1,null,null,u,f,g,C,k,j,null),s[Ac]=o.current,ef(s.nodeType===8?s.parentNode:s),new KE(o)},sS.hydrateRoot=function(s,o,u){if(!w(s))throw Error(y(299));var f=!1,g="",C=Bs,k=Fc,j=Go,z=null,nt=null;return u!=null&&(u.unstable_strictMode===!0&&(f=!0),u.identifierPrefix!==void 0&&(g=u.identifierPrefix),u.onUncaughtError!==void 0&&(C=u.onUncaughtError),u.onCaughtError!==void 0&&(k=u.onCaughtError),u.onRecoverableError!==void 0&&(j=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(z=u.unstable_transitionCallbacks),u.formState!==void 0&&(nt=u.formState)),o=kR(s,1,!0,o,u??null,f,g,C,k,j,z,nt),o.context=MR(null),u=o.current,f=cr(),g=no(f),g.callback=null,Fs(u,g,f),o.current.lanes=f,Gu(o,f),fa(o),s[Ac]=o.current,ef(s),new fu(o)},sS.version="19.0.0",sS}var qV;function wK(){if(qV)return DO.exports;qV=1;function E(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(E)}catch(_){console.error(_)}}return E(),DO.exports=IK(),DO.exports}var OK=wK(),aS={},zV;function NK(){if(zV)return aS;zV=1,Object.defineProperty(aS,"__esModule",{value:!0}),aS.parse=B,aS.serialize=H;const E=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,_=/^[\u0021-\u003A\u003C-\u007E]*$/,T=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,y=/^[\u0020-\u003A\u003D-\u007E]*$/,w=Object.prototype.toString,M=(()=>{const ht=function(){};return ht.prototype=Object.create(null),ht})();function B(ht,Mt){const st=new M,Ut=ht.length;if(Ut<2)return st;const mt=(Mt==null?void 0:Mt.decode)||tt;let vt=0;do{const Gt=ht.indexOf("=",vt);if(Gt===-1)break;const Vt=ht.indexOf(";",vt),Ce=Vt===-1?Ut:Vt;if(Gt>Ce){vt=ht.lastIndexOf(";",Gt-1)+1;continue}const Jt=q(ht,vt,Gt),$e=Y(ht,Gt,Jt),je=ht.slice(Jt,$e);if(st[je]===void 0){let Gn=q(ht,Gt+1,Ce),Pt=Y(ht,Ce,Gn);const Zt=mt(ht.slice(Gn,Pt));st[je]=Zt}vt=Ce+1}while(vt<Ut);return st}function q(ht,Mt,st){do{const Ut=ht.charCodeAt(Mt);if(Ut!==32&&Ut!==9)return Mt}while(++Mt<st);return st}function Y(ht,Mt,st){for(;Mt>st;){const Ut=ht.charCodeAt(--Mt);if(Ut!==32&&Ut!==9)return Mt+1}return st}function H(ht,Mt,st){const Ut=(st==null?void 0:st.encode)||encodeURIComponent;if(!E.test(ht))throw new TypeError(`argument name is invalid: ${ht}`);const mt=Ut(Mt);if(!_.test(mt))throw new TypeError(`argument val is invalid: ${Mt}`);let vt=ht+"="+mt;if(!st)return vt;if(st.maxAge!==void 0){if(!Number.isInteger(st.maxAge))throw new TypeError(`option maxAge is invalid: ${st.maxAge}`);vt+="; Max-Age="+st.maxAge}if(st.domain){if(!T.test(st.domain))throw new TypeError(`option domain is invalid: ${st.domain}`);vt+="; Domain="+st.domain}if(st.path){if(!y.test(st.path))throw new TypeError(`option path is invalid: ${st.path}`);vt+="; Path="+st.path}if(st.expires){if(!rt(st.expires)||!Number.isFinite(st.expires.valueOf()))throw new TypeError(`option expires is invalid: ${st.expires}`);vt+="; Expires="+st.expires.toUTCString()}if(st.httpOnly&&(vt+="; HttpOnly"),st.secure&&(vt+="; Secure"),st.partitioned&&(vt+="; Partitioned"),st.priority)switch(typeof st.priority=="string"?st.priority.toLowerCase():void 0){case"low":vt+="; Priority=Low";break;case"medium":vt+="; Priority=Medium";break;case"high":vt+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${st.priority}`)}if(st.sameSite)switch(typeof st.sameSite=="string"?st.sameSite.toLowerCase():st.sameSite){case!0:case"strict":vt+="; SameSite=Strict";break;case"lax":vt+="; SameSite=Lax";break;case"none":vt+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${st.sameSite}`)}return vt}function tt(ht){if(ht.indexOf("%")===-1)return ht;try{return decodeURIComponent(ht)}catch{return ht}}function rt(ht){return w.call(ht)==="[object Date]"}return aS}NK();/**
 * react-router v7.4.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var XV="popstate";function DK(E={}){function _(y,w){let{pathname:M,search:B,hash:q}=y.location;return YO("",{pathname:M,search:B,hash:q},w.state&&w.state.usr||null,w.state&&w.state.key||"default")}function T(y,w){return typeof w=="string"?w:hS(w)}return PK(_,T,null,E)}function vi(E,_){if(E===!1||E===null||typeof E>"u")throw new Error(_)}function Tc(E,_){if(!E){typeof console<"u"&&console.warn(_);try{throw new Error(_)}catch{}}}function LK(){return Math.random().toString(36).substring(2,10)}function JV(E,_){return{usr:E.state,key:E.key,idx:_}}function YO(E,_,T=null,y){return{pathname:typeof E=="string"?E:E.pathname,search:"",hash:"",...typeof _=="string"?_m(_):_,state:T,key:_&&_.key||y||LK()}}function hS({pathname:E="/",search:_="",hash:T=""}){return _&&_!=="?"&&(E+=_.charAt(0)==="?"?_:"?"+_),T&&T!=="#"&&(E+=T.charAt(0)==="#"?T:"#"+T),E}function _m(E){let _={};if(E){let T=E.indexOf("#");T>=0&&(_.hash=E.substring(T),E=E.substring(0,T));let y=E.indexOf("?");y>=0&&(_.search=E.substring(y),E=E.substring(0,y)),E&&(_.pathname=E)}return _}function PK(E,_,T,y={}){let{window:w=document.defaultView,v5Compat:M=!1}=y,B=w.history,q="POP",Y=null,H=tt();H==null&&(H=0,B.replaceState({...B.state,idx:H},""));function tt(){return(B.state||{idx:null}).idx}function rt(){q="POP";let mt=tt(),vt=mt==null?null:mt-H;H=mt,Y&&Y({action:q,location:Ut.location,delta:vt})}function ht(mt,vt){q="PUSH";let Gt=YO(Ut.location,mt,vt);H=tt()+1;let Vt=JV(Gt,H),Ce=Ut.createHref(Gt);try{B.pushState(Vt,"",Ce)}catch(Jt){if(Jt instanceof DOMException&&Jt.name==="DataCloneError")throw Jt;w.location.assign(Ce)}M&&Y&&Y({action:q,location:Ut.location,delta:1})}function Mt(mt,vt){q="REPLACE";let Gt=YO(Ut.location,mt,vt);H=tt();let Vt=JV(Gt,H),Ce=Ut.createHref(Gt);B.replaceState(Vt,"",Ce),M&&Y&&Y({action:q,location:Ut.location,delta:0})}function st(mt){let vt=w.location.origin!=="null"?w.location.origin:w.location.href,Gt=typeof mt=="string"?mt:hS(mt);return Gt=Gt.replace(/ $/,"%20"),vi(vt,`No window.location.(origin|href) available to create URL for href: ${Gt}`),new URL(Gt,vt)}let Ut={get action(){return q},get location(){return E(w,B)},listen(mt){if(Y)throw new Error("A history only accepts one active listener");return w.addEventListener(XV,rt),Y=mt,()=>{w.removeEventListener(XV,rt),Y=null}},createHref(mt){return _(w,mt)},createURL:st,encodeLocation(mt){let vt=st(mt);return{pathname:vt.pathname,search:vt.search,hash:vt.hash}},push:ht,replace:Mt,go(mt){return B.go(mt)}};return Ut}function TB(E,_,T="/"){return kK(E,_,T,!1)}function kK(E,_,T,y){let w=typeof _=="string"?_m(_):_,M=vl(w.pathname||"/",T);if(M==null)return null;let B=RB(E);MK(B);let q=null;for(let Y=0;q==null&&Y<B.length;++Y){let H=YK(M);q=WK(B[Y],H,y)}return q}function RB(E,_=[],T=[],y=""){let w=(M,B,q)=>{let Y={relativePath:q===void 0?M.path||"":q,caseSensitive:M.caseSensitive===!0,childrenIndex:B,route:M};Y.relativePath.startsWith("/")&&(vi(Y.relativePath.startsWith(y),`Absolute route path "${Y.relativePath}" nested under path "${y}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),Y.relativePath=Y.relativePath.slice(y.length));let H=yl([y,Y.relativePath]),tt=T.concat(Y);M.children&&M.children.length>0&&(vi(M.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${H}".`),RB(M.children,_,tt,H)),!(M.path==null&&!M.index)&&_.push({path:H,score:GK(H,M.index),routesMeta:tt})};return E.forEach((M,B)=>{var q;if(M.path===""||!((q=M.path)!=null&&q.includes("?")))w(M,B);else for(let Y of yB(M.path))w(M,B,Y)}),_}function yB(E){let _=E.split("/");if(_.length===0)return[];let[T,...y]=_,w=T.endsWith("?"),M=T.replace(/\?$/,"");if(y.length===0)return w?[M,""]:[M];let B=yB(y.join("/")),q=[];return q.push(...B.map(Y=>Y===""?M:[M,Y].join("/"))),w&&q.push(...B),q.map(Y=>E.startsWith("/")&&Y===""?"/":Y)}function MK(E){E.sort((_,T)=>_.score!==T.score?T.score-_.score:HK(_.routesMeta.map(y=>y.childrenIndex),T.routesMeta.map(y=>y.childrenIndex)))}var UK=/^:[\w-]+$/,xK=3,VK=2,BK=1,FK=10,jK=-2,QV=E=>E==="*";function GK(E,_){let T=E.split("/"),y=T.length;return T.some(QV)&&(y+=jK),_&&(y+=VK),T.filter(w=>!QV(w)).reduce((w,M)=>w+(UK.test(M)?xK:M===""?BK:FK),y)}function HK(E,_){return E.length===_.length&&E.slice(0,-1).every((y,w)=>y===_[w])?E[E.length-1]-_[_.length-1]:0}function WK(E,_,T=!1){let{routesMeta:y}=E,w={},M="/",B=[];for(let q=0;q<y.length;++q){let Y=y[q],H=q===y.length-1,tt=M==="/"?_:_.slice(M.length)||"/",rt=SC({path:Y.relativePath,caseSensitive:Y.caseSensitive,end:H},tt),ht=Y.route;if(!rt&&H&&T&&!y[y.length-1].route.index&&(rt=SC({path:Y.relativePath,caseSensitive:Y.caseSensitive,end:!1},tt)),!rt)return null;Object.assign(w,rt.params),B.push({params:w,pathname:yl([M,rt.pathname]),pathnameBase:JK(yl([M,rt.pathnameBase])),route:ht}),rt.pathnameBase!=="/"&&(M=yl([M,rt.pathnameBase]))}return B}function SC(E,_){typeof E=="string"&&(E={path:E,caseSensitive:!1,end:!0});let[T,y]=KK(E.path,E.caseSensitive,E.end),w=_.match(T);if(!w)return null;let M=w[0],B=M.replace(/(.)\/+$/,"$1"),q=w.slice(1);return{params:y.reduce((H,{paramName:tt,isOptional:rt},ht)=>{if(tt==="*"){let st=q[ht]||"";B=M.slice(0,M.length-st.length).replace(/(.)\/+$/,"$1")}const Mt=q[ht];return rt&&!Mt?H[tt]=void 0:H[tt]=(Mt||"").replace(/%2F/g,"/"),H},{}),pathname:M,pathnameBase:B,pattern:E}}function KK(E,_=!1,T=!0){Tc(E==="*"||!E.endsWith("*")||E.endsWith("/*"),`Route path "${E}" will be treated as if it were "${E.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${E.replace(/\*$/,"/*")}".`);let y=[],w="^"+E.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(B,q,Y)=>(y.push({paramName:q,isOptional:Y!=null}),Y?"/?([^\\/]+)?":"/([^\\/]+)"));return E.endsWith("*")?(y.push({paramName:"*"}),w+=E==="*"||E==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):T?w+="\\/*$":E!==""&&E!=="/"&&(w+="(?:(?=\\/|$))"),[new RegExp(w,_?void 0:"i"),y]}function YK(E){try{return E.split("/").map(_=>decodeURIComponent(_).replace(/\//g,"%2F")).join("/")}catch(_){return Tc(!1,`The URL path "${E}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${_}).`),E}}function vl(E,_){if(_==="/")return E;if(!E.toLowerCase().startsWith(_.toLowerCase()))return null;let T=_.endsWith("/")?_.length-1:_.length,y=E.charAt(T);return y&&y!=="/"?null:E.slice(T)||"/"}function qK(E,_="/"){let{pathname:T,search:y="",hash:w=""}=typeof E=="string"?_m(E):E;return{pathname:T?T.startsWith("/")?T:zK(T,_):_,search:QK(y),hash:ZK(w)}}function zK(E,_){let T=_.replace(/\/+$/,"").split("/");return E.split("/").forEach(w=>{w===".."?T.length>1&&T.pop():w!=="."&&T.push(w)}),T.length>1?T.join("/"):"/"}function MO(E,_,T,y){return`Cannot include a '${E}' character in a manually specified \`to.${_}\` field [${JSON.stringify(y)}].  Please separate it out to the \`to.${T}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function XK(E){return E.filter((_,T)=>T===0||_.route.path&&_.route.path.length>0)}function vB(E){let _=XK(E);return _.map((T,y)=>y===_.length-1?T.pathname:T.pathnameBase)}function CB(E,_,T,y=!1){let w;typeof E=="string"?w=_m(E):(w={...E},vi(!w.pathname||!w.pathname.includes("?"),MO("?","pathname","search",w)),vi(!w.pathname||!w.pathname.includes("#"),MO("#","pathname","hash",w)),vi(!w.search||!w.search.includes("#"),MO("#","search","hash",w)));let M=E===""||w.pathname==="",B=M?"/":w.pathname,q;if(B==null)q=T;else{let rt=_.length-1;if(!y&&B.startsWith("..")){let ht=B.split("/");for(;ht[0]==="..";)ht.shift(),rt-=1;w.pathname=ht.join("/")}q=rt>=0?_[rt]:"/"}let Y=qK(w,q),H=B&&B!=="/"&&B.endsWith("/"),tt=(M||B===".")&&T.endsWith("/");return!Y.pathname.endsWith("/")&&(H||tt)&&(Y.pathname+="/"),Y}var yl=E=>E.join("/").replace(/\/\/+/g,"/"),JK=E=>E.replace(/\/+$/,"").replace(/^\/*/,"/"),QK=E=>!E||E==="?"?"":E.startsWith("?")?E:"?"+E,ZK=E=>!E||E==="#"?"":E.startsWith("#")?E:"#"+E;function $K(E){return E!=null&&typeof E.status=="number"&&typeof E.statusText=="string"&&typeof E.internal=="boolean"&&"data"in E}var bB=["POST","PUT","PATCH","DELETE"];new Set(bB);var tY=["GET",...bB];new Set(tY);var Em=gt.createContext(null);Em.displayName="DataRouter";var vC=gt.createContext(null);vC.displayName="DataRouterState";var AB=gt.createContext({isTransitioning:!1});AB.displayName="ViewTransition";var eY=gt.createContext(new Map);eY.displayName="Fetchers";var nY=gt.createContext(null);nY.displayName="Await";var yc=gt.createContext(null);yc.displayName="Navigation";var fS=gt.createContext(null);fS.displayName="Location";var Cl=gt.createContext({outlet:null,matches:[],isDataRoute:!1});Cl.displayName="Route";var o0=gt.createContext(null);o0.displayName="RouteError";function iY(E,{relative:_}={}){vi(mS(),"useHref() may be used only in the context of a <Router> component.");let{basename:T,navigator:y}=gt.useContext(yc),{hash:w,pathname:M,search:B}=_S(E,{relative:_}),q=M;return T!=="/"&&(q=M==="/"?T:yl([T,M])),y.createHref({pathname:q,search:B,hash:w})}function mS(){return gt.useContext(fS)!=null}function kh(){return vi(mS(),"useLocation() may be used only in the context of a <Router> component."),gt.useContext(fS).location}var IB="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function wB(E){gt.useContext(yc).static||gt.useLayoutEffect(E)}function rY(){let{isDataRoute:E}=gt.useContext(Cl);return E?EY():sY()}function sY(){vi(mS(),"useNavigate() may be used only in the context of a <Router> component.");let E=gt.useContext(Em),{basename:_,navigator:T}=gt.useContext(yc),{matches:y}=gt.useContext(Cl),{pathname:w}=kh(),M=JSON.stringify(vB(y)),B=gt.useRef(!1);return wB(()=>{B.current=!0}),gt.useCallback((Y,H={})=>{if(Tc(B.current,IB),!B.current)return;if(typeof Y=="number"){T.go(Y);return}let tt=CB(Y,JSON.parse(M),w,H.relative==="path");E==null&&_!=="/"&&(tt.pathname=tt.pathname==="/"?_:yl([_,tt.pathname])),(H.replace?T.replace:T.push)(tt,H.state,H)},[_,T,M,w,E])}gt.createContext(null);function _S(E,{relative:_}={}){let{matches:T}=gt.useContext(Cl),{pathname:y}=kh(),w=JSON.stringify(vB(T));return gt.useMemo(()=>CB(E,JSON.parse(w),y,_==="path"),[E,w,y,_])}function aY(E,_){return OB(E,_)}function OB(E,_,T,y){var Gt;vi(mS(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:w,static:M}=gt.useContext(yc),{matches:B}=gt.useContext(Cl),q=B[B.length-1],Y=q?q.params:{},H=q?q.pathname:"/",tt=q?q.pathnameBase:"/",rt=q&&q.route;{let Vt=rt&&rt.path||"";NB(H,!rt||Vt.endsWith("*")||Vt.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${H}" (under <Route path="${Vt}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Vt}"> to <Route path="${Vt==="/"?"*":`${Vt}/*`}">.`)}let ht=kh(),Mt;if(_){let Vt=typeof _=="string"?_m(_):_;vi(tt==="/"||((Gt=Vt.pathname)==null?void 0:Gt.startsWith(tt)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${tt}" but pathname "${Vt.pathname}" was given in the \`location\` prop.`),Mt=Vt}else Mt=ht;let st=Mt.pathname||"/",Ut=st;if(tt!=="/"){let Vt=tt.replace(/^\//,"").split("/");Ut="/"+st.replace(/^\//,"").split("/").slice(Vt.length).join("/")}let mt=!M&&T&&T.matches&&T.matches.length>0?T.matches:TB(E,{pathname:Ut});Tc(rt||mt!=null,`No routes matched location "${Mt.pathname}${Mt.search}${Mt.hash}" `),Tc(mt==null||mt[mt.length-1].route.element!==void 0||mt[mt.length-1].route.Component!==void 0||mt[mt.length-1].route.lazy!==void 0,`Matched leaf route at location "${Mt.pathname}${Mt.search}${Mt.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let vt=dY(mt&&mt.map(Vt=>Object.assign({},Vt,{params:Object.assign({},Y,Vt.params),pathname:yl([tt,w.encodeLocation?w.encodeLocation(Vt.pathname).pathname:Vt.pathname]),pathnameBase:Vt.pathnameBase==="/"?tt:yl([tt,w.encodeLocation?w.encodeLocation(Vt.pathnameBase).pathname:Vt.pathnameBase])})),B,T,y);return _&&vt?gt.createElement(fS.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Mt},navigationType:"POP"}},vt):vt}function oY(){let E=_Y(),_=$K(E)?`${E.status} ${E.statusText}`:E instanceof Error?E.message:JSON.stringify(E),T=E instanceof Error?E.stack:null,y="rgba(200,200,200, 0.5)",w={padding:"0.5rem",backgroundColor:y},M={padding:"2px 4px",backgroundColor:y},B=null;return console.error("Error handled by React Router default ErrorBoundary:",E),B=gt.createElement(gt.Fragment,null,gt.createElement("p",null," Hey developer "),gt.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",gt.createElement("code",{style:M},"ErrorBoundary")," or"," ",gt.createElement("code",{style:M},"errorElement")," prop on your route.")),gt.createElement(gt.Fragment,null,gt.createElement("h2",null,"Unexpected Application Error!"),gt.createElement("h3",{style:{fontStyle:"italic"}},_),T?gt.createElement("pre",{style:w},T):null,B)}var cY=gt.createElement(oY,null),lY=class extends gt.Component{constructor(E){super(E),this.state={location:E.location,revalidation:E.revalidation,error:E.error}}static getDerivedStateFromError(E){return{error:E}}static getDerivedStateFromProps(E,_){return _.location!==E.location||_.revalidation!=="idle"&&E.revalidation==="idle"?{error:E.error,location:E.location,revalidation:E.revalidation}:{error:E.error!==void 0?E.error:_.error,location:_.location,revalidation:E.revalidation||_.revalidation}}componentDidCatch(E,_){console.error("React Router caught the following error during render",E,_)}render(){return this.state.error!==void 0?gt.createElement(Cl.Provider,{value:this.props.routeContext},gt.createElement(o0.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function uY({routeContext:E,match:_,children:T}){let y=gt.useContext(Em);return y&&y.static&&y.staticContext&&(_.route.errorElement||_.route.ErrorBoundary)&&(y.staticContext._deepestRenderedBoundaryId=_.route.id),gt.createElement(Cl.Provider,{value:E},T)}function dY(E,_=[],T=null,y=null){if(E==null){if(!T)return null;if(T.errors)E=T.matches;else if(_.length===0&&!T.initialized&&T.matches.length>0)E=T.matches;else return null}let w=E,M=T==null?void 0:T.errors;if(M!=null){let Y=w.findIndex(H=>H.route.id&&(M==null?void 0:M[H.route.id])!==void 0);vi(Y>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(M).join(",")}`),w=w.slice(0,Math.min(w.length,Y+1))}let B=!1,q=-1;if(T)for(let Y=0;Y<w.length;Y++){let H=w[Y];if((H.route.HydrateFallback||H.route.hydrateFallbackElement)&&(q=Y),H.route.id){let{loaderData:tt,errors:rt}=T,ht=H.route.loader&&!tt.hasOwnProperty(H.route.id)&&(!rt||rt[H.route.id]===void 0);if(H.route.lazy||ht){B=!0,q>=0?w=w.slice(0,q+1):w=[w[0]];break}}}return w.reduceRight((Y,H,tt)=>{let rt,ht=!1,Mt=null,st=null;T&&(rt=M&&H.route.id?M[H.route.id]:void 0,Mt=H.route.errorElement||cY,B&&(q<0&&tt===0?(NB("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),ht=!0,st=null):q===tt&&(ht=!0,st=H.route.hydrateFallbackElement||null)));let Ut=_.concat(w.slice(0,tt+1)),mt=()=>{let vt;return rt?vt=Mt:ht?vt=st:H.route.Component?vt=gt.createElement(H.route.Component,null):H.route.element?vt=H.route.element:vt=Y,gt.createElement(uY,{match:H,routeContext:{outlet:Y,matches:Ut,isDataRoute:T!=null},children:vt})};return T&&(H.route.ErrorBoundary||H.route.errorElement||tt===0)?gt.createElement(lY,{location:T.location,revalidation:T.revalidation,component:Mt,error:rt,children:mt(),routeContext:{outlet:null,matches:Ut,isDataRoute:!0}}):mt()},null)}function c0(E){return`${E} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function hY(E){let _=gt.useContext(Em);return vi(_,c0(E)),_}function pY(E){let _=gt.useContext(vC);return vi(_,c0(E)),_}function fY(E){let _=gt.useContext(Cl);return vi(_,c0(E)),_}function l0(E){let _=fY(E),T=_.matches[_.matches.length-1];return vi(T.route.id,`${E} can only be used on routes that contain a unique "id"`),T.route.id}function mY(){return l0("useRouteId")}function _Y(){var y;let E=gt.useContext(o0),_=pY("useRouteError"),T=l0("useRouteError");return E!==void 0?E:(y=_.errors)==null?void 0:y[T]}function EY(){let{router:E}=hY("useNavigate"),_=l0("useNavigate"),T=gt.useRef(!1);return wB(()=>{T.current=!0}),gt.useCallback(async(w,M={})=>{Tc(T.current,IB),T.current&&(typeof w=="number"?E.navigate(w):await E.navigate(w,{fromRouteId:_,...M}))},[E,_])}var ZV={};function NB(E,_,T){!_&&!ZV[E]&&(ZV[E]=!0,Tc(!1,T))}gt.memo(gY);function gY({routes:E,future:_,state:T}){return OB(E,void 0,T,_)}function DB(E){vi(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function SY({basename:E="/",children:_=null,location:T,navigationType:y="POP",navigator:w,static:M=!1}){vi(!mS(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let B=E.replace(/^\/*/,"/"),q=gt.useMemo(()=>({basename:B,navigator:w,static:M,future:{}}),[B,w,M]);typeof T=="string"&&(T=_m(T));let{pathname:Y="/",search:H="",hash:tt="",state:rt=null,key:ht="default"}=T,Mt=gt.useMemo(()=>{let st=vl(Y,B);return st==null?null:{location:{pathname:st,search:H,hash:tt,state:rt,key:ht},navigationType:y}},[B,Y,H,tt,rt,ht,y]);return Tc(Mt!=null,`<Router basename="${B}"> is not able to match the URL "${Y}${H}${tt}" because it does not start with the basename, so the <Router> won't render anything.`),Mt==null?null:gt.createElement(yc.Provider,{value:q},gt.createElement(fS.Provider,{children:_,value:Mt}))}function TY({children:E,location:_}){return aY(qO(E),_)}function qO(E,_=[]){let T=[];return gt.Children.forEach(E,(y,w)=>{if(!gt.isValidElement(y))return;let M=[..._,w];if(y.type===gt.Fragment){T.push.apply(T,qO(y.props.children,M));return}vi(y.type===DB,`[${typeof y.type=="string"?y.type:y.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),vi(!y.props.index||!y.props.children,"An index route cannot have child routes.");let B={id:y.props.id||M.join("-"),caseSensitive:y.props.caseSensitive,element:y.props.element,Component:y.props.Component,index:y.props.index,path:y.props.path,loader:y.props.loader,action:y.props.action,hydrateFallbackElement:y.props.hydrateFallbackElement,HydrateFallback:y.props.HydrateFallback,errorElement:y.props.errorElement,ErrorBoundary:y.props.ErrorBoundary,hasErrorBoundary:y.props.hasErrorBoundary===!0||y.props.ErrorBoundary!=null||y.props.errorElement!=null,shouldRevalidate:y.props.shouldRevalidate,handle:y.props.handle,lazy:y.props.lazy};y.props.children&&(B.children=qO(y.props.children,M)),T.push(B)}),T}var cC="get",lC="application/x-www-form-urlencoded";function CC(E){return E!=null&&typeof E.tagName=="string"}function RY(E){return CC(E)&&E.tagName.toLowerCase()==="button"}function yY(E){return CC(E)&&E.tagName.toLowerCase()==="form"}function vY(E){return CC(E)&&E.tagName.toLowerCase()==="input"}function CY(E){return!!(E.metaKey||E.altKey||E.ctrlKey||E.shiftKey)}function bY(E,_){return E.button===0&&(!_||_==="_self")&&!CY(E)}var sC=null;function AY(){if(sC===null)try{new FormData(document.createElement("form"),0),sC=!1}catch{sC=!0}return sC}var IY=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function UO(E){return E!=null&&!IY.has(E)?(Tc(!1,`"${E}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${lC}"`),null):E}function wY(E,_){let T,y,w,M,B;if(yY(E)){let q=E.getAttribute("action");y=q?vl(q,_):null,T=E.getAttribute("method")||cC,w=UO(E.getAttribute("enctype"))||lC,M=new FormData(E)}else if(RY(E)||vY(E)&&(E.type==="submit"||E.type==="image")){let q=E.form;if(q==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let Y=E.getAttribute("formaction")||q.getAttribute("action");if(y=Y?vl(Y,_):null,T=E.getAttribute("formmethod")||q.getAttribute("method")||cC,w=UO(E.getAttribute("formenctype"))||UO(q.getAttribute("enctype"))||lC,M=new FormData(q,E),!AY()){let{name:H,type:tt,value:rt}=E;if(tt==="image"){let ht=H?`${H}.`:"";M.append(`${ht}x`,"0"),M.append(`${ht}y`,"0")}else H&&M.append(H,rt)}}else{if(CC(E))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');T=cC,y=null,w=lC,B=E}return M&&w==="text/plain"&&(B=M,M=void 0),{action:y,method:T.toLowerCase(),encType:w,formData:M,body:B}}function u0(E,_){if(E===!1||E===null||typeof E>"u")throw new Error(_)}async function OY(E,_){if(E.id in _)return _[E.id];try{let T=await import(E.module);return _[E.id]=T,T}catch(T){return console.error(`Error loading route module \`${E.module}\`, reloading page...`),console.error(T),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function NY(E){return E==null?!1:E.href==null?E.rel==="preload"&&typeof E.imageSrcSet=="string"&&typeof E.imageSizes=="string":typeof E.rel=="string"&&typeof E.href=="string"}async function DY(E,_,T){let y=await Promise.all(E.map(async w=>{let M=_.routes[w.route.id];if(M){let B=await OY(M,T);return B.links?B.links():[]}return[]}));return MY(y.flat(1).filter(NY).filter(w=>w.rel==="stylesheet"||w.rel==="preload").map(w=>w.rel==="stylesheet"?{...w,rel:"prefetch",as:"style"}:{...w,rel:"prefetch"}))}function $V(E,_,T,y,w,M){let B=(Y,H)=>T[H]?Y.route.id!==T[H].route.id:!0,q=(Y,H)=>{var tt;return T[H].pathname!==Y.pathname||((tt=T[H].route.path)==null?void 0:tt.endsWith("*"))&&T[H].params["*"]!==Y.params["*"]};return M==="assets"?_.filter((Y,H)=>B(Y,H)||q(Y,H)):M==="data"?_.filter((Y,H)=>{var rt;let tt=y.routes[Y.route.id];if(!tt||!tt.hasLoader)return!1;if(B(Y,H)||q(Y,H))return!0;if(Y.route.shouldRevalidate){let ht=Y.route.shouldRevalidate({currentUrl:new URL(w.pathname+w.search+w.hash,window.origin),currentParams:((rt=T[0])==null?void 0:rt.params)||{},nextUrl:new URL(E,window.origin),nextParams:Y.params,defaultShouldRevalidate:!0});if(typeof ht=="boolean")return ht}return!0}):[]}function LY(E,_,{includeHydrateFallback:T}={}){return PY(E.map(y=>{let w=_.routes[y.route.id];if(!w)return[];let M=[w.module];return w.clientActionModule&&(M=M.concat(w.clientActionModule)),w.clientLoaderModule&&(M=M.concat(w.clientLoaderModule)),T&&w.hydrateFallbackModule&&(M=M.concat(w.hydrateFallbackModule)),w.imports&&(M=M.concat(w.imports)),M}).flat(1))}function PY(E){return[...new Set(E)]}function kY(E){let _={},T=Object.keys(E).sort();for(let y of T)_[y]=E[y];return _}function MY(E,_){let T=new Set;return new Set(_),E.reduce((y,w)=>{let M=JSON.stringify(kY(w));return T.has(M)||(T.add(M),y.push({key:M,link:w})),y},[])}function UY(E,_){let T=typeof E=="string"?new URL(E,typeof window>"u"?"server://singlefetch/":window.location.origin):E;return T.pathname==="/"?T.pathname="_root.data":_&&vl(T.pathname,_)==="/"?T.pathname=`${_.replace(/\/$/,"")}/_root.data`:T.pathname=`${T.pathname.replace(/\/$/,"")}.data`,T}function LB(){let E=gt.useContext(Em);return u0(E,"You must render this element inside a <DataRouterContext.Provider> element"),E}function xY(){let E=gt.useContext(vC);return u0(E,"You must render this element inside a <DataRouterStateContext.Provider> element"),E}var d0=gt.createContext(void 0);d0.displayName="FrameworkContext";function PB(){let E=gt.useContext(d0);return u0(E,"You must render this element inside a <HydratedRouter> element"),E}function VY(E,_){let T=gt.useContext(d0),[y,w]=gt.useState(!1),[M,B]=gt.useState(!1),{onFocus:q,onBlur:Y,onMouseEnter:H,onMouseLeave:tt,onTouchStart:rt}=_,ht=gt.useRef(null);gt.useEffect(()=>{if(E==="render"&&B(!0),E==="viewport"){let Ut=vt=>{vt.forEach(Gt=>{B(Gt.isIntersecting)})},mt=new IntersectionObserver(Ut,{threshold:.5});return ht.current&&mt.observe(ht.current),()=>{mt.disconnect()}}},[E]),gt.useEffect(()=>{if(y){let Ut=setTimeout(()=>{B(!0)},100);return()=>{clearTimeout(Ut)}}},[y]);let Mt=()=>{w(!0)},st=()=>{w(!1),B(!1)};return T?E!=="intent"?[M,ht,{}]:[M,ht,{onFocus:oS(q,Mt),onBlur:oS(Y,st),onMouseEnter:oS(H,Mt),onMouseLeave:oS(tt,st),onTouchStart:oS(rt,Mt)}]:[!1,ht,{}]}function oS(E,_){return T=>{E&&E(T),T.defaultPrevented||_(T)}}function BY({page:E,..._}){let{router:T}=LB(),y=gt.useMemo(()=>TB(T.routes,E,T.basename),[T.routes,E,T.basename]);return y?gt.createElement(jY,{page:E,matches:y,..._}):null}function FY(E){let{manifest:_,routeModules:T}=PB(),[y,w]=gt.useState([]);return gt.useEffect(()=>{let M=!1;return DY(E,_,T).then(B=>{M||w(B)}),()=>{M=!0}},[E,_,T]),y}function jY({page:E,matches:_,...T}){let y=kh(),{manifest:w,routeModules:M}=PB(),{basename:B}=LB(),{loaderData:q,matches:Y}=xY(),H=gt.useMemo(()=>$V(E,_,Y,w,y,"data"),[E,_,Y,w,y]),tt=gt.useMemo(()=>$V(E,_,Y,w,y,"assets"),[E,_,Y,w,y]),rt=gt.useMemo(()=>{if(E===y.pathname+y.search+y.hash)return[];let st=new Set,Ut=!1;if(_.forEach(vt=>{var Vt;let Gt=w.routes[vt.route.id];!Gt||!Gt.hasLoader||(!H.some(Ce=>Ce.route.id===vt.route.id)&&vt.route.id in q&&((Vt=M[vt.route.id])!=null&&Vt.shouldRevalidate)||Gt.hasClientLoader?Ut=!0:st.add(vt.route.id))}),st.size===0)return[];let mt=UY(E,B);return Ut&&st.size>0&&mt.searchParams.set("_routes",_.filter(vt=>st.has(vt.route.id)).map(vt=>vt.route.id).join(",")),[mt.pathname+mt.search]},[B,q,y,w,H,_,E,M]),ht=gt.useMemo(()=>LY(tt,w),[tt,w]),Mt=FY(tt);return gt.createElement(gt.Fragment,null,rt.map(st=>gt.createElement("link",{key:st,rel:"prefetch",as:"fetch",href:st,...T})),ht.map(st=>gt.createElement("link",{key:st,rel:"modulepreload",href:st,...T})),Mt.map(({key:st,link:Ut})=>gt.createElement("link",{key:st,...Ut})))}function GY(...E){return _=>{E.forEach(T=>{typeof T=="function"?T(_):T!=null&&(T.current=_)})}}var kB=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{kB&&(window.__reactRouterVersion="7.4.0")}catch{}function HY({basename:E,children:_,window:T}){let y=gt.useRef();y.current==null&&(y.current=DK({window:T,v5Compat:!0}));let w=y.current,[M,B]=gt.useState({action:w.action,location:w.location}),q=gt.useCallback(Y=>{gt.startTransition(()=>B(Y))},[B]);return gt.useLayoutEffect(()=>w.listen(q),[w,q]),gt.createElement(SY,{basename:E,children:_,location:M.location,navigationType:M.action,navigator:w})}var MB=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,UB=gt.forwardRef(function({onClick:_,discover:T="render",prefetch:y="none",relative:w,reloadDocument:M,replace:B,state:q,target:Y,to:H,preventScrollReset:tt,viewTransition:rt,...ht},Mt){let{basename:st}=gt.useContext(yc),Ut=typeof H=="string"&&MB.test(H),mt,vt=!1;if(typeof H=="string"&&Ut&&(mt=H,kB))try{let Pt=new URL(window.location.href),Zt=H.startsWith("//")?new URL(Pt.protocol+H):new URL(H),Ie=vl(Zt.pathname,st);Zt.origin===Pt.origin&&Ie!=null?H=Ie+Zt.search+Zt.hash:vt=!0}catch{Tc(!1,`<Link to="${H}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Gt=iY(H,{relative:w}),[Vt,Ce,Jt]=VY(y,ht),$e=qY(H,{replace:B,state:q,target:Y,preventScrollReset:tt,relative:w,viewTransition:rt});function je(Pt){_&&_(Pt),Pt.defaultPrevented||$e(Pt)}let Gn=gt.createElement("a",{...ht,...Jt,href:mt||Gt,onClick:vt||M?_:je,ref:GY(Mt,Ce),target:Y,"data-discover":!Ut&&T==="render"?"true":void 0});return Vt&&!Ut?gt.createElement(gt.Fragment,null,Gn,gt.createElement(BY,{page:Gt})):Gn});UB.displayName="Link";var WY=gt.forwardRef(function({"aria-current":_="page",caseSensitive:T=!1,className:y="",end:w=!1,style:M,to:B,viewTransition:q,children:Y,...H},tt){let rt=_S(B,{relative:H.relative}),ht=kh(),Mt=gt.useContext(vC),{navigator:st,basename:Ut}=gt.useContext(yc),mt=Mt!=null&&ZY(rt)&&q===!0,vt=st.encodeLocation?st.encodeLocation(rt).pathname:rt.pathname,Gt=ht.pathname,Vt=Mt&&Mt.navigation&&Mt.navigation.location?Mt.navigation.location.pathname:null;T||(Gt=Gt.toLowerCase(),Vt=Vt?Vt.toLowerCase():null,vt=vt.toLowerCase()),Vt&&Ut&&(Vt=vl(Vt,Ut)||Vt);const Ce=vt!=="/"&&vt.endsWith("/")?vt.length-1:vt.length;let Jt=Gt===vt||!w&&Gt.startsWith(vt)&&Gt.charAt(Ce)==="/",$e=Vt!=null&&(Vt===vt||!w&&Vt.startsWith(vt)&&Vt.charAt(vt.length)==="/"),je={isActive:Jt,isPending:$e,isTransitioning:mt},Gn=Jt?_:void 0,Pt;typeof y=="function"?Pt=y(je):Pt=[y,Jt?"active":null,$e?"pending":null,mt?"transitioning":null].filter(Boolean).join(" ");let Zt=typeof M=="function"?M(je):M;return gt.createElement(UB,{...H,"aria-current":Gn,className:Pt,ref:tt,style:Zt,to:B,viewTransition:q},typeof Y=="function"?Y(je):Y)});WY.displayName="NavLink";var KY=gt.forwardRef(({discover:E="render",fetcherKey:_,navigate:T,reloadDocument:y,replace:w,state:M,method:B=cC,action:q,onSubmit:Y,relative:H,preventScrollReset:tt,viewTransition:rt,...ht},Mt)=>{let st=JY(),Ut=QY(q,{relative:H}),mt=B.toLowerCase()==="get"?"get":"post",vt=typeof q=="string"&&MB.test(q),Gt=Vt=>{if(Y&&Y(Vt),Vt.defaultPrevented)return;Vt.preventDefault();let Ce=Vt.nativeEvent.submitter,Jt=(Ce==null?void 0:Ce.getAttribute("formmethod"))||B;st(Ce||Vt.currentTarget,{fetcherKey:_,method:Jt,navigate:T,replace:w,state:M,relative:H,preventScrollReset:tt,viewTransition:rt})};return gt.createElement("form",{ref:Mt,method:mt,action:Ut,onSubmit:y?Y:Gt,...ht,"data-discover":!vt&&E==="render"?"true":void 0})});KY.displayName="Form";function YY(E){return`${E} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function xB(E){let _=gt.useContext(Em);return vi(_,YY(E)),_}function qY(E,{target:_,replace:T,state:y,preventScrollReset:w,relative:M,viewTransition:B}={}){let q=rY(),Y=kh(),H=_S(E,{relative:M});return gt.useCallback(tt=>{if(bY(tt,_)){tt.preventDefault();let rt=T!==void 0?T:hS(Y)===hS(H);q(E,{replace:rt,state:y,preventScrollReset:w,relative:M,viewTransition:B})}},[Y,q,H,T,y,_,E,w,M,B])}var zY=0,XY=()=>`__${String(++zY)}__`;function JY(){let{router:E}=xB("useSubmit"),{basename:_}=gt.useContext(yc),T=mY();return gt.useCallback(async(y,w={})=>{let{action:M,method:B,encType:q,formData:Y,body:H}=wY(y,_);if(w.navigate===!1){let tt=w.fetcherKey||XY();await E.fetch(tt,T,w.action||M,{preventScrollReset:w.preventScrollReset,formData:Y,body:H,formMethod:w.method||B,formEncType:w.encType||q,flushSync:w.flushSync})}else await E.navigate(w.action||M,{preventScrollReset:w.preventScrollReset,formData:Y,body:H,formMethod:w.method||B,formEncType:w.encType||q,replace:w.replace,state:w.state,fromRouteId:T,flushSync:w.flushSync,viewTransition:w.viewTransition})},[E,_,T])}function QY(E,{relative:_}={}){let{basename:T}=gt.useContext(yc),y=gt.useContext(Cl);vi(y,"useFormAction must be used inside a RouteContext");let[w]=y.matches.slice(-1),M={..._S(E||".",{relative:_})},B=kh();if(E==null){M.search=B.search;let q=new URLSearchParams(M.search),Y=q.getAll("index");if(Y.some(tt=>tt==="")){q.delete("index"),Y.filter(rt=>rt).forEach(rt=>q.append("index",rt));let tt=q.toString();M.search=tt?`?${tt}`:""}}return(!E||E===".")&&w.route.index&&(M.search=M.search?M.search.replace(/^\?/,"?index&"):"?index"),T!=="/"&&(M.pathname=M.pathname==="/"?T:yl([T,M.pathname])),hS(M)}function ZY(E,_={}){let T=gt.useContext(AB);vi(T!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:y}=xB("useViewTransitionState"),w=_S(E,{relative:_.relative});if(!T.isTransitioning)return!1;let M=vl(T.currentLocation.pathname,y)||T.currentLocation.pathname,B=vl(T.nextLocation.pathname,y)||T.nextLocation.pathname;return SC(w.pathname,B)!=null||SC(w.pathname,M)!=null}new TextEncoder;var uC={exports:{}},$Y=uC.exports,tB;function tq(){return tB||(tB=1,function(E,_){(function(T,y){E.exports=y()})($Y,function(){function T(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var y=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof wO<"u"?wO:typeof self<"u"?self:{};function w(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var M=function(t){try{return!!t()}catch{return!0}},B=!M(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),q=B,Y=Function.prototype,H=Y.call,tt=q&&Y.bind.bind(H,H),rt=q?tt:function(t){return function(){return H.apply(t,arguments)}},ht=rt({}.isPrototypeOf),Mt=function(t){return t&&t.Math==Math&&t},st=Mt(typeof globalThis=="object"&&globalThis)||Mt(typeof window=="object"&&window)||Mt(typeof self=="object"&&self)||Mt(typeof y=="object"&&y)||function(){return this}()||y||Function("return this")(),Ut=B,mt=Function.prototype,vt=mt.apply,Gt=mt.call,Vt=typeof Reflect=="object"&&Reflect.apply||(Ut?Gt.bind(vt):function(){return Gt.apply(vt,arguments)}),Ce=rt,Jt=Ce({}.toString),$e=Ce("".slice),je=function(t){return $e(Jt(t),8,-1)},Gn=je,Pt=rt,Zt=function(t){if(Gn(t)==="Function")return Pt(t)},Ie=typeof document=="object"&&document.all,Qn={all:Ie,IS_HTMLDDA:Ie===void 0&&Ie!==void 0},qi=Qn.all,tn=Qn.IS_HTMLDDA?function(t){return typeof t=="function"||t===qi}:function(t){return typeof t=="function"},be={},Bt=!M(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),$t=B,re=Function.prototype.call,pe=$t?re.bind(re):function(){return re.apply(re,arguments)},$={},Ft={}.propertyIsEnumerable,fe=Object.getOwnPropertyDescriptor,_e=fe&&!Ft.call({1:2},1);$.f=_e?function(t){var e=fe(this,t);return!!e&&e.enumerable}:Ft;var zt,en,we=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},_r=M,Cn=je,ui=Object,Zn=rt("".split),qr=_r(function(){return!ui("z").propertyIsEnumerable(0)})?function(t){return Cn(t)=="String"?Zn(t,""):ui(t)}:ui,ia=function(t){return t==null},Oo=ia,Mh=TypeError,Ma=function(t){if(Oo(t))throw Mh("Can't call method on "+t);return t},bl=qr,Rm=Ma,Ls=function(t){return bl(Rm(t))},Uh=tn,ym=Qn.all,er=Qn.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:Uh(t)||t===ym}:function(t){return typeof t=="object"?t!==null:Uh(t)},zr={},vm=zr,cs=st,PC=tn,Cm=function(t){return PC(t)?t:void 0},nr=function(t,e){return arguments.length<2?Cm(vm[t])||Cm(cs[t]):vm[t]&&vm[t][e]||cs[t]&&cs[t][e]},Ps=typeof navigator<"u"&&String(navigator.userAgent)||"",SS=st,xh=Ps,TS=SS.process,RS=SS.Deno,Al=TS&&TS.versions||RS&&RS.version,Nr=Al&&Al.v8;Nr&&(en=(zt=Nr.split("."))[0]>0&&zt[0]<4?1:+(zt[0]+zt[1])),!en&&xh&&(!(zt=xh.match(/Edge\/(\d+)/))||zt[1]>=74)&&(zt=xh.match(/Chrome\/(\d+)/))&&(en=+zt[1]);var vc=en,Ua=vc,Xr=M,kC=st.String,Il=!!Object.getOwnPropertySymbols&&!Xr(function(){var t=Symbol();return!kC(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Ua&&Ua<41}),yS=Il&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Vh=nr,Bh=tn,Cc=ht,Fh=Object,xa=yS?function(t){return typeof t=="symbol"}:function(t){var e=Vh("Symbol");return Bh(e)&&Cc(e.prototype,Fh(t))},MC=String,bc=function(t){try{return MC(t)}catch{return"Object"}},vS=tn,bm=bc,Gu=TypeError,Jr=function(t){if(vS(t))return t;throw Gu(bm(t)+" is not a function")},CS=Jr,bS=ia,Hu=function(t,e){var n=t[e];return bS(n)?void 0:CS(n)},Am=pe,AS=tn,Va=er,ir=TypeError,Er={exports:{}},Ac=st,Im=Object.defineProperty,UC=function(t,e){try{Im(Ac,t,{value:e,configurable:!0,writable:!0})}catch{Ac[t]=e}return e},IS="__core-js_shared__",jh=st[IS]||UC(IS,{}),wl=jh;(Er.exports=function(t,e){return wl[t]||(wl[t]=e!==void 0?e:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var No=Er.exports,Ic=Ma,Ol=Object,Dr=function(t){return Ol(Ic(t))},Nl=Dr,ji=rt({}.hasOwnProperty),di=Object.hasOwn||function(t,e){return ji(Nl(t),e)},wS=rt,wc=0,Dl=Math.random(),Ba=wS(1 .toString),wm=function(t){return"Symbol("+(t===void 0?"":t)+")_"+Ba(++wc+Dl,36)},OS=No,Om=di,xC=wm,Gh=Il,Hh=yS,Lr=st.Symbol,Pr=OS("wks"),NS=Hh?Lr.for||Lr:Lr&&Lr.withoutSetter||xC,In=function(t){return Om(Pr,t)||(Pr[t]=Gh&&Om(Lr,t)?Lr[t]:NS("Symbol."+t)),Pr[t]},Wh=pe,Nm=er,Wu=xa,VC=Hu,ls=function(t,e){var n,i;if(AS(n=t.toString)&&!Va(i=Am(n,t))||AS(n=t.valueOf)&&!Va(i=Am(n,t)))return i;throw ir("Can't convert object to primitive value")},Dm=TypeError,DS=In("toPrimitive"),Lm=function(t,e){if(!Nm(t)||Wu(t))return t;var n,i=VC(t,DS);if(i){if(n=Wh(i,t,e),!Nm(n)||Wu(n))return n;throw Dm("Can't convert object to primitive value")}return ls(t)},Ll=xa,Ku=function(t){var e=Lm(t,"string");return Ll(e)?e:e+""},Pm=er,Do=st.document,BC=Pm(Do)&&Pm(Do.createElement),Kh=function(t){return BC?Do.createElement(t):{}},LS=Kh,Yh=!Bt&&!M(function(){return Object.defineProperty(LS("div"),"a",{get:function(){return 7}}).a!=7}),FC=Bt,jC=pe,qh=$,km=we,Mm=Ls,Pl=Ku,kl=di,PS=Yh,zh=Object.getOwnPropertyDescriptor;be.f=FC?zh:function(t,e){if(t=Mm(t),e=Pl(e),PS)try{return zh(t,e)}catch{}if(kl(t,e))return km(!jC(qh.f,t,e),t[e])};var kS=M,Yu=tn,Um=/#|\.prototype\./,Fa=function(t,e){var n=xm[Lo(t)];return n==MS||n!=Xh&&(Yu(e)?kS(e):!!e)},Lo=Fa.normalize=function(t){return String(t).replace(Um,".").toLowerCase()},xm=Fa.data={},Xh=Fa.NATIVE="N",MS=Fa.POLYFILL="P",qu=Fa,Jh=Jr,US=B,kr=Zt(Zt.bind),Mr=function(t,e){return Jh(t),e===void 0?t:US?kr(t,e):function(){return t.apply(e,arguments)}},gr={},Ml=Bt&&M(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),GC=er,Vm=String,Bm=TypeError,Ci=function(t){if(GC(t))return t;throw Bm(Vm(t)+" is not an object")},Qh=Bt,xS=Yh,HC=Ml,Zh=Ci,VS=Ku,Fm=TypeError,jm=Object.defineProperty,WC=Object.getOwnPropertyDescriptor,Gm="enumerable",Hm="configurable",Wm="writable";gr.f=Qh?HC?function(t,e,n){if(Zh(t),e=VS(e),Zh(n),typeof t=="function"&&e==="prototype"&&"value"in n&&Wm in n&&!n[Wm]){var i=WC(t,e);i&&i[Wm]&&(t[e]=n.value,n={configurable:Hm in n?n[Hm]:i[Hm],enumerable:Gm in n?n[Gm]:i[Gm],writable:!1})}return jm(t,e,n)}:jm:function(t,e,n){if(Zh(t),e=VS(e),Zh(n),xS)try{return jm(t,e,n)}catch{}if("get"in n||"set"in n)throw Fm("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var BS=gr,KC=we,Po=Bt?function(t,e,n){return BS.f(t,e,KC(1,n))}:function(t,e,n){return t[e]=n,t},$h=st,YC=Vt,Km=Zt,qC=tn,zC=be.f,XC=qu,Oc=zr,JC=Mr,Ul=Po,FS=di,QC=function(t){var e=function(n,i,r){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,i)}return new t(n,i,r)}return YC(t,this,arguments)};return e.prototype=t.prototype,e},Ue=function(t,e){var n,i,r,a,c,l,d,h,p,m=t.target,S=t.global,R=t.stat,O=t.proto,A=S?$h:R?$h[m]:($h[m]||{}).prototype,I=S?Oc:Oc[m]||Ul(Oc,m,{})[m],D=I.prototype;for(a in e)i=!(n=XC(S?a:m+(R?".":"#")+a,t.forced))&&A&&FS(A,a),l=I[a],i&&(d=t.dontCallGetSet?(p=zC(A,a))&&p.value:A[a]),c=i&&d?d:e[a],i&&typeof l==typeof c||(h=t.bind&&i?JC(c,$h):t.wrap&&i?QC(c):O&&qC(c)?Km(c):c,(t.sham||c&&c.sham||l&&l.sham)&&Ul(h,"sham",!0),Ul(I,a,h),O&&(FS(Oc,r=m+"Prototype")||Ul(Oc,r,{}),Ul(Oc[r],a,c),t.real&&D&&(n||!D[a])&&Ul(D,a,c)))},ZC=Math.ceil,$C=Math.floor,tb=Math.trunc||function(t){var e=+t;return(e>0?$C:ZC)(e)},eb=tb,zu=function(t){var e=+t;return e!=e||e===0?0:eb(e)},Xu=zu,nb=Math.max,jS=Math.min,tp=function(t,e){var n=Xu(t);return n<0?nb(n+e,0):jS(n,e)},GS=zu,HS=Math.min,Ym=function(t){return t>0?HS(GS(t),9007199254740991):0},xl=Ym,ja=function(t){return xl(t.length)},ib=Ls,rb=tp,WS=ja,qm=function(t){return function(e,n,i){var r,a=ib(e),c=WS(a),l=rb(i,c);if(t&&n!=n){for(;c>l;)if((r=a[l++])!=r)return!0}else for(;c>l;l++)if((t||l in a)&&a[l]===n)return t||l||0;return!t&&-1}},Nc={includes:qm(!0),indexOf:qm(!1)},Ju=Nc.includes;Ue({target:"Array",proto:!0,forced:M(function(){return!Array(1).includes()})},{includes:function(t){return Ju(this,t,arguments.length>1?arguments[1]:void 0)}});var sb=zr,Sr=function(t){return sb[t+"Prototype"]},KS=Sr("Array").includes,YS=er,zm=je,Xm=In("match"),Jm=function(t){var e;return YS(t)&&((e=t[Xm])!==void 0?!!e:zm(t)=="RegExp")},qS=Jm,zS=TypeError,XS={};XS[In("toStringTag")]="z";var Qm=String(XS)==="[object z]",ab=Qm,ob=tn,ep=je,Qr=In("toStringTag"),Qu=Object,JS=ep(function(){return arguments}())=="Arguments",ks=ab?ep:function(t){var e,n,i;return t===void 0?"Undefined":t===null?"Null":typeof(n=function(r,a){try{return r[a]}catch{}}(e=Qu(t),Qr))=="string"?n:JS?ep(e):(i=ep(e))=="Object"&&ob(e.callee)?"Arguments":i},QS=ks,ZS=String,Tr=function(t){if(QS(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return ZS(t)},cb=In("match"),lb=Ue,Vl=function(t){if(qS(t))throw zS("The method doesn't accept regular expressions");return t},Zm=Ma,Bl=Tr,$m=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[cb]=!1,"/./"[t](e)}catch{}}return!1},$S=rt("".indexOf);lb({target:"String",proto:!0,forced:!$m("includes")},{includes:function(t){return!!~$S(Bl(Zm(this)),Bl(Vl(t)),arguments.length>1?arguments[1]:void 0)}});var Dc=Sr("String").includes,Lc=ht,t_=KS,tT=Dc,Ga=Array.prototype,np=String.prototype,eT=function(t){var e=t.includes;return t===Ga||Lc(Ga,t)&&e===Ga.includes?t_:typeof t=="string"||t===np||Lc(np,t)&&e===np.includes?tT:e},_t=w(eT),ub=Jr,db=Dr,hb=qr,nT=ja,iT=TypeError,rT=function(t){return function(e,n,i,r){ub(n);var a=db(e),c=hb(a),l=nT(a),d=t?l-1:0,h=t?-1:1;if(i<2)for(;;){if(d in c){r=c[d],d+=h;break}if(d+=h,t?d<0:l<=d)throw iT("Reduce of empty array with no initial value")}for(;t?d>=0:l>d;d+=h)d in c&&(r=n(r,c[d],d,a));return r}},Ms={left:rT(!1)},us=M,Ha=function(t,e){var n=[][t];return!!n&&us(function(){n.call(null,e||function(){return 1},1)})},ko=typeof process<"u"&&je(process)=="process",ip=Ms.left;Ue({target:"Array",proto:!0,forced:!ko&&vc>79&&vc<83||!Ha("reduce")},{reduce:function(t){var e=arguments.length;return ip(this,t,e,e>1?arguments[1]:void 0)}});var rp=Sr("Array").reduce,e_=ht,Mo=rp,sp=Array.prototype,ap=function(t){var e=t.reduce;return t===sp||e_(sp,t)&&e===sp.reduce?Mo:e},Pc=ap,ds=w(Pc),hs=je,ra=Array.isArray||function(t){return hs(t)=="Array"},Fl=Ue,op=ra,cp=rt([].reverse),Zr=[1,2];Fl({target:"Array",proto:!0,forced:String(Zr)===String(Zr.reverse())},{reverse:function(){return op(this)&&(this.length=this.length),cp(this)}});var ps=Sr("Array").reverse,kc=ht,Wa=ps,Us=Array.prototype,Mc=function(t){var e=t.reverse;return t===Us||kc(Us,t)&&e===Us.reverse?Wa:e},n_=Mc,lp=w(n_),i_=wm,rr=No("keys"),bi=function(t){return rr[t]||(rr[t]=i_(t))},fn=!M(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),xs=di,sa=tn,r_=Dr,Uc=fn,s_=bi("IE_PROTO"),up=Object,Zu=up.prototype,xc=Uc?up.getPrototypeOf:function(t){var e=r_(t);if(xs(e,s_))return e[s_];var n=e.constructor;return sa(n)&&e instanceof n?n.prototype:e instanceof up?Zu:null},$u=rt,td=Jr,sT=tn,a_=String,aT=TypeError,dp=function(t,e,n){try{return $u(td(Object.getOwnPropertyDescriptor(t,e)[n]))}catch{}},oT=Ci,ed=function(t){if(typeof t=="object"||sT(t))return t;throw aT("Can't set "+a_(t)+" as a prototype")},cT=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=dp(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch{}return function(i,r){return oT(i),ed(r),e?t(i,r):i.__proto__=r,i}}():void 0),Ka={},Uo={},jl=di,nd=Ls,hp=Nc.indexOf,lT=Uo,o_=rt([].push),xo=function(t,e){var n,i=nd(t),r=0,a=[];for(n in i)!jl(lT,n)&&jl(i,n)&&o_(a,n);for(;e.length>r;)jl(i,n=e[r++])&&(~hp(a,n)||o_(a,n));return a},pp=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Gl=xo,fp=pp.concat("length","prototype");Ka.f=Object.getOwnPropertyNames||function(t){return Gl(t,fp)};var Hl={};Hl.f=Object.getOwnPropertySymbols;var c_=nr,l_=Ka,fs=Hl,aa=Ci,Vo=rt([].concat),uT=c_("Reflect","ownKeys")||function(t){var e=l_.f(aa(t)),n=fs.f;return n?Vo(e,n(t)):e},Ya=di,qa=uT,Mi=be,mp=gr,u_={},pb=xo,fb=pp,hi=Object.keys||function(t){return pb(t,fb)},d_=Bt,id=Ml,rd=gr,h_=Ci,Wl=Ls,Kl=hi;u_.f=d_&&!id?Object.defineProperties:function(t,e){h_(t);for(var n,i=Wl(e),r=Kl(e),a=r.length,c=0;a>c;)rd.f(t,n=r[c++],i[n]);return t};var _p,p_=nr("document","documentElement"),mb=Ci,dT=u_,Bo=pp,f_=Uo,Ep=p_,hT=Kh,oa="prototype",Ve="script",wn=bi("IE_PROTO"),pi=function(){},sd=function(t){return"<"+Ve+">"+t+"</"+Ve+">"},Vc=function(t){t.write(sd("")),t.close();var e=t.parentWindow.Object;return t=null,e},ca=function(){try{_p=new ActiveXObject("htmlfile")}catch{}var t,e,n;ca=typeof document<"u"?document.domain&&_p?Vc(_p):(e=hT("iframe"),n="java"+Ve+":",e.style.display="none",Ep.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(sd("document.F=Object")),t.close(),t.F):Vc(_p);for(var i=Bo.length;i--;)delete ca[oa][Bo[i]];return ca()};f_[wn]=!0;var Fo=Object.create||function(t,e){var n;return t!==null?(pi[oa]=mb(t),n=new pi,pi[oa]=null,n[wn]=t):n=ca(),e===void 0?n:dT.f(n,e)},ad=er,Yl=Po,pT=Error,Ei=rt("".replace),m_=String(pT("zxcasd").stack),gp=/\n\s*at [^:]*:[^\n]*/,fT=gp.test(m_),mT=we,_b=!M(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",mT(1,7)),t.stack!==7)}),__=Po,E_=function(t,e){if(fT&&typeof t=="string"&&!pT.prepareStackTrace)for(;e--;)t=Ei(t,gp,"");return t},g_=_b,Rr=Error.captureStackTrace,Hn={},Sp=Hn,od=In("iterator"),Tp=Array.prototype,Rp=function(t){return t!==void 0&&(Sp.Array===t||Tp[od]===t)},za=ks,cd=Hu,S_=ia,T_=Hn,_T=In("iterator"),ld=function(t){if(!S_(t))return cd(t,_T)||cd(t,"@@iterator")||T_[za(t)]},ET=pe,gT=Jr,ST=Ci,TT=bc,R_=ld,RT=TypeError,y_=function(t,e){var n=arguments.length<2?R_(t):e;if(gT(n))return ST(ET(n,t));throw RT(TT(t)+" is not iterable")},yT=pe,v_=Ci,vT=Hu,yp=function(t,e,n){var i,r;v_(t);try{if(!(i=vT(t,"return"))){if(e==="throw")throw n;return n}i=yT(i,t)}catch(a){r=!0,i=a}if(e==="throw")throw n;if(r)throw i;return v_(i),n},CT=Mr,bT=pe,AT=Ci,IT=bc,wT=Rp,Eb=ja,C_=ht,ql=y_,OT=ld,ud=yp,vp=TypeError,dd=function(t,e){this.stopped=t,this.result=e},Cp=dd.prototype,zl=function(t,e,n){var i,r,a,c,l,d,h,p=n&&n.that,m=!(!n||!n.AS_ENTRIES),S=!(!n||!n.IS_RECORD),R=!(!n||!n.IS_ITERATOR),O=!(!n||!n.INTERRUPTED),A=CT(e,p),I=function(L){return i&&ud(i,"normal",L),new dd(!0,L)},D=function(L){return m?(AT(L),O?A(L[0],L[1],I):A(L[0],L[1])):O?A(L,I):A(L)};if(S)i=t.iterator;else if(R)i=t;else{if(!(r=OT(t)))throw vp(IT(t)+" is not iterable");if(wT(r)){for(a=0,c=Eb(t);c>a;a++)if((l=D(t[a]))&&C_(Cp,l))return l;return new dd(!1)}i=ql(t,r)}for(d=S?t.next:i.next;!(h=bT(d,i)).done;){try{l=D(h.value)}catch(L){ud(i,"throw",L)}if(typeof l=="object"&&l&&C_(Cp,l))return l}return new dd(!1)},NT=Tr,DT=Ue,LT=ht,b_=xc,hd=cT,PT=function(t,e,n){for(var i=qa(e),r=mp.f,a=Mi.f,c=0;c<i.length;c++){var l=i[c];Ya(t,l)||n&&Ya(n,l)||r(t,l,a(e,l))}},bp=Fo,Ap=Po,Ip=we,gb=function(t,e){ad(e)&&"cause"in e&&Yl(t,"cause",e.cause)},A_=function(t,e,n,i){g_&&(Rr?Rr(t,e):__(t,"stack",E_(n,i)))},kT=zl,MT=function(t,e){return t===void 0?arguments.length<2?"":e:NT(t)},I_=In("toStringTag"),pd=Error,UT=[].push,Xl=function(t,e){var n,i=LT(w_,this);hd?n=hd(pd(),i?b_(this):w_):(n=i?this:bp(w_),Ap(n,I_,"Error")),e!==void 0&&Ap(n,"message",MT(e)),A_(n,Xl,n.stack,1),arguments.length>2&&gb(n,arguments[2]);var r=[];return kT(t,UT,{that:r}),Ap(n,"errors",r),n};hd?hd(Xl,pd):PT(Xl,pd,{name:!0});var w_=Xl.prototype=bp(pd.prototype,{constructor:Ip(1,Xl),message:Ip(1,""),name:Ip(1,"AggregateError")});DT({global:!0},{AggregateError:Xl});var fd,Xa,Jl,wp=tn,O_=st.WeakMap,xT=wp(O_)&&/native code/.test(String(O_)),Vs=st,Bc=er,jo=Po,Ja=di,md=jh,N_=bi,VT=Uo,D_="Object already initialized",Qa=Vs.TypeError,Op=Vs.WeakMap;if(xT||md.state){var Bs=md.state||(md.state=new Op);Bs.get=Bs.get,Bs.has=Bs.has,Bs.set=Bs.set,fd=function(t,e){if(Bs.has(t))throw Qa(D_);return e.facade=t,Bs.set(t,e),e},Xa=function(t){return Bs.get(t)||{}},Jl=function(t){return Bs.has(t)}}else{var Fc=N_("state");VT[Fc]=!0,fd=function(t,e){if(Ja(t,Fc))throw Qa(D_);return e.facade=t,jo(t,Fc,e),e},Xa=function(t){return Ja(t,Fc)?t[Fc]:{}},Jl=function(t){return Ja(t,Fc)}}var Go,_d,L_,Za={set:fd,get:Xa,has:Jl,enforce:function(t){return Jl(t)?Xa(t):fd(t,{})},getterFor:function(t){return function(e){var n;if(!Bc(e)||(n=Xa(e)).type!==t)throw Qa("Incompatible receiver, "+t+" required");return n}}},Np=Bt,BT=di,FT=Function.prototype,jT=Np&&Object.getOwnPropertyDescriptor,Ui=BT(FT,"name"),Gi={PROPER:Ui&&(function(){}).name==="something",CONFIGURABLE:Ui&&(!Np||Np&&jT(FT,"name").configurable)},GT=Po,$a=function(t,e,n,i){return i&&i.enumerable?t[e]=n:GT(t,e,n),t},HT=M,WT=tn,KT=er,Ed=Fo,Dp=xc,YT=$a,Lp=In("iterator"),P_=!1;[].keys&&("next"in(L_=[].keys())?(_d=Dp(Dp(L_)))!==Object.prototype&&(Go=_d):P_=!0);var k_=!KT(Go)||HT(function(){var t={};return Go[Lp].call(t)!==t});WT((Go=k_?{}:Ed(Go))[Lp])||YT(Go,Lp,function(){return this});var Pp={IteratorPrototype:Go,BUGGY_SAFARI_ITERATORS:P_},M_=ks,qT=Qm?{}.toString:function(){return"[object "+M_(this)+"]"},U_=Qm,x_=gr.f,V_=Po,zT=di,B_=qT,F_=In("toStringTag"),sr=function(t,e,n,i){if(t){var r=n?t:t.prototype;zT(r,F_)||x_(r,F_,{configurable:!0,value:e}),i&&!U_&&V_(r,"toString",B_)}},j_=Pp.IteratorPrototype,Sb=Fo,XT=we,G_=sr,jc=Hn,to=function(){return this},la=function(t,e,n,i){var r=e+" Iterator";return t.prototype=Sb(j_,{next:XT(+!i,n)}),G_(t,r,!1,!0),jc[r]=to,t},eo=Ue,H_=pe,W_=Gi,gd=la,kp=xc,Gc=sr,zi=$a,Sd=Hn,JT=Pp,Ho=W_.PROPER,Ql=JT.BUGGY_SAFARI_ITERATORS,Td=In("iterator"),no="keys",Fs="values",Zl="entries",K_=function(){return this},Mp=function(t,e,n,i,r,a,c){gd(n,e,i);var l,d,h,p=function(D){if(D===r&&A)return A;if(!Ql&&D in R)return R[D];switch(D){case no:case Fs:case Zl:return function(){return new n(this,D)}}return function(){return new n(this)}},m=e+" Iterator",S=!1,R=t.prototype,O=R[Td]||R["@@iterator"]||r&&R[r],A=!Ql&&O||p(r),I=e=="Array"&&R.entries||O;if(I&&(l=kp(I.call(new t)))!==Object.prototype&&l.next&&(Gc(l,m,!0,!0),Sd[m]=K_),Ho&&r==Fs&&O&&O.name!==Fs&&(S=!0,A=function(){return H_(O,this)}),r)if(d={values:p(Fs),keys:a?A:p(no),entries:p(Zl)},c)for(h in d)(Ql||S||!(h in R))&&zi(R,h,d[h]);else eo({target:e,proto:!0,forced:Ql||S},d);return c&&R[Td]!==A&&zi(R,Td,A,{}),Sd[e]=A,d},Hc=function(t,e){return{value:t,done:e}},Rd=Ls,Y_=Hn,q_=Za;gr.f;var yd=Mp,io=Hc,z_="Array Iterator",QT=q_.set,Wc=q_.getterFor(z_);yd(Array,"Array",function(t,e){QT(this,{type:z_,target:Rd(t),index:0,kind:e})},function(){var t=Wc(this),e=t.target,n=t.kind,i=t.index++;return!e||i>=e.length?(t.target=void 0,io(void 0,!0)):io(n=="keys"?i:n=="values"?e[i]:[i,e[i]],!1)},"values"),Y_.Arguments=Y_.Array;var $r=gr,vd=function(t,e,n){return $r.f(t,e,n)},ZT=nr,$T=vd,X_=Bt,Up=In("species"),xp=ht,ro=TypeError,$n=function(t,e){if(xp(e,t))return t;throw ro("Incorrect invocation")},J_=tn,Vp=jh,Hi=rt(Function.toString);J_(Vp.inspectSource)||(Vp.inspectSource=function(t){return Hi(t)});var Q_=Vp.inspectSource,Tb=rt,tR=M,Z_=tn,Ai=ks,ts=Q_,ua=function(){},eR=[],$_=nr("Reflect","construct"),tE=/^\s*(?:class|function)\b/,eE=Tb(tE.exec),ms=!tE.exec(ua),yr=function(t){if(!Z_(t))return!1;try{return $_(ua,eR,t),!0}catch{return!1}},nE=function(t){if(!Z_(t))return!1;switch(Ai(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return ms||!!eE(tE,ts(t))}catch{return!0}};nE.sham=!0;var ar,Kc,da,Wo,js=!$_||tR(function(){var t;return yr(yr.call)||!yr(Object)||!yr(function(){t=!0})||t})?nE:yr,iE=js,rE=bc,Ko=TypeError,sE=Ci,$l=function(t){if(iE(t))return t;throw Ko(rE(t)+" is not a constructor")},Cd=ia,bd=In("species"),Yo=function(t,e){var n,i=sE(t).constructor;return i===void 0||Cd(n=sE(i)[bd])?e:$l(n)},Ad=rt([].slice),nR=TypeError,ha=function(t,e){if(t<e)throw nR("Not enough arguments");return t},aE=/(?:ipad|iphone|ipod).*applewebkit/i.test(Ps),or=st,iR=Vt,Rb=Mr,es=tn,oE=di,so=M,cE=p_,Bp=Ad,qo=Kh,rR=ha,lE=aE,uE=ko,Gs=or.setImmediate,Fp=or.clearImmediate,jp=or.process,Yc=or.Dispatch,ni=or.Function,sR=or.MessageChannel,yb=or.String,Gp=0,Id={},aR="onreadystatechange";so(function(){ar=or.location});var zn=function(t){if(oE(Id,t)){var e=Id[t];delete Id[t],e()}},Ln=function(t){return function(){zn(t)}},ze=function(t){zn(t.data)},sn=function(t){or.postMessage(yb(t),ar.protocol+"//"+ar.host)};Gs&&Fp||(Gs=function(t){rR(arguments.length,1);var e=es(t)?t:ni(t),n=Bp(arguments,1);return Id[++Gp]=function(){iR(e,void 0,n)},Kc(Gp),Gp},Fp=function(t){delete Id[t]},uE?Kc=function(t){jp.nextTick(Ln(t))}:Yc&&Yc.now?Kc=function(t){Yc.now(Ln(t))}:sR&&!lE?(Wo=(da=new sR).port2,da.port1.onmessage=ze,Kc=Rb(Wo.postMessage,Wo)):or.addEventListener&&es(or.postMessage)&&!or.importScripts&&ar&&ar.protocol!=="file:"&&!so(sn)?(Kc=sn,or.addEventListener("message",ze,!1)):Kc=aR in qo("script")?function(t){cE.appendChild(qo("script"))[aR]=function(){cE.removeChild(this),zn(t)}}:function(t){setTimeout(Ln(t),0)});var On={set:Gs,clear:Fp},Ur=function(){this.head=null,this.tail=null};Ur.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var xr,zo,wd,Hs,ii,ao=Ur,qc=/ipad|iphone|ipod/i.test(Ps)&&typeof Pebble<"u",dE=/web0s(?!.*chrome)/i.test(Ps),Wi=st,zc=Mr,Od=be.f,_s=On.set,hE=ao,pE=aE,Hp=qc,Wp=dE,pa=ko,Nd=Wi.MutationObserver||Wi.WebKitMutationObserver,Xo=Wi.document,tu=Wi.process,eu=Wi.Promise,Kp=Od(Wi,"queueMicrotask"),Xc=Kp&&Kp.value;if(!Xc){var nu=new hE,cr=function(){var t,e;for(pa&&(t=tu.domain)&&t.exit();e=nu.get();)try{e()}catch(n){throw nu.head&&xr(),n}t&&t.enter()};pE||pa||Wp||!Nd||!Xo?!Hp&&eu&&eu.resolve?((Hs=eu.resolve(void 0)).constructor=eu,ii=zc(Hs.then,Hs),xr=function(){ii(cr)}):pa?xr=function(){tu.nextTick(cr)}:(_s=zc(_s,Wi),xr=function(){_s(cr)}):(zo=!0,wd=Xo.createTextNode(""),new Nd(cr).observe(wd,{characterData:!0}),xr=function(){wd.data=zo=!zo}),Xc=function(t){nu.head||xr(),nu.add(t)}}var fE=Xc,Ii=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},Jo=st.Promise,Yp=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",oR=!Yp&&!ko&&typeof window=="object"&&typeof document=="object",vb=st,ns=Jo,qp=tn,mE=qu,iu=Q_,cR=In,lR=oR,uR=Yp,Dd=vc,zp=ns&&ns.prototype,Cb=cR("species"),dR=qp(vb.PromiseRejectionEvent),bb=mE("Promise",function(){var t=iu(ns),e=t!==String(ns);if(!e&&Dd===66||!zp.catch||!zp.finally)return!0;if(!Dd||Dd<51||!/native code/.test(t)){var n=new ns(function(r){r(1)}),i=function(r){r(function(){},function(){})};if((n.constructor={})[Cb]=i,!(n.then(function(){})instanceof i))return!0}return!e&&(lR||uR)&&!dR}),ru={CONSTRUCTOR:bb,REJECTION_EVENT:dR},Ws={},Jc=Jr,Xp=TypeError,hR=function(t){var e,n;this.promise=new t(function(i,r){if(e!==void 0||n!==void 0)throw Xp("Bad Promise constructor");e=i,n=r}),this.resolve=Jc(e),this.reject=Jc(n)};Ws.f=function(t){return new hR(t)};var Jp,pR,fR=Ue,oo=ko,co=st,gn=pe,_E=$a,Ab=sr,mR=function(t){var e=ZT(t);X_&&e&&!e[Up]&&$T(e,Up,{configurable:!0,get:function(){return this}})},Ib=Jr,EE=tn,wb=er,Qp=$n,su=Yo,Zp=On.set,au=fE,gE=function(t,e){try{arguments.length==1?console.error(t):console.error(t,e)}catch{}},Qc=Ii,fa=ao,ou=Za,SE=Jo,TE=ru,RE=Ws,Ld="Promise",_R=TE.CONSTRUCTOR,yE=TE.REJECTION_EVENT,$p=ou.getterFor(Ld),ER=ou.set,Ob=SE&&SE.prototype,Zc=SE,Pd=Ob,gR=co.TypeError,vE=co.document,$c=co.process,CE=RE.f,SR=CE,an=!!(vE&&vE.createEvent&&co.dispatchEvent),tf="unhandledrejection",kd=function(t){var e;return!(!wb(t)||!EE(e=t.then))&&e},ef=function(t,e){var n,i,r,a=e.value,c=e.state==1,l=c?t.ok:t.fail,d=t.resolve,h=t.reject,p=t.domain;try{l?(c||(e.rejection===2&&cu(e),e.rejection=1),l===!0?n=a:(p&&p.enter(),n=l(a),p&&(p.exit(),r=!0)),n===t.promise?h(gR("Promise-chain cycle")):(i=kd(n))?gn(i,n,d,h):d(n)):h(a)}catch(m){p&&!r&&p.exit(),h(m)}},bE=function(t,e){t.notified||(t.notified=!0,au(function(){for(var n,i=t.reactions;n=i.get();)ef(n,t);t.notified=!1,e&&!t.rejection&&Md(t)}))},nf=function(t,e,n){var i,r;an?((i=vE.createEvent("Event")).promise=e,i.reason=n,i.initEvent(t,!1,!0),co.dispatchEvent(i)):i={promise:e,reason:n},!yE&&(r=co["on"+t])?r(i):t===tf&&gE("Unhandled promise rejection",n)},Md=function(t){gn(Zp,co,function(){var e,n=t.facade,i=t.value;if(Ud(t)&&(e=Qc(function(){oo?$c.emit("unhandledRejection",i,n):nf(tf,n,i)}),t.rejection=oo||Ud(t)?2:1,e.error))throw e.value})},Ud=function(t){return t.rejection!==1&&!t.parent},cu=function(t){gn(Zp,co,function(){var e=t.facade;oo?$c.emit("rejectionHandled",e):nf("rejectionhandled",e,t.value)})},tl=function(t,e,n){return function(i){t(e,i,n)}},lu=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,bE(t,!0))},AE=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw gR("Promise can't be resolved itself");var i=kd(e);i?au(function(){var r={done:!1};try{gn(i,e,tl(AE,r,t),tl(lu,r,t))}catch(a){lu(r,a,t)}}):(t.value=e,t.state=1,bE(t,!1))}catch(r){lu({done:!1},r,t)}}};_R&&(Pd=(Zc=function(t){Qp(this,Pd),Ib(t),gn(Jp,this);var e=$p(this);try{t(tl(AE,e),tl(lu,e))}catch(n){lu(e,n)}}).prototype,(Jp=function(t){ER(this,{type:Ld,done:!1,notified:!1,parent:!1,reactions:new fa,rejection:!1,state:0,value:void 0})}).prototype=_E(Pd,"then",function(t,e){var n=$p(this),i=CE(su(this,Zc));return n.parent=!0,i.ok=!EE(t)||t,i.fail=EE(e)&&e,i.domain=oo?$c.domain:void 0,n.state==0?n.reactions.add(i):au(function(){ef(i,n)}),i.promise}),pR=function(){var t=new Jp,e=$p(t);this.promise=t,this.resolve=tl(AE,e),this.reject=tl(lu,e)},RE.f=CE=function(t){return t===Zc||t===void 0?new pR(t):SR(t)}),fR({global:!0,wrap:!0,forced:_R},{Promise:Zc}),Ab(Zc,Ld,!1,!0),mR(Ld);var IE=In("iterator"),wE=!1;try{var rf=0,Nn={next:function(){return{done:!!rf++}},return:function(){wE=!0}};Nn[IE]=function(){return this},Array.from(Nn,function(){throw 2})}catch{}var OE=Jo,Xi=function(t,e){if(!wE)return!1;var n=!1;try{var i={};i[IE]=function(){return{next:function(){return{done:n=!0}}}},t(i)}catch{}return n},sf=ru.CONSTRUCTOR||!Xi(function(t){OE.all(t).then(void 0,function(){})}),NE=pe,DE=Jr,af=Ws,TR=Ii,RR=zl;Ue({target:"Promise",stat:!0,forced:sf},{all:function(t){var e=this,n=af.f(e),i=n.resolve,r=n.reject,a=TR(function(){var c=DE(e.resolve),l=[],d=0,h=1;RR(t,function(p){var m=d++,S=!1;h++,NE(c,e,p).then(function(R){S||(S=!0,l[m]=R,--h||i(l))},r)}),--h||i(l)});return a.error&&r(a.value),n.promise}});var LE=Ue,PE=ru.CONSTRUCTOR;Jo&&Jo.prototype,LE({target:"Promise",proto:!0,forced:PE,real:!0},{catch:function(t){return this.then(void 0,t)}});var Nb=pe,yR=Jr,Db=Ws,vR=Ii,Lb=zl;Ue({target:"Promise",stat:!0,forced:sf},{race:function(t){var e=this,n=Db.f(e),i=n.reject,r=vR(function(){var a=yR(e.resolve);Lb(t,function(c){Nb(a,e,c).then(n.resolve,i)})});return r.error&&i(r.value),n.promise}});var Pb=pe,kE=Ws;Ue({target:"Promise",stat:!0,forced:ru.CONSTRUCTOR},{reject:function(t){var e=kE.f(this);return Pb(e.reject,void 0,t),e.promise}});var ME=Ci,kb=er,Mb=Ws,Es=function(t,e){if(ME(t),kb(e)&&e.constructor===t)return e;var n=Mb.f(t);return(0,n.resolve)(e),n.promise},CR=Ue,bR=Jo,gs=ru.CONSTRUCTOR,AR=Es,of=nr("Promise"),lo=!gs;CR({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return AR(lo&&this===of?bR:this,t)}});var Ub=pe,xb=Jr,uu=Ws,IR=Ii,Vb=zl;Ue({target:"Promise",stat:!0,forced:sf},{allSettled:function(t){var e=this,n=uu.f(e),i=n.resolve,r=n.reject,a=IR(function(){var c=xb(e.resolve),l=[],d=0,h=1;Vb(t,function(p){var m=d++,S=!1;h++,Ub(c,e,p).then(function(R){S||(S=!0,l[m]={status:"fulfilled",value:R},--h||i(l))},function(R){S||(S=!0,l[m]={status:"rejected",reason:R},--h||i(l))})}),--h||i(l)});return a.error&&r(a.value),n.promise}});var Bb=pe,Fb=Jr,jb=nr,Gb=Ws,Hb=Ii,Wb=zl,UE="No one promise resolved";Ue({target:"Promise",stat:!0,forced:sf},{any:function(t){var e=this,n=jb("AggregateError"),i=Gb.f(e),r=i.resolve,a=i.reject,c=Hb(function(){var l=Fb(e.resolve),d=[],h=0,p=1,m=!1;Wb(t,function(S){var R=h++,O=!1;p++,Bb(l,e,S).then(function(A){O||m||(m=!0,r(A))},function(A){O||m||(O=!0,d[R]=A,--p||a(new n(d,UE)))})}),--p||a(new n(d,UE))});return c.error&&a(c.value),i.promise}});var du=Ue,el=Jo,wR=M,Kb=nr,hu=tn,xd=Yo,xE=Es,cf=el&&el.prototype;du({target:"Promise",proto:!0,real:!0,forced:!!el&&wR(function(){cf.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=xd(this,Kb("Promise")),n=hu(t);return this.then(n?function(i){return xE(e,t()).then(function(){return i})}:t,n?function(i){return xE(e,t()).then(function(){throw i})}:t)}});var Vd=rt,VE=zu,lf=Tr,OR=Ma,NR=Vd("".charAt),DR=Vd("".charCodeAt),LR=Vd("".slice),pu=function(t){return function(e,n){var i,r,a=lf(OR(e)),c=VE(n),l=a.length;return c<0||c>=l?t?"":void 0:(i=DR(a,c))<55296||i>56319||c+1===l||(r=DR(a,c+1))<56320||r>57343?t?NR(a,c):i:t?LR(a,c,c+2):r-56320+(i-55296<<10)+65536}},BE={codeAt:pu(!1),charAt:pu(!0)},Yb=BE.charAt,qb=Tr,Bd=Za,uf=Mp,df=Hc,PR="String Iterator",Fd=Bd.set,zb=Bd.getterFor(PR);uf(String,"String",function(t){Fd(this,{type:PR,string:qb(t),index:0})},function(){var t,e=zb(this),n=e.string,i=e.index;return i>=n.length?df(void 0,!0):(t=Yb(n,i),e.index+=t.length,df(t,!1))});var kR=zr.Promise,MR={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},UR=st,xR=ks,FE=Po,jE=Hn,jd=In("toStringTag");for(var GE in MR){var VR=UR[GE],Gd=VR&&VR.prototype;Gd&&xR(Gd)!==jd&&FE(Gd,jd,GE),jE[GE]=jE.Array}var hf=kR,Et=w(hf),HE=Sr("Array").values,BR=ks,WE=di,Qo=ht,Zo=HE,ma=Array.prototype,Hd={DOMTokenList:!0,NodeList:!0},Wd=function(t){var e=t.values;return t===ma||Qo(ma,t)&&e===ma.values||WE(Hd,BR(t))?Zo:e},gi=w(Wd),Xb=M,FR=In("iterator"),nl=!Xb(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,n=new URLSearchParams("a=1&a=2"),i="";return t.pathname="c%20d",e.forEach(function(r,a){e.delete("b"),i+=a+r}),n.delete("a",2),!t.toJSON||!n.has("a",1)||n.has("a",2)||!e.size&&!0||!e.sort||t.href!=="http://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[FR]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||i!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Jb=$a,jR=Ku,pf=gr,GR=we,ff=function(t,e,n){var i=jR(e);i in t?pf.f(t,i,GR(0,n)):t[i]=n},Kd=tp,mf=ja,HR=ff,Yd=Array,KE=Math.max,fu=function(t,e,n){for(var i=mf(t),r=Kd(e,i),a=Kd(n===void 0?i:n,i),c=Yd(KE(a-r,0)),l=0;r<a;r++,l++)HR(c,l,t[r]);return c.length=l,c},YE=fu,Qb=Math.floor,mu=function(t,e){var n=t.length,i=Qb(n/2);return n<8?s(t,e):o(t,mu(YE(t,0,i),e),mu(YE(t,i),e),e)},s=function(t,e){for(var n,i,r=t.length,a=1;a<r;){for(i=a,n=t[a];i&&e(t[i-1],n)>0;)t[i]=t[--i];i!==a++&&(t[i]=n)}return t},o=function(t,e,n,i){for(var r=e.length,a=n.length,c=0,l=0;c<r||l<a;)t[c+l]=c<r&&l<a?i(e[c],n[l])<=0?e[c++]:n[l++]:c<r?e[c++]:n[l++];return t},u=mu,f=Ue,g=st,C=pe,k=rt,j=Bt,z=nl,nt=$a,bt=vd,xt=function(t,e,n){for(var i in e)n&&n.unsafe&&t[i]?t[i]=e[i]:Jb(t,i,e[i],n);return t},pt=sr,yt=la,se=Za,Le=$n,ti=tn,ot=di,et=Mr,ut=ks,Nt=Ci,ne=er,me=Tr,oe=Fo,Ee=we,wi=y_,mn=ld,is=ha,Zb=u,CF=In("iterator"),qE="URLSearchParams",T0=qE+"Iterator",R0=se.set,_a=se.getterFor(qE),bF=se.getterFor(T0),AF=Object.getOwnPropertyDescriptor,$b=function(t){if(!j)return g[t];var e=AF(g,t);return e&&e.value},y0=$b("fetch"),WR=$b("Request"),zE=$b("Headers"),tA=WR&&WR.prototype,v0=zE&&zE.prototype,IF=g.RegExp,wF=g.TypeError,C0=g.decodeURIComponent,OF=g.encodeURIComponent,NF=k("".charAt),b0=k([].join),qd=k([].push),eA=k("".replace),DF=k([].shift),A0=k([].splice),I0=k("".split),LF=k("".slice),PF=/\+/g,w0=Array(4),kF=function(t){return w0[t-1]||(w0[t-1]=IF("((?:%[\\da-f]{2}){"+t+"})","gi"))},MF=function(t){try{return C0(t)}catch{return t}},O0=function(t){var e=eA(t,PF," "),n=4;try{return C0(e)}catch{for(;n;)e=eA(e,kF(n--),MF);return e}},UF=/[!'()~]|%20/g,xF={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},VF=function(t){return xF[t]},N0=function(t){return eA(OF(t),UF,VF)},nA=yt(function(t,e){R0(this,{type:T0,iterator:wi(_a(t).entries),kind:e})},"Iterator",function(){var t=bF(this),e=t.kind,n=t.iterator.next(),i=n.value;return n.done||(n.value=e==="keys"?i.key:e==="values"?i.value:[i.key,i.value]),n},!0),D0=function(t){this.entries=[],this.url=null,t!==void 0&&(ne(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?NF(t,0)==="?"?LF(t,1):t:me(t)))};D0.prototype={type:qE,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,i,r,a,c,l,d=mn(t);if(d)for(n=(e=wi(t,d)).next;!(i=C(n,e)).done;){if(a=(r=wi(Nt(i.value))).next,(c=C(a,r)).done||(l=C(a,r)).done||!C(a,r).done)throw wF("Expected sequence with length 2");qd(this.entries,{key:me(c.value),value:me(l.value)})}else for(var h in t)ot(t,h)&&qd(this.entries,{key:h,value:me(t[h])})},parseQuery:function(t){if(t)for(var e,n,i=I0(t,"&"),r=0;r<i.length;)(e=i[r++]).length&&(n=I0(e,"="),qd(this.entries,{key:O0(DF(n)),value:O0(b0(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],i=0;i<e.length;)t=e[i++],qd(n,N0(t.key)+"="+N0(t.value));return b0(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var KR=function(){Le(this,_f);var t=R0(this,new D0(arguments.length>0?arguments[0]:void 0));j||(this.size=t.entries.length)},_f=KR.prototype;if(xt(_f,{append:function(t,e){var n=_a(this);is(arguments.length,2),qd(n.entries,{key:me(t),value:me(e)}),j||this.length++,n.updateURL()},delete:function(t){for(var e=_a(this),n=is(arguments.length,1),i=e.entries,r=me(t),a=n<2?void 0:arguments[1],c=a===void 0?a:me(a),l=0;l<i.length;){var d=i[l];if(d.key!==r||c!==void 0&&d.value!==c)l++;else if(A0(i,l,1),c!==void 0)break}j||(this.size=i.length),e.updateURL()},get:function(t){var e=_a(this).entries;is(arguments.length,1);for(var n=me(t),i=0;i<e.length;i++)if(e[i].key===n)return e[i].value;return null},getAll:function(t){var e=_a(this).entries;is(arguments.length,1);for(var n=me(t),i=[],r=0;r<e.length;r++)e[r].key===n&&qd(i,e[r].value);return i},has:function(t){for(var e=_a(this).entries,n=is(arguments.length,1),i=me(t),r=n<2?void 0:arguments[1],a=r===void 0?r:me(r),c=0;c<e.length;){var l=e[c++];if(l.key===i&&(a===void 0||l.value===a))return!0}return!1},set:function(t,e){var n=_a(this);is(arguments.length,1);for(var i,r=n.entries,a=!1,c=me(t),l=me(e),d=0;d<r.length;d++)(i=r[d]).key===c&&(a?A0(r,d--,1):(a=!0,i.value=l));a||qd(r,{key:c,value:l}),j||(this.size=r.length),n.updateURL()},sort:function(){var t=_a(this);Zb(t.entries,function(e,n){return e.key>n.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=_a(this).entries,i=et(t,arguments.length>1?arguments[1]:void 0),r=0;r<n.length;)i((e=n[r++]).value,e.key,this)},keys:function(){return new nA(this,"keys")},values:function(){return new nA(this,"values")},entries:function(){return new nA(this,"entries")}},{enumerable:!0}),nt(_f,CF,_f.entries,{}),nt(_f,"toString",function(){return _a(this).serialize()},{enumerable:!0}),j&&bt(_f,"size",{get:function(){return _a(this).entries.length},configurable:!0,enumerable:!0}),pt(KR,qE),f({global:!0,forced:!z},{URLSearchParams:KR}),!z&&ti(zE)){var BF=k(v0.has),FF=k(v0.set),L0=function(t){if(ne(t)){var e,n=t.body;if(ut(n)===qE)return e=t.headers?new zE(t.headers):new zE,BF(e,"content-type")||FF(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),oe(t,{body:Ee(0,me(n)),headers:Ee(0,e)})}return t};if(ti(y0)&&f({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return y0(t,arguments.length>1?L0(arguments[1]):{})}}),ti(WR)){var iA=function(t){return Le(this,tA),new WR(t,arguments.length>1?L0(arguments[1]):{})};tA.constructor=iA,iA.prototype=tA,f({global:!0,dontCallGetSet:!0,forced:!0},{Request:iA})}}var Ea,jF={URLSearchParams:KR,getState:_a},GF=zr.URLSearchParams,P0=Bt,HF=rt,WF=pe,KF=M,rA=hi,YF=Hl,qF=$,zF=Dr,XF=qr,Ef=Object.assign,k0=Object.defineProperty,JF=HF([].concat),QF=!Ef||KF(function(){if(P0&&Ef({b:1},Ef(k0({},"a",{enumerable:!0,get:function(){k0(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},n=Symbol(),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach(function(r){e[r]=r}),Ef({},t)[n]!=7||rA(Ef({},e)).join("")!=i})?function(t,e){for(var n=zF(t),i=arguments.length,r=1,a=YF.f,c=qF.f;i>r;)for(var l,d=XF(arguments[r++]),h=a?JF(rA(d),a(d)):rA(d),p=h.length,m=0;p>m;)l=h[m++],P0&&!WF(c,d,l)||(n[l]=d[l]);return n}:Ef,ZF=Ci,$F=yp,tj=Mr,ej=pe,nj=Dr,ij=function(t,e,n,i){try{return i?e(ZF(n)[0],n[1]):e(n)}catch(r){$F(t,"throw",r)}},rj=Rp,sj=js,aj=ja,M0=ff,oj=y_,cj=ld,U0=Array,zd=rt,sA=2147483647,lj=/[^\0-\u007E]/,x0=/[.\u3002\uFF0E\uFF61]/g,V0="Overflow: input needs wider integers to process",B0=RangeError,uj=zd(x0.exec),gf=Math.floor,aA=String.fromCharCode,F0=zd("".charCodeAt),j0=zd([].join),_u=zd([].push),dj=zd("".replace),hj=zd("".split),pj=zd("".toLowerCase),G0=function(t){return t+22+75*(t<26)},fj=function(t,e,n){var i=0;for(t=n?gf(t/700):t>>1,t+=gf(t/e);t>455;)t=gf(t/35),i+=36;return gf(i+36*t/(t+38))},mj=function(t){var e=[];t=function(D){for(var L=[],V=0,W=D.length;V<W;){var K=F0(D,V++);if(K>=55296&&K<=56319&&V<W){var G=F0(D,V++);(64512&G)==56320?_u(L,((1023&K)<<10)+(1023&G)+65536):(_u(L,K),V--)}else _u(L,K)}return L}(t);var n,i,r=t.length,a=128,c=0,l=72;for(n=0;n<t.length;n++)(i=t[n])<128&&_u(e,aA(i));var d=e.length,h=d;for(d&&_u(e,"-");h<r;){var p=sA;for(n=0;n<t.length;n++)(i=t[n])>=a&&i<p&&(p=i);var m=h+1;if(p-a>gf((sA-c)/m))throw B0(V0);for(c+=(p-a)*m,a=p,n=0;n<t.length;n++){if((i=t[n])<a&&++c>sA)throw B0(V0);if(i==a){for(var S=c,R=36;;){var O=R<=l?1:R>=l+26?26:R-l;if(S<O)break;var A=S-O,I=36-O;_u(e,aA(G0(O+A%I))),S=gf(A/I),R+=36}_u(e,aA(G0(S))),l=fj(c,m,h==d),c=0,h++}}c++,a++}return j0(e,"")},_j=Ue,oA=Bt,Ej=nl,cA=st,H0=Mr,ga=rt,YR=$a,Sa=vd,gj=$n,lA=di,uA=QF,Sf=function(t){var e=nj(t),n=sj(this),i=arguments.length,r=i>1?arguments[1]:void 0,a=r!==void 0;a&&(r=tj(r,i>2?arguments[2]:void 0));var c,l,d,h,p,m,S=cj(e),R=0;if(!S||this===U0&&rj(S))for(c=aj(e),l=n?new this(c):U0(c);c>R;R++)m=a?r(e[R],R):e[R],M0(l,R,m);else for(p=(h=oj(e,S)).next,l=n?new this:[];!(d=ej(p,h)).done;R++)m=a?ij(h,r,[d.value,R],!0):d.value,M0(l,R,m);return l.length=R,l},uo=fu,Sj=BE.codeAt,Tj=function(t){var e,n,i=[],r=hj(dj(pj(t),x0,"."),".");for(e=0;e<r.length;e++)n=r[e],_u(i,uj(lj,n)?"xn--"+mj(n):n);return j0(i,".")},il=Tr,Rj=sr,yj=ha,W0=jF,K0=Za,vj=K0.set,qR=K0.getterFor("URL"),Cj=W0.URLSearchParams,bj=W0.getState,XE=cA.URL,dA=cA.TypeError,zR=cA.parseInt,Aj=Math.floor,Y0=Math.pow,Ta=ga("".charAt),ho=ga(/./.exec),JE=ga([].join),Ij=ga(1 .toString),wj=ga([].pop),Tf=ga([].push),hA=ga("".replace),Oj=ga([].shift),Nj=ga("".split),QE=ga("".slice),XR=ga("".toLowerCase),Dj=ga([].unshift),pA="Invalid scheme",Xd="Invalid host",q0="Invalid port",z0=/[a-z]/i,Lj=/[\d+-.a-z]/i,fA=/\d/,Pj=/^0x/i,kj=/^[0-7]+$/,Mj=/^\d+$/,X0=/^[\da-f]+$/i,Uj=/[\0\t\n\r #%/:<>?@[\\\]^|]/,xj=/[\0\t\n\r #/:<>?@[\\\]^|]/,Vj=/^[\u0000-\u0020]+/,Bj=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Fj=/[\t\n\r]/g,ZE=function(t){var e,n,i,r;if(typeof t=="number"){for(e=[],n=0;n<4;n++)Dj(e,t%256),t=Aj(t/256);return JE(e,".")}if(typeof t=="object"){for(e="",i=function(a){for(var c=null,l=1,d=null,h=0,p=0;p<8;p++)a[p]!==0?(h>l&&(c=d,l=h),d=null,h=0):(d===null&&(d=p),++h);return h>l&&(c=d,l=h),c}(t),n=0;n<8;n++)r&&t[n]===0||(r&&(r=!1),i===n?(e+=n?":":"::",r=!0):(e+=Ij(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},JR={},J0=uA({},JR,{" ":1,'"':1,"<":1,">":1,"`":1}),Q0=uA({},J0,{"#":1,"?":1,"{":1,"}":1}),mA=uA({},Q0,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Eu=function(t,e){var n=Sj(t,0);return n>32&&n<127&&!lA(e,t)?t:encodeURIComponent(t)},QR={ftp:21,file:null,http:80,https:443,ws:80,wss:443},$E=function(t,e){var n;return t.length==2&&ho(z0,Ta(t,0))&&((n=Ta(t,1))==":"||!e&&n=="|")},Z0=function(t){var e;return t.length>1&&$E(QE(t,0,2))&&(t.length==2||(e=Ta(t,2))==="/"||e==="\\"||e==="?"||e==="#")},jj=function(t){return t==="."||XR(t)==="%2e"},_A={},$0={},EA={},tN={},eN={},gA={},nN={},iN={},ZR={},$R={},SA={},TA={},RA={},yA={},rN={},vA={},Rf={},$o={},sN={},Jd={},rl={},CA=function(t,e,n){var i,r,a,c=il(t);if(e){if(r=this.parse(c))throw dA(r);this.searchParams=null}else{if(n!==void 0&&(i=new CA(n,!0)),r=this.parse(c,null,i))throw dA(r);(a=bj(new Cj)).bindURL(this),this.searchParams=a}};CA.prototype={type:"URL",parse:function(t,e,n){var i,r,a,c,l,d=this,h=e||_A,p=0,m="",S=!1,R=!1,O=!1;for(t=il(t),e||(d.scheme="",d.username="",d.password="",d.host=null,d.port=null,d.path=[],d.query=null,d.fragment=null,d.cannotBeABaseURL=!1,t=hA(t,Vj,""),t=hA(t,Bj,"$1")),t=hA(t,Fj,""),i=Sf(t);p<=i.length;){switch(r=i[p],h){case _A:if(!r||!ho(z0,r)){if(e)return pA;h=EA;continue}m+=XR(r),h=$0;break;case $0:if(r&&(ho(Lj,r)||r=="+"||r=="-"||r=="."))m+=XR(r);else{if(r!=":"){if(e)return pA;m="",h=EA,p=0;continue}if(e&&(d.isSpecial()!=lA(QR,m)||m=="file"&&(d.includesCredentials()||d.port!==null)||d.scheme=="file"&&!d.host))return;if(d.scheme=m,e)return void(d.isSpecial()&&QR[d.scheme]==d.port&&(d.port=null));m="",d.scheme=="file"?h=yA:d.isSpecial()&&n&&n.scheme==d.scheme?h=tN:d.isSpecial()?h=iN:i[p+1]=="/"?(h=eN,p++):(d.cannotBeABaseURL=!0,Tf(d.path,""),h=sN)}break;case EA:if(!n||n.cannotBeABaseURL&&r!="#")return pA;if(n.cannotBeABaseURL&&r=="#"){d.scheme=n.scheme,d.path=uo(n.path),d.query=n.query,d.fragment="",d.cannotBeABaseURL=!0,h=rl;break}h=n.scheme=="file"?yA:gA;continue;case tN:if(r!="/"||i[p+1]!="/"){h=gA;continue}h=ZR,p++;break;case eN:if(r=="/"){h=$R;break}h=$o;continue;case gA:if(d.scheme=n.scheme,r==Ea)d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=uo(n.path),d.query=n.query;else if(r=="/"||r=="\\"&&d.isSpecial())h=nN;else if(r=="?")d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=uo(n.path),d.query="",h=Jd;else{if(r!="#"){d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=uo(n.path),d.path.length--,h=$o;continue}d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=uo(n.path),d.query=n.query,d.fragment="",h=rl}break;case nN:if(!d.isSpecial()||r!="/"&&r!="\\"){if(r!="/"){d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,h=$o;continue}h=$R}else h=ZR;break;case iN:if(h=ZR,r!="/"||Ta(m,p+1)!="/")continue;p++;break;case ZR:if(r!="/"&&r!="\\"){h=$R;continue}break;case $R:if(r=="@"){S&&(m="%40"+m),S=!0,a=Sf(m);for(var A=0;A<a.length;A++){var I=a[A];if(I!=":"||O){var D=Eu(I,mA);O?d.password+=D:d.username+=D}else O=!0}m=""}else if(r==Ea||r=="/"||r=="?"||r=="#"||r=="\\"&&d.isSpecial()){if(S&&m=="")return"Invalid authority";p-=Sf(m).length+1,m="",h=SA}else m+=r;break;case SA:case TA:if(e&&d.scheme=="file"){h=vA;continue}if(r!=":"||R){if(r==Ea||r=="/"||r=="?"||r=="#"||r=="\\"&&d.isSpecial()){if(d.isSpecial()&&m=="")return Xd;if(e&&m==""&&(d.includesCredentials()||d.port!==null))return;if(c=d.parseHost(m))return c;if(m="",h=Rf,e)return;continue}r=="["?R=!0:r=="]"&&(R=!1),m+=r}else{if(m=="")return Xd;if(c=d.parseHost(m))return c;if(m="",h=RA,e==TA)return}break;case RA:if(!ho(fA,r)){if(r==Ea||r=="/"||r=="?"||r=="#"||r=="\\"&&d.isSpecial()||e){if(m!=""){var L=zR(m,10);if(L>65535)return q0;d.port=d.isSpecial()&&L===QR[d.scheme]?null:L,m=""}if(e)return;h=Rf;continue}return q0}m+=r;break;case yA:if(d.scheme="file",r=="/"||r=="\\")h=rN;else{if(!n||n.scheme!="file"){h=$o;continue}if(r==Ea)d.host=n.host,d.path=uo(n.path),d.query=n.query;else if(r=="?")d.host=n.host,d.path=uo(n.path),d.query="",h=Jd;else{if(r!="#"){Z0(JE(uo(i,p),""))||(d.host=n.host,d.path=uo(n.path),d.shortenPath()),h=$o;continue}d.host=n.host,d.path=uo(n.path),d.query=n.query,d.fragment="",h=rl}}break;case rN:if(r=="/"||r=="\\"){h=vA;break}n&&n.scheme=="file"&&!Z0(JE(uo(i,p),""))&&($E(n.path[0],!0)?Tf(d.path,n.path[0]):d.host=n.host),h=$o;continue;case vA:if(r==Ea||r=="/"||r=="\\"||r=="?"||r=="#"){if(!e&&$E(m))h=$o;else if(m==""){if(d.host="",e)return;h=Rf}else{if(c=d.parseHost(m))return c;if(d.host=="localhost"&&(d.host=""),e)return;m="",h=Rf}continue}m+=r;break;case Rf:if(d.isSpecial()){if(h=$o,r!="/"&&r!="\\")continue}else if(e||r!="?")if(e||r!="#"){if(r!=Ea&&(h=$o,r!="/"))continue}else d.fragment="",h=rl;else d.query="",h=Jd;break;case $o:if(r==Ea||r=="/"||r=="\\"&&d.isSpecial()||!e&&(r=="?"||r=="#")){if((l=XR(l=m))===".."||l==="%2e."||l===".%2e"||l==="%2e%2e"?(d.shortenPath(),r=="/"||r=="\\"&&d.isSpecial()||Tf(d.path,"")):jj(m)?r=="/"||r=="\\"&&d.isSpecial()||Tf(d.path,""):(d.scheme=="file"&&!d.path.length&&$E(m)&&(d.host&&(d.host=""),m=Ta(m,0)+":"),Tf(d.path,m)),m="",d.scheme=="file"&&(r==Ea||r=="?"||r=="#"))for(;d.path.length>1&&d.path[0]==="";)Oj(d.path);r=="?"?(d.query="",h=Jd):r=="#"&&(d.fragment="",h=rl)}else m+=Eu(r,Q0);break;case sN:r=="?"?(d.query="",h=Jd):r=="#"?(d.fragment="",h=rl):r!=Ea&&(d.path[0]+=Eu(r,JR));break;case Jd:e||r!="#"?r!=Ea&&(r=="'"&&d.isSpecial()?d.query+="%27":d.query+=r=="#"?"%23":Eu(r,JR)):(d.fragment="",h=rl);break;case rl:r!=Ea&&(d.fragment+=Eu(r,J0))}p++}},parseHost:function(t){var e,n,i;if(Ta(t,0)=="["){if(Ta(t,t.length-1)!="]"||(e=function(r){var a,c,l,d,h,p,m,S=[0,0,0,0,0,0,0,0],R=0,O=null,A=0,I=function(){return Ta(r,A)};if(I()==":"){if(Ta(r,1)!=":")return;A+=2,O=++R}for(;I();){if(R==8)return;if(I()!=":"){for(a=c=0;c<4&&ho(X0,I());)a=16*a+zR(I(),16),A++,c++;if(I()=="."){if(c==0||(A-=c,R>6))return;for(l=0;I();){if(d=null,l>0){if(!(I()=="."&&l<4))return;A++}if(!ho(fA,I()))return;for(;ho(fA,I());){if(h=zR(I(),10),d===null)d=h;else{if(d==0)return;d=10*d+h}if(d>255)return;A++}S[R]=256*S[R]+d,++l!=2&&l!=4||R++}if(l!=4)return;break}if(I()==":"){if(A++,!I())return}else if(I())return;S[R++]=a}else{if(O!==null)return;A++,O=++R}}if(O!==null)for(p=R-O,R=7;R!=0&&p>0;)m=S[R],S[R--]=S[O+p-1],S[O+--p]=m;else if(R!=8)return;return S}(QE(t,1,-1)),!e))return Xd;this.host=e}else if(this.isSpecial()){if(t=Tj(t),ho(Uj,t)||(e=function(r){var a,c,l,d,h,p,m,S=Nj(r,".");if(S.length&&S[S.length-1]==""&&S.length--,(a=S.length)>4)return r;for(c=[],l=0;l<a;l++){if((d=S[l])=="")return r;if(h=10,d.length>1&&Ta(d,0)=="0"&&(h=ho(Pj,d)?16:8,d=QE(d,h==8?1:2)),d==="")p=0;else{if(!ho(h==10?Mj:h==8?kj:X0,d))return r;p=zR(d,h)}Tf(c,p)}for(l=0;l<a;l++)if(p=c[l],l==a-1){if(p>=Y0(256,5-a))return null}else if(p>255)return null;for(m=wj(c),l=0;l<c.length;l++)m+=c[l]*Y0(256,3-l);return m}(t),e===null))return Xd;this.host=e}else{if(ho(xj,t))return Xd;for(e="",n=Sf(t),i=0;i<n.length;i++)e+=Eu(n[i],JR);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return lA(QR,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme=="file"&&e==1&&$E(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,i=t.password,r=t.host,a=t.port,c=t.path,l=t.query,d=t.fragment,h=e+":";return r!==null?(h+="//",t.includesCredentials()&&(h+=n+(i?":"+i:"")+"@"),h+=ZE(r),a!==null&&(h+=":"+a)):e=="file"&&(h+="//"),h+=t.cannotBeABaseURL?c[0]:c.length?"/"+JE(c,"/"):"",l!==null&&(h+="?"+l),d!==null&&(h+="#"+d),h},setHref:function(t){var e=this.parse(t);if(e)throw dA(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t=="blob")try{return new yf(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+ZE(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(il(t)+":",_A)},getUsername:function(){return this.username},setUsername:function(t){var e=Sf(il(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=Eu(e[n],mA)}},getPassword:function(){return this.password},setPassword:function(t){var e=Sf(il(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=Eu(e[n],mA)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?ZE(t):ZE(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,SA)},getHostname:function(){var t=this.host;return t===null?"":ZE(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,TA)},getPort:function(){var t=this.port;return t===null?"":il(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=il(t))==""?this.port=null:this.parse(t,RA))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+JE(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Rf))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=il(t))==""?this.query=null:(Ta(t,0)=="?"&&(t=QE(t,1)),this.query="",this.parse(t,Jd)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=il(t))!=""?(Ta(t,0)=="#"&&(t=QE(t,1)),this.fragment="",this.parse(t,rl)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var yf=function(t){var e=gj(this,rs),n=yj(arguments.length,1)>1?arguments[1]:void 0,i=vj(e,new CA(t,!1,n));oA||(e.href=i.serialize(),e.origin=i.getOrigin(),e.protocol=i.getProtocol(),e.username=i.getUsername(),e.password=i.getPassword(),e.host=i.getHost(),e.hostname=i.getHostname(),e.port=i.getPort(),e.pathname=i.getPathname(),e.search=i.getSearch(),e.searchParams=i.getSearchParams(),e.hash=i.getHash())},rs=yf.prototype,Ra=function(t,e){return{get:function(){return qR(this)[t]()},set:e&&function(n){return qR(this)[e](n)},configurable:!0,enumerable:!0}};if(oA&&(Sa(rs,"href",Ra("serialize","setHref")),Sa(rs,"origin",Ra("getOrigin")),Sa(rs,"protocol",Ra("getProtocol","setProtocol")),Sa(rs,"username",Ra("getUsername","setUsername")),Sa(rs,"password",Ra("getPassword","setPassword")),Sa(rs,"host",Ra("getHost","setHost")),Sa(rs,"hostname",Ra("getHostname","setHostname")),Sa(rs,"port",Ra("getPort","setPort")),Sa(rs,"pathname",Ra("getPathname","setPathname")),Sa(rs,"search",Ra("getSearch","setSearch")),Sa(rs,"searchParams",Ra("getSearchParams")),Sa(rs,"hash",Ra("getHash","setHash"))),YR(rs,"toJSON",function(){return qR(this).serialize()},{enumerable:!0}),YR(rs,"toString",function(){return qR(this).serialize()},{enumerable:!0}),XE){var aN=XE.createObjectURL,oN=XE.revokeObjectURL;aN&&YR(yf,"createObjectURL",H0(aN,XE)),oN&&YR(yf,"revokeObjectURL",H0(oN,XE))}Rj(yf,"URL"),_j({global:!0,forced:!Ej,sham:!oA},{URL:yf});var Gj=Ue,Hj=M,Wj=ha,cN=Tr,Kj=nl,lN=nr("URL");Gj({target:"URL",stat:!0,forced:!(Kj&&Hj(function(){lN.canParse()}))},{canParse:function(t){var e=Wj(arguments.length,1),n=cN(t),i=e<2||arguments[1]===void 0?void 0:cN(arguments[1]);try{return!!new lN(n,i)}catch{return!1}}});var ty=w(zr.URL);let uN=!0,dN=!0;function ey(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseInt(i[n],10)}function Qd(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(c,l){if(c!==e)return r.apply(this,arguments);const d=h=>{const p=n(h);p&&(l.handleEvent?l.handleEvent(p):l(p))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,d),r.apply(this,[c,d])};const a=i.removeEventListener;i.removeEventListener=function(c,l){if(c!==e||!this._eventMap||!this._eventMap[e])return a.apply(this,arguments);if(!this._eventMap[e].has(l))return a.apply(this,arguments);const d=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[c,d])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(c){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),c&&this.addEventListener(e,this["_on"+e]=c)},enumerable:!0,configurable:!0})}function Yj(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(uN=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function qj(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(dN=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function hN(){if(typeof window=="object"){if(uN)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function bA(t,e){dN&&console.warn(t+" is deprecated, please use "+e+" instead.")}function pN(t){return Object.prototype.toString.call(t)==="[object Object]"}function fN(t){var e;return pN(t)?ds(e=Object.keys(t)).call(e,function(n,i){const r=pN(t[i]),a=r?fN(t[i]):t[i],c=r&&!Object.keys(a).length;return a===void 0||c?n:Object.assign(n,{[i]:a})},{}):t}function AA(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?AA(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{AA(t,t.get(r),n)})}))}function mN(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const a=[];return t.forEach(c=>{c.type==="track"&&c.trackIdentifier===e.id&&a.push(c)}),a.forEach(c=>{t.forEach(l=>{l.type===i&&l.trackId===c.id&&AA(t,l,r)})}),r}const _N=hN;function EN(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const l={};return Object.keys(c).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const h=typeof c[d]=="object"?c[d]:{ideal:c[d]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const p=function(m,S){return m?m+S.charAt(0).toUpperCase()+S.slice(1):S==="deviceId"?"sourceId":S};if(h.ideal!==void 0){l.optional=l.optional||[];let m={};typeof h.ideal=="number"?(m[p("min",d)]=h.ideal,l.optional.push(m),m={},m[p("max",d)]=h.ideal,l.optional.push(m)):(m[p("",d)]=h.ideal,l.optional.push(m))}h.exact!==void 0&&typeof h.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[p("",d)]=h.exact):["min","max"].forEach(m=>{h[m]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[p(m,d)]=h[m])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},r=function(c,l){if(e.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const d=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])};d((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),d(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=i(c.audio)}if(c&&typeof c.video=="object"){let d=c.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const h=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||h)){let p;if(delete c.video.facingMode,d.exact==="environment"||d.ideal==="environment"?p=["back","rear"]:d.exact!=="user"&&d.ideal!=="user"||(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(m=>{let S=(m=m.filter(R=>R.kind==="videoinput")).find(R=>p.some(O=>{var A;return _t(A=R.label.toLowerCase()).call(A,O)}));return!S&&m.length&&_t(p).call(p,"back")&&(S=m[m.length-1]),S&&(c.video.deviceId=d.exact?{exact:S.deviceId}:{ideal:S.deviceId}),c.video=i(c.video),_N("chrome: "+JSON.stringify(c)),l(c)})}c.video=i(c.video)}return _N("chrome: "+JSON.stringify(c)),l(c)},a=function(c){return e.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(c,l,d){r(c,h=>{n.webkitGetUserMedia(h,l,p=>{d&&d(a(p))})})}).bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return r(l,d=>c(d).then(h=>{if(d.audio&&!h.getAudioTracks().length||d.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return h},h=>Et.reject(a(h))))}}}function gN(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function SN(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.track.id):{track:i.track};const a=new Event("track");a.track=i.track,a.receiver=r,a.transceiver={receiver:r},a.streams=[n.stream],this.dispatchEvent(a)}),n.stream.getTracks().forEach(i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.id):{track:i};const a=new Event("track");a.track=i,a.receiver=r,a.transceiver={receiver:r},a.streams=[n.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Qd(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function TN(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=r.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,l){let d=r.apply(this,arguments);return d||(d=e(this,c),this._senders.push(d)),d};const a=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){a.apply(this,arguments);const l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(a=>{const c=this._senders.find(l=>l.track===a);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function RN(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,i,r]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const a=function(l){const d={};return l.result().forEach(h=>{const p={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(m=>{p[m]=h.stat(m)}),d[p.id]=p}),d},c=function(l){return new Map(Object.keys(l).map(d=>[d,l[d]]))};if(arguments.length>=2){const l=function(d){i(c(a(d)))};return e.apply(this,[l,n])}return new Et((l,d)=>{e.apply(this,[function(h){l(c(a(h)))},d])}).then(i,r)}}function yN(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(a=>a._pc=this),r});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(a=>mN(a,r.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Qd(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(r=>mN(r,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let i,r,a;return this.getSenders().forEach(c=>{c.track===n&&(i?a=!0:i=c)}),this.getReceivers().forEach(c=>(c.track===n&&(r?a=!0:r=c),c.track===n)),a||i&&r?Et.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():r?r.getStats():Et.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function vN(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(d=>c.indexOf(d)===-1);this._shimmedLocalStreams[a.id]=[a].concat(l)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const l=this._shimmedLocalStreams[c].indexOf(a);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),r.apply(this,arguments)}}function CN(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return vN(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(h=>this._reverseStreams[h.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const h=new t.MediaStream(d.getTracks());this._streams[d.id]=h,this._reverseStreams[h.id]=d,d=h}i.apply(this,[d])};const r=t.RTCPeerConnection.prototype.removeStream;function a(d,h){let p=h.sdp;return Object.keys(d._reverseStreams||[]).forEach(m=>{const S=d._reverseStreams[m],R=d._streams[S.id];p=p.replace(new RegExp(R.id,"g"),S.id)}),new RTCSessionDescription({type:h.type,sdp:p})}t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(R=>R===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(R=>R.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const S=this._streams[h.id];if(S)S.addTrack(d),Et.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const R=new t.MediaStream([d]);this._streams[h.id]=R,this._reverseStreams[R.id]=h,this.addStream(R)}return this.getSenders().find(R=>R.track===d)},["createOffer","createAnswer"].forEach(function(d){const h=t.RTCPeerConnection.prototype[d],p={[d](){const m=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[S=>{const R=a(this,S);m[0].apply(null,[R])},S=>{m[1]&&m[1].apply(null,S)},arguments[2]]):h.apply(this,arguments).then(S=>a(this,S))}};t.RTCPeerConnection.prototype[d]=p[d]});const c=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(d,h){let p=h.sdp;return Object.keys(d._reverseStreams||[]).forEach(m=>{const S=d._reverseStreams[m],R=d._streams[S.id];p=p.replace(new RegExp(S.id,"g"),R.id)}),new RTCSessionDescription({type:h.type,sdp:p})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=l.get.apply(this);return d.type===""?d:a(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(d._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let h;this._streams=this._streams||{},Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(m=>d.track===m)&&(h=this._streams[p])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function IA(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function bN(t,e){Qd(t,"negotiationneeded",n=>{const i=n.target;if(!(e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var AN=Object.freeze({__proto__:null,fixNegotiationNeeded:bN,shimAddTrackRemoveTrack:CN,shimAddTrackRemoveTrackWithNative:vN,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(i=>{const r=n.video&&n.video.width,a=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:c||3}},r&&(n.video.mandatory.maxWidth=r),a&&(n.video.mandatory.maxHeight=a),t.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:TN,shimGetStats:RN,shimGetUserMedia:EN,shimMediaStream:gN,shimOnTrack:SN,shimPeerConnection:IA,shimSenderReceiverGetStats:yN});function IN(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,a,c){bA("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(a,c)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(c,l,d){l in c&&!(d in c)&&(c[d]=c[l],delete c[l])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),r(c.audio,"autoGainControl","mozAutoGainControl"),r(c.audio,"noiseSuppression","mozNoiseSuppression")),a(c)},i&&i.prototype.getSettings){const c=i.prototype.getSettings;i.prototype.getSettings=function(){const l=c.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(i&&i.prototype.applyConstraints){const c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function wN(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function wA(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const a=t.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=c[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[r,a,c]=arguments;return i.apply(this,[r||null]).then(l=>{if(e.version<53&&!a)try{l.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;l.forEach((h,p)=>{l.set(p,Object.assign({},h,{type:n[h.type]||h.type}))})}return l}).then(a,c)}}function ON(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Et.resolve(new Map)}}function NN(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n}),Qd(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function DN(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){bA("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&_t(i=e.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function LN(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function PN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(i){const{sender:a}=r,c=a.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,a.sendEncodings=n,this.setParametersPromises.push(a.setParameters(c).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return r})}function kN(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function MN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Et.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function UN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Et.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var xN=Object.freeze({__proto__:null,shimAddTransceiver:PN,shimCreateAnswer:UN,shimCreateOffer:MN,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Et.reject(i)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:kN,shimGetUserMedia:IN,shimOnTrack:wN,shimPeerConnection:wA,shimRTCDataChannel:LN,shimReceiverGetStats:NN,shimRemoveStream:DN,shimSenderGetStats:ON});function VN(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),_t(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>e.call(this,r,n)),n.getVideoTracks().forEach(r=>e.call(this,r,n))},t.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return r&&r.forEach(c=>{var l;this._localStreams?_t(l=this._localStreams).call(l,c)||this._localStreams.push(c):this._localStreams=[c]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const i=e.getTracks();this.getSenders().forEach(r=>{_t(i).call(i,r.track)&&this.removeTrack(r)})})}}function BN(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{var a;if(this._remoteStreams||(this._remoteStreams=[]),_t(a=this._remoteStreams).call(a,r))return;this._remoteStreams.push(r);const c=new Event("addstream");c.stream=r,this.dispatchEvent(c)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(r=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(r)>=0)return;n._remoteStreams.push(r);const a=new Event("addstream");a.stream=r,n.dispatchEvent(a)})}),e.apply(n,arguments)}}}function FN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,a=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(d,h){const p=arguments.length>=2?arguments[2]:arguments[0],m=n.apply(this,[p]);return h?(m.then(d,h),Et.resolve()):m},e.createAnswer=function(d,h){const p=arguments.length>=2?arguments[2]:arguments[0],m=i.apply(this,[p]);return h?(m.then(d,h),Et.resolve()):m};let l=function(d,h,p){const m=r.apply(this,[d]);return p?(m.then(h,p),Et.resolve()):m};e.setLocalDescription=l,l=function(d,h,p){const m=a.apply(this,[d]);return p?(m.then(h,p),Et.resolve()):m},e.setRemoteDescription=l,l=function(d,h,p){const m=c.apply(this,[d]);return p?(m.then(h,p),Et.resolve()):m},e.addIceCandidate=l}function jN(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(GN(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,i,r){e.mediaDevices.getUserMedia(n).then(i,r)}).bind(e))}function GN(t){return t&&t.video!==void 0?Object.assign({},t,{video:fN(t.video)}):t}function HN(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const r=[];for(let a=0;a<n.iceServers.length;a++){let c=n.iceServers[a];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(bA("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,r.push(c)):r.push(n.iceServers[a])}n.iceServers=r}return new e(n,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function WN(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function KN(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveVideo!==!0||r||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function YN(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var qN=Object.freeze({__proto__:null,shimAudioContext:YN,shimCallbacksAPI:FN,shimConstraints:GN,shimCreateOfferLegacy:KN,shimGetUserMedia:jN,shimLocalStreamsAPI:VN,shimRTCIceServerUrls:HN,shimRemoteStreamsAPI:BN,shimTrackEventTransceiver:WN}),zN=`	
\v\f\r \u2028\u2029\uFEFF`,zj=Ma,Xj=Tr,OA=zN,XN=rt("".replace),Jj=RegExp("^["+OA+"]+"),Qj=RegExp("(^|[^"+OA+"])["+OA+"]+$"),Zj=function(t){return function(e){var n=Xj(zj(e));return 1&t&&(n=XN(n,Jj,"")),2&t&&(n=XN(n,Qj,"$1")),n}},$j={trim:Zj(3)},t3=Gi.PROPER,e3=M,JN=zN,n3=$j.trim;Ue({target:"String",proto:!0,forced:function(t){return e3(function(){return!!JN[t]()||""[t]()!==""||t3&&JN[t].name!==t})}("trim")},{trim:function(){return n3(this)}});var i3=Sr("String").trim,r3=ht,s3=i3,NA=String.prototype,a3=function(t){var e=t.trim;return typeof t=="string"||t===NA||r3(NA,t)&&e===NA.trim?s3:e},Ji=w(a3),QN={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,r)=>(r>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let a=8;a<i.length;a+=2)switch(i[a]){case"raddr":r.relatedAddress=i[a+1];break;case"rport":r.relatedPort=parseInt(i[a+1],10);break;case"tcptype":r.tcpType=i[a+1];break;case"ufrag":r.ufrag=i[a+1],r.usernameFragment=i[a+1];break;default:r[i[a]]===void 0&&(r[i[a]]=i[a+1])}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const a=n.type;return i.push("typ"),i.push(a),a!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const a=n.substring(n.indexOf(" ")+1).split(";");for(let c=0;c<a.length;c++)r=a[c].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const a=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?a.push(c+"="+n.parameters[c]):a.push(c)}),i+="a=fmtp:"+r+" "+a.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(a=>{i+="a=rtcp-fb:"+r+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},a=n.indexOf(":",i);return a>-1?(r.attribute=n.substring(i+1,a),r.value=n.substring(a+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(a=>{r+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],a=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&a?{usernameFragment:r.substring(12),password:a.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(n)[0].split(" ");i.profile=r[2];for(let c=3;c<r.length;c++){const l=r[c],d=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(d){const h=e.parseRtpMap(d),p=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(h.parameters=p.length?e.parseFmtp(p[0]):{},h.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(h.name.toUpperCase())}}}e.matchPrefix(n,"a=extmap:").forEach(c=>{i.headerExtensions.push(e.parseExtmap(c))});const a=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(c=>{a.forEach(l=>{c.rtcpFeedback.find(d=>d.type===l.type&&d.parameter===l.parameter)||c.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(c=>{r+=e.writeRtpMap(c),r+=e.writeFmtp(c),r+=e.writeRtcpFb(c)});let a=0;return i.codecs.forEach(c=>{c.maxptime>a&&(a=c.maxptime)}),a>0&&(r+="a=maxptime:"+a+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(c=>{r+=e.writeExtmap(c)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),a=r.fecMechanisms.indexOf("RED")!==-1,c=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(S=>e.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),d=l.length>0&&l[0].ssrc;let h;const p=e.matchPrefix(n,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(R=>parseInt(R,10)));p.length>0&&p[0].length>1&&p[0][0]===d&&(h=p[0][1]),r.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let R={ssrc:d,codecPayloadType:parseInt(S.parameters.apt,10)};d&&h&&(R.rtx={ssrc:h}),i.push(R),a&&(R=JSON.parse(JSON.stringify(R)),R.fec={ssrc:d,mechanism:c?"red+ulpfec":"red"},i.push(R))}}),i.length===0&&d&&i.push({ssrc:d});let m=e.matchPrefix(n,"b=");return m.length&&(m=m[0].indexOf("b=TIAS:")===0?parseInt(m[0].substring(7),10):m[0].indexOf("b=AS:")===0?1e3*parseInt(m[0].substring(5),10)*.95-16e3:void 0,i.forEach(S=>{S.maxBitrate=m})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const a=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=a.length>0,i.compound=a.length===0;const c=e.matchPrefix(n,"a=rtcp-mux");return i.mux=c.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const a=e.matchPrefix(n,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return a.length>0?(i=a[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let a;r.length>0&&(a=parseInt(r[0].substring(19),10)),isNaN(a)&&(a=65536);const c=e.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:i.fmt,maxMessageSize:a};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const d=l[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:a}}},e.writeSctpDescription=function(n,i){let r=[];return r=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let a;const c=i!==void 0?i:2;return a=n||e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+a+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let a=0;a<r.length;a++)switch(r[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[a].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(QN);var ZN=QN.exports,vf=w(ZN),o3=T({__proto__:null,default:vf},[ZN]);function ny(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new e(n),r=vf.parseCandidate(n.candidate),a=Object.assign(i,r);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,Qd(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function DA(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Qd(t,"icecandidate",e=>{if(e.candidate){const n=vf.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function iy(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const d=vf.splitSections(l.sdp);return d.shift(),d.some(h=>{const p=vf.parseMLine(h);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},i=function(l){const d=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;const h=parseInt(d[1],10);return h!=h?-1:h},r=function(l){let d=65536;return e.browser==="firefox"&&(d=e.version<57?l===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),d},a=function(l,d){let h=65536;e.browser==="firefox"&&e.version===57&&(h=65535);const p=vf.matchPrefix(l.sdp,"a=max-message-size:");return p.length>0?h=parseInt(p[0].substr(19),10):e.browser==="firefox"&&d!==-1&&(h=2147483637),h},c=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=i(arguments[0]),d=r(l),h=a(arguments[0],l);let p;p=d===0&&h===0?Number.POSITIVE_INFINITY:d===0||h===0?Math.max(d,h):Math.min(d,h);const m={};Object.defineProperty(m,"maxMessageSize",{get:()=>p}),this._sctp=m}return c.apply(this,arguments)}}function ry(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const a=i.send;i.send=function(){const c=arguments[0],l=c.length||c.size||c.byteLength;if(i.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return a.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},Qd(t,"datachannel",i=>(e(i.channel,i.target),i))}function LA(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const a=r.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const c=new Event("connectionstatechange",r);a.dispatchEvent(c)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function PA(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=i.sdp.split(`
`).filter(a=>Ji(a).call(a)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:r}):i.sdp=r}return n.apply(this,arguments)}}function sy(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Et.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Et.resolve())})}function ay(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(r=>n.apply(this,[r]))})}var c3=Object.freeze({__proto__:null,removeExtmapAllowMixed:PA,shimAddIceCandidateNullOrEmpty:sy,shimConnectionState:LA,shimMaxMessageSize:iy,shimParameterlessSetLocalDescription:ay,shimRTCIceCandidate:ny,shimRTCIceCandidateRelayProtocol:DA,shimSendThrowTypeError:ry});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=hN,i=function(a){const c={browser:null,version:null};if(a===void 0||!a.navigator)return c.browser="Not a browser.",c;const{navigator:l}=a;if(l.mozGetUserMedia)c.browser="firefox",c.version=ey(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||a.isSecureContext===!1&&a.webkitRTCPeerConnection)c.browser="chrome",c.version=ey(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!a.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=ey(l.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=a.RTCRtpTransceiver&&"currentDirection"in a.RTCRtpTransceiver.prototype}return c}(t),r={browserDetails:i,commonShim:c3,extractVersion:ey,disableLog:Yj,disableWarnings:qj,sdp:o3};switch(i.browser){case"chrome":if(!AN||!IA||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=AN,sy(t,i),ay(t),EN(t,i),gN(t),IA(t,i),SN(t),CN(t,i),TN(t),RN(t),yN(t),bN(t,i),ny(t),DA(t),LA(t),iy(t,i),ry(t),PA(t,i);break;case"firefox":if(!xN||!wA||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=xN,sy(t,i),ay(t),IN(t,i),wA(t,i),wN(t),DN(t),ON(t),NN(t),LN(t),PN(t),kN(t),MN(t),UN(t),ny(t),LA(t),iy(t,i),ry(t);break;case"safari":if(!qN||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=qN,sy(t,i),ay(t),HN(t),KN(t),FN(t),VN(t),BN(t),WN(t),jN(t),YN(t),ny(t),DA(t),iy(t,i),ry(t),PA(t,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var $N=bc,l3=TypeError,tD=Ps.match(/firefox\/(\d+)/i),u3=!!tD&&+tD[1],d3=/MSIE|Trident/.test(Ps),eD=Ps.match(/AppleWebKit\/(\d+)\./),h3=!!eD&&+eD[1],p3=Ue,nD=rt,f3=Jr,m3=Dr,iD=ja,_3=function(t,e){if(!delete t[e])throw l3("Cannot delete property "+$N(e)+" of "+$N(t))},rD=Tr,kA=M,E3=u,g3=Ha,sD=u3,S3=d3,aD=vc,oD=h3,gu=[],cD=nD(gu.sort),T3=nD(gu.push),R3=kA(function(){gu.sort(void 0)}),y3=kA(function(){gu.sort(null)}),v3=g3("sort"),lD=!kA(function(){if(aD)return aD<70;if(!(sD&&sD>3)){if(S3)return!0;if(oD)return oD<603;var t,e,n,i,r="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)gu.push({k:e+i,v:n})}for(gu.sort(function(a,c){return c.v-a.v}),i=0;i<gu.length;i++)e=gu[i].k.charAt(0),r.charAt(r.length-1)!==e&&(r+=e);return r!=="DGBEFHACIJK"}});p3({target:"Array",proto:!0,forced:R3||!y3||!v3||!lD},{sort:function(t){t!==void 0&&f3(t);var e=m3(this);if(lD)return t===void 0?cD(e):cD(e,t);var n,i,r=[],a=iD(e);for(i=0;i<a;i++)i in e&&T3(r,e[i]);for(E3(r,function(c){return function(l,d){return d===void 0?-1:l===void 0?1:c!==void 0?+c(l,d)||0:rD(l)>rD(d)?1:-1}}(t)),n=iD(r),i=0;i<n;)e[i]=r[i++];for(;i<a;)_3(e,i++);return e}});var C3=Sr("Array").sort,b3=ht,A3=C3,MA=Array.prototype,I3=function(t){var e=t.sort;return t===MA||b3(MA,t)&&e===MA.sort?A3:e},tg=w(I3),UA=st;Ue({global:!0,forced:UA.globalThis!==UA},{globalThis:UA});var uD=w(st),xA={exports:{}};(function(t,e){(function(n,i){var r="function",a="undefined",c="object",l="string",d="major",h="model",p="name",m="type",S="vendor",R="version",O="architecture",A="console",I="mobile",D="tablet",L="smarttv",V="wearable",W="embedded",K="Amazon",G="Apple",Q="ASUS",lt="BlackBerry",Tt="Browser",At="Chrome",de="Firefox",he="Google",Ze="Huawei",Mn="LG",An="Microsoft",Or="Motorola",it="Opera",ft="Samsung",Lt="Sharp",at="Sony",b="Xiaomi",x="Zebra",F="Facebook",dt="Chromium OS",Qt="Mac OS",We=function(qn){for(var ci={},ln=0;ln<qn.length;ln++)ci[qn[ln].toUpperCase()]=qn[ln];return ci},oi=function(qn,ci){return typeof qn===l&&Hr(ci).indexOf(Hr(qn))!==-1},Hr=function(qn){return qn.toLowerCase()},Rl=function(qn,ci){if(typeof qn===l)return qn=qn.replace(/^\s\s*/,""),typeof ci===a?qn:qn.substring(0,350)},wh=function(qn,ci){for(var ln,os,gc,Un,De,Wr,Fu=0;Fu<ci.length&&!De;){var Ao=ci[Fu],xV=ci[Fu+1];for(ln=os=0;ln<Ao.length&&!De&&Ao[ln];)if(De=Ao[ln++].exec(qn))for(gc=0;gc<xV.length;gc++)Wr=De[++os],typeof(Un=xV[gc])===c&&Un.length>0?Un.length===2?typeof Un[1]==r?this[Un[0]]=Un[1].call(this,Wr):this[Un[0]]=Un[1]:Un.length===3?typeof Un[1]!==r||Un[1].exec&&Un[1].test?this[Un[0]]=Wr?Wr.replace(Un[1],Un[2]):i:this[Un[0]]=Wr?Un[1].call(this,Wr,Un[2]):i:Un.length===4&&(this[Un[0]]=Wr?Un[3].call(this,Wr.replace(Un[1],Un[2])):i):this[Un]=Wr||i;Fu+=2}},iS=function(qn,ci){for(var ln in ci)if(typeof ci[ln]===c&&ci[ln].length>0){for(var os=0;os<ci[ln].length;os++)if(oi(ci[ln][os],qn))return ln==="?"?i:ln}else if(oi(ci[ln],qn))return ln==="?"?i:ln;return qn},iC={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},rC={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[R,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[R,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,R],[/opios[\/ ]+([\w\.]+)/i],[R,[p,it+" Mini"]],[/\bopr\/([\w\.]+)/i],[R,[p,it]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[p,R],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[R,[p,"UC"+Tt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[R,[p,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[R,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[R,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[R,[p,"IE"]],[/yabrowser\/([\w\.]+)/i],[R,[p,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+Tt],R],[/\bfocus\/([\w\.]+)/i],[R,[p,de+" Focus"]],[/\bopt\/([\w\.]+)/i],[R,[p,it+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[R,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[R,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[R,[p,it+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[R,[p,"MIUI "+Tt]],[/fxios\/([-\w\.]+)/i],[R,[p,de]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360 "+Tt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 "+Tt],R],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],R],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[p,R],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,F],R],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[p,R],[/\bgsa\/([\w\.]+) .*safari\//i],[R,[p,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[R,[p,At+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,At+" WebView"],R],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[R,[p,"Android "+Tt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,R],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[R,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[R,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[R,iS,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,R],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],R],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[R,[p,de+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[p,R],[/(cobalt)\/([\w\.]+)/i],[p,[R,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[O,"amd64"]],[/(ia32(?=;))/i],[[O,Hr]],[/((?:i[346]|x)86)[;\)]/i],[[O,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[O,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[O,"armhf"]],[/windows (ce|mobile); ppc;/i],[[O,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[O,/ower/,"",Hr]],[/(sun4\w)[;\)]/i],[[O,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[O,Hr]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[S,ft],[m,D]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[h,[S,ft],[m,I]],[/\((ip(?:hone|od)[\w ]*);/i],[h,[S,G],[m,I]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[S,G],[m,D]],[/(macintosh);/i],[h,[S,G]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[S,Lt],[m,I]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[S,Ze],[m,D]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[S,Ze],[m,I]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[h,/_/g," "],[S,b],[m,I]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[S,b],[m,D]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[S,"OPPO"],[m,I]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[S,"Vivo"],[m,I]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[h,[S,"Realme"],[m,I]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[S,Or],[m,I]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[S,Or],[m,D]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[S,Mn],[m,D]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[S,Mn],[m,I]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[S,"Lenovo"],[m,D]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[S,"Nokia"],[m,I]],[/(pixel c)\b/i],[h,[S,he],[m,D]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[S,he],[m,I]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[S,at],[m,I]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[S,at],[m,D]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[S,"OnePlus"],[m,I]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[S,K],[m,D]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[S,K],[m,I]],[/(playbook);[-\w\),; ]+(rim)/i],[h,S,[m,D]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[S,lt],[m,I]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[S,Q],[m,D]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[S,Q],[m,I]],[/(nexus 9)/i],[h,[S,"HTC"],[m,D]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[S,[h,/_/g," "],[m,I]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[S,"Acer"],[m,D]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[S,"Meizu"],[m,I]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[S,h,[m,I]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,h,[m,D]],[/(surface duo)/i],[h,[S,An],[m,D]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[S,"Fairphone"],[m,I]],[/(u304aa)/i],[h,[S,"AT&T"],[m,I]],[/\bsie-(\w*)/i],[h,[S,"Siemens"],[m,I]],[/\b(rct\w+) b/i],[h,[S,"RCA"],[m,D]],[/\b(venue[\d ]{2,7}) b/i],[h,[S,"Dell"],[m,D]],[/\b(q(?:mv|ta)\w+) b/i],[h,[S,"Verizon"],[m,D]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[S,"Barnes & Noble"],[m,D]],[/\b(tm\d{3}\w+) b/i],[h,[S,"NuVision"],[m,D]],[/\b(k88) b/i],[h,[S,"ZTE"],[m,D]],[/\b(nx\d{3}j) b/i],[h,[S,"ZTE"],[m,I]],[/\b(gen\d{3}) b.+49h/i],[h,[S,"Swiss"],[m,I]],[/\b(zur\d{3}) b/i],[h,[S,"Swiss"],[m,D]],[/\b((zeki)?tb.*\b) b/i],[h,[S,"Zeki"],[m,D]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],h,[m,D]],[/\b(ns-?\w{0,9}) b/i],[h,[S,"Insignia"],[m,D]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[S,"NextBook"],[m,D]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],h,[m,I]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],h,[m,I]],[/\b(ph-1) /i],[h,[S,"Essential"],[m,I]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[S,"Envizen"],[m,D]],[/\b(trio[-\w\. ]+) b/i],[h,[S,"MachSpeed"],[m,D]],[/\btu_(1491) b/i],[h,[S,"Rotor"],[m,D]],[/(shield[\w ]+) b/i],[h,[S,"Nvidia"],[m,D]],[/(sprint) (\w+)/i],[S,h,[m,I]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[S,An],[m,I]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[S,x],[m,D]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[S,x],[m,I]],[/smart-tv.+(samsung)/i],[S,[m,L]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[S,ft],[m,L]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,Mn],[m,L]],[/(apple) ?tv/i],[S,[h,G+" TV"],[m,L]],[/crkey/i],[[h,At+"cast"],[S,he],[m,L]],[/droid.+aft(\w)( bui|\))/i],[h,[S,K],[m,L]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[S,Lt],[m,L]],[/(bravia[\w ]+)( bui|\))/i],[h,[S,at],[m,L]],[/(mitv-\w{5}) bui/i],[h,[S,b],[m,L]],[/Hbbtv.*(technisat) (.*);/i],[S,h,[m,L]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[S,Rl],[h,Rl],[m,L]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,L]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,h,[m,A]],[/droid.+; (shield) bui/i],[h,[S,"Nvidia"],[m,A]],[/(playstation [345portablevi]+)/i],[h,[S,at],[m,A]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[S,An],[m,A]],[/((pebble))app/i],[S,h,[m,V]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[S,G],[m,V]],[/droid.+; (glass) \d/i],[h,[S,he],[m,V]],[/droid.+; (wt63?0{2,3})\)/i],[h,[S,x],[m,V]],[/(quest( 2| pro)?)/i],[h,[S,F],[m,V]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[m,W]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[h,[m,I]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[m,D]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,D]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,I]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[R,[p,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[R,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[p,R],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[R,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,R],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[p,[R,iS,iC]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,"Windows"],[R,iS,iC]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[R,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,Qt],[R,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[R,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,R],[/\(bb(10);/i],[R,[p,lt]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[R,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[R,[p,de+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[R,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[R,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[R,[p,At+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,dt],R],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,R],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],R],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[p,R]]},ea=function(qn,ci){if(typeof qn===c&&(ci=qn,qn=i),!(this instanceof ea))return new ea(qn,ci).getResult();var ln=typeof n!==a&&n.navigator?n.navigator:i,os=qn||(ln&&ln.userAgent?ln.userAgent:""),gc=ln&&ln.userAgentData?ln.userAgentData:i,Un=ci?function(De,Wr){var Fu={};for(var Ao in De)Wr[Ao]&&Wr[Ao].length%2==0?Fu[Ao]=Wr[Ao].concat(De[Ao]):Fu[Ao]=De[Ao];return Fu}(rC,ci):rC;return this.getBrowser=function(){var De={};return De[p]=i,De[R]=i,wh.call(De,os,Un.browser),De[d]=function(Wr){return typeof Wr===l?Wr.replace(/[^\d\.]/g,"").split(".")[0]:i}(De[R]),ln&&ln.brave&&typeof ln.brave.isBrave==r&&(De[p]="Brave"),De},this.getCPU=function(){var De={};return De[O]=i,wh.call(De,os,Un.cpu),De},this.getDevice=function(){var De={};return De[S]=i,De[h]=i,De[m]=i,wh.call(De,os,Un.device),!De[m]&&gc&&gc.mobile&&(De[m]=I),De[h]=="Macintosh"&&ln&&typeof ln.standalone!==a&&ln.maxTouchPoints&&ln.maxTouchPoints>2&&(De[h]="iPad",De[m]=D),De},this.getEngine=function(){var De={};return De[p]=i,De[R]=i,wh.call(De,os,Un.engine),De},this.getOS=function(){var De={};return De[p]=i,De[R]=i,wh.call(De,os,Un.os),!De[p]&&gc&&gc.platform!="Unknown"&&(De[p]=gc.platform.replace(/chrome os/i,dt).replace(/macos/i,Qt)),De},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return os},this.setUA=function(De){return os=typeof De===l&&De.length>350?Rl(De,350):De,this},this.setUA(os),this};ea.VERSION="0.7.34",ea.BROWSER=We([p,R,d]),ea.CPU=We([O]),ea.DEVICE=We([h,S,m,A,I,L,D,V,W]),ea.ENGINE=ea.OS=We([p,R]),t.exports&&(e=t.exports=ea),e.UAParser=ea;var Bu=typeof n!==a&&(n.jQuery||n.Zepto);if(Bu&&!Bu.ua){var Oh=new ea;Bu.ua=Oh.getResult(),Bu.ua.get=function(){return Oh.getUA()},Bu.ua.set=function(qn){Oh.setUA(qn);var ci=Oh.getResult();for(var ln in ci)Bu.ua[ln]=ci[ln]}}})(typeof window=="object"?window:y)})(xA,xA.exports);var w3=w(xA.exports),O3=ks,N3=di,D3=ia,L3=Hn,P3=In("iterator"),k3=Object,M3=function(t){if(D3(t))return!1;var e=k3(t);return e[P3]!==void 0||"@@iterator"in e||N3(L3,O3(e))},U3=w(M3),dD=On.clear;Ue({global:!0,bind:!0,forced:st.clearImmediate!==dD},{clearImmediate:dD});var x3=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",hD=st,V3=Vt,B3=tn,F3=x3,j3=Ps,G3=Ad,H3=ha,W3=hD.Function,K3=/MSIE .\./.test(j3)||F3&&function(){var t=hD.Bun.version.split(".");return t.length<3||t[0]==0&&(t[1]<3||t[1]==3&&t[2]==0)}(),Y3=Ue,pD=st,fD=On.set,q3=function(t,e){var n=1;return K3?function(i,r){var a=H3(arguments.length,1)>n,c=B3(i)?i:W3(i),l=a?G3(arguments,n):[],d=a?function(){V3(c,this,l)}:c;return t(d)}:t},mD=pD.setImmediate?q3(fD):fD;Y3({global:!0,bind:!0,forced:pD.setImmediate!==mD},{setImmediate:mD});var _D=w(zr.setImmediate),z3=Ue,X3=fE,J3=Jr,Q3=ha,Z3=ko,$3=st.process;z3({global:!0,dontCallGetSet:!0},{queueMicrotask:function(t){Q3(arguments.length,1),J3(t);var e=Z3&&$3.domain;X3(e?e.bind(t):t)}});var ED=w(zr.queueMicrotask);function gD(t,e){return function(){return t.apply(e,arguments)}}const{toString:tG}=Object.prototype,{getPrototypeOf:VA}=Object,oy=(BA=Object.create(null),t=>{const e=tG.call(t);return BA[e]||(BA[e]=e.slice(8,-1).toLowerCase())});var BA;const po=t=>(t=t.toLowerCase(),e=>oy(e)===t),cy=t=>e=>typeof e===t,{isArray:Cf}=Array,eg=cy("undefined"),SD=po("ArrayBuffer"),eG=cy("string"),Ks=cy("function"),TD=cy("number"),ly=t=>t!==null&&typeof t=="object",uy=t=>{if(oy(t)!=="object")return!1;const e=VA(t);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.toStringTag in t||U3(t))},nG=po("Date"),iG=po("File"),rG=po("Blob"),sG=po("FileList"),aG=po("URLSearchParams"),[oG,cG,lG,uG]=["ReadableStream","Request","Response","Headers"].map(po);function ng(t,e){let n,i,{allOwnKeys:r=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Cf(t))for(n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else{const a=r?Object.getOwnPropertyNames(t):Object.keys(t),c=a.length;let l;for(n=0;n<c;n++)l=a[n],e.call(null,t[l],l,t)}}function RD(t,e){e=e.toLowerCase();const n=Object.keys(t);let i,r=n.length;for(;r-- >0;)if(i=n[r],e===i.toLowerCase())return i;return null}const Zd=uD!==void 0?uD:typeof self<"u"?self:typeof window<"u"?window:wO,yD=t=>!eg(t)&&t!==Zd,dG=(FA=typeof Uint8Array<"u"&&VA(Uint8Array),t=>FA&&t instanceof FA);var FA;const hG=po("HTMLFormElement"),vD=(t=>{let{hasOwnProperty:e}=t;return(n,i)=>e.call(n,i)})(Object.prototype),pG=po("RegExp"),CD=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),i={};ng(n,(r,a)=>{let c;(c=e(r,a,t))!==!1&&(i[a]=c||r)}),Object.defineProperties(t,i)},jA="abcdefghijklmnopqrstuvwxyz",bD="0123456789",AD={DIGIT:bD,ALPHA:jA,ALPHA_DIGIT:jA+jA.toUpperCase()+bD},fG=po("AsyncFunction"),ID=(wD=typeof _D=="function",OD=Ks(Zd.postMessage),wD?_D:OD?(GA="axios@".concat(Math.random()),dy=[],Zd.addEventListener("message",t=>{let{source:e,data:n}=t;e===Zd&&n===GA&&dy.length&&dy.shift()()},!1),t=>{dy.push(t),Zd.postMessage(GA,"*")}):t=>setTimeout(t));var wD,OD,GA,dy;const mG=ED!==void 0?ED.bind(Zd):typeof process<"u"&&process.nextTick||ID;var St={isArray:Cf,isArrayBuffer:SD,isBuffer:function(t){return t!==null&&!eg(t)&&t.constructor!==null&&!eg(t.constructor)&&Ks(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Ks(t.append)&&((e=oy(t))==="formdata"||e==="object"&&Ks(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&SD(t.buffer),e},isString:eG,isNumber:TD,isBoolean:t=>t===!0||t===!1,isObject:ly,isPlainObject:uy,isReadableStream:oG,isRequest:cG,isResponse:lG,isHeaders:uG,isUndefined:eg,isDate:nG,isFile:iG,isBlob:rG,isRegExp:pG,isFunction:Ks,isStream:t=>ly(t)&&Ks(t.pipe),isURLSearchParams:aG,isTypedArray:dG,isFileList:sG,forEach:ng,merge:function t(){const{caseless:e}=yD(this)&&this||{},n={},i=(r,a)=>{const c=e&&RD(n,a)||a;uy(n[c])&&uy(r)?n[c]=t(n[c],r):uy(r)?n[c]=t({},r):Cf(r)?n[c]=r.slice():n[c]=r};for(let r=0,a=arguments.length;r<a;r++)arguments[r]&&ng(arguments[r],i);return n},extend:function(t,e,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return ng(e,(r,a)=>{n&&Ks(r)?t[a]=gD(r,n):t[a]=r},{allOwnKeys:i}),t},trim:t=>Ji(t)?Ji(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,e,n,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,i)=>{let r,a,c;const l={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),a=r.length;a-- >0;)c=r[a],i&&!i(c,t,e)||l[c]||(e[c]=t[c],l[c]=!0);t=n!==!1&&VA(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:oy,kindOfTest:po,endsWith:(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const i=t.indexOf(e,n);return i!==-1&&i===n},toArray:t=>{if(!t)return null;if(Cf(t))return t;let e=t.length;if(!TD(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let i;for(;(i=n.next())&&!i.done;){const r=i.value;e.call(t,r[0],r[1])}},matchAll:(t,e)=>{let n;const i=[];for(;(n=t.exec(e))!==null;)i.push(n);return i},isHTMLForm:hG,hasOwnProperty:vD,hasOwnProp:vD,reduceDescriptors:CD,freezeMethods:t=>{CD(t,(e,n)=>{if(Ks(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];Ks(i)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(t,e)=>{const n={},i=r=>{r.forEach(a=>{n[a]=!0})};return Cf(t)?i(t):i(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,findKey:RD,global:Zd,isContextDefined:yD,ALPHABET:AD,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:AD.ALPHA_DIGIT,n="";const{length:i}=e;for(;t--;)n+=e[Math.random()*i|0];return n},isSpecCompliantForm:function(t){return!!(t&&Ks(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),n=(i,r)=>{if(ly(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[r]=i;const a=Cf(i)?[]:{};return ng(i,(c,l)=>{const d=n(c,r+1);!eg(d)&&(a[l]=d)}),e[r]=void 0,a}}return i};return n(t,0)},isAsyncFn:fG,isThenable:t=>t&&(ly(t)||Ks(t))&&Ks(t.then)&&Ks(t.catch),setImmediate:ID,asap:mG};function Ge(t,e,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}St.inherits(Ge,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:St.toJSONObject(this.config),code:this.code,status:this.status}}});const ND=Ge.prototype,DD={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{DD[t]={value:t}}),Object.defineProperties(Ge,DD),Object.defineProperty(ND,"isAxiosError",{value:!0}),Ge.from=(t,e,n,i,r,a)=>{const c=Object.create(ND);return St.toFlatObject(t,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),Ge.call(c,t.message,e,n,i,r),c.cause=t,c.name=t.name,a&&Object.assign(c,a),c};function HA(t){return St.isPlainObject(t)||St.isArray(t)}function LD(t){return St.endsWith(t,"[]")?t.slice(0,-2):t}function PD(t,e,n){return t?t.concat(e).map(function(i,r){return i=LD(i),!n&&r?"["+i+"]":i}).join(n?".":""):e}const _G=St.toFlatObject(St,{},null,function(t){return/^is[A-Z]/.test(t)});function hy(t,e,n){if(!St.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const i=(n=St.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,R){return!St.isUndefined(R[S])})).metaTokens,r=n.visitor||h,a=n.dots,c=n.indexes,l=(n.Blob||typeof Blob<"u"&&Blob)&&St.isSpecCompliantForm(e);if(!St.isFunction(r))throw new TypeError("visitor must be a function");function d(S){if(S===null)return"";if(St.isDate(S))return S.toISOString();if(!l&&St.isBlob(S))throw new Ge("Blob is not supported. Use a Buffer instead.");return St.isArrayBuffer(S)||St.isTypedArray(S)?l&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function h(S,R,O){let A=S;if(S&&!O&&typeof S=="object"){if(St.endsWith(R,"{}"))R=i?R:R.slice(0,-2),S=JSON.stringify(S);else if(St.isArray(S)&&function(I){return St.isArray(I)&&!I.some(HA)}(S)||(St.isFileList(S)||St.endsWith(R,"[]"))&&(A=St.toArray(S)))return R=LD(R),A.forEach(function(I,D){!St.isUndefined(I)&&I!==null&&e.append(c===!0?PD([R],D,a):c===null?R:R+"[]",d(I))}),!1}return!!HA(S)||(e.append(PD(O,R,a),d(S)),!1)}const p=[],m=Object.assign(_G,{defaultVisitor:h,convertValue:d,isVisitable:HA});if(!St.isObject(t))throw new TypeError("data must be an object");return function S(R,O){if(!St.isUndefined(R)){if(p.indexOf(R)!==-1)throw Error("Circular reference detected in "+O.join("."));p.push(R),St.forEach(R,function(A,I){(!(St.isUndefined(A)||A===null)&&r.call(e,A,St.isString(I)?Ji(I).call(I):I,O,m))===!0&&S(A,O?O.concat(I):[I])}),p.pop()}}(t),e}function kD(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function WA(t,e){this._pairs=[],t&&hy(t,this,e)}const MD=WA.prototype;function EG(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function UD(t,e,n){if(!e)return t;const i=n&&n.encode||EG;St.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let a;if(a=r?r(e,n):St.isURLSearchParams(e)?e.toString():new WA(e,n).toString(i),a){const c=t.indexOf("#");c!==-1&&(t=t.slice(0,c)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}MD.append=function(t,e){this._pairs.push([t,e])},MD.toString=function(t){const e=t?function(n){return t.call(this,n,kD)}:kD;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};var xD=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){St.forEach(this.handlers,function(e){e!==null&&t(e)})}},VD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},BD={exports:{}},gG=Ue,SG=Bt,FD=gr.f;gG({target:"Object",stat:!0,forced:Object.defineProperty!==FD,sham:!SG},{defineProperty:FD});var jD=zr.Object,TG=BD.exports=function(t,e,n){return jD.defineProperty(t,e,n)};jD.defineProperty.sham&&(TG.sham=!0);var GD=w(BD.exports),RG=TypeError,HD=ra,yG=js,vG=er,CG=In("species"),WD=Array,bG=function(t){var e;return HD(t)&&(e=t.constructor,(yG(e)&&(e===WD||HD(e.prototype))||vG(e)&&(e=e[CG])===null)&&(e=void 0)),e===void 0?WD:e},KD=function(t,e){return new(bG(t))(e===0?0:e)},AG=M,IG=vc,wG=In("species"),YD=function(t){return IG>=51||!AG(function(){var e=[];return(e.constructor={})[wG]=function(){return{foo:1}},e[t](Boolean).foo!==1})},OG=Ue,NG=M,DG=ra,LG=er,PG=Dr,kG=ja,qD=function(t){if(t>9007199254740991)throw RG("Maximum allowed index exceeded");return t},zD=ff,MG=KD,UG=YD,xG=vc,XD=In("isConcatSpreadable"),VG=xG>=51||!NG(function(){var t=[];return t[XD]=!1,t.concat()[0]!==t}),BG=function(t){if(!LG(t))return!1;var e=t[XD];return e!==void 0?!!e:DG(t)};OG({target:"Array",proto:!0,forced:!VG||!UG("concat")},{concat:function(t){var e,n,i,r,a,c=PG(this),l=MG(c,0),d=0;for(e=-1,i=arguments.length;e<i;e++)if(BG(a=e===-1?c:arguments[e]))for(r=kG(a),qD(d+r),n=0;n<r;n++,d++)n in a&&zD(l,d,a[n]);else qD(d+1),zD(l,d++,a);return l.length=d,l}});var JD={},FG=je,jG=Ls,QD=Ka.f,GG=fu,ZD=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];JD.f=function(t){return ZD&&FG(t)=="Window"?function(e){try{return QD(e)}catch{return GG(ZD)}}(t):QD(jG(t))};var bf={},HG=In;bf.f=HG;var $D=zr,WG=di,KG=bf,YG=gr.f,Oi=function(t){var e=$D.Symbol||($D.Symbol={});WG(e,t)||YG(e,t,{value:KG.f(t)})},qG=pe,zG=nr,XG=In,JG=$a,tL=function(){var t=zG("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,i=XG("toPrimitive");e&&!e[i]&&JG(e,i,function(r){return qG(n,this)},{})},QG=Mr,ZG=qr,$G=Dr,t4=ja,e4=KD,eL=rt([].push),n4=function(t){var e=t==1,n=t==2,i=t==3,r=t==4,a=t==6,c=t==7,l=t==5||a;return function(d,h,p,m){for(var S,R,O=$G(d),A=ZG(O),I=QG(h,p),D=t4(A),L=0,V=m||e4,W=e?V(d,D):n||c?V(d,0):void 0;D>L;L++)if((l||L in A)&&(R=I(S=A[L],L,O),t))if(e)W[L]=R;else if(R)switch(t){case 3:return!0;case 5:return S;case 6:return L;case 2:eL(W,S)}else switch(t){case 4:return!1;case 7:eL(W,S)}return a?-1:i||r?r:W}},nL={forEach:n4(0)},py=Ue,KA=st,YA=pe,i4=rt,Af=Bt,If=Il,r4=M,lr=di,s4=ht,qA=Ci,fy=Ls,zA=Ku,a4=Tr,XA=we,ig=Fo,iL=hi,o4=Ka,rL=JD,c4=Hl,sL=be,aL=gr,l4=u_,oL=$,cL=$a,u4=vd,JA=No,lL=Uo,uL=wm,d4=In,h4=bf,p4=Oi,f4=tL,m4=sr,dL=Za,my=nL.forEach,Ss=bi("hidden"),_y="Symbol",rg="prototype",_4=dL.set,hL=dL.getterFor(_y),fo=Object[rg],$d=KA.Symbol,Ey=$d&&$d[rg],E4=KA.TypeError,QA=KA.QObject,pL=sL.f,th=aL.f,fL=rL.f,g4=oL.f,mL=i4([].push),sl=JA("symbols"),sg=JA("op-symbols"),S4=JA("wks"),ZA=!QA||!QA[rg]||!QA[rg].findChild,$A=Af&&r4(function(){return ig(th({},"a",{get:function(){return th(this,"a",{value:7}).a}})).a!=7})?function(t,e,n){var i=pL(fo,e);i&&delete fo[e],th(t,e,n),i&&t!==fo&&th(fo,e,i)}:th,tI=function(t,e){var n=sl[t]=ig(Ey);return _4(n,{type:_y,tag:t,description:e}),Af||(n.description=e),n},gy=function(t,e,n){t===fo&&gy(sg,e,n),qA(t);var i=zA(e);return qA(n),lr(sl,i)?(n.enumerable?(lr(t,Ss)&&t[Ss][i]&&(t[Ss][i]=!1),n=ig(n,{enumerable:XA(0,!1)})):(lr(t,Ss)||th(t,Ss,XA(1,{})),t[Ss][i]=!0),$A(t,i,n)):th(t,i,n)},eI=function(t,e){qA(t);var n=fy(e),i=iL(n).concat(SL(n));return my(i,function(r){Af&&!YA(_L,n,r)||gy(t,r,n[r])}),t},_L=function(t){var e=zA(t),n=YA(g4,this,e);return!(this===fo&&lr(sl,e)&&!lr(sg,e))&&(!(n||!lr(this,e)||!lr(sl,e)||lr(this,Ss)&&this[Ss][e])||n)},EL=function(t,e){var n=fy(t),i=zA(e);if(n!==fo||!lr(sl,i)||lr(sg,i)){var r=pL(n,i);return!r||!lr(sl,i)||lr(n,Ss)&&n[Ss][i]||(r.enumerable=!0),r}},gL=function(t){var e=fL(fy(t)),n=[];return my(e,function(i){lr(sl,i)||lr(lL,i)||mL(n,i)}),n},SL=function(t){var e=t===fo,n=fL(e?sg:fy(t)),i=[];return my(n,function(r){!lr(sl,r)||e&&!lr(fo,r)||mL(i,sl[r])}),i};If||($d=function(){if(s4(Ey,this))throw E4("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?a4(arguments[0]):void 0,e=uL(t),n=function(i){this===fo&&YA(n,sg,i),lr(this,Ss)&&lr(this[Ss],e)&&(this[Ss][e]=!1),$A(this,e,XA(1,i))};return Af&&ZA&&$A(fo,e,{configurable:!0,set:n}),tI(e,t)},cL(Ey=$d[rg],"toString",function(){return hL(this).tag}),cL($d,"withoutSetter",function(t){return tI(uL(t),t)}),oL.f=_L,aL.f=gy,l4.f=eI,sL.f=EL,o4.f=rL.f=gL,c4.f=SL,h4.f=function(t){return tI(d4(t),t)},Af&&u4(Ey,"description",{configurable:!0,get:function(){return hL(this).description}})),py({global:!0,wrap:!0,forced:!If,sham:!If},{Symbol:$d}),my(iL(S4),function(t){p4(t)}),py({target:_y,stat:!0,forced:!If},{useSetter:function(){ZA=!0},useSimple:function(){ZA=!1}}),py({target:"Object",stat:!0,forced:!If,sham:!Af},{create:function(t,e){return e===void 0?ig(t):eI(ig(t),e)},defineProperty:gy,defineProperties:eI,getOwnPropertyDescriptor:EL}),py({target:"Object",stat:!0,forced:!If},{getOwnPropertyNames:gL}),f4(),m4($d,_y),lL[Ss]=!0;var TL=Il&&!!Symbol.for&&!!Symbol.keyFor,T4=Ue,R4=nr,y4=di,v4=Tr,RL=No,C4=TL,nI=RL("string-to-symbol-registry"),b4=RL("symbol-to-string-registry");T4({target:"Symbol",stat:!0,forced:!C4},{for:function(t){var e=v4(t);if(y4(nI,e))return nI[e];var n=R4("Symbol")(e);return nI[e]=n,b4[n]=e,n}});var A4=Ue,I4=di,w4=xa,O4=bc,N4=TL,yL=No("symbol-to-string-registry");A4({target:"Symbol",stat:!0,forced:!N4},{keyFor:function(t){if(!w4(t))throw TypeError(O4(t)+" is not a symbol");if(I4(yL,t))return yL[t]}});var vL=ra,D4=tn,CL=je,L4=Tr,bL=rt([].push),P4=Ue,AL=nr,IL=Vt,k4=pe,ag=rt,wL=M,OL=tn,NL=xa,DL=Ad,M4=function(t){if(D4(t))return t;if(vL(t)){for(var e=t.length,n=[],i=0;i<e;i++){var r=t[i];typeof r=="string"?bL(n,r):typeof r!="number"&&CL(r)!="Number"&&CL(r)!="String"||bL(n,L4(r))}var a=n.length,c=!0;return function(l,d){if(c)return c=!1,d;if(vL(this))return d;for(var h=0;h<a;h++)if(n[h]===l)return d}}},U4=Il,x4=String,Su=AL("JSON","stringify"),Sy=ag(/./.exec),LL=ag("".charAt),V4=ag("".charCodeAt),B4=ag("".replace),F4=ag(1 .toString),j4=/[\uD800-\uDFFF]/g,PL=/^[\uD800-\uDBFF]$/,kL=/^[\uDC00-\uDFFF]$/,ML=!U4||wL(function(){var t=AL("Symbol")();return Su([t])!="[null]"||Su({a:t})!="{}"||Su(Object(t))!="{}"}),UL=wL(function(){return Su("\uDF06\uD834")!=='"\\udf06\\ud834"'||Su("\uDEAD")!=='"\\udead"'}),G4=function(t,e){var n=DL(arguments),i=M4(e);if(OL(i)||t!==void 0&&!NL(t))return n[1]=function(r,a){if(OL(i)&&(a=k4(i,this,x4(r),a)),!NL(a))return a},IL(Su,null,n)},H4=function(t,e,n){var i=LL(n,e-1),r=LL(n,e+1);return Sy(PL,t)&&!Sy(kL,r)||Sy(kL,t)&&!Sy(PL,i)?"\\u"+F4(V4(t,0),16):t};Su&&P4({target:"JSON",stat:!0,forced:ML||UL},{stringify:function(t,e,n){var i=DL(arguments),r=IL(ML?G4:Su,null,i);return UL&&typeof r=="string"?B4(r,j4,H4):r}});var xL=Hl,W4=Dr;Ue({target:"Object",stat:!0,forced:!Il||M(function(){xL.f(1)})},{getOwnPropertySymbols:function(t){var e=xL.f;return e?e(W4(t)):[]}}),Oi("asyncIterator"),Oi("hasInstance"),Oi("isConcatSpreadable"),Oi("iterator"),Oi("match"),Oi("matchAll"),Oi("replace"),Oi("search"),Oi("species"),Oi("split");var K4=tL;Oi("toPrimitive"),K4();var Y4=nr,q4=sr;Oi("toStringTag"),q4(Y4("Symbol"),"Symbol"),Oi("unscopables"),sr(st.JSON,"JSON",!0);var z4=zr.Symbol,X4=In,J4=gr.f,VL=X4("metadata"),BL=Function.prototype;BL[VL]===void 0&&J4(BL,VL,{value:null}),Oi("dispose"),Oi("metadata");var Q4=z4;Oi("asyncDispose");var Z4=rt,iI=nr("Symbol"),$4=iI.keyFor,t5=Z4(iI.prototype.valueOf),FL=iI.isRegisteredSymbol||function(t){try{return $4(t5(t))!==void 0}catch{return!1}};Ue({target:"Symbol",stat:!0},{isRegisteredSymbol:FL});for(var e5=No,jL=nr,n5=rt,i5=xa,r5=In,Ty=jL("Symbol"),GL=Ty.isWellKnownSymbol,HL=jL("Object","getOwnPropertyNames"),s5=n5(Ty.prototype.valueOf),WL=e5("wks"),rI=0,KL=HL(Ty),a5=KL.length;rI<a5;rI++)try{var YL=KL[rI];i5(Ty[YL])&&r5(YL)}catch{}var qL=function(t){if(GL&&GL(t))return!0;try{for(var e=s5(t),n=0,i=HL(WL),r=i.length;n<r;n++)if(WL[i[n]]==e)return!0}catch{}return!1};Ue({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:qL}),Oi("matcher"),Oi("observable"),Ue({target:"Symbol",stat:!0},{isRegistered:FL}),Ue({target:"Symbol",stat:!0,forced:!0},{isWellKnown:qL}),Oi("metadataKey"),Oi("patternMatch"),Oi("replaceAll");var wf=w(Q4),zL=w(bf.f("iterator"));function og(t){return og=typeof wf=="function"&&typeof zL=="symbol"?function(e){return typeof e}:function(e){return e&&typeof wf=="function"&&e.constructor===wf&&e!==wf.prototype?"symbol":typeof e},og(t)}var o5=w(bf.f("toPrimitive"));function c5(t){var e=function(n,i){if(og(n)!=="object"||n===null)return n;var r=n[o5];if(r!==void 0){var a=r.call(n,i);if(og(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(t,"string");return og(e)==="symbol"?e:String(e)}function N(t,e,n){return(e=c5(e))in t?GD(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var XL=w(GF),l5={isBrowser:!0,classes:{URLSearchParams:XL!==void 0?XL:WA,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const sI=typeof window<"u"&&typeof document<"u",aI=typeof navigator=="object"&&navigator||void 0,u5=sI&&(!aI||["ReactNative","NativeScript","NS"].indexOf(aI.product)<0),d5=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",h5=sI&&window.location.href||"http://localhost";function JL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function QL(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?JL(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):JL(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var Vr=QL(QL({},Object.freeze({__proto__:null,hasBrowserEnv:sI,hasStandardBrowserEnv:u5,hasStandardBrowserWebWorkerEnv:d5,navigator:aI,origin:h5})),l5),p5=Ci,f5=pe,m5=di,_5=ht,E5=function(){var t=p5(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},ZL=RegExp.prototype,$L=function(t){var e=t.flags;return e!==void 0||"flags"in ZL||m5(t,"flags")||!_5(ZL,t)?e:f5(E5,t)},g5=BE.charAt,tP=pe,S5=Ci,T5=tn,R5=je,y5=/./.exec,v5=TypeError,C5=Ue,eP=pe,nP=Zt,b5=la,Ry=Hc,iP=Ma,rP=Ym,cg=Tr,A5=Ci,I5=ia,w5=je,O5=Jm,sP=$L,N5=Hu,D5=M,L5=Yo,P5=function(t,e,n){return e+(n?g5(t,e).length:1)},k5=function(t,e){var n=t.exec;if(T5(n)){var i=tP(n,t,e);return i!==null&&S5(i),i}if(R5(t)==="RegExp")return tP(y5,t,e);throw v5("RegExp#exec called on incompatible receiver")},aP=Za,M5=In("matchAll"),oP="RegExp String",cP=oP+" Iterator",U5=aP.set,x5=aP.getterFor(cP),V5=TypeError,oI=nP("".indexOf),yy=nP("".matchAll),cI=!!yy&&!D5(function(){yy("a",/./)}),B5=b5(function(t,e,n,i){U5(this,{type:cP,regexp:t,string:e,global:n,unicode:i,done:!1})},oP,function(){var t=x5(this);if(t.done)return Ry(void 0,!0);var e=t.regexp,n=t.string,i=k5(e,n);return i===null?(t.done=!0,Ry(void 0,!0)):t.global?(cg(i[0])===""&&(e.lastIndex=P5(n,rP(e.lastIndex),t.unicode)),Ry(i,!1)):(t.done=!0,Ry(i,!1))}),lP=function(t){var e,n,i,r=A5(this),a=cg(t),c=L5(r,RegExp),l=cg(sP(r));return e=new c(c===RegExp?r.source:r,l),n=!!~oI(l,"g"),i=!!~oI(l,"u"),e.lastIndex=rP(r.lastIndex),new B5(e,a,n,i)};C5({target:"String",proto:!0,forced:cI},{matchAll:function(t){var e,n,i,r,a=iP(this);if(I5(t)){if(cI)return yy(a,t)}else{if(O5(t)&&(e=cg(iP(sP(t))),!~oI(e,"g")))throw V5("`.matchAll` does not allow non-global regexes");if(cI)return yy(a,t);if((i=N5(t,M5))===void 0&&w5(t)=="RegExp"&&(i=lP),i)return eP(i,t,a)}return n=cg(a),r=new RegExp(t,"g"),eP(lP,r,n)}});var F5=Sr("String").matchAll,j5=ht,G5=F5,lI=String.prototype,H5=function(t){var e=t.matchAll;return typeof t=="string"||t===lI||j5(lI,t)&&e===lI.matchAll?G5:e},W5=w(H5);function uP(t){function e(n,i,r,a){let c=n[a++];if(c==="__proto__")return!0;const l=Number.isFinite(+c),d=a>=n.length;return c=!c&&St.isArray(r)?r.length:c,d?(St.hasOwnProp(r,c)?r[c]=[r[c],i]:r[c]=i,!l):(r[c]&&St.isObject(r[c])||(r[c]=[]),e(n,i,r[c],a)&&St.isArray(r[c])&&(r[c]=function(h){const p={},m=Object.keys(h);let S;const R=m.length;let O;for(S=0;S<R;S++)O=m[S],p[O]=h[O];return p}(r[c])),!l)}if(St.isFormData(t)&&St.isFunction(t.entries)){const n={};return St.forEachEntry(t,(i,r)=>{e(function(a){return W5(St).call(St,/\w+|\[(\w*)]/g,a).map(c=>c[0]==="[]"?"":c[1]||c[0])}(i),r,n,0)}),n}return null}const uI={transitional:VD,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const n=e.getContentType()||"",i=n.indexOf("application/json")>-1,r=St.isObject(t);if(r&&St.isHTMLForm(t)&&(t=new FormData(t)),St.isFormData(t))return i?JSON.stringify(uP(t)):t;if(St.isArrayBuffer(t)||St.isBuffer(t)||St.isStream(t)||St.isFile(t)||St.isBlob(t)||St.isReadableStream(t))return t;if(St.isArrayBufferView(t))return t.buffer;if(St.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(c,l){return hy(c,new Vr.classes.URLSearchParams,Object.assign({visitor:function(d,h,p,m){return Vr.isNode&&St.isBuffer(d)?(this.append(h,d.toString("base64")),!1):m.defaultVisitor.apply(this,arguments)}},l))}(t,this.formSerializer).toString();if((a=St.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return hy(a?{"files[]":t}:t,c&&new c,this.formSerializer)}}return r||i?(e.setContentType("application/json",!1),function(c,l,d){if(St.isString(c))try{return(l||JSON.parse)(c),Ji(St).call(St,c)}catch(h){if(h.name!=="SyntaxError")throw h}return(d||JSON.stringify)(c)}(t)):t}],transformResponse:[function(t){const e=this.transitional||uI.transitional,n=e&&e.forcedJSONParsing,i=this.responseType==="json";if(St.isResponse(t)||St.isReadableStream(t))return t;if(t&&St.isString(t)&&(n&&!this.responseType||i)){const r=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(a){if(r)throw a.name==="SyntaxError"?Ge.from(a,Ge.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Vr.classes.FormData,Blob:Vr.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};St.forEach(["delete","get","head","post","put","patch"],t=>{uI.headers[t]={}});var dI=uI;const K5=St.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),dP=Symbol("internals");function lg(t){var e;return t&&Ji(e=String(t)).call(e).toLowerCase()}function vy(t){return t===!1||t==null?t:St.isArray(t)?t.map(vy):String(t)}function hI(t,e,n,i,r){return St.isFunction(i)?i.call(this,e,n):(r&&(e=n),St.isString(e)?St.isString(i)?e.indexOf(i)!==-1:St.isRegExp(i)?i.test(e):void 0:void 0)}class Cy{constructor(e){e&&this.set(e)}set(e,n,i){const r=this;function a(d,h,p){const m=lg(h);if(!m)throw new Error("header name must be a non-empty string");const S=St.findKey(r,m);(!S||r[S]===void 0||p===!0||p===void 0&&r[S]!==!1)&&(r[S||h]=vy(d))}const c=(d,h)=>St.forEach(d,(p,m)=>a(p,m,h));if(St.isPlainObject(e)||e instanceof this.constructor)c(e,n);else if(St.isString(e)&&(e=Ji(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Ji(l=e).call(l)))c((d=>{const h={};let p,m,S;return d&&d.split(`
`).forEach(function(R){var O,A;S=R.indexOf(":"),p=Ji(O=R.substring(0,S)).call(O).toLowerCase(),m=Ji(A=R.substring(S+1)).call(A),!p||h[p]&&K5[p]||(p==="set-cookie"?h[p]?h[p].push(m):h[p]=[m]:h[p]=h[p]?h[p]+", "+m:m)}),h})(e),n);else if(St.isHeaders(e))for(const[d,h]of e.entries())a(h,d,i);else e!=null&&a(n,e,i);var l;return this}get(e,n){if(e=lg(e)){const i=St.findKey(this,e);if(i){const r=this[i];if(!n)return r;if(n===!0)return function(a){const c=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let d;for(;d=l.exec(a);)c[d[1]]=d[2];return c}(r);if(St.isFunction(n))return n.call(this,r,i);if(St.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=lg(e)){const i=St.findKey(this,e);return!(!i||this[i]===void 0||n&&!hI(0,this[i],i,n))}return!1}delete(e,n){const i=this;let r=!1;function a(c){if(c=lg(c)){const l=St.findKey(i,c);!l||n&&!hI(0,i[l],l,n)||(delete i[l],r=!0)}}return St.isArray(e)?e.forEach(a):a(e),r}clear(e){const n=Object.keys(this);let i=n.length,r=!1;for(;i--;){const a=n[i];e&&!hI(0,this[a],a,e,!0)||(delete this[a],r=!0)}return r}normalize(e){const n=this,i={};return St.forEach(this,(r,a)=>{var c;const l=St.findKey(i,a);if(l)return n[l]=vy(r),void delete n[a];const d=e?function(h){return Ji(h).call(h).toLowerCase().replace(/([a-z\d])(\w*)/g,(p,m,S)=>m.toUpperCase()+S)}(a):Ji(c=String(a)).call(c);d!==a&&delete n[a],n[d]=vy(r),i[d]=!0}),this}concat(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(e){const n=Object.create(null);return St.forEach(this,(i,r)=>{i!=null&&i!==!1&&(n[r]=e&&St.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[n,i]=e;return n+": "+i}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const n=new this(e);for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return r.forEach(c=>n.set(c)),n}static accessor(e){const n=(this[dP]=this[dP]={accessors:{}}).accessors,i=this.prototype;function r(a){const c=lg(a);n[c]||(function(l,d){const h=St.toCamelCase(" "+d);["get","set","has"].forEach(p=>{Object.defineProperty(l,p+h,{value:function(m,S,R){return this[p].call(this,d,m,S,R)},configurable:!0})})}(i,a),n[c]=!0)}return St.isArray(e)?e.forEach(r):r(e),this}}Cy.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),St.reduceDescriptors(Cy.prototype,(t,e)=>{let{value:n}=t,i=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[i]=r}}}),St.freezeMethods(Cy);var mo=Cy;function pI(t,e){const n=this||dI,i=e||n,r=mo.from(i.headers);let a=i.data;return St.forEach(t,function(c){a=c.call(n,a,r.normalize(),e?e.status:void 0)}),r.normalize(),a}function hP(t){return!(!t||!t.__CANCEL__)}function Of(t,e,n){Ge.call(this,t??"canceled",Ge.ERR_CANCELED,e,n),this.name="CanceledError"}function pP(t,e,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?e(new Ge("Request failed with status code "+n.status,[Ge.ERR_BAD_REQUEST,Ge.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}St.inherits(Of,Ge,{__CANCEL__:!0});const by=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const r=function(a,c){a=a||10;const l=new Array(a),d=new Array(a);let h,p=0,m=0;return c=c!==void 0?c:1e3,function(S){const R=Date.now(),O=d[m];h||(h=R),l[p]=S,d[p]=R;let A=m,I=0;for(;A!==p;)I+=l[A++],A%=a;if(p=(p+1)%a,p===m&&(m=(m+1)%a),R-h<c)return;const D=O&&R-O;return D?Math.round(1e3*I/D):void 0}}(50,250);return function(a,c){let l,d,h=0,p=1e3/c;const m=function(S){h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),l=null,d&&(clearTimeout(d),d=null),a.apply(null,S)};return[function(){const S=Date.now(),R=S-h;for(var O=arguments.length,A=new Array(O),I=0;I<O;I++)A[I]=arguments[I];R>=p?m(A,S):(l=A,d||(d=setTimeout(()=>{d=null,m(l)},p-R)))},()=>l&&m(l)]}(a=>{const c=a.loaded,l=a.lengthComputable?a.total:void 0,d=c-i,h=r(d);i=c,t({loaded:c,total:l,progress:l?c/l:void 0,bytes:d,rate:h||void 0,estimated:h&&l&&c<=l?(l-c)/h:void 0,event:a,lengthComputable:l!=null,[e?"download":"upload"]:!0})},n)},fP=(t,e)=>{const n=t!=null;return[i=>e[0]({lengthComputable:n,total:t,loaded:i}),e[1]]},mP=t=>function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return St.asap(()=>t(...n))};var Y5=Vr.hasStandardBrowserEnv?((t,e)=>n=>(n=new ty(n,Vr.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new ty(Vr.origin),Vr.navigator&&/(msie|trident)/i.test(Vr.navigator.userAgent)):()=>!0,q5=Vr.hasStandardBrowserEnv?{write(t,e,n,i,r,a){const c=[t+"="+encodeURIComponent(e)];St.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),St.isString(i)&&c.push("path="+i),St.isString(r)&&c.push("domain="+r),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function _P(t,e){return t&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(e)?function(n,i){return i?n.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):n}(t,e):e}function EP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const gP=t=>t instanceof mo?function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?EP(Object(i),!0).forEach(function(r){N(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):EP(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t):t;function eh(t,e){e=e||{};const n={};function i(h,p,m,S){return St.isPlainObject(h)&&St.isPlainObject(p)?St.merge.call({caseless:S},h,p):St.isPlainObject(p)?St.merge({},p):St.isArray(p)?p.slice():p}function r(h,p,m,S){return St.isUndefined(p)?St.isUndefined(h)?void 0:i(void 0,h,0,S):i(h,p,0,S)}function a(h,p){if(!St.isUndefined(p))return i(void 0,p)}function c(h,p){return St.isUndefined(p)?St.isUndefined(h)?void 0:i(void 0,h):i(void 0,p)}function l(h,p,m){return m in e?i(h,p):m in t?i(void 0,h):void 0}const d={url:a,method:a,data:a,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(h,p,m)=>r(gP(h),gP(p),0,!0)};return St.forEach(Object.keys(Object.assign({},t,e)),function(h){const p=d[h]||r,m=p(t[h],e[h],h);St.isUndefined(m)&&p!==l||(n[h]=m)}),n}var SP=t=>{const e=eh({},t);let n,{data:i,withXSRFToken:r,xsrfHeaderName:a,xsrfCookieName:c,headers:l,auth:d}=e;if(e.headers=l=mo.from(l),e.url=UD(_P(e.baseURL,e.url),t.params,t.paramsSerializer),d&&l.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),St.isFormData(i)){if(Vr.hasStandardBrowserEnv||Vr.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((n=l.getContentType())!==!1){const[h,...p]=n?n.split(";").map(m=>Ji(m).call(m)).filter(Boolean):[];l.setContentType([h||"multipart/form-data",...p].join("; "))}}if(Vr.hasStandardBrowserEnv&&(r&&St.isFunction(r)&&(r=r(e)),r||r!==!1&&Y5(e.url))){const h=a&&c&&q5.read(c);h&&l.set(a,h)}return e},z5=typeof XMLHttpRequest<"u"&&function(t){return new Et(function(e,n){const i=SP(t);let r=i.data;const a=mo.from(i.headers).normalize();let c,l,d,h,p,{responseType:m,onUploadProgress:S,onDownloadProgress:R}=i;function O(){h&&h(),p&&p(),i.cancelToken&&i.cancelToken.unsubscribe(c),i.signal&&i.signal.removeEventListener("abort",c)}let A=new XMLHttpRequest;function I(){if(!A)return;const L=mo.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders());pP(function(V){e(V),O()},function(V){n(V),O()},{data:m&&m!=="text"&&m!=="json"?A.response:A.responseText,status:A.status,statusText:A.statusText,headers:L,config:t,request:A}),A=null}A.open(i.method.toUpperCase(),i.url,!0),A.timeout=i.timeout,"onloadend"in A?A.onloadend=I:A.onreadystatechange=function(){A&&A.readyState===4&&(A.status!==0||A.responseURL&&A.responseURL.indexOf("file:")===0)&&setTimeout(I)},A.onabort=function(){A&&(n(new Ge("Request aborted",Ge.ECONNABORTED,t,A)),A=null)},A.onerror=function(){n(new Ge("Network Error",Ge.ERR_NETWORK,t,A)),A=null},A.ontimeout=function(){let L=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const V=i.transitional||VD;i.timeoutErrorMessage&&(L=i.timeoutErrorMessage),n(new Ge(L,V.clarifyTimeoutError?Ge.ETIMEDOUT:Ge.ECONNABORTED,t,A)),A=null},r===void 0&&a.setContentType(null),"setRequestHeader"in A&&St.forEach(a.toJSON(),function(L,V){A.setRequestHeader(V,L)}),St.isUndefined(i.withCredentials)||(A.withCredentials=!!i.withCredentials),m&&m!=="json"&&(A.responseType=i.responseType),R&&([d,p]=by(R,!0),A.addEventListener("progress",d)),S&&A.upload&&([l,h]=by(S),A.upload.addEventListener("progress",l),A.upload.addEventListener("loadend",h)),(i.cancelToken||i.signal)&&(c=L=>{A&&(n(!L||L.type?new Of(null,t,A):L),A.abort(),A=null)},i.cancelToken&&i.cancelToken.subscribe(c),i.signal&&(i.signal.aborted?c():i.signal.addEventListener("abort",c)));const D=function(L){const V=/^([-+\w]{1,25})(:?\/\/|:)/.exec(L);return V&&V[1]||""}(i.url);D&&Vr.protocols.indexOf(D)===-1?n(new Ge("Unsupported protocol "+D+":",Ge.ERR_BAD_REQUEST,t)):A.send(r||null)})},X5=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let i,r=new AbortController;const a=function(h){if(!i){i=!0,l();const p=h instanceof Error?h:this.reason;r.abort(p instanceof Ge?p:new Of(p instanceof Error?p.message:p))}};let c=e&&setTimeout(()=>{c=null,a(new Ge("timeout ".concat(e," of ms exceeded"),Ge.ETIMEDOUT))},e);const l=()=>{t&&(c&&clearTimeout(c),c=null,t.forEach(h=>{h.unsubscribe?h.unsubscribe(a):h.removeEventListener("abort",a)}),t=null)};t.forEach(h=>h.addEventListener("abort",a));const{signal:d}=r;return d.unsubscribe=()=>St.asap(l),d}},J5=hf,Q5=Ws;Ue({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=Q5.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var Z5=Ws,$5=Ii;Ue({target:"Promise",stat:!0,forced:!0},{try:function(t){var e=Z5.f(this),n=$5(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var fI=w(J5),TP=bf.f("asyncIterator"),tH=w(TP);function mI(t,e){this.v=t,this.k=e}function ug(t){var e,n;function i(a,c){try{var l=t[a](c),d=l.value,h=d instanceof mI;fI.resolve(h?d.v:d).then(function(p){if(h){var m=a==="return"?"return":"next";if(!d.k||p.done)return i(m,p);p=t[m](p).value}r(l.done?"return":"normal",p)},function(p){i("throw",p)})}catch(p){r("throw",p)}}function r(a,c){switch(a){case"return":e.resolve({value:c,done:!0});break;case"throw":e.reject(c);break;default:e.resolve({value:c,done:!1})}(e=e.next)?i(e.key,e.arg):n=null}this._invoke=function(a,c){return new fI(function(l,d){var h={key:a,arg:c,resolve:l,reject:d,next:null};n?n=n.next=h:(e=n=h,i(a,c))})},typeof t.return!="function"&&(this.return=void 0)}function Ys(t){return function(){return new ug(t.apply(this,arguments))}}function Te(t){return new mI(t,0)}function Ay(t){var e={},n=!1;function i(r,a){return n=!0,{done:!1,value:new mI(a=new fI(function(c){c(t[r](a))}),1)}}return e[wf!==void 0&&zL||"@@iterator"]=function(){return this},e.next=function(r){return n?(n=!1,r):i("next",r)},typeof t.throw=="function"&&(e.throw=function(r){if(n)throw n=!1,r;return i("throw",r)}),typeof t.return=="function"&&(e.return=function(r){return n?(n=!1,r):i("return",r)}),e}ug.prototype[typeof wf=="function"&&tH||"@@asyncIterator"]=function(){return this},ug.prototype.next=function(t){return this._invoke("next",t)},ug.prototype.throw=function(t){return this._invoke("throw",t)},ug.prototype.return=function(t){return this._invoke("return",t)};var _I=w(TP);function EI(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=_I,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new Iy(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Iy(t){function e(n){if(Object(n)!==n)return Et.reject(new TypeError(n+" is not an object."));var i=n.done;return Et.resolve(n.value).then(function(r){return{value:r,done:i}})}return Iy=function(n){this.s=n,this.n=n.next},Iy.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?Et.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?Et.reject(n):e(i.apply(this.s,arguments))}},new Iy(t)}const eH=function*(t,e){let n=t.byteLength;if(!e||n<e)return void(yield t);let i,r=0;for(;r<n;)i=r+e,yield t.slice(r,i),r=i},nH=function(){var t=Ys(function*(e,n){var i,r=!1,a=!1;try{for(var c,l=EI(iH(e));r=!(c=yield Te(l.next())).done;r=!1){const d=c.value;yield*Ay(EI(eH(d,n)))}}catch(d){a=!0,i=d}finally{try{r&&l.return!=null&&(yield Te(l.return()))}finally{if(a)throw i}}});return function(e,n){return t.apply(this,arguments)}}(),iH=function(){var t=Ys(function*(e){if(e[_I])return void(yield*Ay(EI(e)));const n=e.getReader();try{for(;;){const{done:i,value:r}=yield Te(n.read());if(i)break;yield r}}finally{yield Te(n.cancel())}});return function(e){return t.apply(this,arguments)}}(),RP=(t,e,n,i)=>{const r=nH(t,e);let a,c=0,l=d=>{a||(a=!0,i&&i(d))};return new ReadableStream({async pull(d){try{const{done:h,value:p}=await r.next();if(h)return l(),void d.close();let m=p.byteLength;if(n){let S=c+=m;n(S)}d.enqueue(new Uint8Array(p))}catch(h){throw l(h),h}},cancel:d=>(l(d),r.return())},{highWaterMark:2})};function yP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function vP(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?yP(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yP(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const wy=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",CP=wy&&typeof ReadableStream=="function",rH=wy&&(typeof TextEncoder=="function"?(bP=new TextEncoder,t=>bP.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var bP;const AP=function(t){try{for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return!!t(...n)}catch{return!1}},sH=CP&&AP(()=>{let t=!1;const e=new Request(Vr.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),gI=CP&&AP(()=>St.isReadableStream(new Response("").body)),Oy={stream:gI&&(t=>t.body)};var IP;wy&&(IP=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Oy[t]&&(Oy[t]=St.isFunction(IP[t])?e=>e[t]():(e,n)=>{throw new Ge("Response type '".concat(t,"' is not supported"),Ge.ERR_NOT_SUPPORT,n)})}));const aH=async(t,e)=>{const n=St.toFiniteNumber(t.getContentLength());return n??(async i=>i==null?0:St.isBlob(i)?i.size:St.isSpecCompliantForm(i)?(await new Request(Vr.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:St.isArrayBufferView(i)||St.isArrayBuffer(i)?i.byteLength:(St.isURLSearchParams(i)&&(i+=""),St.isString(i)?(await rH(i)).byteLength:void 0))(e)};var oH=wy&&(async t=>{let{url:e,method:n,data:i,signal:r,cancelToken:a,timeout:c,onDownloadProgress:l,onUploadProgress:d,responseType:h,headers:p,withCredentials:m="same-origin",fetchOptions:S}=SP(t);h=h?(h+"").toLowerCase():"text";let R,O=X5([r,a&&a.toAbortSignal()],c);const A=O&&O.unsubscribe&&(()=>{O.unsubscribe()});let I;try{if(d&&sH&&n!=="get"&&n!=="head"&&(I=await aH(p,i))!==0){let K,G=new Request(e,{method:"POST",body:i,duplex:"half"});if(St.isFormData(i)&&(K=G.headers.get("content-type"))&&p.setContentType(K),G.body){const[Q,lt]=fP(I,by(mP(d)));i=RP(G.body,65536,Q,lt)}}St.isString(m)||(m=m?"include":"omit");const D="credentials"in Request.prototype;R=new Request(e,vP(vP({},S),{},{signal:O,method:n.toUpperCase(),headers:p.normalize().toJSON(),body:i,duplex:"half",credentials:D?m:void 0}));let L=await fetch(R);const V=gI&&(h==="stream"||h==="response");if(gI&&(l||V&&A)){const K={};["status","statusText","headers"].forEach(Tt=>{K[Tt]=L[Tt]});const G=St.toFiniteNumber(L.headers.get("content-length")),[Q,lt]=l&&fP(G,by(mP(l),!0))||[];L=new Response(RP(L.body,65536,Q,()=>{lt&&lt(),A&&A()}),K)}h=h||"text";let W=await Oy[St.findKey(Oy,h)||"text"](L,t);return!V&&A&&A(),await new Et((K,G)=>{pP(K,G,{data:W,headers:mo.from(L.headers),status:L.status,statusText:L.statusText,config:t,request:R})})}catch(D){throw A&&A(),D&&D.name==="TypeError"&&/fetch/i.test(D.message)?Object.assign(new Ge("Network Error",Ge.ERR_NETWORK,t,R),{cause:D.cause||D}):Ge.from(D,D&&D.code,t,R)}});const SI={http:null,xhr:z5,fetch:oH};St.forEach(SI,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const wP=t=>"- ".concat(t),cH=t=>St.isFunction(t)||t===null||t===!1;var OP={getAdapter:t=>{t=St.isArray(t)?t:[t];const{length:e}=t;let n,i;const r={};for(let a=0;a<e;a++){let c;if(n=t[a],i=n,!cH(n)&&(i=SI[(c=String(n)).toLowerCase()],i===void 0))throw new Ge("Unknown adapter '".concat(c,"'"));if(i)break;r[c||"#"+a]=i}if(!i){const a=Object.entries(r).map(c=>{let[l,d]=c;return"adapter ".concat(l," ")+(d===!1?"is not supported by the environment":"is not available in the build")});throw new Ge("There is no suitable adapter to dispatch the request "+(e?a.length>1?`since :
`+a.map(wP).join(`
`):" "+wP(a[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:SI};function TI(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Of(null,t)}function NP(t){return TI(t),t.headers=mo.from(t.headers),t.data=pI.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),OP.getAdapter(t.adapter||dI.adapter)(t).then(function(e){return TI(t),e.data=pI.call(t,t.transformResponse,e),e.headers=mo.from(e.headers),e},function(e){return hP(e)||(TI(t),e&&e.response&&(e.response.data=pI.call(t,t.transformResponse,e.response),e.response.headers=mo.from(e.response.headers))),Et.reject(e)})}const DP="1.7.9",Ny={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Ny[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const LP={};Ny.transitional=function(t,e,n){function i(r,a){return"[Axios v"+DP+"] Transitional option '"+r+"'"+a+(n?". "+n:"")}return(r,a,c)=>{if(t===!1)throw new Ge(i(a," has been removed"+(e?" in "+e:"")),Ge.ERR_DEPRECATED);return e&&!LP[a]&&(LP[a]=!0,console.warn(i(a," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(r,a,c)}},Ny.spelling=function(t){return(e,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(t)),!0)};var Dy={assertOptions:function(t,e,n){if(typeof t!="object")throw new Ge("options must be an object",Ge.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let r=i.length;for(;r-- >0;){const a=i[r],c=e[a];if(c){const l=t[a],d=l===void 0||c(l,a,t);if(d!==!0)throw new Ge("option "+a+" must be "+d,Ge.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Ge("Unknown option "+a,Ge.ERR_BAD_OPTION)}},validators:Ny};const tc=Dy.validators;let Ly=class{constructor(t){this.defaults=t,this.interceptors={request:new xD,response:new xD}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?r&&!String(n.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+r):n.stack=r}catch{}}throw n}}_request(t,e){typeof t=="string"?(e=e||{}).url=t:e=t||{},e=eh(this.defaults,e);const{transitional:n,paramsSerializer:i,headers:r}=e;n!==void 0&&Dy.assertOptions(n,{silentJSONParsing:tc.transitional(tc.boolean),forcedJSONParsing:tc.transitional(tc.boolean),clarifyTimeoutError:tc.transitional(tc.boolean)},!1),i!=null&&(St.isFunction(i)?e.paramsSerializer={serialize:i}:Dy.assertOptions(i,{encode:tc.function,serialize:tc.function},!0)),Dy.assertOptions(e,{baseUrl:tc.spelling("baseURL"),withXsrfToken:tc.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let a=r&&St.merge(r.common,r[e.method]);r&&St.forEach(["delete","get","head","post","put","patch","common"],R=>{delete r[R]}),e.headers=mo.concat(a,r);const c=[];let l=!0;this.interceptors.request.forEach(function(R){typeof R.runWhen=="function"&&R.runWhen(e)===!1||(l=l&&R.synchronous,c.unshift(R.fulfilled,R.rejected))});const d=[];let h;this.interceptors.response.forEach(function(R){d.push(R.fulfilled,R.rejected)});let p,m=0;if(!l){const R=[NP.bind(this),void 0];for(R.unshift.apply(R,c),R.push.apply(R,d),p=R.length,h=Et.resolve(e);m<p;)h=h.then(R[m++],R[m++]);return h}p=c.length;let S=e;for(m=0;m<p;){const R=c[m++],O=c[m++];try{S=R(S)}catch(A){O.call(this,A);break}}try{h=NP.call(this,S)}catch(R){return Et.reject(R)}for(m=0,p=d.length;m<p;)h=h.then(d[m++],d[m++]);return h}getUri(t){return UD(_P((t=eh(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};St.forEach(["delete","get","head","options"],function(t){Ly.prototype[t]=function(e,n){return this.request(eh(n||{},{method:t,url:e,data:(n||{}).data}))}}),St.forEach(["post","put","patch"],function(t){function e(n){return function(i,r,a){return this.request(eh(a||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:r}))}}Ly.prototype[t]=e(),Ly.prototype[t+"Form"]=e(!0)});var Py=Ly;class RI{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Et(function(r){n=r});const i=this;this.promise.then(r=>{if(!i._listeners)return;let a=i._listeners.length;for(;a-- >0;)i._listeners[a](r);i._listeners=null}),this.promise.then=r=>{let a;const c=new Et(l=>{i.subscribe(l),a=l}).then(r);return c.cancel=function(){i.unsubscribe(a)},c},e(function(r,a,c){i.reason||(i.reason=new Of(r,a,c),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=i=>{e.abort(i)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new RI(function(i){e=i}),cancel:e}}}var lH=RI;const yI={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(yI).forEach(t=>{let[e,n]=t;yI[n]=e});var uH=yI;const Ki=function t(e){const n=new Py(e),i=gD(Py.prototype.request,n);return St.extend(i,Py.prototype,n,{allOwnKeys:!0}),St.extend(i,n,null,{allOwnKeys:!0}),i.create=function(r){return t(eh(e,r))},i}(dI);Ki.Axios=Py,Ki.CanceledError=Of,Ki.CancelToken=lH,Ki.isCancel=hP,Ki.VERSION=DP,Ki.toFormData=hy,Ki.AxiosError=Ge,Ki.Cancel=Ki.CanceledError,Ki.all=function(t){return Et.all(t)},Ki.spread=function(t){return function(e){return t.apply(null,e)}},Ki.isAxiosError=function(t){return St.isObject(t)&&t.isAxiosError===!0},Ki.mergeConfig=eh,Ki.AxiosHeaders=mo,Ki.formToJSON=t=>uP(St.isHTMLForm(t)?new FormData(t):t),Ki.getAdapter=OP.getAdapter,Ki.HttpStatusCode=uH,Ki.default=Ki;var vr=Ki;const dH=()=>{};function dg(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:dH};return t.promise=new Et((e,n)=>{t.resolve=i=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(i),t.value=i)},t.reject=i=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,n(i))}}),t}const ky=new Map,My=new Map,ec=new Map;let ri=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Oe=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const PP=new w3;let _o=PP.getResult(),vI=null;function Re(t){if(!vI){_o=PP.getResult();const e=function(l){if(l.engine.name==="Blink"&&l.browser.name!=="WeChat")return Oe.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Oe.CHROME;case"Safari":case"Mobile Safari":return Oe.SAFARI;case"Edge":return Oe.EDGE;case"Firefox":return Oe.FIREFOX;case"QQ":case"QQBrowser":return Oe.QQ;case"Opera":return Oe.OPERA;case"WeChat":return Oe.WECHAT;default:return l.browser.name||""}}(_o),n=kP(_o),i=function(l){return l.os.name==="Windows"?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||""}(_o),r=_o.os.version,a=kP(_o,!1),c=_o.device.type;if(!(e&&n&&i&&r))return{name:e,version:n,os:i,osVersion:r,browserVersion:a,deviceType:c};vI={name:e,version:n,os:i,osVersion:r,browserVersion:a,deviceType:c}}return vI}function kP(t){let e,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",n?e.split(".")[0]:e}function Uy(){return Re().os}function MP(){const t=Re();return"".concat(t.os," ").concat(t.osVersion)}function xy(){const t=Re();return!!(_o.engine.name==="WebKit"&&t.os===ri.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Oe.SAFARI||ur()&&t.name!==Oe.SAFARI)}function al(){return Re().name===Oe.CHROME}function Ni(){return Re().name===Oe.SAFARI}function UP(){return Re().name===Oe.EDGE}function Sn(){return Re().name===Oe.FIREFOX}function ur(){return Re().os===ri.IOS}function hg(t){const e=Re();return!(e.name!==Oe.CHROME||!e.osVersion)&&Number(e.version)>=t}function xP(t){const e=Re();return!(e.name!==Oe.CHROME||!e.osVersion)&&Number(e.version)<t}function CI(t,e,n){const i=Re();return!(i.name!==t||!i.osVersion)&&(n?Number(i.version)>=e&&Number(i.version)<=n:Number(i.version)===e)}function bI(t){const e=Re();return!(e.name!==Oe.EDGE||!e.osVersion)&&Number(e.version)>=t}function VP(t){const e=Re();return!(e.name!==Oe.SAFARI||!e.osVersion)&&Number(e.version)>=t}function BP(t,e,n){const i=Re();if(i.os!==ri.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t}function FP(t,e,n){const i=Re();if(i.name!==Oe.SAFARI||!i.osVersion||!i.browserVersion)return!1;const r=i.browserVersion.split(".");return n?e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t:e?Number(r[0])===t&&Number(r[1])<=e||Number(r[0])<t:Number(r[0])<=t}function AI(t){const e=Re();return!(e.name!==Oe.OPERA||!e.osVersion)&&Number(e.version)>=t}function jP(){const t=Re();if(t.os!==ri.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function Nf(){const t=Re();if(t.os!==ri.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function II(){const t=Re();if(t.os!==ri.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===16}function GP(){const t=Re();if(t.os!==ri.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function ya(){return Ni()&&navigator.maxTouchPoints>0}function HP(){return Re().name===Oe.WECHAT}function WP(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function wI(){const t=Uy();return function(){const{deviceType:e}=Re();return e==="mobile"||e==="tablet"}()||t===ri.ANDROID||t===ri.IOS||t===ri.HARMONY_OS}function ol(){const t=Re();return t.name!==Oe.EDGE&&t.name!==Oe.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Vy(){return Uy()===ri.ANDROID}function pg(){const t=Re();return Vy()&&(t.name===Oe.CHROME||t.name===Oe.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function KP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function It(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?KP(Object(n),!0).forEach(function(i){Xt(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):KP(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Xt(t,e,n){return(e=function(i){var r=function(a,c){if(typeof a!="object"||a===null)return a;var l=a[Symbol.toPrimitive];if(l!==void 0){var d=l.call(a,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(i);return typeof r=="symbol"?r:String(r)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}let P=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),Z=class extends Error{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(e),Xt(this,"code",void 0),Xt(this,"message",void 0),Xt(this,"data",void 0),Xt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return t==="error"&&(e||console).error(this.toString()),t==="warning"&&(e||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function cl(t,e){if(typeof t!="boolean")throw new Z(P.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function ei(t,e,n){if(!_t(n).call(n,t))throw new Z(P.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(n)))}function He(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<n||t>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(r){return typeof r=="number"&&r%1==0}(t))throw new Z(P.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function OI(t,e){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new Z(P.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));t.min!==void 0&&He(t.min,"".concat(e,".min"),0,1/0),t.max!==void 0&&He(t.max,"".concat(e,".max"),1,1/0),t.exact!==void 0&&He(t.exact,"".concat(e,".exact"),1,1/0),t.ideal!==void 0&&He(t.ideal,"".concat(e,".ideal"),1,1/0)}else He(t,e,1,1/0)}function Si(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new Z(P.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!YP(t,n,i,r))throw new Z(P.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(r?" ASCII characters only.":""))}function ll(t,e){if(!Array.isArray(t))throw new Z(P.INVALID_PARAMS,"".concat(e," should be an array"))}function Tn(t){return t==null}function YP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=n&&t.length>=e&&(!i||function(r){if(typeof r!="string")return!1;for(let a=0;a<r.length;a+=1){const c=r.charCodeAt(a);if(c<0||c>255)return!1}return!0}(t))}var fg=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(fg||{}),NI=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(NI||{});const qP=new class{constructor(){Xt(this,"_clientSize",null),Xt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Xt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Xt(this,"getStyle",t=>window.getComputedStyle(t,null)),Xt(this,"checkCssVisibleProperty",t=>{var e;let n=!0;const i=this.getStyle(t),{display:r,visibility:a,opacity:c,filter:l}=i;return(r==="none"||_t(e=["hidden","collapse"]).call(e,a)||Number(c)<.1)&&(n=!1),!!n&&(l&&l.split(" ").filter(d=>{var h;const p=d.split("(")[0];return _t(h=["brightness","blur","opacity"]).call(h,p)}).map(d=>{const[h,p]=d.split(/\(|\)/);return[h,Number(p.match(/^[0-9\.]+/))]}).forEach(d=>{const[h,p]=d;switch(h){case"brightness":(p<.1||p>3)&&(n=!1);break;case"blur":p>3&&(n=!1);break;case"opacity":p<.1&&(n=!1)}}),n)}),Xt(this,"checkPropertyUpToAllParentNodes",(t,e)=>{let n=!0,i=!0;const r=c=>e(c);let a=t;for(;a&&i;)r(a)||(n=!1,i=!1),a=a.parentElement,a||(i=!1);return n}),Xt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),Xt(this,"getSizeAboutClient",t=>{const{width:e,height:n,left:i,right:r,top:a,bottom:c}=t.getBoundingClientRect(),l=this.getClientWidth(),d=this.getClientHeight();return{width:e,height:n,left:i,right:r,top:a,bottom:c,clientWidth:l,clientHeight:d,clientMin:Math.min(l,d)}}),Xt(this,"checkActualSize",()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)}),Xt(this,"elementFromPoint",(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null),Xt(this,"checkCoverForAPoint",(t,e,n)=>{const i=this.elementFromPoint(t,e);return i!==null&&i!==n}),Xt(this,"getPointPositionList",()=>{const{width:t,height:e,left:n,top:i}=this._clientSize,r=t/6,a=e/6,c=[],l=10**6;for(let d=0;d<5;d++)for(let h=0;h<5;h++){const p=(n*l+(d===0?.1:d===4?(r*d*l-1e5)/l:r*d)*l)/l,m=(i*l+(h===0?.1:h===4?(a*h*l-1e5)/l:a*h)*l)/l;c.push({x:p,y:m})}return[...c]}),Xt(this,"checkElementCover",t=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,t)).filter(e=>!!e).length>6),Xt(this,"checkSizeIsVisible",(t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10)),Xt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:e,top:n,bottom:i,clientHeight:r,clientWidth:a,clientMin:c}=this._clientSize;let l,d,h,p;if(t<0)l=0;else{if(!(t<a))return!1;l=t}if(e<0)return!1;if(d=e<a?e:a,n<0)h=0;else{if(!(n<r))return!1;h=n}if(i<0)return!1;p=i<r?i:r;const m=d-l,S=p-h;return this.checkSizeIsVisible(m,S,c)}),Xt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),Xt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(fg.COVERED);{const e=this.checkActualSize(),n=this.checkSizeOfPartInClient();return e&&!n?this.returnHiddenResult(fg.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(fg.SIZE)}}return this.returnHiddenResult(fg.STYLE)}return this.returnHiddenResult(NI.UNMOUNTED)}return this.returnHiddenResult(NI.INVALID_HTML_ELEMENT)}),Xt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function DI(t){return new TextEncoder().encode(t)}const zP=function(t,e){const n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n},LI=async t=>function(e,n){let i="";return new Uint8Array(e).forEach(r=>{i+=r.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",DI(t)),16);let _n=class{constructor(){Xt(this,"_events",{}),Xt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(e=>e.listener):[]}on(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!1})}once(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!0})}off(t,e){if(!this._events[t])return;const n=this._events[t],i=this._indexOfListener(n,e);i!==-1&&n.splice(i,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const e=this._events[t].map(a=>a);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(let a=0;a<e.length;a+=1){const c=e[a];c.once&&this.off(t,c.listener),c.listener.apply(this,i||[])}}safeEmit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];[...this._events[t]||[]].forEach(r=>{r.once&&this.off(t,r.listener);try{r.listener.apply(this,n)}catch(a){console.error("safeEmit event:".concat(t," error ").concat(a==null?void 0:a.toString()))}})}_indexOfListener(t,e){let n=t.length;for(;n--;)if(t[n].listener===e)return n;return-1}},mg=null;function XP(){if(mg)return mg;if(window.electron)return mg=window.electron;if(!window.require)return null;try{return mg=window.require("electron"),mg}catch{return null}}let Wn=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),Rn=function(t){return t.TRACER="tracer",t}({});function JP(t){return He(t.timeout,"config.timeout",0,1e5),He(t.timeoutFactor,"config.timeoutFactor",0,100,!1),He(t.maxRetryCount,"config.maxRetryConfig",0,1/0),He(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let hH=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Pe=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function _g(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function QP(t){return Si(t.turnServerURL,"turnServerURL"),Si(t.username,"username"),Si(t.password,"password"),t.udpport&&He(t.udpport,"udpport",1,99999,!0),t.forceturn&&cl(t.forceturn,"forceturn"),t.security&&cl(t.security,"security"),t.tcpport&&He(t.tcpport,"tcpport",1,99999,!0),!0}function PI(t){return t.level!==void 0&&ei(t.level,"level",[1,2,3]),t.delay!==void 0&&He(t.delay,"delay",0,3e3,!0),!0}let ce=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),Di=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),ss=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),Df=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function Li(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return t.getListeners(e).length===0?Et.reject(new Z(P.UNEXPECTED_ERROR,"can not emit promise")):new Et((a,c)=>{t.emit(e,...i,a,c)})}function Xe(t,e){if(t.getListeners(e).length===0)return Et.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return Li(t,e,...i)}function Ts(t,e){if(t.getListeners(e).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return Eg(t,e,...i)}function Eg(t,e){let n=null,i=null;for(var r=arguments.length,a=new Array(r>2?r-2:0),c=2;c<r;c++)a[c-2]=arguments[c];if(t.emit(e,...a,l=>{n=l},l=>{i=l}),i!==null)throw i;if(n===null)throw new Z(P.UNEXPECTED_ERROR,"handler is not sync");return n}const xn=new class extends _n{set networkState(t){this.emit(Df.NETWORK_STATE_CHANGE,t,this._networkState),t===ss.ONLINE?this.emit(Df.ONLINE):t===ss.OFFLINE&&(this.onlineWaiter=new Et(e=>{this.once(Df.ONLINE,()=>{this.onlineWaiter=void 0,e(ss.ONLINE)})}),this.emit(Df.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===ss.ONLINE}constructor(){super(),Xt(this,"_moduleName","network-indicator"),Xt(this,"_networkState",ss.ONLINE),Xt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=ss.ONLINE}),window.addEventListener("offline",()=>{this.networkState=ss.OFFLINE})}};function By(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}function Lf(t){const e=[];return t.forEach(n=>{e.indexOf(n)===-1&&e.push(n)}),e}function Fy(t){Et!==void 0?Et.resolve().then(t):setTimeout(t,0)}function yn(t){return JSON.parse(JSON.stringify(t))}function nh(t){try{return yn(t)}catch{return t}}const ZP={};function Tu(t,e){ZP[e]||(ZP[e]=!0,t())}function ih(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i+=1)n[i]=e.charCodeAt(i);return n}function Ru(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}function $P(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(t);if(n.length>e)n=n.slice(0,e);else if(n.length<e){const i=new Uint8Array(e);i.set(n),n=i}return n}function tk(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=ds(e).call(e,(c,l)=>c+l.length,0),r=new Uint8Array(new ArrayBuffer(i));let a=0;return e.forEach(c=>{r.set(c,a),a+=c.length}),r}function nc(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function ek(t){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(n=>{e+=typeof n=="string"?nc(n):n.size}),e+138}function pH(t){const e=new Z(P.TIMEOUT,"timeout");return new Et((n,i)=>{window.setTimeout(()=>i(e),t)})}function Ti(t){return new Et(e=>{window.setTimeout(e,t)})}function Je(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,t).toLowerCase();return n.length===t?"".concat(e).concat(n):"".concat(e).concat(n)+Je(t-n.length,"")}function rh(){return Je(32,"").toUpperCase()}const jy=()=>{},nk=new class{constructor(){Xt(this,"fnMap",new Map)}throttleByKey(t,e,n,i){for(var r=arguments.length,a=new Array(r>4?r-4:0),c=4;c<r;c++)a[c-4]=arguments[c];if(this.fnMap.has(e)){const l=this.fnMap.get(e);if(l.threshold!==n){l.fn(...l.args),clearTimeout(l.timer);const d=window.setTimeout(()=>{const h=this.fnMap.get(e);h&&h.fn(...h.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:d,args:a,skipFn:i})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(e,It(It({},l),{},{fn:t,args:a,skipFn:i}))}else{const l=window.setTimeout(()=>{const d=this.fnMap.get(e);d&&d.fn(...d.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:l,args:a,skipFn:i})}}},ik=nk.throttleByKey.bind(nk);function rk(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function kI(t,e){if(!rk(t)||!rk(e)||Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const n=[...t];for(let i=0;i<e.length;i++)n[i]=kI(t[i],e[i]);return n}{const n=It({},t);for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(t,i)?n[i]=kI(t[i],e[i]):n[i]=e[i]);return n}}function sk(t,e){let n=[0];if(n=new Array(e).fill(0),t===0)return n;let i=0;for(;t>0&&(n[i]=255&t,t>>=8,i++,i!==e););return n}function MI(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function ak(t){const e="0123456789abcdef";function n(V){let W,K="";for(W=0;W<=3;W++)K+=e.charAt(V>>8*W+4&15)+e.charAt(V>>8*W&15);return K}function i(V,W){const K=(65535&V)+(65535&W);return(V>>16)+(W>>16)+(K>>16)<<16|65535&K}function r(V,W,K,G,Q,lt){return i(function(Tt,At){return Tt<<At|Tt>>>32-At}(i(i(W,V),i(G,lt)),Q),K)}function a(V,W,K,G,Q,lt,Tt){return r(W&K|~W&G,V,W,Q,lt,Tt)}function c(V,W,K,G,Q,lt,Tt){return r(W&G|K&~G,V,W,Q,lt,Tt)}function l(V,W,K,G,Q,lt,Tt){return r(W^K^G,V,W,Q,lt,Tt)}function d(V,W,K,G,Q,lt,Tt){return r(K^(W|~G),V,W,Q,lt,Tt)}const h=function(V){let W;const K=1+(V.length+8>>6),G=new Array(16*K);for(W=0;W<16*K;W++)G[W]=0;for(W=0;W<V.length;W++)G[W>>2]|=V.charCodeAt(W)<<W%4*8;return G[W>>2]|=128<<W%4*8,G[16*K-2]=8*V.length,G}(t);let p,m,S,R,O,A=1732584193,I=-271733879,D=-1732584194,L=271733878;for(p=0;p<h.length;p+=16)m=A,S=I,R=D,O=L,A=a(A,I,D,L,h[p+0],7,-680876936),L=a(L,A,I,D,h[p+1],12,-389564586),D=a(D,L,A,I,h[p+2],17,606105819),I=a(I,D,L,A,h[p+3],22,-1044525330),A=a(A,I,D,L,h[p+4],7,-176418897),L=a(L,A,I,D,h[p+5],12,1200080426),D=a(D,L,A,I,h[p+6],17,-1473231341),I=a(I,D,L,A,h[p+7],22,-45705983),A=a(A,I,D,L,h[p+8],7,1770035416),L=a(L,A,I,D,h[p+9],12,-1958414417),D=a(D,L,A,I,h[p+10],17,-42063),I=a(I,D,L,A,h[p+11],22,-1990404162),A=a(A,I,D,L,h[p+12],7,1804603682),L=a(L,A,I,D,h[p+13],12,-40341101),D=a(D,L,A,I,h[p+14],17,-1502002290),I=a(I,D,L,A,h[p+15],22,1236535329),A=c(A,I,D,L,h[p+1],5,-165796510),L=c(L,A,I,D,h[p+6],9,-1069501632),D=c(D,L,A,I,h[p+11],14,643717713),I=c(I,D,L,A,h[p+0],20,-373897302),A=c(A,I,D,L,h[p+5],5,-701558691),L=c(L,A,I,D,h[p+10],9,38016083),D=c(D,L,A,I,h[p+15],14,-660478335),I=c(I,D,L,A,h[p+4],20,-405537848),A=c(A,I,D,L,h[p+9],5,568446438),L=c(L,A,I,D,h[p+14],9,-1019803690),D=c(D,L,A,I,h[p+3],14,-187363961),I=c(I,D,L,A,h[p+8],20,1163531501),A=c(A,I,D,L,h[p+13],5,-1444681467),L=c(L,A,I,D,h[p+2],9,-51403784),D=c(D,L,A,I,h[p+7],14,1735328473),I=c(I,D,L,A,h[p+12],20,-1926607734),A=l(A,I,D,L,h[p+5],4,-378558),L=l(L,A,I,D,h[p+8],11,-2022574463),D=l(D,L,A,I,h[p+11],16,1839030562),I=l(I,D,L,A,h[p+14],23,-35309556),A=l(A,I,D,L,h[p+1],4,-1530992060),L=l(L,A,I,D,h[p+4],11,1272893353),D=l(D,L,A,I,h[p+7],16,-155497632),I=l(I,D,L,A,h[p+10],23,-1094730640),A=l(A,I,D,L,h[p+13],4,681279174),L=l(L,A,I,D,h[p+0],11,-358537222),D=l(D,L,A,I,h[p+3],16,-722521979),I=l(I,D,L,A,h[p+6],23,76029189),A=l(A,I,D,L,h[p+9],4,-640364487),L=l(L,A,I,D,h[p+12],11,-421815835),D=l(D,L,A,I,h[p+15],16,530742520),I=l(I,D,L,A,h[p+2],23,-995338651),A=d(A,I,D,L,h[p+0],6,-198630844),L=d(L,A,I,D,h[p+7],10,1126891415),D=d(D,L,A,I,h[p+14],15,-1416354905),I=d(I,D,L,A,h[p+5],21,-57434055),A=d(A,I,D,L,h[p+12],6,1700485571),L=d(L,A,I,D,h[p+3],10,-1894986606),D=d(D,L,A,I,h[p+10],15,-1051523),I=d(I,D,L,A,h[p+1],21,-2054922799),A=d(A,I,D,L,h[p+8],6,1873313359),L=d(L,A,I,D,h[p+15],10,-30611744),D=d(D,L,A,I,h[p+6],15,-1560198380),I=d(I,D,L,A,h[p+13],21,1309151649),A=d(A,I,D,L,h[p+4],6,-145523070),L=d(L,A,I,D,h[p+11],10,-1120210379),D=d(D,L,A,I,h[p+2],15,718787259),I=d(I,D,L,A,h[p+9],21,-343485551),A=i(A,m),I=i(I,S),D=i(D,R),L=i(L,O);return n(A)+n(I)+n(D)+n(L)}let fH=1,ok=console,xi=class{static setLogger(t){ok=t}constructor(t,e){Xt(this,"id",void 0),Xt(this,"lockingPromise",Et.resolve()),Xt(this,"locks",0),Xt(this,"name",""),Xt(this,"lockId",void 0),this.lockId=fH++,t&&(this.name=t),e&&(this.id=e),this.logger("created")}logger(t,e){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(e??"");ok.debug("".concat(n," ").concat(i))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,this.logger("locked",t);const n=new Et(r=>{e=()=>{this.locks-=1,this.logger("unlocked",t),r()}}),i=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function Pf(t,e){return function(n,i,r){const a=r.value;if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this[e];if(!c)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const l=await c.lock("From ".concat(t,".").concat(i));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await a.apply(this,h)}finally{l()}},r}}const Kn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function UI(t,e){const n=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,n)}function Eo(t,e,n,i){const r=Object.assign({},Kn,i);let a=r.timeout;const c=async()=>{await function(h){return new Et(p=>{window.setTimeout(p,h)})}(a),a*=r.timeoutFactor,a=Math.min(r.maxRetryTimeout,a)};let l=!1;const d=new Et(async(h,p)=>{e=e||(()=>!1),n=n||(()=>!0);for(let m=0;m<r.maxRetryCount;m+=1){if(l)return p(new Z(P.OPERATION_ABORTED));try{const S=await t();if(!e(S,m)||m+1===r.maxRetryCount)return h(S);await c()}catch(S){if(!n(S,m)||m+1===r.maxRetryCount)return p(S);await c()}}});return d.cancel=()=>l=!0,d}let Gy,ck=class{constructor(t){Xt(this,"input",[]),Xt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:ds(t=this.input).call(t,(e,n)=>e+n)/this.input.length}},Hy=0,xI=0;function VI(t,e,n,i){return new Et((r,a)=>{e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),Hy+=nc(e.data)):n&&(e.data.size?Hy+=e.data.size:e.data instanceof FormData?Hy+=ek(e.data):Hy+=nc(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,vr.request(e).then(c=>{typeof c.data=="string"?xI+=nc(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?xI+=c.data.byteLength:xI+=nc(JSON.stringify(c.data)),r(c.data)}).catch(c=>{vr.isCancel(c)?a(new Z(P.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?a(new Z(P.NETWORK_TIMEOUT,c.message)):c.response?a(new Z(P.NETWORK_RESPONSE_ERROR,c.response.status)):a(new Z(P.NETWORK_ERROR,c.message))})})}async function mH(t,e){const n=new Blob([e.data],{type:"buffer"});return await VI(t,It(It({},e),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const lk=()=>window.isSecureContext!==void 0;function va(t){if(Array.isArray(t))return t.map(n=>n);if(!uk(t))return t;const e={};for(const n in t){const i=t[n];uk(i)||Array.isArray(i)?e[n]=va(i):e[n]=i}return e}function uk(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let BI=class{constructor(t){Xt(this,"input",[]),Xt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const ic={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},gg={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:ic,remoteCandidate:ic},updateInterval:0},dk={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},hk={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},pk={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},fk={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let FI=class{constructor(t,e){Xt(this,"onFirstVideoReceived",void 0),Xt(this,"onFirstVideoDecoded",void 0),Xt(this,"onFirstAudioReceived",void 0),Xt(this,"onFirstVideoDecodedTimeout",void 0),Xt(this,"onFirstAudioDecoded",void 0),Xt(this,"onSelectedLocalCandidateChanged",void 0),Xt(this,"onSelectedRemoteCandidateChanged",void 0),Xt(this,"videoIsReady",!1),Xt(this,"videoIsReady2",{}),Xt(this,"pc",void 0),Xt(this,"options",void 0),Xt(this,"intervalTimer",void 0),Xt(this,"stats",va(gg)),Xt(this,"isFirstVideoReceived",{}),Xt(this,"isFirstVideoDecoded",{}),Xt(this,"isFirstAudioReceived",{}),Xt(this,"isFirstAudioDecoded",{}),Xt(this,"isFirstVideoDecodedTimeout",{}),Xt(this,"lossRateWindowStats",[]),this.pc=t,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Et(t=>{t({local:It({},ic),remote:It({},ic)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,e){this.videoIsReady2[t]=e}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const e=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,r=0,a=0,c=0;for(const l of n)t[l].forEach((d,h)=>{if(!this.lossRateWindowStats[e-1][l][h]||!this.lossRateWindowStats[0][l][h])return;const p=this.lossRateWindowStats[e-1][l][h].packets-this.lossRateWindowStats[0][l][h].packets,m=this.lossRateWindowStats[e-1][l][h].packetsLost-this.lossRateWindowStats[0][l][h].packetsLost;l==="videoSend"||l==="audioSend"?(i+=p,a+=m):(r+=p,c+=m),Number.isNaN(p)||Number.isNaN(p)?d.packetLostRate=0:d.packetLostRate=p<=0||m<=0?0:m/(p+m)});t.sendPacketLossRate=i<=0||a<=0?0:a/(i+a),t.recvPacketLossRate=r<=0||c<=0?0:c/(r+c)}},_H=class extends FI{constructor(){super(...arguments),Xt(this,"_stats",gg),Xt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),e=this.statsResponsesToObjects(t);this._stats=va(gg);const n=e.filter(r=>r.type==="ssrc");this.processSSRCStats(n);const i=e.find(r=>r.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(e=>{var n;const i=_t(n=e.id).call(n,"send");switch("".concat(e.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const r=va(hk);r.codec=e.googCodecName,r.adaptionChangeReason="none",e.googCpuLimitedResolution&&(r.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(r.adaptionChangeReason="bandwidth"),r.avgEncodeMs=Number(e.googAvgEncodeMs),r.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.firsCount=Number(e.googFirReceived),r.nacksCount=Number(e.googNacksReceived),r.plisCount=Number(e.googPlisReceived),r.frameCount=Number(e.framesEncoded),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(r),this._stats.rtt=r.rttMs;break}case"video_recv":{const r=va(dk),a=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(r.codec=e.googCodecName,r.targetDelayMs=Number(e.googTargetDelayMs),r.renderDelayMs=Number(e.googRenderDelayMs),r.currentDelayMs=Number(e.googCurrentDelayMs),r.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),r.decodeMs=Number(e.googDecodeMs),r.maxDecodeMs=Number(e.googMaxDecodeMs),r.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},r.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},r.decodeFrameRate=Number(e.googFrameRateDecoded),r.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},r.jitterBufferMs=Number(e.googJitterBufferMs),r.firsCount=Number(e.googFirsSent),r.nacksCount=Number(e.googNacksSent),r.plisCount=Number(e.googPlisSent),r.framesDecodeCount=Number(e.framesDecoded),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame.width,r.decodedFrame.height),this.isFirstVideoDecoded[r.ssrc]=!0),a){const c=a.stats,l=Date.now()-a.lts;r.framesDecodeFreezeTime=c.framesDecodeFreezeTime,r.framesDecodeInterval=c.framesDecodeInterval,r.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(a.lts=Date.now(),r.framesDecodeInterval=l,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<a.stats.framesDecodeCount&&(r.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:It({},r),lts:Date.now()}),this._stats.videoRecv.push(r);break}case"audio_recv":{const r=va(fk);r.codec=e.googCodecName,r.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,r.decodingCNG=Number(e.googDecodingCNG),r.decodingCTN=Number(e.googDecodingCTN),r.decodingCTSG=Number(e.googDecodingCTSG),r.decodingNormal=Number(e.googDecodingNormal),r.decodingPLC=Number(e.googDecodingPLC),r.decodingPLCCNG=Number(e.googDecodingPLCCNG),r.expandRate=Number(e.googExpandRate),r.accelerateRate=Number(e.googAccelerateRate),r.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),r.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),r.speechExpandRate=Number(e.googSpeechExpandRate),r.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),r.jitterBufferMs=Number(e.googJitterBufferMs),r.jitterMs=Number(e.googJitterReceived),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),r.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.decodingNormal>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),this._stats.audioRecv.push(r);break}case"audio_send":{const r=va(pk);r.codec=e.googCodecName,r.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,r.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),r.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),r.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),r.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.rtt=r.rttMs,this._stats.audioSend.push(r);break}}})}_getStats(){return new Et((t,e)=>{this.pc.getStats(t,e)})}statsResponsesToObjects(t){const e=[];return t.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(r=>{i[r]=n.stat(r)}),e.push(i)}),e}},Sg=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),Wy=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),jI=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),Rs=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var kf=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(kf||{});function Tg(t,e,n,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:kf.kNone;if(!e)return;const a=Number(e[n]);if(typeof a!="number")return;const c=Number(e[i]);if(typeof c!="number")return;if(!t)return c?a/c*r:void 0;const l=Number(t[n]);if(typeof l!="number")return;const d=Number(t[i]);if(typeof d!="number")return;const h=c-d;return h?(a-l)/h*r:void 0}let mk=class extends FI{constructor(){super(...arguments),Xt(this,"_stats",gg),Xt(this,"report",void 0),Xt(this,"lastDecodeVideoReceiverStats",new Map),Xt(this,"lastVideoFramesRecv",new Map),Xt(this,"lastVideoFramesSent",new Map),Xt(this,"lastVideoFramesDecode",new Map),Xt(this,"lastVideoFramesOutput",new Map),Xt(this,"lastVideoJBDelay",new Map),Xt(this,"lastAudioJBDelay",new Map),Xt(this,"mediaBytesSent",new Map),Xt(this,"mediaBytesRetransmit",new Map),Xt(this,"mediaBytesTargetEncode",new Map),Xt(this,"lastDecodeAudioReceiverStats",new Map),Xt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=va(gg),this.report.forEach(t=>{switch(t.type){case Rs.OUTBOUND:case Rs.INBOUND:{const e=t.mediaType||t.kind,n=!e&&"frameWidth"in t,i=!e&&!("frameWidth"in t);t.type===Rs.OUTBOUND?e==="audio"||i?this.processAudioOutboundStats(t):(e==="video"||n)&&this.processVideoOutboundStats(t):t.type===Rs.INBOUND&&(e==="audio"||i?this.processAudioInboundStats(t):(e==="video"||n)&&this.processVideoInboundStats(t));break}case Rs.TRANSPORT:{const e=this.report.get(t.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case Rs.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),e={local:It({},ic),remote:It({},ic)};return t.forEach(n=>{let i;if(n.type===Rs.TRANSPORT&&(i=t.get(n.selectedCandidatePairId)),n.type===Rs.CANDIDATE_PAIR&&n.selected&&(i=n),i){const r=(a,c)=>{a.type=c.type,a.id=c.id,c.address&&(a.address=c.address),c.candidateType&&(a.candidateType=c.candidateType),c.port&&(a.port=c.port),c.priority&&(a.priority=c.priority),c.protocol&&(a.protocol=c.protocol),c.relayProtocol&&(a.relayProtocol=c.relayProtocol)};if(i.localCandidateId){const a=t.get(i.localCandidateId);a&&r(e.local,a)}if(i.remoteCandidateId){const a=t.get(i.remoteCandidateId);a&&r(e.remote,a)}}}),e}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const e=this.report.get(t.localCandidateId);e&&this.processCandidateStats(e)}if(t.remoteCandidateId){const e=this.report.get(t.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(t){let e;t.type===Rs.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),t.type===Rs.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol),t.type===Rs.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(It({},e),It({},this.stats.selectedCandidatePair.localCandidate)),t.type===Rs.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(It({},e),It({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let e=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);e||(e=va(fk),this._stats.audioRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.packetsDiscarded=t.packetsDiscarded,e.bytes=t.bytesReceived,e.jitterMs=1e3*t.jitter,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived,e.totalProcessingDelay=t.totalProcessingDelay,e.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(e.ssrc);e.avgProcessingDelayMs=Tg(n,e,"totalProcessingDelay","jitterBufferEmittedCount",kf.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),e.receivedFrames||(e.receivedFrames=t.packetsReceived),e.droppedFrames||(e.droppedFrames=t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof t.concealedSamples=="number"&&(e.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(e.ssrc,It({},e))}processVideoInboundStats(t){let e=this._stats.videoRecv.find(c=>c.ssrc===t.ssrc);e||(e=va(dk),this._stats.videoRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.framesDecodeCount=t.framesDecoded,e.framesDroppedCount=t.framesDropped,e.totalInterFrameDelay=t.totalInterFrameDelay,e.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,e.totalFreezesDuration=t.totalFreezesDuration,e.totalProcessingDelay=t.totalProcessingDelay,e.packetsDiscarded=t.packetsDiscarded,e.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,e.totalAssemblyTime=t.totalAssemblyTime,e.keyFramesDecoded=t.keyFramesDecoded,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(e.ssrc),i=this.lastVideoFramesDecode.get(e.ssrc),r=this.lastVideoFramesOutput.get(e.ssrc),a=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){const c=e.decodedFrame?e.decodedFrame.width:0,l=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,c,l),this.isFirstVideoDecoded[e.ssrc]=!0}if(n){const c=n.stats,l=a-n.lts;e.framesDecodeFreezeTime=c.framesDecodeFreezeTime,e.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(n.lts=Date.now(),e.framesDecodeInterval=l,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<c.framesDecodeCount&&(e.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(n.stats.framesDecodeCount>t.framesDecoded?e.qpSumPerFrame=t.qpSum/t.framesDecoded:e.qpSumPerFrame=(t.qpSum-n.qpSum)/(t.framesDecoded-n.stats.framesDecodeCount))}t.totalDecodeTime&&(e.decodeMs=1e3*t.totalDecodeTime,e.avgDecodeMs=Tg(n==null?void 0:n.stats,e,"decodeMs","framesDecodeCount")),e.avgProcessingDelayMs=Tg(n==null?void 0:n.stats,e,"totalProcessingDelay","framesDecodeCount",kf.kMillisecondsFromSeconds),e.avgFramesAssembledFromMultiplePacketsMs=Tg(n==null?void 0:n.stats,e,"totalAssemblyTime","framesAssembledFromMultiplePackets",kf.kMillisecondsFromSeconds),e.avgInterFrameDelayMs=Tg(n==null?void 0:n.stats,e,"totalInterFrameDelay","framesDecodeCount",kf.kMillisecondsFromSeconds),i&&a-i.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-i.count)/((a-i.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:a,rate:e.decodeFrameRate})):i?e.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:a,rate:0}),e.framesDroppedCount&&t.framesReceived&&(r&&a-r.lts>=800?(e.outputFrameRate=Math.round((t.framesReceived-e.framesDroppedCount-r.count)/((a-r.lts)/1e3)),this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:a,rate:Math.max(e.outputFrameRate,0)})):r?e.outputFrameRate=r.rate:this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:a,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(e.framesRateFirefox=t.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:It({},e),lts:n?n.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let e=this._stats.videoSend.find(i=>i.ssrc===t.ssrc);e||(e=va(hk),this._stats.videoSend.push(e));const n=this.mediaBytesSent.get(t.ssrc);if(n)n.add(t.bytesSent);else{const i=new BI(10);i.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,i)}if(t.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(t.ssrc);if(i)i.add(t.retransmittedBytesSent);else{const r=new BI(10);r.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,r)}}if(t.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(t.ssrc);if(i)i.add(t.totalEncodedBytesTarget);else{const r=new BI(10);r.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,r)}}if(e.ssrc=t.ssrc,e.bytes=t.bytesSent,e.packets=t.packetsSent,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.frameCount=t.framesEncoded,e.adaptionChangeReason=t.qualityLimitationReason,e.scalabilityMode=t.scalabilityMode,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,e.hugeFramesSent=t.hugeFramesSent,e.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const i=this.lastEncoderMs.get(t.ssrc);if(!i||i.lastFrameCount>t.framesEncoded)e.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const r=t.framesEncoded-i.lastFrameCount,a=t.totalEncodeTime-i.lastEncoderTime;e.avgEncodeMs=1e3*a/r}}if(t.framesEncoded&&t.qpSum){const i=this.lastEncoderMs.get(t.ssrc);!i||i.lastFrameCount>t.framesEncoded?e.qpSumPerFrame=t.qpSum/t.framesEncoded:e.qpSumPerFrame=(t.qpSum-i.lastQpSum)/(t.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,e),this.processVideoTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const i=this.findRemoteStatsId(t.ssrc,Rs.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,e)}}processAudioOutboundStats(t){let e=this._stats.audioSend.find(n=>n.ssrc===t.ssrc);if(e||(e=va(pk),this._stats.audioSend.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsSent,e.bytes=t.bytesSent,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const n=this.findRemoteStatsId(t.ssrc,Rs.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,e)}}findRemoteStatsId(t,e){var n;const i=Array.from(gi(n=this.report).call(n)).find(r=>r.type===e&&r.ssrc===t);return i?i.id:null}processVideoMediaSource(t,e){const n=this.report.get(t);n&&n.width&&n.height&&n.framesPerSecond&&(e.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(t,e){const n=this.report.get(t);n&&(e.inputLevel=n.audioLevel)}processVideoTrackSenderStats(t,e,n){var i,r,a,c;const l=e?this.report.get(e):void 0,d=(i=l==null?void 0:l.framesSent)!==null&&i!==void 0?i:t.framesSent;if(typeof d!="number")return;let h=(r=l==null?void 0:l.frameWidth)!==null&&r!==void 0?r:t.frameWidth,p=(a=l==null?void 0:l.frameHeight)!==null&&a!==void 0?a:t.frameHeight,m=(c=l==null?void 0:l.framesPerSecond)!==null&&c!==void 0?c:t.framesPerSecond;if(typeof h=="number"&&typeof p=="number"||(h=0,p=0),m==null){const S=Date.now(),R=this.lastVideoFramesSent.get(n.ssrc);R&&S-R.lts>=800?(m=Math.round((d-R.count)/((S-R.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:d,lts:S,rate:m})):R?m=R.rate:this.lastVideoFramesSent.set(n.ssrc,{count:d,lts:S,rate:0})}n.sentFrame={width:h,height:p,frameRate:Math.max(0,m)}}processVideoTrackReceiverStats(t,e,n){var i,r,a,c,l;const d=e?this.report.get(e):void 0,h=(i=d==null?void 0:d.framesReceived)!==null&&i!==void 0?i:t.framesReceived,p=(r=d==null?void 0:d.frameWidth)!==null&&r!==void 0?r:t.frameWidth,m=(a=d==null?void 0:d.frameHeight)!==null&&a!==void 0?a:t.frameHeight,S=(c=d==null?void 0:d.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,R=(l=d==null?void 0:d.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount;if(typeof h=="number"){const O=this.lastVideoFramesRecv.get(n.ssrc),A=Date.now();n.framesReceivedCount=h;let I=0;O&&A-O.lts>=800?(I=Math.round((h-O.count)/((A-O.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:A,rate:I})):O?I=O.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:A,rate:0}),n.receivedFrame={width:p||0,height:m||0,frameRate:I||0},n.decodedFrame={width:p||0,height:m||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:p||0,height:m||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(S&&R){const O=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let A=O.jitterBufferMs;const I=R-O.jitterBufferEmittedCount;I>0&&(A=1e3*(S-O.jitterBufferDelay)/I),n.jitterBufferMs=A,n.currentDelayMs=Math.round(A),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:R,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(t,e,n){var i,r,a,c;const l=e?this.report.get(e):void 0,d=(i=(r=l==null?void 0:l.echoReturnLoss)!==null&&r!==void 0?r:t.echoReturnLoss)!==null&&i!==void 0?i:0,h=(a=(c=l==null?void 0:l.echoReturnLossEnhancement)!==null&&c!==void 0?c:t.echoReturnLossEnhancement)!==null&&a!==void 0?a:0;n.aecReturnLoss=d,n.aecReturnLossEnhancement=h}processAudioTrackReceiverStats(t,e,n){var i,r,a,c,l,d,h;const p=e?this.report.get(e):void 0,m=(i=p==null?void 0:p.removedSamplesForAcceleration)!==null&&i!==void 0?i:t.removedSamplesForAcceleration,S=(r=p==null?void 0:p.totalSamplesReceived)!==null&&r!==void 0?r:t.totalSamplesReceived,R=(a=p==null?void 0:p.jitterBufferDelay)!==null&&a!==void 0?a:t.jitterBufferDelay,O=(c=p==null?void 0:p.jitterBufferEmittedCount)!==null&&c!==void 0?c:t.jitterBufferEmittedCount,A=(l=p==null?void 0:p.audioLevel)!==null&&l!==void 0?l:t==null?void 0:t.audioLevel,I=(d=p==null?void 0:p.totalSamplesDuration)!==null&&d!==void 0?d:t==null?void 0:t.totalSamplesDuration,D=(h=p==null?void 0:p.concealedSamples)!==null&&h!==void 0?h:t.concealedSamples;if(typeof S=="number"&&(n.totalSamplesReceived=S),m&&S&&(n.accelerateRate=m/S),R&&O){const V=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let W=V.jitterBufferMs;const K=O-V.jitterBufferEmittedCount;K>0&&(W=1e3*(R-V.jitterBufferDelay)/K),n.jitterBufferMs=Math.round(W),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:R,jitterBufferEmittedCount:O,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=A;let L=1920;I&&S&&(L=S/I/50,n.receivedFrames=Math.round(S/L)),D&&(n.droppedFrames=Math.round(D/L))}processRemoteInboundStats(t,e){const n=this.report.get(t);n&&(e.packetsLost=n.packetsLost,n.roundTripTime&&(e.rttMs=1e3*n.roundTripTime),n.jitter&&(e.jitterMs=1e3*n.jitter),n.timestamp&&(e.timestamp=n.timestamp))}getCodecFromCodecStats(t){const e=this.report.get(t);if(!e)return"";const n=e.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let t=0,e=null,n=null;this.mediaBytesSent.forEach(r=>{t+=r.diffMean()}),this.mediaBytesRetransmit.forEach(r=>{e=e===null?r.diffMean():e+r.diffMean()}),this.mediaBytesTargetEncode.forEach(r=>{n=n===null?r.diffMean():n+r.diffMean()});const i=e!==null?t-e:t;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},EH=class extends FI{updateStats(){return Et.resolve()}};function GI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const a=function(){const c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null}();return a?a<76?new _H(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new mk(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):function(c){if(!window.RTCStatsReport)return!1;const l=c.getStats();return!!(l instanceof Et||function(d){return!!d&&(typeof d=="object"||typeof d=="function")&&typeof d.then=="function"}(l))}(t)?new mk(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new EH(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r})}const _k="websdk_ng_install_id";function HI(){try{if(U("INSTALL_ID"))return U("INSTALL_ID");let t=window.localStorage.getItem(_k);return t||(t=rh(),window.localStorage.setItem(_k,t)),Be("INSTALL_ID",t),t}catch{return}}const qs=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(e&&e[1]&&e[2]){const n=e[1],i=e[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.23.2"),WI=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let sh=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Pi=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),r=[];for(let l=0;l<6;l++)r.push("1");const a=r.join(""),c={};return c[t]=i,c[e]=a,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Pi;const Ky={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},KI={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},YI="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",qI={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},on=It(It(It({},qI),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:KI,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Ky),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function Be(t,e,n){var i,r,a;_t(i=Object.keys(on)).call(i,t)&&(!n&&_t(r=Object.keys(go)).call(r,t)||(on[t]=e,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS_METADATA"||e!==!0||(on.ENABLE_ENCODED_TRANSFORM=!0,t==="ENABLE_AUDIO_PTS_METADATA"&&(on.ENABLE_AUDIO_METADATA=!0)),t==="USE_NEW_NETWORK_CONFIG"&&e&&(a=!!e,on.USE_NEW_NETWORK_CONFIG=a,a&&(on.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],on.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],on.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],on.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],on.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",on.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",on.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&e&&(on.ENABLE_INSTANT_VIDEO=!0,on.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&e&&(on.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&e&&(on.NEW_TURN_MODE||(on.NEW_TURN_MODE=4))))}function U(t){return on[t]}WI||(on.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],on.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],on.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],on.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],on.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],on.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],on.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",on.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",on.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",on.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",on.AREAS=["NORTH_AMERICA","OVERSEA"]);let Ek=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const go={};var le=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(le||{});let Yy=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const gk=128,gH=96,Sk=1e3,Mf=10;let SH=0;var Tk=(()=>{var t={8:(i,r,a)=>{a.r(r),a.d(r,{Parser:()=>Tt,Printer:()=>Mn,parse:()=>ft,print:()=>Lt});const c=`
`,l="".concat("\r").concat(c),d=" ";let h;function p(at){return at>="0"&&at<="9"}function m(at){return at>="!"&&at<="~"}function S(at){return m(at)||at>=""&&at<=""}function R(at){return at==="!"||at>="#"&&at<="'"||at>="*"&&at<="+"||at>="-"&&at<="."||at>="0"&&at<="9"||at>="A"&&at<="Z"||at>="^"&&at<="~"}function O(at){return at>="1"&&at<="9"}function A(at){return at>="A"&&at<="Z"||at>="a"&&at<="z"}function I(at){return at==="d"||at==="h"||at==="m"||at==="s"}function D(at){return at>""&&at<"	"||at>"\v"&&at<"\f"||at>""&&at<""}function L(at){return A(at)||p(at)||at==="+"||at==="/"}function V(at){return p(at)||A(at)||at==="+"||at==="/"||at==="-"||at==="_"}function W(at){return A(at)||p(at)||at==="+"||at==="/"}function K(at,b){var x=Object.keys(at);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(at);b&&(F=F.filter(function(dt){return Object.getOwnPropertyDescriptor(at,dt).enumerable})),x.push.apply(x,F)}return x}function G(at){for(var b=1;b<arguments.length;b++){var x=arguments[b]!=null?arguments[b]:{};b%2?K(Object(x),!0).forEach(function(F){Q(at,F,x[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(at,Object.getOwnPropertyDescriptors(x)):K(Object(x)).forEach(function(F){Object.defineProperty(at,F,Object.getOwnPropertyDescriptor(x,F))})}return at}function Q(at,b,x){return b in at?Object.defineProperty(at,b,{value:x,enumerable:!0,configurable:!0,writable:!0}):at[b]=x,at}(function(at){at.VERSION="v",at.ORIGIN="o",at.SESSION_NAME="s",at.INFORMATION="i",at.URI="u",at.EMAIL="e",at.PHONE="p",at.CONNECTION="c",at.BANDWIDTH="b",at.TIME="t",at.REPEAT="r",at.ZONE_ADJUSTMENTS="z",at.KEY="k",at.ATTRIBUTE="a",at.MEDIA="m"})(h||(h={}));class lt{consumeText(b,x){let F=x;for(;F<b.length;){const dt=b[F];if(dt==="\0"||dt==="\r"||dt===c)break;F+=1}if(F-x==0)throw new Error("Invalid text, at ".concat(b));return F}consumeUnicastAddress(b,x,F){return this.consumeTill(b,x,d)}consumeOneOrMore(b,x,F){let dt=x;for(;F(b[dt]);)dt++;if(dt-x==0)throw new Error("Invalid rule at ".concat(x,"."));return dt}consumeSpace(b,x){if(b[x]===d)return x+1;throw new Error("Invalid space at ".concat(x,"."))}consumeIP4Address(b,x){let F=x;for(let dt=0;dt<4;dt++)if(F=this.consumeDecimalUChar(b,F),dt!==3){if(b[F]!==".")throw new Error("Invalid IP4 address.");F++}return F}consumeDecimalUChar(b,x){let F=x;for(let Qt=0;Qt<3&&p(b[F]);Qt++,F++);if(F-x==0)throw new Error("Invalid decimal uchar.");const dt=parseInt(b.slice(x,F));if(dt>=0&&dt<=255)return F;throw new Error("Invalid decimal uchar")}consumeIP6Address(b,x){let F=this.consumeHexpart(b,x);return b[F]===":"&&(F+=1,F=this.consumeIP4Address(b,F)),F}consumeHexpart(b,x){let F=x;if(b[F]===":"&&b[F+1]===":"){F+=2;try{F=this.consumeHexseq(b,F)}catch{}return F}if(F=this.consumeHexseq(b,F),b[F]===":"&&b[F+1]===":"){F+=2;try{F=this.consumeHexseq(b,F)}catch{}return F}return F}consumeHexseq(b,x){let F=x;for(;F=this.consumeHex4(b,F),b[F]===":"&&b[F+1]!==":";)F+=1;return F}consumeHex4(b,x){let F=0;for(;F<4;F++)if(!((dt=b[x+F])>="0"&&dt<="9"||dt>="a"&&dt<="f"||dt>="A"&&dt<="F")){if(F===0)throw new Error("Invalid hex 4");break}var dt;return x+F}consumeFQDN(b,x){let F=x;for(;p(b[F])||A(b[F])||b[F]==="-"||b[F]===".";)F+=1;if(F-x<4)throw new Error("Invalid FQDN");return F}consumeExtnAddr(b,x){return this.consumeOneOrMore(b,x,S)}consumeMulticastAddress(b,x,F){switch(F){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(b,x);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(b,x);default:try{return this.consumeFQDN(b,x)}catch{return this.consumeExtnAddr(b,x)}}}consumeIP6MulticastAddress(b,x){const F=this.consumeHexpart(b,x);return b[F]==="/"?this.consumeInteger(b,F+1):F}consumeIP4MulticastAddress(b,x){let F=x+3;const dt=b.slice(x,F),Qt=parseInt(dt);if(Qt<224||Qt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let We=0;We<3;We++){if(b[F]!==".")throw new Error("Invalid IP4 multicast address.");F+=1,F=this.consumeDecimalUChar(b,F)}return b[F]==="/"&&(F+=1),F=this.consumeTTL(b,F),b[F]==="/"&&(F=this.consumeInteger(b,F)),F}consumeInteger(b,x){if(!O(b[x]))throw new Error("Invalid integer.");for(x+=1;p(b[x]);)x+=1;return x}consumeTTL(b,x){if(b[x]==="0")return x+1;if(!O(b[x]))throw new Error("Invalid TTL.");x+=1;for(let F=0;F<2&&p(b[x]);F++)x+=1;return x}consumeToken(b,x){return this.consumeOneOrMore(b,x,R)}consumeTime(b,x){let F=x;if(b[F]==="0")return F+1;for(O(b[F])&&(F+=1);p(b[F]);)F++;if(F-x<10)throw new Error("Invalid time");return F}consumeAddress(b,x){return this.consumeTill(b,x,d)}consumeTypedTime(b,x){let F=x;return F=this.consumeOneOrMore(b,F,p),I(b[F])?F+1:F}consumeRepeatInterval(b,x){if(!O(b[x]))throw new Error("Invalid repeat interval");for(x+=1;p(b[x]);)x+=1;return I(b[x])&&(x+=1),x}consumePort(b,x){return this.consumeOneOrMore(b,x,p)}consume(b,x,F){for(let dt=0;dt<F.length;dt++){if(x+dt>=b.length)throw new Error("consume exceeding value length");if(b[x+dt]!==F[dt])throw new Error("consume ".concat(F," failed at ").concat(dt))}return x+F.length}consumeTill(b,x,F){let dt=x;for(;dt<b.length&&(typeof F!="string"||b[dt]!==F)&&(typeof F!="function"||!F(b[dt]));)dt++;return dt}}class Tt extends lt{constructor(){super(),Q(this,"records",[]),Q(this,"currentLine",0)}parse(b){const x=this.probeEOL(b);this.records=b.split(x).filter(Oh=>!!Ji(Oh).call(Oh)).map(this.parseLine),this.currentLine=0;const F=this.parseVersion(),dt=this.parseOrigin(),Qt=this.parseSessionName(),We=this.parseInformation(),oi=this.parseUri(),Hr=this.parseEmail(),Rl=this.parsePhone(),wh=this.parseConnection(),iS=this.parseBandWidth(),iC=this.parseTimeFields(),rC=this.parseKey(),ea=this.parseSessionAttribute(),Bu=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:F,origin:dt,sessionName:Qt,information:We,uri:oi,emails:Hr,phones:Rl,connection:wh,bandwidths:iS,timeFields:iC,key:rC,attributes:ea,mediaDescriptions:Bu}}getCurrentRecord(){const b=this.records[this.currentLine];if(!b)throw new Error("Record doesn't exit.");return b}probeEOL(b){for(let x=0;x<b.length;x++)if(b[x]===c)return b[x-1]==="\r"?l:c;throw new Error("Invalid newline character.")}parseLine(b,x){if(b.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const F=b[0];if(b[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:F,value:b.slice(2),line:x,cur:0}}parseSessionAttribute(){const b=new de;for(;this.currentLine<this.records.length;){const x=this.getCurrentRecord();if(x.type!==h.ATTRIBUTE)break;const F={attField:this.extractOneOrMore(x,dt=>R(dt)&&dt!==":"),_cur:0};x.value[x.cur]===":"&&(x.cur+=1,F.attValue=this.extractOneOrMore(x,D)),b.parse(F),this.currentLine++}return b.digest()}parseMediaAttributes(b){const x=new he(b);for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==h.ATTRIBUTE)break;const dt={attField:this.extractOneOrMore(F,Qt=>R(Qt)&&Qt!==":"),_cur:0};F.value[F.cur]===":"&&(F.cur+=1,dt.attValue=this.extractOneOrMore(F,D)),x.parse(dt),this.currentLine++}return x.digest()}parseKey(){const b=this.getCurrentRecord();if(b.type===h.KEY){if(b.value==="prompt"||b.value==="clear:"||b.value==="base64:"||b.value==="uri:")return b.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const b=this.getCurrentRecord();if(b.type===h.ZONE_ADJUSTMENTS){const x=[];for(;;)try{const F=this.extract(b,this.consumeTime);this.consumeSpaceForRecord(b);let dt=!1;b.value[b.cur]==="-"&&(dt=!0,b.cur+=1);const Qt=this.extract(b,this.consumeTypedTime);x.push({time:F,typedTime:Qt,back:dt})}catch{break}if(x.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,x}return[]}parseRepeat(){const b=[];for(;;){const x=this.getCurrentRecord();if(x.type!==h.REPEAT)break;{const F=this.extract(x,this.consumeRepeatInterval),dt=this.parseTypedTime(x);b.push({repeatInterval:F,typedTimes:dt}),this.currentLine++}}return b}parseTypedTime(b){const x=[];for(;;)try{this.consumeSpaceForRecord(b),x.push(this.extract(b,this.consumeTypedTime))}catch{break}if(x.length===0)throw new Error("Invalid typed time.");return x}parseTime(){const b=this.getCurrentRecord(),x=this.extract(b,this.consumeTime);this.consumeSpaceForRecord(b);const F=this.extract(b,this.consumeTime);return this.currentLine++,{startTime:x,stopTime:F}}parseBandWidth(){const b=[];for(;this.currentLine<this.records.length;){const x=this.getCurrentRecord();if(x.type!==h.BANDWIDTH)break;{const F=this.extractOneOrMore(x,R);if(x.value[x.cur]!==":")throw new Error("Invalid bandwidth field.");x.cur++;const dt=this.extractOneOrMore(x,p);b.push({bwtype:F,bandwidth:dt}),this.currentLine++}}return b}parseVersion(){const b=this.getCurrentRecord();if(b.type!==h.VERSION)throw new Error("first sdp record must be version");const x=b.value.slice(0,this.consumeOneOrMore(b.value,0,p));if(x.length!==b.value.length)throw new Error('invalid proto version, "v='.concat(b.value,'"'));return this.currentLine++,x}parseOrigin(){const b=this.getCurrentRecord();if(b.type!==h.ORIGIN)throw new Error("second line of sdp must be origin");const x=this.extractOneOrMore(b,S);this.consumeSpaceForRecord(b);const F=this.extractOneOrMore(b,p);this.consumeSpaceForRecord(b);const dt=this.extractOneOrMore(b,p);this.consumeSpaceForRecord(b);const Qt=this.extractOneOrMore(b,R);this.consumeSpaceForRecord(b);const We=this.extractOneOrMore(b,R);this.consumeSpaceForRecord(b);const oi=this.extract(b,this.consumeUnicastAddress);return this.currentLine++,{username:x,sessId:F,sessVersion:dt,nettype:Qt,addrtype:We,unicastAddress:oi}}parseSessionName(){const b=this.getCurrentRecord();if(b.type===h.SESSION_NAME){const x=this.extract(b,this.consumeText);return this.currentLine++,x}}parseInformation(){const b=this.getCurrentRecord();if(b.type!==h.INFORMATION)return;const x=this.extract(b,this.consumeText);return this.currentLine++,x}parseUri(){const b=this.getCurrentRecord();if(b.type===h.URI)return this.currentLine++,b.value}parseEmail(){const b=[];for(;;){const x=this.getCurrentRecord();if(x.type!==h.EMAIL)break;b.push(x.value),this.currentLine++}return b}parsePhone(){const b=[];for(;;){const x=this.getCurrentRecord();if(x.type!==h.PHONE)break;b.push(x.value),this.currentLine++}return b}parseConnection(){const b=this.getCurrentRecord();if(b.type===h.CONNECTION){const x=this.extractOneOrMore(b,R);this.consumeSpaceForRecord(b);const F=this.extractOneOrMore(b,R);this.consumeSpaceForRecord(b);const dt=this.extract(b,this.consumeAddress);return this.currentLine++,{nettype:x,addrtype:F,address:dt}}}parseMedia(){const b=this.getCurrentRecord(),x=this.extract(b,this.consumeToken);this.consumeSpaceForRecord(b);let F=this.extract(b,this.consumePort);b.value[b.cur]==="/"&&(b.cur+=1,F+=this.extract(b,this.consumeInteger)),this.consumeSpaceForRecord(b);const dt=[];for(dt.push(this.extract(b,this.consumeToken));b.value[b.cur]==="/";)b.cur+=1,dt.push(this.extract(b,this.consumeToken));if(dt.length===0)throw new Error("Invalid proto");const Qt=this.parseFmt(b);return this.currentLine++,{mediaType:x,port:F,protos:dt,fmts:Qt}}parseTimeFields(){const b=[];for(;this.getCurrentRecord().type===h.TIME;){const x=this.parseTime(),F=this.parseRepeat(),dt=this.parseZone();b.push({time:x,repeats:F,zones:dt})}return b}parseMediaDescription(){const b=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.MEDIA;){const x=this.parseMedia(),F=this.parseInformation(),dt=this.parseConnections(),Qt=this.parseBandWidth(),We=this.parseKey(),oi=this.parseMediaAttributes(x);b.push({media:x,information:F,connections:dt,bandwidths:Qt,key:We,attributes:oi})}return b}parseConnections(){const b=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.CONNECTION;)b.push(this.parseConnection());return b}parseFmt(b){const x=[];for(;;)try{this.consumeSpaceForRecord(b),x.push(this.extract(b,this.consumeToken))}catch{break}if(x.length===0)throw new Error("Invalid fmts");return x}extract(b,x){for(var F=arguments.length,dt=new Array(F>2?F-2:0),Qt=2;Qt<F;Qt++)dt[Qt-2]=arguments[Qt];const We=x.call(this,b.value,b.cur,...dt),oi=b.value.slice(b.cur,We);return b.cur=We,oi}extractOneOrMore(b,x){const F=this.consumeOneOrMore(b.value,b.cur,x),dt=b.value.slice(b.cur,F);return b.cur=F,dt}consumeSpaceForRecord(b){if(b.value[b.cur]!==d)throw new Error("Invalid space at ".concat(b.cur,"."));b.cur+=1}}class At extends lt{constructor(){super(...arguments),Q(this,"attributes",void 0),Q(this,"digested",!1)}extractOneOrMore(b,x,F){const dt=this.consumeOneOrMore(b.attValue,b._cur,x),Qt=b.attValue.slice(b._cur,dt),[We,oi]=F||[];if(typeof We=="number"&&Qt.length<We)throw new Error("error in length, should be more or equal than ".concat(We," characters."));if(typeof oi=="number"&&Qt.length>oi)throw new Error("error in length, should be less or equal than ".concat(oi," characters."));return b._cur=dt,Qt}consumeAttributeSpace(b){if(b.attValue[b._cur]!==d)throw new Error("Invalid space at ".concat(b._cur,"."));b._cur+=1}extract(b,x){if(!b.attValue)throw new Error("Nothing to extract from attValue.");for(var F=arguments.length,dt=new Array(F>2?F-2:0),Qt=2;Qt<F;Qt++)dt[Qt-2]=arguments[Qt];const We=x.call(this,b.attValue,b._cur,...dt),oi=b.attValue.slice(b._cur,We);return b._cur=We,oi}atEnd(b){if(!b.attValue)throw new Error;return b._cur>=b.attValue.length}peekChar(b){if(!b.attValue)throw new Error;return b.attValue[b._cur]}peek(b,x){if(!b.attValue)throw new Error;for(let F=0;F<x.length;F++)if(x[F]!==b.attValue[b._cur+F])return!1;return!0}parseIceUfrag(b){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(b,L,[4,256])}parseIcePwd(b){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(b,L,[22,256])}parseIceOptions(b){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const x=[];for(;!this.atEnd(b);){x.push(this.extractOneOrMore(b,L));try{this.consumeAttributeSpace(b)}catch(F){if(this.atEnd(b))break;throw F}}this.attributes.iceOptions=x}parseFingerprint(b){const x=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const F=this.extract(b,this.consumeTill);this.attributes.fingerprints.push({hashFunction:x,fingerprint:F})}parseExtmap(b){const x=this.extractOneOrMore(b,p);let F;this.peekChar(b)==="/"&&(this.extract(b,this.consume,"/"),F=this.extract(b,this.consumeToken)),this.consumeAttributeSpace(b);const dt=this.extract(b,this.consumeTill,d),Qt=G(G({entry:parseInt(x,10)},F&&{direction:F}),{},{extensionName:dt});this.peekChar(b)===d&&(this.consumeAttributeSpace(b),Qt.extensionAttributes=this.extract(b,this.consumeTill)),this.attributes.extmaps.push(Qt)}parseSetup(b){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const x=this.extract(b,this.consumeTill);if(x!=="active"&&x!=="passive"&&x!=="actpass"&&x!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=x}}class de extends At{constructor(){super(...arguments),Q(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(b){if(this.digested)throw new Error("already digested");try{switch(b.attField){case"group":this.parseGroup(b);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(b);break;case"ice-pwd":this.parseIcePwd(b);break;case"ice-options":this.parseIceOptions(b);break;case"fingerprint":this.parseFingerprint(b);break;case"setup":this.parseSetup(b);break;case"tls-id":this.parseTlsId(b);break;case"identity":this.parseIdentity(b);break;case"extmap":this.parseExtmap(b);break;case"msid-semantic":this.parseMsidSemantic(b);break;default:b.ignored=!0,this.attributes.unrecognized.push(b)}}catch(x){throw console.error("parsing session attribute ".concat(b.attField,' error, "a=').concat(b.attField,":").concat(b.attValue,'"')),x}if(!b.ignored&&b.attValue&&!this.atEnd(b))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(b){const x=this.extract(b,this.consumeToken),F=[];for(;!this.atEnd(b)&&this.peekChar(b)===d;)this.consumeAttributeSpace(b),F.push(this.extract(b,this.consumeToken));this.attributes.groups.push({semantic:x,identificationTag:F})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(b){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(b,V)}parseIdentity(b){const x=this.extractOneOrMore(b,W),F=[];for(;!this.atEnd(b)&&this.peekChar(b)===d;){this.consumeAttributeSpace(b);const dt=this.extract(b,this.consumeToken);this.extract(b,this.consume,"=");const Qt=this.extractOneOrMore(b,We=>We!==d&&D(We));F.push({name:dt,value:Qt})}this.attributes.identities.push({assertionValue:x,extensions:F})}parseMsidSemantic(b){this.peekChar(b)===d&&this.consumeAttributeSpace(b);const x={semantic:this.extract(b,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(b)}catch{break}if(this.peekChar(b)==="*"){this.extract(b,this.consume,"*"),x.applyForAll=!0;break}{const F=this.extract(b,this.consumeTill,d);x.identifierList.push(F)}}this.attributes.msidSemantic=x}}class he extends At{constructor(b){super(),Q(this,"attributes",void 0),b.protos.indexOf("RTP")!==-1||b.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(b){if(this.digested)throw new Error("already digested");try{switch(b.attField){case"extmap":this.parseExtmap(b);break;case"setup":this.parseSetup(b);break;case"ice-ufrag":this.parseIceUfrag(b);break;case"ice-pwd":this.parseIcePwd(b);break;case"ice-options":this.parseIceOptions(b);break;case"candidate":this.parseCandidate(b);break;case"remote-candidate":this.parseRemoteCandidate(b);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(b);break;case"rtpmap":this.parseRtpmap(b);break;case"ptime":this.parsePtime(b);break;case"maxptime":this.parseMaxPtime(b);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(b);break;case"ssrc":this.parseSSRC(b);break;case"fmtp":this.parseFmtp(b);break;case"rtcp-fb":this.parseRtcpFb(b);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(b);break;case"mid":this.parseMid(b);break;case"msid":this.parseMsid(b);break;case"imageattr":this.parseImageAttr(b);break;case"rid":this.parseRid(b);break;case"simulcast":this.parseSimulcast(b);break;case"sctp-port":this.parseSctpPort(b);break;case"max-message-size":this.parseMaxMessageSize(b);break;case"ssrc-group":this.parseSSRCGroup(b);break;default:b.ignored=!0,this.attributes.unrecognized.push(b)}}catch(x){throw console.error("parsing media attribute ".concat(b.attField,' error, "a=').concat(b.attField,":").concat(b.attValue,'"')),x}if(!b.ignored&&b.attValue&&!this.atEnd(b))throw new Error("attribute parsing error")}parseCandidate(b){const x=this.extractOneOrMore(b,L,[1,32]);this.consumeAttributeSpace(b);const F=this.extractOneOrMore(b,p,[1,5]);this.consumeAttributeSpace(b);const dt=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const Qt=this.extractOneOrMore(b,p,[1,10]);this.consumeAttributeSpace(b);const We=this.extract(b,this.consumeAddress);this.consumeAttributeSpace(b);const oi=this.extract(b,this.consumePort);this.consumeAttributeSpace(b),this.extract(b,this.consume,"typ"),this.consumeAttributeSpace(b);const Hr={foundation:x,componentId:F,transport:dt,priority:Qt,connectionAddress:We,port:oi,type:this.extract(b,this.consumeToken),extension:{}};for(this.peek(b," raddr")&&(this.extract(b,this.consume," raddr"),this.consumeAttributeSpace(b),Hr.relAddr=this.extract(b,this.consumeAddress)),this.peek(b," rport")&&(this.extract(b,this.consume," rport"),this.consumeAttributeSpace(b),Hr.relPort=this.extract(b,this.consumePort));this.peekChar(b)===d;){this.consumeAttributeSpace(b);const Rl=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b),Hr.extension[Rl]=this.extractOneOrMore(b,m)}this.attributes.candidates.push(Hr)}parseRemoteCandidate(b){const x=[];for(;;){const F=this.extractOneOrMore(b,p,[1,5]);this.consumeAttributeSpace(b);const dt=this.extract(b,this.consumeAddress);this.consumeAttributeSpace(b);const Qt=this.extract(b,this.consumePort);x.push({componentId:F,connectionAddress:dt,port:Qt});try{this.consumeAttributeSpace(b)}catch{break}}this.attributes.remoteCandidatesList.push(x)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(b){const x=this.extract(b,this.consumeToken);this.consumeAttributeSpace(b);const F=this.extract(b,this.consumeTill,"/");this.extract(b,this.consume,"/");const dt={encodingName:F,clockRate:this.extractOneOrMore(b,p)};this.atEnd(b)||this.peekChar(b)!=="/"||(this.extract(b,this.consume,"/"),dt.encodingParameters=parseInt(this.extract(b,this.consumeTill),10));const Qt=this.attributes.payloads.find(We=>We.payloadType===parseInt(x,10));Qt?Qt.rtpMap=dt:this.attributes.payloads.push({payloadType:parseInt(x,10),rtpMap:dt,rtcpFeedbacks:[]})}parsePtime(b){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(b,this.consumeTill)}parseMaxPtime(b){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(b,this.consumeTill)}parseDirection(b){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=b.attField}parseSSRC(b){const x=this.extractOneOrMore(b,p);this.consumeAttributeSpace(b);const F=this.extract(b,this.consumeTill,":");let dt;this.peekChar(b)===":"&&(this.extract(b,this.consume,":"),dt=this.extract(b,this.consumeTill));const Qt=this.attributes.ssrcs.find(We=>We.ssrcId===parseInt(x,10));Qt?Qt.attributes[F]=dt:this.attributes.ssrcs.push({ssrcId:parseInt(x,10),attributes:{[F]:dt}})}parseFmtp(b){const x=this.extract(b,this.consumeTill,d);this.consumeAttributeSpace(b);const F=this.extract(b,this.consumeTill),dt={};F.split(";").forEach(We=>{let[oi,Hr]=We.split("=");oi=Ji(oi).call(oi);const Rl=typeof Hr=="string"?Ji(Hr).call(Hr):null;typeof oi=="string"&&oi.length>0&&(dt[oi]=Rl)});const Qt=this.attributes.payloads.find(We=>We.payloadType===parseInt(x,10));Qt?Qt.fmtp={parameters:dt}:this.attributes.payloads.push({payloadType:parseInt(x,10),rtcpFeedbacks:[],fmtp:{parameters:dt}})}parseFmtParameters(b){const x={},F=this.extract(b,this.consumeTill,"=");b._cur++;const dt=this.extract(b,this.consumeTill,";");for(x[F]=dt;b.attValue[b._cur]===";";){const Qt=this.extract(b,this.consumeTill,"=");b._cur++;const We=this.extract(b,this.consumeTill,";");x[Qt]=We}return x}parseRtcpFb(b){let x="";x=this.peekChar(b)==="*"?this.extract(b,this.consume,"*"):this.extract(b,this.consumeTill,d),this.consumeAttributeSpace(b);const F=this.extract(b,this.consumeTill,d);let dt;if(F==="trr-int")dt={type:F,interval:this.extract(b,this.consumeTill)};else{const Qt={type:F};this.peekChar(b)===d&&(this.consumeAttributeSpace(b),Qt.parameter=this.extract(b,this.consumeToken),this.peekChar(b)===d&&(Qt.additional=this.extract(b,this.consumeTill))),dt=Qt}if(x==="*")this.attributes.rtcpFeedbackWildcards.push(dt);else{const Qt=this.attributes.payloads.find(We=>We.payloadType===parseInt(x,10));Qt?Qt.rtcpFeedbacks.push(dt):this.attributes.payloads.push({payloadType:parseInt(x,10),rtcpFeedbacks:[dt]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(b){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const x={port:this.extract(b,this.consumePort)};this.peekChar(b)===d&&(this.consumeAttributeSpace(b),x.netType=this.extractOneOrMore(b,R),this.consumeAttributeSpace(b),x.addressType=this.extractOneOrMore(b,R),this.consumeAttributeSpace(b),x.address=this.extract(b,this.consumeAddress)),this.attributes.rtcp=x}parseMsid(b){const x={id:this.extractOneOrMore(b,R,[1,64])};this.peekChar(b)===d&&(this.consumeAttributeSpace(b),x.appdata=this.extractOneOrMore(b,R,[1,64])),this.attributes.msids.push(x)}parseImageAttr(b){this.attributes.imageattr.push(b.attValue)}parseRid(b){const x=this.extractOneOrMore(b,dt=>A(dt)||p(dt)||dt==="_"||dt==="-");this.consumeAttributeSpace(b);const F={id:x,direction:this.extract(b,this.consumeToken),params:[]};if(this.peekChar(b)===d){if(this.consumeAttributeSpace(b),this.peek(b,"pt=")){this.extract(b,this.consume,"pt=");const dt=[];for(;;){const Qt=this.extract(b,this.consumeToken);dt.push(Qt);try{this.extract(b,this.consume,",")}catch{break}}F.payloads=dt,this.peekChar(b)===d&&this.extract(b,this.consume,d)}for(;;){const dt=this.extract(b,this.consumeToken);switch(dt){case"depend":{const Qt={type:dt,rids:this.extract(b,this.consume,"=").split(",")};F.params.push(Qt);break}default:{const Qt={type:dt};this.peekChar(b)==="="&&(this.extract(b,this.consume,"="),Qt.val=this.extract(b,this.consumeTill,";")),F.params.push(Qt)}}try{this.extract(b,this.consume,";")}catch{break}}}this.attributes.rids.push(F)}parseSimulcast(b){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=b.attValue,this.extract(b,this.consumeTill)}parseSctpPort(b){this.attributes.sctpPort=this.extractOneOrMore(b,p,[1,5])}parseMaxMessageSize(b){this.attributes.maxMessageSize=this.extractOneOrMore(b,p,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(b){this.attributes.mid=this.extract(b,this.consumeToken)}parseSSRCGroup(b){const x=this.extract(b,this.consumeToken),F=[];for(;;)try{this.consumeAttributeSpace(b);const dt=this.extract(b,this.consumeInteger);F.push(parseInt(dt,10))}catch{break}this.attributes.ssrcGroups.push({semantic:x,ssrcIds:F})}}function Ze(at,b,x){return b in at?Object.defineProperty(at,b,{value:x,enumerable:!0,configurable:!0,writable:!0}):at[b]=x,at}class Mn{constructor(){Ze(this,"eol",l)}print(b,x){let F="";return x&&(this.eol=x),F+=this.printVersion(b.version),F+=this.printOrigin(b.origin),F+=this.printSessionName(b.sessionName),F+=this.printInformation(b.information),F+=this.printUri(b.uri),F+=this.printEmail(b.emails),F+=this.printPhone(b.phones),F+=this.printConnection(b.connection),F+=this.printBandwidth(b.bandwidths),F+=this.printTimeFields(b.timeFields),F+=this.printKey(b.key),F+=this.printSessionAttributes(b.attributes),F+=this.printMediaDescription(b.mediaDescriptions),F}printVersion(b){return"v=".concat(b).concat(this.eol)}printOrigin(b){return"o=".concat(b.username," ").concat(b.sessId," ").concat(b.sessVersion," ").concat(b.nettype," ").concat(b.addrtype," ").concat(b.unicastAddress).concat(this.eol)}printSessionName(b){return b?"s=".concat(b).concat(this.eol):""}printInformation(b){return b?"i=".concat(b).concat(this.eol):""}printUri(b){return b?"u=".concat(b).concat(this.eol):""}printEmail(b){let x="";for(const F of b)x+="e=".concat(F).concat(this.eol);return x}printPhone(b){let x="";for(const F of b)x+="e=".concat(F).concat(this.eol);return x}printConnection(b){return b?"c=".concat(b.nettype," ").concat(b.addrtype," ").concat(b.address).concat(this.eol):""}printBandwidth(b){let x="";for(const F of b)x+="b=".concat(F.bwtype,":").concat(F.bandwidth).concat(this.eol);return x}printTimeFields(b){let x="";for(const F of b){x+="t=".concat(F.time.startTime," ").concat(F.time.startTime).concat(this.eol);for(const dt of F.repeats)x+="r=".concat(dt.repeatInterval," ").concat(dt.typedTimes.join(" ")).concat(this.eol);F.zoneAdjustments&&(x+="z=",x+="z=".concat(F.zoneAdjustments.map(dt=>"".concat(dt.time," ").concat(dt.back?"-":""," ").concat(dt.typedTime)).join(" ")).concat(this.eol),x+=this.eol)}return x}printKey(b){return b?"k=".concat(b).concat(this.eol):""}printAttributes(b){let x="";for(const F of b)x+="a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol);return x}printMediaDescription(b){let x="";for(const F of b)x+=this.printMedia(F.media),x+=this.printInformation(F.information),x+=this.printConnections(F.connections),x+=this.printBandwidth(F.bandwidths),x+=this.printKey(F.key),x+=this.printMediaAttributes(F);return x}printConnections(b){let x="";for(const F of b)x+=this.printConnection(F);return x}printMedia(b){return"m=".concat(b.mediaType," ").concat(b.port," ").concat(b.protos.join("/")," ").concat(b.fmts.join(" ")).concat(this.eol)}printSessionAttributes(b){return new Or(this.eol).print(b)}printMediaAttributes(b){return new it(this.eol).print(b)}}class An{constructor(b){Ze(this,"eol",void 0),this.eol=b}printIceUfrag(b){return b===void 0?"":"a=ice-ufrag:".concat(b).concat(this.eol)}printIcePwd(b){return b===void 0?"":"a=ice-pwd:".concat(b).concat(this.eol)}printIceOptions(b){return b===void 0?"":"a=ice-options:".concat(b.join(d)).concat(this.eol)}printFingerprints(b){return b.length>0?b.map(x=>"a=fingerprint:".concat(x.hashFunction).concat(d).concat(x.fingerprint)).join(this.eol)+this.eol:""}printExtmap(b){return b.map(x=>"a=extmap:".concat(x.entry).concat(x.direction?"/".concat(x.direction):"").concat(d).concat(x.extensionName).concat(x.extensionAttributes?"".concat(d).concat(x.extensionAttributes):"").concat(this.eol)).join("")}printSetup(b){return b===void 0?"":"a=setup:".concat(b).concat(this.eol)}printUnrecognized(b){return b.map(x=>"a=".concat(x.attField).concat(x.attValue?":".concat(x.attValue):"").concat(this.eol)).join("")}}class Or extends An{print(b){let x="";return x+=this.printGroups(b.groups),x+=this.printMsidSemantic(b.msidSemantic),x+=this.printIceLite(b.iceLite),x+=this.printIceUfrag(b.iceUfrag),x+=this.printIcePwd(b.icePwd),x+=this.printIceOptions(b.iceOptions),x+=this.printFingerprints(b.fingerprints),x+=this.printSetup(b.setup),x+=this.printTlsId(b.tlsId),x+=this.printIdentity(b.identities),x+=this.printExtmap(b.extmaps),x+=this.printUnrecognized(b.unrecognized),x}printGroups(b){let x="";return b.length>0&&(x+=b.map(F=>"a=group:".concat(F.semantic).concat(F.identificationTag.map(dt=>"".concat(d).concat(dt)).join("")).concat(this.eol)).join("")),x}printIceLite(b){return b===void 0?"":"a=ice-lite"+this.eol}printTlsId(b){return b?"a=tls-id:".concat(b).concat(this.eol):""}printIdentity(b){return b.length===0?"":b.map(x=>"a=identity:".concat(x.assertionValue).concat(x.extensions.map(F=>"".concat(d).concat(F.name).concat(F.value?"=".concat(F.value):"")))).join(this.eol)+this.eol}printMsidSemantic(b){if(!b)return"";let x="a=msid-semantic:".concat(b.semantic);return b.applyForAll?x+="".concat(d,"*"):b.identifierList.length>0&&(x+=b.identifierList.map(F=>"".concat(d).concat(F))),x+this.eol}}class it extends An{print(b){const x=b.attributes;let F="";return F+=this.printRTCP(x.rtcp),F+=this.printIceUfrag(x.iceUfrag),F+=this.printIcePwd(x.icePwd),F+=this.printIceOptions(x.iceOptions),F+=this.printCandidates(x.candidates),F+=this.printRemoteCandidatesList(x.remoteCandidatesList),F+=this.printEndOfCandidates(x.endOfCandidates),F+=this.printFingerprints(x.fingerprints),F+=this.printSetup(x.setup),F+=this.printMid(x.mid),F+=this.printExtmap(x.extmaps),F+=this.printRTPRelated(x),F+=this.printPtime(x.ptime),F+=this.printMaxPtime(x.maxPtime),F+=this.printDirection(x.direction),F+=this.printSSRCGroups(x.ssrcGroups),F+=this.printSSRC(x.ssrcs),F+=this.printRTCPMux(x.rtcpMux),F+=this.printRTCPMuxOnly(x.rtcpMuxOnly),F+=this.printRTCPRsize(x.rtcpRsize),F+=this.printMSId(x.msids),F+=this.printImageattr(x.imageattr),F+=this.printRid(x.rids),F+=this.printSimulcast(x.simulcast),F+=this.printSCTPPort(x.sctpPort),F+=this.printMaxMessageSize(x.maxMessageSize),F+=this.printUnrecognized(x.unrecognized),F}printCandidates(b){return b.map(x=>"a=candidate:".concat(x.foundation).concat(d).concat(x.componentId).concat(d).concat(x.transport).concat(d).concat(x.priority).concat(d).concat(x.connectionAddress).concat(d).concat(x.port).concat(d,"typ").concat(d).concat(x.type).concat(x.relAddr?"".concat(d,"raddr").concat(d).concat(x.relAddr):"").concat(x.relPort?"".concat(d,"rport").concat(d).concat(x.relPort):"").concat(Object.keys(x.extension).map(F=>"".concat(d).concat(F).concat(d).concat(x.extension[F])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(b){return b.map(x=>"a=remote-candidates:".concat(x.join(d)).concat(this.eol)).join("")}printEndOfCandidates(b){return b===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(b){if(!b.payloads)return"";const x=b.payloads;let F="";F+=b.rtcpFeedbackWildcards.map(dt=>this.printRTCPFeedback("*",dt)).join("");for(const dt of x)F+=this.printRtpMap(dt.payloadType,dt.rtpMap),F+=this.printFmtp(dt.payloadType,dt.fmtp),F+=dt.rtcpFeedbacks.map(Qt=>this.printRTCPFeedback(dt.payloadType,Qt)).join("");return F}printFmtp(b,x){if(!x)return"";const F=Object.keys(x.parameters);return F.length===1&&x.parameters[F[0]]===null?"a=fmtp:".concat(b).concat(d).concat(F[0]).concat(this.eol):"a=fmtp:".concat(b).concat(d).concat(Object.keys(x.parameters).map(dt=>"".concat(dt,"=").concat(x.parameters[dt])).join(";")).concat(this.eol)}printRtpMap(b,x){return x?"a=rtpmap:".concat(b).concat(d).concat(x.encodingName,"/").concat(x.clockRate).concat(x.encodingParameters?"/".concat(x.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(b,x){let F="a=rtcp-fb:".concat(b).concat(d),dt=x;return dt.type==="trr-int"?F+="ttr-int".concat(d).concat(dt.interval):(F+="".concat(dt.type),dt.parameter&&(F+="".concat(d).concat(dt.parameter),dt.additional&&(F+="".concat(d).concat(dt.additional)))),F+this.eol}printPtime(b){return b===void 0?"":"a=ptime:".concat(b).concat(this.eol)}printMaxPtime(b){return b===void 0?"":"a=maxptime:".concat(b).concat(this.eol)}printDirection(b){return b===void 0?"":"a=".concat(b).concat(this.eol)}printSSRC(b){return b.map(x=>Object.keys(x.attributes).map(F=>"a=ssrc:".concat(x.ssrcId.toString(10)).concat(d).concat(F).concat(x.attributes[F]?":".concat(x.attributes[F]):"").concat(this.eol)).join("")).join("")}printRTCPMux(b){return b===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(b){return b===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(b){return b===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(b){if(b===void 0)return"";let x="a=rtcp:".concat(b.port);return b.netType&&(x+="".concat(d).concat(b.netType)),b.addressType&&(x+="".concat(d).concat(b.addressType)),b.address&&(x+="".concat(d).concat(b.address)),x+this.eol}printMSId(b){return b.map(x=>"a=msid:".concat(x.id).concat(x.appdata?"".concat(d).concat(x.appdata):"").concat(this.eol)).join("")}printImageattr(b){return b.map(x=>"a=imageattr:".concat(x).concat(this.eol)).join("")}printRid(b){return b.map(x=>{let F="a=rid:".concat(x.id).concat(d).concat(x.direction);return x.payloads&&(F+="".concat(d,"pt=").concat(x.payloads.join(","))),x.params.length>0&&(F+="".concat(d).concat(x.params.map(dt=>dt.type==="depend"?"depend=".concat(dt.rids.join(",")):"".concat(dt.type,"=").concat(dt.val)).join(";"))),F+this.eol}).join("")}printSimulcast(b){return b===void 0?"":"a=simulcast:".concat(b).concat(this.eol)}printSCTPPort(b){return b===void 0?"":"a=sctp-port:".concat(b).concat(this.eol)}printMaxMessageSize(b){return b===void 0?"":"a=max-message-size:".concat(b).concat(this.eol)}printMid(b){return b===void 0?"":"a=mid:".concat(b).concat(this.eol)}printSSRCGroups(b){return b.map(x=>"a=ssrc-group:".concat(x.semantic).concat(x.ssrcIds.map(F=>"".concat(d).concat(F.toString(10))).join("")).concat(this.eol)).join("")}}function ft(at){return new Tt().parse(at)}function Lt(at,b){return new Mn().print(at,b)}}},e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}return n.d=(i,r)=>{for(var a in r)n.o(r,a)&&!n.o(i,a)&&Object.defineProperty(i,a,{enumerable:!0,get:r[a]})},n.o=(i,r)=>Object.prototype.hasOwnProperty.call(i,r),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function Br(t){return Tk.parse(t)}function yu(t,e){return Tk.print(t,e)}var TH=Sr("Array").keys,RH=ks,yH=di,vH=ht,CH=TH,zI=Array.prototype,bH={DOMTokenList:!0,NodeList:!0},AH=function(t){var e=t.keys;return t===zI||vH(zI,t)&&e===zI.keys||yH(bH,RH(t))?CH:e},ys=w(AH);function Rk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ie(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Rk(Object(n),!0).forEach(function(i){vn(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Rk(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function vn(t,e,n){return(e=function(i){var r=function(a,c){if(typeof a!="object"||a===null)return a;var l=a[Symbol.toPrimitive];if(l!==void 0){var d=l.call(a,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(i);return typeof r=="symbol"?r:String(r)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const yk=new class extends _n{constructor(){super(...arguments),vn(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:e}=t;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class IH{constructor(e){vn(this,"logger",void 0),vn(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function XI(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function vk(){const t=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const zs={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},qy=Date.now(),Rg=t=>{for(const e in zs)if(Object.prototype.hasOwnProperty.call(zs,e)&&zs[e]===t)return e;return"DEFAULT"},v=new class{constructor(){vn(this,"proxyServerURL",void 0),vn(this,"logLevel",zs.DEBUG),vn(this,"uploadState","collecting"),vn(this,"uploadLogWaitingList",[]),vn(this,"uploadLogUploadingList",[]),vn(this,"uploadErrorCount",0),vn(this,"currentLogID",0),vn(this,"url",void 0),vn(this,"extLog",(t,e)=>{this.appendLogToWaitingList(t,...e)})}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[zs.DEBUG].concat(e);this.log.apply(this,i)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[zs.INFO].concat(e);this.log.apply(this,i)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[zs.WARNING].concat(e);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[zs.ERROR].concat(e);this.log.apply(this,i)}upload(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[zs.DEBUG].concat(e);this.uploadLog.apply(this,i)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){Be("UPLOAD_LOG",!0)}disableLogUpload(){Be("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new IH(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-qy<100)return void setTimeout(()=>{this.log(...e)},Date.now()-qy);const i=Math.max(0,Math.min(4,e[0]));if(e[0]=XI()+" Agora-SDK [".concat(Rg(i),"]:"),this.appendLogToWaitingList(i,...e),i<this.logLevel)return;const r=XI()+" %cAgora-SDK [".concat(Rg(i),"]:");let a=[];if(!U("USE_NEW_LOG"))switch(i){case zs.DEBUG:a=[r,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,a);break;case zs.INFO:a=[r,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,a);break;case zs.WARNING:a=[r,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,a);break;case zs.ERROR:a=[r,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,a)}}uploadLog(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-qy<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-qy);const i=Math.max(0,Math.min(4,e[0]));e[0]=XI()+" Agora-SDK [".concat(Rg(i),"]:"),this.appendLogToWaitingList(i,...e)}appendLogToWaitingList(t){if(!U("UPLOAD_LOG"))return;for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=vk()+" Agora-SDK [".concat(Rg(t),"]:"):n[0]=vk()+" Agora-SDK [".concat(Rg(t),"]:");let r="";n.forEach(a=>{typeof a=="object"&&(a=JSON.stringify(a)),r+="".concat(a," ")}),this.uploadLogWaitingList.push({payload_str:r,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:qs,process_id:U("PROCESS_ID"),payload:JSON.stringify(t)};return Eo(async()=>{const n=await vr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(U("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(U("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:t.map(r=>r.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),yk.reportLogUploadError(i),!0},{timeout:U("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:U("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,U("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),U("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),U("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),U("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var Ck;function wH(t){return Si(t.reportId,"params.reportId",0,100,!1),Si(t.category,"params.category",0,100,!1),Si(t.event,"params.event",0,100,!1),Si(t.label,"params.label",0,100,!1),He(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(Ck={}).FREE="free",Ck.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const OH={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let si=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),un=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let NH=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function Wt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,n,i){const r=i.value;if(typeof r=="function"){const a=t.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);i.value=function(){for(var c,l=arguments.length,d=new Array(l),h=0;h<l;h++)d[h]=arguments[h];let p=d;if(t.argsMap)try{p=t.argsMap(this,...d)}catch(S){v.warning(S),p=[]}try{JSON.stringify(p)}catch{v.warning("arguments for method ".concat(a,".").concat(String(n)," not serializable for apiInvoke.")),p=[]}const m=(t.report||kt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((c=this.store)===null||c===void 0?void 0:c.clientId)||this._ID,name:"".concat(a,".").concat(String(n)),options:p,tag:Rn.TRACER,reportResult:t.reportResult},t.throttleTime);try{const S=r.apply(this,d);return S instanceof Et?S.then(R=>(m.onSuccess(t.reportResult&&R),R)).catch(R=>{throw m.onError(R),R}):(m.onSuccess(t.reportResult&&S),S)}catch(S){throw m.onError(S),S}}}return i}}const kt=new class{constructor(){vn(this,"baseInfoMap",new Map),vn(this,"proxyServer",void 0),vn(this,"eventUploadTimer",void 0),vn(this,"setSessionIdTimer",void 0),vn(this,"url",void 0),vn(this,"sids",new Set),vn(this,"backupUrl",void 0),vn(this,"_appId",void 0),vn(this,"_aid",0),vn(this,"keyEventUploadPendingItems",[]),vn(this,"normalEventUploadPendingItems",[]),vn(this,"apiInvokeUploadPendingItems",[]),vn(this,"apiInvokeCount",0),vn(this,"apiInvokeLoggedCount",0),vn(this,"ltsList",[]),vn(this,"lastSendNormalEventTime",Date.now()),vn(this,"customReportCounterTimer",void 0),vn(this,"customReportCount",0),vn(this,"extApiInvoke",async t=>{for(const e of t){const n=ie(ie({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Rn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),U("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),U("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,e=>{let[n,i]=e;return n+i}),16)||0}reportApiInvoke(t,e,n){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const i=Date.now();this.apiInvokeCount+=1;const r=this.apiInvokeCount,a=!!U("SHOW_REPORT_INVOKER_LOG"),c=!!U("SHOW_REPORT_USER_INVOKER_LOG"),l=a||c&&e.id;l&&(this.apiInvokeLoggedCount+=1);const d=this.apiInvokeLoggedCount;function h(R,O){if(l){let A="[apiInvoke-".concat(d,"]");e.id&&(A+="[".concat(e.id,"]")),e.name&&(A+="[".concat(e.name,"]")),v.info("".concat(A," ").concat(R),R==="start"?e.options:O||"")}}const p=()=>({tag:e.tag,invokeId:r,sid:t,name:e.name,apiInvokeTime:i,options:e.options,states:e.states||null});h("start");let m=!1;Ti(e.timeout).then(()=>{m||(this.sendApiInvoke(ie(ie({},p()),{},{error:P.API_INVOKE_TIMEOUT,success:!1})),h("timeout"))});const S=new Z(P.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:R=>{const O=()=>{if(m)throw S;return m=!0,this.sendApiInvoke(ie(ie({},p()),{},{success:!0},e.reportResult&&{result:R})),h("onSuccess"),R};return n?ik(O,e.name+"Success",n,()=>m=!0):O()},onError:R=>{const O=()=>{if(m)throw R;m=!0,this.sendApiInvoke(ie(ie({},p()),{},{success:!1,error:R})),h("onFailure",R.toString())};return n?ik(O,e.name+"Error",n,()=>m=!0):O()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const n=Date.now(),i=this.createBaseInfo(t,n);i.cname=e.cname;const r=Object.assign({},{willUploadConsoleLog:U("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:WI?"global":"oversea",areas:U("AREAS")&&U("AREAS").join(",")},e.extend),{stringUid:a,channelProfile:c,channelMode:l,isABTestSuccess:d,lsid:h,clientRole:p}=e,m=Date.now(),S=ie(ie({},i),{},{eventType:si.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,buildFormat:e.buildFormat,build:YI,lts:m,elapse:m-n,extend:JSON.stringify(r),mode:e.mode,process:U("PROCESS_ID"),appType:U("APP_TYPE"),success:!0,version:qs,stringUid:a,channelProfile:c,channelMode:l,isABTestSuccess:d,lsid:h,clientType:_t(R=window.navigator.userAgent).call(R,"AgoraWebView")?42:20,clientRole:p,serviceId:U("PROCESS_ID"),extensionID:U("PLUGIN_INFO").join(",")||""});var R;this.send({type:un.SESSION,data:S},!0)}joinChooseServer(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ie(ie({},i),{},{role:e.role,eventType:si.JOIN_CHOOSE_SERVER,lts:r,eventElapse:e.elapse||r-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:r-n.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3,corssRegionTagReq:e.corssRegionTagReq||void 0,corssRegionTagRes:e.corssRegionTagRes||void 0});this.send({type:un.JOIN_CHOOSE_SERVER,data:a},!0)}reqUserAccount(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ie(ie({},i),{},{eventType:si.REQ_USER_ACCOUNT,lts:r,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:e.elapse||r-n.startTime,eventElapse:r-e.lts,extend:JSON.stringify(e.extend)});this.send({type:un.REQ_USER_ACCOUNT,data:a},!0)}joinGateway(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info;e.vid&&(i.vid=e.vid),i.uid=e.uid,i.cid=e.cid;const r=Date.now(),{firstSuccess:a,avoidJoinStartTime:c,addr:l,isProxy:d}=e,h=r-(a&&c?c:n.startTime),p=ie(ie({},i),{},{eventType:si.JOIN_GATEWAY,lts:r,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,errorMsg:e.errorMsg||"",elapse:h,eventElapse:r-e.lts,firstSuccess:a,signalChannel:e.signalChannel,preload:e.preload?1:0,installId:HI(),isABTestSuccess:e.isABTestSuccess?1:0}),m=p.success?1:0;if(e.succ&&(n.lastJoinSuccessTime=r),a)this.send({type:un.JOIN_GATEWAY,data:p},!0);else{let S;if(l)if(d){const O=l.match(/h=(\d{1,3}-){3}\d{1,3}/g),A=l.match(/p=[0-9]{1,6}/g);S={isSuccess:m,gatewayIp:O&&O.length?O[0].split("=")[1].replace(/-/g,"."):"",port:A&&A.length?A[0].split("=")[1]:"",isProxy:d?1:0}}else{const O=l.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),A=l.match(/(:|p=)[0-9]{1,6}/g);S={isSuccess:m,gatewayIp:O&&O.length?O[0].split("//")[1].replace(/-/g,"."):"",port:A&&A.length?A[0].split(/:|p=/g)[1]:"",isProxy:d?1:0}}else S={isSuccess:m,gatewayIp:"",port:"",isProxy:d?1:0};delete p.success,delete p.eventType,delete p.firstSuccess,p.vid=Number(p.vid);const R=Object.assign({},p,S,{eventType:si.REJOIN_GATEWAY});this.send({type:un.RE_JOIN_GATEWAY,data:R},!0)}}joinChannelTimeout(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=Date.now(),r=ie(ie({},n.info),{},{lts:i,timeout:e,elapse:i-n.startTime});this.send({type:un.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ie(ie({},i),{},{eventType:si.PUBLISH,lts:r,eventElapse:e.eventElapse,elapse:r-n.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:un.PUBLISH,data:a},!0)}subscribe(t,e,n){const i=this.baseInfoMap.get(t);if(!i)return;const r=i.info,a=Date.now(),c=ie(ie({},r),{},{eventType:si.SUBSCRIBE,lts:a,eventElapse:e.eventElapse,elapse:a-i.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid,preSsrc:e.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?c.peerSuid=e.peerid:c.peer=e.peerid,this.send({type:un.SUBSCRIBE,data:c},!0)}wsCompressorInit(t){var e;const n=[...ys(e=this.baseInfoMap).call(e)],i=n.length?n[0]:"UnableToGetSid",r=this.baseInfoMap.get(i);if(!r)return;const a=r.info,c=Date.now(),l=ie(ie({},a),{},{eventType:si.WS_COMPRESSOR_INIT,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,status:t.status?1:2});this.send({type:un.WS_COMPRESSOR_INIT,data:l},!0)}firstRemoteVideoDecode(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const a=r.info,c=Date.now(),l=ie(ie(ie({},a),i),{},{elapse:c-r.startTime,eventType:e,lts:c,firstDecodeFrame:Math.max((i.firstFrame||c)-r.startTime,0),apEnd:Math.max(i.apEnd-r.startTime,0),apStart:Math.max(i.apStart-r.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-r.startTime,0),joinGwStart:Math.max(i.joinGwStart-r.startTime,0),pcEnd:Math.max(i.pcEnd-r.startTime,0),pcStart:Math.max(i.pcStart-r.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-r.startTime,0),subscriberStart:Math.max(i.subscriberStart-r.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-r.startTime,0)});this.send({type:n,data:l},!0)}firstRemoteFrame(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const a=r.info,c=Date.now(),l=ie(ie(ie({},a),i),{},{elapse:c-r.startTime,eventType:e,lts:c});this.send({type:n,data:l},!0)}abTest(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ie(ie(ie({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:si.AB_TEST,lts:r});this.send({type:un.AB_TEST,data:a},!0)}pcStats(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ie(ie(ie({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:si.PC_STATS,lts:r,preallocation:e.preallocation?1:0});this.send({type:un.PC_STATS,data:a},!0)}updateRemoteRTPCapabilities(t,e){if(t){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ie(ie(ie({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:si.UPDATE_REMOTE_RTPCAPABILITIES,lts:r});this.send({type:un.UPDATE_REMOTE_RTPCAPABILITIES,data:a},!0)}}onGatewayStream(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const a=r.info,c=Date.now(),l=ie(ie(ie({},a),i),{},{eventType:e,lts:c});this.send({type:n,data:l},!0)}streamSwitch(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ie(ie({},i),{},{eventType:si.STREAM_SWITCH,lts:r,isDual:e.isdual,elapse:r-n.startTime,success:e.succ});this.send({type:un.STREAM_SWITCH,data:a},!0)}requestProxyAppCenter(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ie(ie({},i),{},{eventType:si.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:un.REQUEST_PROXY_APPCENTER,data:a},!0)}requestProxyWorkerManager(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ie(ie({},i),{},{eventType:si.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:un.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}setProxyServer(t){this.proxyServer=t,t?v.debug("reportProxyServerurl: ".concat(t)):v.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ie(ie({},i),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:r,elapse:r-n.startTime,joinChannelSuccessElapse:r-(n.lastJoinSuccessTime||r),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:un.PEER_PUBLISH_STATUS,data:a},!0)}workerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now();(function(a,c,l){const d=a[c];if(!d||typeof d!="string")return[a];a[c]="";const h=nc(JSON.stringify(a));let p=0;const m=[];let S=0;for(let R=0;R<d.length;R++)S+=d.charCodeAt(R)<=127?1:3,S<=l-h||(m[m.length]=It(It({},a),{},{[c]:d.substring(p,R)}),p=R,S=d.charCodeAt(R)<=127?1:3);return p!==d.length-1&&(m[m.length]=It(It({},a),{},{[c]:d.substring(p)})),m})(ie(ie(ie({},i),e),{},{elapse:r-n.startTime,lts:r,productType:"WebRTC"}),"payload",1300).forEach(a=>this.send({type:un.WORKER_EVENT,data:a},!0))}apworkerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ie(ie(ie({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:un.AP_WORKER_EVENT,data:a},!0)}joinWebProxyAP(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ie(ie(ie({},i),e),{},{elapse:r-n.startTime,lts:r,extend:e.extend||void 0});this.send({type:un.JOIN_WEB_PROXY_AP,data:a},!0)}WebSocketQuit(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),a=ie(ie(ie({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:un.WEBSOCKET_QUIT,data:a},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>U("CUSTOM_REPORT_LIMIT"))throw new Z(P.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=e.map(r=>({type:un.USER_ANALYTICS,data:ie(ie({sid:t},r),{},{lts:n})}));try{U("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(r){throw v.error("send custom report message failed",r.toString()),new Z(P.CUSTOM_REPORT_SEND_FAILED,r.message)}}sendApiInvoke(t){const e=U("NOT_REPORT_EVENT");if(t.tag&&_t(e)&&_t(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const n=this.baseInfoMap.get(t.sid);if(!n)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:i,uid:r,cid:a}=n.info;let c;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof Z){const{code:d,message:h}=t.error;c=d||h||t.error.toString()}else c=t.error.toString();const l={invokeId:t.invokeId,sid:t.sid,cname:i,cid:a,uid:r,lts:t.lts,success:t.success,elapse:t.lts-n.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?c:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:un.API_INVOKE,data:l},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const e=Array.from(this.sids).find(n=>n!==null);e&&t.forEach(n=>{n&&(n.sid=e,this.sendApiInvoke(Object.assign({},n)))}),t.length=0}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>U("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const n=[],i=[];for(;t.length;){const a=t.shift();n.length<20?n.push(a):i.push(a)}t.push(...i);for(const a of[...n]){var r;this.ltsList.indexOf(a.data.lts)!==-1?(a.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(a.data.lts)):(this.ltsList.push(a.data.lts),tg(r=this.ltsList).call(r,(c,l)=>c-l))}return e||(this.lastSendNormalEventTime=Date.now()),U("ENABLE_EVENT_REPORT")&&n.length&&(U("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((a=>c=>{U("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(a):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(a),this.normalEventUploadPendingItems.length>U("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-U("NORMAL_EVENT_QUEUE_CAPACITY")),v.warning("report: drop normal events"))))})(n)),t}async postDataToStatsCollector2(t){xn.networkState===ss.OFFLINE&&await Et.race([xn.onlineWaiter,Ti(2*Kn.maxRetryTimeout)]);const e=r=>{let a=new Uint8Array;return r.forEach(c=>{const l=DI(JSON.stringify(c.data)),d=new ArrayBuffer(5),h=(m=>{let S=0;return Object.entries(un).forEach(R=>{let[O,A]=R;A===m.type&&(S=NH[O])}),S})(c),p=new DataView(d);p.setUint16(0,l.byteLength,!0),p.setUint8(2,255&h),p.setUint8(3,h>>>8&255),p.setUint8(4,h>>>16&255),a=zP(a,new Uint8Array(d)),a=zP(a,l)}),a},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(U("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(U("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let r=0;r<2;r+=1){r===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(U("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(U("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await VI(i,{timeout:1e4,data:e(t),headers:ie(ie({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(a){if(r===1)throw a;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(l=>{const d=l&&l.data.sid&&this.baseInfoMap.get(l.data.sid);return d&&d.info.vid&&+d.info.vid||0})(t[0]),i=n?void 0:this._aid,r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(l=>JSON.stringify(l)),vid:n,aid:i};xn.networkState===ss.OFFLINE&&await Et.race([xn.onlineWaiter,Ti(2*Kn.maxRetryTimeout)]);const a=e?"/events/proto-raws":"/events/messages";let c=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(U("EVENT_REPORT_DOMAIN"),"&p=").concat(U("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat(U("EVENT_REPORT_DOMAIN"),":").concat(U("STATS_COLLECTOR_PORT")).concat(a));for(let l=0;l<2;l+=1){l===1&&(c=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(U("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(U("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat(U("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(U("STATS_COLLECTOR_PORT")).concat(a)));try{e?await mH(c,{timeout:1e4,data:r}):await VI(c,{timeout:1e4,data:r})}catch(d){if(l===1)throw d;continue}return}}createBaseInfo(t,e){const n=Object.assign({},OH);return n.sid=t,this.baseInfoMap.set(t,{info:n,startTime:e}),n}reportResourceTiming(t,e){const n=performance.getEntriesByName(t),i=n[n.length-1];i&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:i,tag:Rn.TRACER}).onSuccess()}};yk.on("REPORT_LOG_UPLOAD",t=>{t.networkState=xn.networkState,kt.reportApiInvoke(null,{name:"logUploadError",options:t,tag:Rn.TRACER}).onSuccess("logUploadError")});class J extends Z{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),vn(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,v)}throw(){super.throw(v)}}const Ri={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Ae(){return Ri}function bk(){return"setSinkId"in HTMLAudioElement.prototype&&(!U("RESTRICTION_SET_PLAYBACK_DEVICE")||(al()||UP())&&!wI())}function Ak(){return!Ri.supportUnifiedPlan||U("CHROME_FORCE_PLAN_B")&&ol()}let yi=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Uf(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function ye(t,e,n,i,r){return{width:t,height:e,frameRate:n,bitrateMin:i,bitrateMax:r}}function Ca(t,e,n,i,r){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:i,bitrateMax:r}}function JI(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}const DH={"90p":ye(160,90),"90p_1":ye(160,90),"120p":ye(160,120,15,30,65),"120p_1":ye(160,120,15,30,65),"120p_3":ye(120,120,15,30,50),"120p_4":ye(212,120),"180p":ye(320,180,15,30,140),"180p_1":ye(320,180,15,30,140),"180p_3":ye(180,180,15,30,100),"180p_4":ye(240,180,15,30,120),"240p":ye(320,240,15,40,200),"240p_1":ye(320,240,15,40,200),"240p_3":ye(240,240,15,40,140),"240p_4":ye(424,240,15,40,220),"360p":ye(640,360,15,80,400),"360p_1":ye(640,360,15,80,400),"360p_3":ye(360,360,15,80,260),"360p_4":ye(640,360,30,80,600),"360p_6":ye(360,360,30,80,400),"360p_7":ye(480,360,15,80,320),"360p_8":ye(480,360,30,80,490),"360p_9":ye(640,360,15,80,800),"360p_10":ye(640,360,24,80,800),"360p_11":ye(640,360,24,80,1e3),"480p":ye(640,480,15,100,500),"480p_1":ye(640,480,15,100,500),"480p_2":ye(640,480,30,100,1e3),"480p_3":ye(480,480,15,100,400),"480p_4":ye(640,480,30,100,750),"480p_6":ye(480,480,30,100,600),"480p_8":ye(848,480,15,100,610),"480p_9":ye(848,480,30,100,930),"480p_10":ye(640,480,10,100,400),"720p":ye(1280,720,15,120,1130),"720p_auto":ye(1280,720,30,900,3e3),"720p_1":ye(1280,720,15,120,1130),"720p_2":ye(1280,720,30,120,2e3),"720p_3":ye(1280,720,30,120,1710),"720p_5":ye(960,720,15,120,910),"720p_6":ye(960,720,30,120,1380),"1080p":ye(1920,1080,15,120,2080),"1080p_1":ye(1920,1080,15,120,2080),"1080p_2":ye(1920,1080,30,120,3e3),"1080p_3":ye(1920,1080,30,120,3150),"1080p_5":ye(1920,1080,60,120,4780),"1440p":ye(2560,1440,30,120,4850),"1440p_1":ye(2560,1440,30,120,4850),"1440p_2":ye(2560,1440,60,120,7350),"4k":ye(3840,2160,30,120,8910),"4k_1":ye(3840,2160,30,120,8910),"4k_3":ye(3840,2160,60,120,13500)},LH={"480p":Ca(640,480,5),"480p_1":Ca(640,480,5),"480p_2":Ca(640,480,30),"480p_3":Ca(640,480,15),"720p":Ca(1280,720,5),"720p_auto":ye(1280,720,30,900,3e3),"720p_1":Ca(1280,720,5),"720p_2":Ca(1280,720,30),"720p_3":Ca(1280,720,15),"1080p":Ca(1920,1080,5),"1080p_1":Ca(1920,1080,5),"1080p_2":Ca(1920,1080,30),"1080p_3":Ca(1920,1080,15)},PH={"1SL1TL":JI(1,1),"3SL3TL":JI(3,3),"2SL3TL":JI(2,3)};function rc(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},DH[t]):t}function QI(t){return typeof t=="string"?Object.assign({},LH[t]):t}function zy(t){return typeof t=="string"?Object.assign({},PH[t]):t}const kH={speech_low_quality:Uf(16e3,!1),speech_standard:Uf(32e3,!1,18),music_standard:Uf(48e3,!1),standard_stereo:Uf(48e3,!0,56),high_quality:Uf(48e3,!1,128),high_quality_stereo:Uf(48e3,!0,192)};function Xy(t){return typeof t=="string"?Object.assign({},kH[t]):t}const xf=[];function Ik(t){return ei(t,"mediaSource",["screen","window","application"]),!0}let Ot=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),Qe=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),Vf=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),MH=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),UH=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),ah=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),Bf=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),Ff=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),jf=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),vs=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const ZI={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},$I={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},wk={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},xH={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Ok={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let dr=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Cs=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),yg=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),oh=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),Qi=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),sc=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const tw={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Jy=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function Nk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function dn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Nk(Object(n),!0).forEach(function(i){X(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Nk(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function X(t,e,n){return(e=function(i){var r=function(a,c){if(typeof a!="object"||a===null)return a;var l=a[Symbol.toPrimitive];if(l!==void 0){var d=l.call(a,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(i);return typeof r=="symbol"?r:String(r)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ve(t,e,n,i,r){var a,c,l={};return Object.keys(i).forEach(function(d){l[d]=i[d]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=ds(a=lp(c=n.slice()).call(c)).call(a,function(d,h){return h(t,e,d)||d},l),r&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(r):void 0,l.initializer=void 0),l.initializer===void 0&&(Object.defineProperty(t,e,l),l=null),l}class Dk extends _n{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(ah.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,n){super(),X(this,"trackMediaType",void 0),X(this,"_ID",void 0),X(this,"_rtpTransceiver",void 0),X(this,"_lowRtpTransceiver",void 0),X(this,"_hints",[]),X(this,"_isClosed",!1),X(this,"_originMediaStreamTrack",void 0),X(this,"mediaStreamTrack",void 0),X(this,"_external",{}),this._ID=n||Je(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(i){_t(xf).call(xf,i)||xf.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||Tu(()=>{var n;kt.reportApiInvoke(null,{name:Wn.GET_MEDIA_STREAM_TRACK,options:[],tag:Rn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===Vf.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const n=xf.indexOf(e);n!==-1&&xf.splice(n,1)}(this),this.emit(Bf.CLOSED),this.removeAllListeners(ah.SEI_RECEIVED)}_updateRtpTransceiver(e,n){if(n===Vf.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(ah.TRANSCEIVER_UPDATED,e,n)}}class Gf extends Dk{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,n){super(e,n),X(this,"_enabled",!0),X(this,"_muted",!1),X(this,"_isExternalTrack",!1),X(this,"_isClosed",!1),X(this,"_enabledMutex",void 0),X(this,"processor",void 0),X(this,"_processorContext",void 0),X(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new xi("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,n;return(e=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,v.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ot.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Xe(this,Ot.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Bf.TRACK_ENDED)}stateCheck(e,n){if(v.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(n,"]")),cl(n,e),this._enabled&&this._muted&&e==="enabled"&&n===!1)throw new Z(P.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",v);if(!this._enabled&&!this._muted&&e==="muted"&&n===!0)throw new Z(P.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",v)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Et.resolve([])}}const Lk=window.AudioContext||window.webkitAudioContext;let bs=null;const Fe=new class extends _n{constructor(){super(...arguments),X(this,"prevState",void 0),X(this,"curState",void 0),X(this,"currentTime",void 0),X(this,"currentTimeStuckAt",void 0),X(this,"interruptDetectorTrack",void 0),X(this,"onLocalAudioTrackMute",()=>{v.info("ios15-interruption-start"),this.emit(yi.IOS_15_16_INTERRUPTION_START)}),X(this,"onLocalAudioTrackUnmute",async()=>{v.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?v.info("ios15-interruption-end-canceled"):(bs&&await bs.suspend(),this.emit(yi.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){v.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){v.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Hf(){if(!bs){if(function(){if(!Lk)return void v.error("your browser is not support web audio");v.info("create audio context");const t=dn({},U("WEBAUDIO_INIT_OPTIONS"));v.debug("audio context init option:",JSON.stringify(t)),bs=new Lk(t),Fe.curState=bs.state,bs.onstatechange=()=>{Fe.prevState=Fe.curState,Fe.curState=bs?bs.state:void 0;const{prevState:e,curState:n}=Fe,i=n==="running",r=n==="interrupted",a=e==="running",c=e==="suspended",l=e==="interrupted",d=Re().osVersion;(ur()||ya())&&a&&r&&(v.info("ios".concat(d,"-interruption-start")),Fe.emit(yi.IOS_INTERRUPTION_START)),(ur()||ya())&&(c||l)&&i&&(v.info("ios".concat(d,"-interruption-end")),Fe.emit(yi.IOS_INTERRUPTION_END)),e!==n&&Fe.emit(yi.STATE_CHANGE,n,e)},setInterval(()=>{var e;const n=(e=bs)===null||e===void 0?void 0:e.currentTime;Fe.currentTime!==n?(Fe.currentTimeStuckAt&&(v.debug("AudioContext current time resume at ".concat(n)),Fe.currentTimeStuckAt=void 0),Fe.currentTime=n):(n!==Fe.currentTimeStuckAt&&(kt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Rn.TRACER}).onSuccess(),v.warning("AudioContext current time stuck at ".concat(n))),Fe.currentTimeStuckAt=n)},5e3),async function(e){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,r=!1,a=!1,c=!1;function l(A){e.state==="running"?d(!1):ur()||ya()?e.state==="suspended"&&(d(!0),A&&e.resume().then(h,h)):e.state!=="closed"&&(d(!0),A&&e.resume().then(h,h))}function d(A){if(r!==A){r=A;for(let I=0,D=n;I<D.length;I+=1){const L=D[I];A?window.addEventListener(L,p,{capture:!0,passive:!0}):window.removeEventListener(L,p,{capture:!0,passive:!0})}}}function h(){l(!1)}function p(){l(!0)}function m(A){if(!c)if(i.paused)if(A){let I;S(!1),c=!0;try{I=i.play(),I?I.then(R,R):(i.addEventListener("playing",R),i.addEventListener("abort",R),i.addEventListener("error",R))}catch{R()}}else S(!0);else S(!1)}function S(A){if(a!==A){a=A;for(let I=0,D=n;I<D.length;I++){const L=D[I];A?window.addEventListener(L,O,{capture:!0,passive:!0}):window.removeEventListener(L,O,{capture:!0,passive:!0})}}}function R(){i.removeEventListener("playing",R),i.removeEventListener("abort",R),i.removeEventListener("error",R),c=!1,m(!1)}function O(){m(!0)}if(ur()){const A=e.createMediaStreamDestination(),I=document.createElement("div");I.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=I.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=A.stream,m(!0)}Fe.on(yi.STATE_CHANGE,function(){l(!0)}),l(!1)}(bs)}(),!bs)throw new Z(P.NOT_SUPPORTED,"can not create audio context");return bs}return bs}function ch(t){if(function(){if(ew!==null)return ew;const i=Hf(),r=i.createBufferSource(),a=i.createGain(),c=i.createGain();r.connect(a),r.connect(c),r.disconnect(a);let l=!1;try{r.disconnect(a)}catch{l=!0}return r.disconnect(),ew=l,l}())return;const e=t.connect,n=t.disconnect;t.connect=(i,r,a)=>{var c;return t._inputNodes||(t._inputNodes=[]),_t(c=t._inputNodes).call(c,i)||(i instanceof AudioNode?(t._inputNodes.push(i),e.call(t,i,r,a)):e.call(t,i,r)),t},t.disconnect=(i,r,a)=>{n.call(t),i?By(t._inputNodes,i):t._inputNodes=[];for(const c of t._inputNodes)e.call(t,c)}}let ew=null;function nw(t,e){let n=!1;const i=1/e;if(U("DISABLE_WEBAUDIO")){const r=window.setInterval(()=>{n?window.clearInterval(r):t(performance.now()/1e3)},1e3*i)}else{const r=Hf();let a=r.createGain();a.gain.value=0,a.connect(r.destination);const c=()=>{if(n)return void(a=null);const l=r.createOscillator();l.onended=c,l.connect(a),l.start(0),l.stop(r.currentTime+i),t(r.currentTime)};c()}return()=>{n=!0}}class Pk{constructor(){X(this,"context",void 0),X(this,"analyserNode",void 0),X(this,"sourceNode",void 0),this.context=Hf(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ur()||ya()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let r=0;r<e.length;++r)e[r]=i[r]/128-1}const n=ds(e).call(e,(i,r)=>i+r*r,0)/e.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,n;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{v.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class kk extends _n{get processSourceNode(){return this.sourceNode}set processedNode(e){var n;if(!this.isDestroyed&&this._processedNode!==e){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),X(this,"outputNode",void 0),X(this,"outputTrack",void 0),X(this,"isPlayed",!1),X(this,"sourceNode",void 0),X(this,"context",void 0),X(this,"audioBufferNode",void 0),X(this,"destNode",void 0),X(this,"audioOutputLevel",0),X(this,"volumeLevelAnalyser",void 0),X(this,"_processedNode",void 0),X(this,"playNode",void 0),X(this,"isDestroyed",!1),X(this,"onNoAudioInput",void 0),X(this,"isNoAudioInput",!1),X(this,"_noAudioInputCount",0),this.context=Hf(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),ch(this.outputNode),this.volumeLevelAnalyser=new Pk}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(vs.ON_AUDIO_BUFFER,function(i){for(let r=0;r<i.outputBuffer.numberOfChannels;r+=1){const a=i.outputBuffer.getChannelData(r);for(let c=0;c<a.length;c+=1)a[c]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ae().webAudioMediaStreamDest)throw new Z(P.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&Fy(()=>{Fe.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ur()||ya()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let r=!1;for(let a=0;a<i.length;a++)i[a]!==0&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await Ti(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,n;(e=this.processedNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Mk extends kk{get isFreeze(){return!1}constructor(e,n,i){var r;if(super(),X(this,"sourceNode",void 0),X(this,"track",void 0),X(this,"clonedTrack",void 0),X(this,"audioElement",void 0),X(this,"isCurrentTrackCloned",!1),X(this,"isRemoteTrack",!1),X(this,"originVolumeLevelAnalyser",void 0),X(this,"rebuildWebAudio",async()=>{if(v.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void v.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>v.info("resume success")),v.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;const d=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(d),ch(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const h=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(h,this.context.currentTime),ch(this.outputNode),this.emit(vs.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=d,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new Z(P.UNEXPECTED_ERROR);this.track=e;const a=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(a),ch(this.sourceNode),i){const l=i.clone();l.enabled=!0,this.clonedTrack=l,v.debug("create an unmuted track ".concat(l.id," from the original track ").concat(i.id," to get the volume"));const d=this.context.createMediaStreamSource(new MediaStream([l]));ch(d),this.originVolumeLevelAnalyser=new Pk,this.originVolumeLevelAnalyser.updateSource(d)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=a;const c=Re();n&&c.os===ri.IOS&&Number((r=c.osVersion)===null||r===void 0?void 0:r.split(".")[0])<15&&(Fe.on(yi.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const n=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(n),ch(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(vs.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),Fe.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const n=e.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),v.debug("create an unmuted track ".concat(n.id," from the original track ").concat(e.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));ch(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function Uk(t,e,n){const i=(a,c)=>a?typeof a!="number"?a.max||a.exact||a.ideal||a.min||c:a:c,r={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:i(e.height,1080),maxWidth:i(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(r.video.mandatory.maxFrameRate=e.frameRate.max,r.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(r.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function VH(t,e){const n=await xk(t.mediaSource),{sourceId:i,audio:r}=await function(a){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Et((l,d)=>{const h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const m=document.createElement("div");m.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",m.setAttribute("style","height: 12%;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const R=document.createElement("div");R.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const O=document.createElement("button");O.innerHTML="cancel",O.setAttribute("style","width: 85px;"),O.onclick=()=>{document.body.removeChild(D);const L=new Error("NotAllowedError");L.name="NotAllowedError",d(L)};let A=c;const I=document.createElement("div");if(c){const L=document.createElement("input");L.setAttribute("type","checkbox");const V=document.createElement("span");L.setAttribute("style","margin-right: 6px;"),V.innerText="Share audio",L.checked=A,L.onchange=()=>{A=L.checked},I.appendChild(L),I.appendChild(V)}R.appendChild(I),R.appendChild(O),p.appendChild(m),p.appendChild(S),p.appendChild(R);const D=document.createElement("div");D.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),D.appendChild(h),D.appendChild(p),document.body.appendChild(D),a.map(L=>{if(L.id){const V=document.createElement("div");V.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let W=L.thumbnail;try{const{width:K}=W.getSize();K>1920&&(W=W.resize({width:1920}))}catch(K){throw K&&K.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),K}V.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+W.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+L.name.replace(/[\u00A0-\u9999<>\&]/g,function(K){return"&#"+K.charCodeAt(0)+";"})+"</span>",V.onclick=()=>{document.body.removeChild(D),l({sourceId:L.id,audio:A})},S.appendChild(V)}})})}(n,e);return await Uk(i,t,r)}async function xk(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const n=XP();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new Z(P.ELECTRON_IS_NULL);let i=null;try{var r;i=((r=n.desktopCapturer)===null||r===void 0?void 0:r.getSources({types:e}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{i=null}i&&i.then||(i=new Et((a,c)=>{n.desktopCapturer.getSources({types:e},(l,d)=>{l?c(l):a(d)})}));try{return await i}catch(a){throw new Z(P.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,a.toString())}}const iw=new xi("safari");let Vk=!1,Bk=!1;async function As(t,e){let n=0,i=null;for(;n<2;)try{i=await BH(t,e,n>0);break}catch(r){if(r instanceof Z)throw v.error("[".concat(e,"] ").concat(r.toString())),r;const a=Qy(r.name||r.code||r,r.message);if(a.code===P.MEDIA_OPTION_INVALID){v.debug("[".concat(e,"] detect media option invalid, retry")),n+=1,await Ti(500);continue}throw v.error("[".concat(e,"] ").concat(a.toString())),a}if(!i)throw new Z(P.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function BH(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Z(P.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const i=Ae(),r=new MediaStream;if(t.audioSource&&r.addTrack(t.audioSource),t.videoSource&&r.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return v.debug("Using Video Source/ Audio Source"),r;if(t.screen)if(XP())t.screen.sourceId?Wf(r,await Uk(t.screen.sourceId,t.screen,!!t.screenAudio)):Wf(r,await VH(t.screen,!!t.screenAudio));else if(al()&&t.screen.extensionId&&t.screen.mandatory){if(!i.getStreamFromExtension)throw new Z(P.NOT_SUPPORTED,"This browser does not support screen sharing");v.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const S=await(c=t.screen.extensionId,l=e,new Et((R,O)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},A=>{if(!A||!A.streamId)return v.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),A),void O(new Z(P.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));R(A.streamId)})}catch(A){v.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),A.toString()),O(new Z(P.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=S,Wf(r,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(i.getDisplayMedia){var a;t.screen.mediaSource&&Ik(t.screen.mediaSource);const S={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(a=t.screen.displaySurface)!==null&&a!==void 0?a:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:R,surfaceSwitching:O,systemAudio:A,preferCurrentTab:I}=t.screen,D={selfBrowserSurface:R,surfaceSwitching:O,systemAudio:A,preferCurrentTab:I};!R&&delete D.selfBrowserSurface,!O&&delete D.surfaceSwitching,!A&&delete D.systemAudio,!I&&delete D.preferCurrentTab,v.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:S,audio:t.screenAudio,controls:D})),Wf(r,await navigator.mediaDevices.getDisplayMedia(dn({video:S,audio:t.screenAudio},D)))}else{if(!Sn())throw v.error("[".concat(e,"] This browser does not support screenSharing")),new Z(P.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&Ik(t.screen.mediaSource);const S={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};v.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(S))),Wf(r,await navigator.mediaDevices.getUserMedia(S))}}var c,l;if(!t.video&&!t.audio)return r;let d={video:t.video,audio:t.audio},h=U("MEDIA_DEVICE_CONSTRAINTS");if(h)try{typeof h=="string"&&(h=JSON.parse(h)),d=kI(d,h)}catch{}v.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(d)),Re();let p,m=null;(Ni()||ur()||xy())&&(m=await iw.lock());try{p=await navigator.mediaDevices.getUserMedia(d)}catch(S){throw m&&m(),S}return d.audio&&(Vk=!0),d.video&&(Bk=!0),Wf(r,p),m&&m(),r}function Qy(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Z(P.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new Z(P.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new Z(P.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new Z(P.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Z(P.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new Z(P.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return v.error("getUserMedia unexpected error",t),new Z(P.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function Wf(t,e){const n=t.getVideoTracks()[0],i=t.getAudioTracks()[0],r=e.getVideoTracks()[0],a=e.getAudioTracks()[0];a&&(i&&t.removeTrack(i),t.addTrack(a)),r&&(n&&t.removeTrack(n),t.addTrack(r))}const Is=new class extends _n{get state(){return this._state}set state(t){t!==this._state&&(this.emit(oh.STATE_CHANGE,t),this._state=t)}constructor(){super(),X(this,"_state",yg.IDLE),X(this,"isAccessMicrophonePermission",!1),X(this,"isAccessCameraPermission",!1),X(this,"lastAccessMicrophonePermission",!1),X(this,"lastAccessCameraPermission",!1),X(this,"checkdeviceMatched",!1),X(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(U("ENUMERATE_DEVICES_INTERVAL")||(Vy()||Uy()===ri.HARMONY_OS)&&ol())&&this.updateDevicesInfo()},U("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>v.error(t.toString()))}async enumerateDevices(t,e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Z(P.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),r=this.checkMediaDeviceInfoIsOk(i);let a=!this.isAccessMicrophonePermission&&t,c=!this.isAccessCameraPermission&&e;r.audio&&(a=!1),r.video&&(c=!1);let l=null,d=null,h=null;if(!n&&(a||c)){if(iw.isLocked&&(v.debug("[device manager] wait GUM lock"),(await iw.lock())(),v.debug("[device manager] GUM unlock")),Vk&&(a=!1,this.isAccessMicrophonePermission=!0),Bk&&(c=!1,this.isAccessCameraPermission=!0),v.debug("[device manager] check media device permissions",t,e,a,c),a&&c){try{h=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(p){const m=Qy(p.name||p.code||p,p.message);if(m.code===P.PERMISSION_DENIED)throw m;v.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(a){try{l=await navigator.mediaDevices.getUserMedia({audio:t})}catch(p){const m=Qy(p.name||p.code||p,p.message);if(m.code===P.PERMISSION_DENIED)throw m;v.warning("getUserMedia failed in getDevices",m)}this.isAccessMicrophonePermission=!0}else if(c){try{d=await navigator.mediaDevices.getUserMedia({video:e})}catch(p){const m=Qy(p.name||p.code||p,p.message);if(m.code===P.PERMISSION_DENIED)throw m;v.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0}v.debug("[device manager] mic permission",t,"cam permission",e)}try{const p=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(m=>m.stop()),d&&d.getTracks().forEach(m=>m.stop()),h&&h.getTracks().forEach(m=>m.stop()),l=null,d=null,h=null,p}catch(p){return l&&l.getTracks().forEach(m=>m.stop()),d&&d.getTracks().forEach(m=>m.stop()),h&&h.getTracks().forEach(m=>m.stop()),l=null,d=null,h=null,new Z(P.ENUMERATE_DEVICES_FAILED,p.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach(n=>{n.device.label===t&&(e=n.device.deviceId)}),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===t);if(!e)throw new Z(P.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=yg.INITING;try{await this.updateDevicesInfo(),this.state=yg.INITEND}catch(t){throw v.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=yg.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Z(P.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),n=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const r=t.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),a=t.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");r&&a?a.groupId===r.groupId?v.debug("[device-check] default input ".concat(r.label," and output ").concat(a.label," is the same group")):v.debug("[device-check] default input ".concat(r.label," and output ").concat(a.label," is not the same group")):v.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(r=>{if(!r.deviceId)return;const a=this.deviceInfoMap.get("".concat(r.kind,"_").concat(r.deviceId));if((a?a.state:"INACTIVE")!=="ACTIVE"){const c={initAt:e,updateAt:e,device:r,state:"ACTIVE"};this.deviceInfoMap.set("".concat(r.kind,"_").concat(r.deviceId),c),n.push(c)}a&&(a.updateAt=e)}),this.deviceInfoMap.forEach((r,a)=>{r.state==="ACTIVE"&&r.updateAt!==e&&(r.state="INACTIVE",n.push(r))}),this.state!==yg.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(r=>{switch(r.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(oh.RECORDING_DEVICE_CHANGED,r);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(oh.CAMERA_DEVICE_CHANGED,r);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(oh.PLAYOUT_DEVICE_CHANGED,r)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter(r=>r.kind==="audioinput"),n=t.filter(r=>r.kind==="videoinput"),i={audio:!1,video:!1};for(const r of e)if(r.label&&r.deviceId){i.audio=!0;break}for(const r of n)if(r.label&&r.deviceId){i.video=!0;break}return i}};let rw=!1;const ws=new class extends _n{constructor(){super(...arguments),X(this,"onAutoplayFailed",void 0),X(this,"onAudioAutoplayFailed",void 0)}};function Fk(){if(Re(),!rw){const t=e=>{e.preventDefault(),rw=!1,pg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};rw=!0,pg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),v.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),ws.onAutoplayFailed?ws.onAutoplayFailed():ws.onAudioAutoplayFailed?v.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):v.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),ws.emit("autoplay-failed")}}function jk(t,e,n,i){if(!t)return;const r=kt.getBaseInfoBySessionId(t);if(!r)return;const a=r.info,c=Date.now(),l=dn(dn({},a),{},{vid:a.vid===void 0?0:Number(a.vid),lts:c,elapse:c-r.startTime,cbRegistered:ws.onAutoplayFailed||ws.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:i,extend:void 0});kt.send({type:un.AUTOPLAY_FAILED,data:l},!0)}const FH=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Cr=new class{constructor(){X(this,"onAutoplayFailed",void 0),X(this,"elementMap",new Map),X(this,"elementStateMap",new Map),X(this,"elementsNeedToResume",[]),X(this,"sinkIdMap",new Map),X(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,i]=e;const r=this.elementStateMap.get(n),a=i.srcObject.getAudioTracks()[0],c=a&&a.readyState;if(v.debug("resume after interrupted, ele: ".concat(r," audio: ").concat(c," ").concat(t)),c==="live"){if(t)return i.pause(),void i.play();if(Fe.curState==="running")return Nf()?(i.pause(),void i.play()):void(r&&r==="paused"&&i.play())}})}),X(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[e,n]=t;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(v.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Fe.on(yi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Fe.on(yi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Fe.on(yi.STATE_CHANGE,()=>{ur()&&Fe.prevState==="suspended"&&Fe.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(i){throw new Z(P.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(t,e,n,i){if(this.elementMap.has(e))return;const r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,r),this.elementMap.set(e,r),this.elementStateMap.set(e,Qi.INIT),this.setVolume(e,n);const a=this.sinkIdMap.get(e);if(a)try{r.setSinkId(a).catch(l=>{v.warning("[".concat(e,"] set sink id failed"),l.toString())})}catch(l){v.warning("[".concat(e,"] set sink id failed"),l.toString())}const c=r.play();c&&c.then&&c.catch(l=>{i&&jk(i,"audio",l.message,e),v.warning("audio element play warning",l.toString()),this.elementMap.has(e)&&l.name==="NotAllowedError"&&(v.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),Fy(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Fk()}))})}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const n=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(n,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){FH.forEach(n=>{e.addEventListener(n,i=>{const r=this.elementStateMap.get(t),a=i.type==="pause"?"paused":i.type;if(v.debug("[".concat(t,"] audio-element-status change ").concat(r," => ").concat(a)),i.type==="error"){const c=e==null?void 0:e.error;c&&v.error("[".concat(t,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(t,a)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(n=>{v.debug("Auto resume audio element success")}).catch(n=>{v.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new Et(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{pg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function Pn(){return function(t,e,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new Z(P.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",v);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];const l=i.apply(this,a);return l instanceof Et?new Et((d,h)=>{l.then(d).catch(h)}):l}),n}}class Gk extends _n{constructor(e){super(),X(this,"name","VideoProcessorDestination"),X(this,"ID","0"),X(this,"_source",void 0),X(this,"videoContext",void 0),X(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Z(P.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Z(P.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(dr.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(dr.ON_TRACK,void 0)}}class Hk extends _n{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n){super(),X(this,"constraintsMap",new Map),X(this,"statsRegistry",[]),X(this,"usageRegistry",[]),X(this,"trackId",void 0),X(this,"direction",void 0),X(this,"_chained",!1),this.trackId=e,this.direction=n}async getConstraints(){return await Li(this,Cs.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,n){var i;return v.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Xe(this,Cs.REQUEST_UPDATE_CONSTRAINTS,Array.from(gi(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return v.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),Xe(this,Cs.REQUEST_UPDATE_CONSTRAINTS,Array.from(gi(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:a}of this.statsRegistry)try{const c=a();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){v.error(new Z(P.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof Et&&(i=await i),e.push(dn(dn({},i),{},{direction:this.direction}))}catch(i){v.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class Wk extends _n{constructor(e){super(),X(this,"name","AudioProcessorDestination"),X(this,"ID","0"),X(this,"inputTrack",void 0),X(this,"inputNode",void 0),X(this,"audioProcessorContext",void 0),X(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Z(P.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Z(P.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(dr.ON_TRACK,void 0),this.emit(dr.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(dr.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(dr.ON_NODE,this.inputNode))}}class Kk extends _n{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n,i){super(),X(this,"constraintsMap",new Map),X(this,"statsRegistry",[]),X(this,"audioContext",void 0),X(this,"trackId",void 0),X(this,"direction",void 0),X(this,"usageRegistry",[]),X(this,"_chained",!1),this.audioContext=e,this.trackId=n,this.direction=i}async getConstraints(){return Li(this,Cs.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,n){var i;return v.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Xe(this,Cs.REQUEST_UPDATE_CONSTRAINTS,Array.from(gi(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),Xe(this,Cs.REQUEST_UPDATE_CONSTRAINTS,Array.from(gi(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:a}of this.statsRegistry)try{const c=a();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){v.error(new Z(P.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof Et&&(i=await i),e.push(dn(dn({},i),{},{direction:this.direction}))}catch(i){v.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class sw extends _n{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),X(this,"context",void 0),X(this,"processSourceNode",void 0),X(this,"outputTrack",void 0),X(this,"processedNode",void 0),X(this,"clonedTrack",void 0),X(this,"outputNode",void 0),this.outputNode=new jH}setVolume(){}createOutputTrack(){throw new Z(P.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class jH{disconnect(){}connect(){}}function Yk(t){return new Et((e,n)=>{let i=!1;const r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r);const a=ur()?"canplay":"playing";r.addEventListener(a,()=>{const c=r.videoWidth,l=r.videoHeight;!c&&Sn()||(i=!0,r.srcObject=null,r.remove(),e([c,l]))}),r.srcObject=new MediaStream([t]),r.play().catch(jy),setTimeout(()=>{i||(r.srcObject=null,r.remove(),e([r.videoWidth,r.videoHeight]))},4e3)})}function Zy(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const n=rc(t.encoderConfig);return n.width!=null&&(e.width=n.width),n.height!=null&&(e.height=n.height),!WP()&&n.frameRate&&(e.frameRate=n.frameRate),UP()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),Sn()&&(e.frameRate={ideal:30,max:30}),e}function qk(t){const e={};return WP()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,al()&&t.ANS&&(e.googHighpassFilter=t.ANS))),e}function zk(t){const e=qk(t);if(t.encoderConfig){const n=Xy(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),Vy()&&(e.sampleRate=void 0),e}const GH=t=>{const e=t._encoderConfig;if(!e)return;const{frameRate:n,width:i,height:r}=t.getMediaStreamTrackSettings();let{frameRate:a=n,width:c=i,height:l=r}=e;if(!a||!c||!l)return;c=MI(c),l=MI(l),a=MI(a);const{max:d,min:h}=function(R,O,A){const I=200*Math.pow(A/15,.6)*Math.pow(R*O/640/360,.75);return{min:Math.floor(I),max:Math.floor(4*I)}}(c,l,a),{bitrateMax:p,bitrateMin:m}=e||{};p||v.debug("calculate bitrate: [w: ".concat(c,", h: ").concat(l,", fps: ").concat(a,"] => [brMax: ").concat(p,", brMin: ").concat(m,"]"));const{maxFramerate:S}=U("ENCODER_CONFIG_LIMIT");return S&&typeof S=="number"&&(a=Math.min(a,S)),{frameRate:a,bitrateMax:p||d,bitrateMin:m||h,scaleResolutionDownBy:1,scale:0}},Xk=async(t,e,n)=>await(async(i,r,a)=>{const c=function(h){const p=[];for(let m=0;m<h.length;m+=2)p.push(parseInt(h.slice(m,m+2),16));return Uint8Array.from(p)}(ak(""+r+a)).slice(0,16),l=c.slice(0,12),d=await window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},d,i))})(t.buffer,e,n),aw=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new Et((n,i)=>{e.toBlob(async r=>{if(e.remove(),r){const a=await Jk(r);n({buffer:a,width:e.width,height:e.height})}else i(new Z(P.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},Jk=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)};var Qk,Zk,$k,tM,eM,nM,iM,rM,sM,aM,oM,cM,lM,uM,dM,hM,pM,fM,En,mM,_M,EM,gM,SM,TM,ac,RM,yM,vM,CM,bM,AM,IM,wM,OM,NM,DM,LM,PM,ki;let bn=(Qk=Wt({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),Zk=Wt({argsMap:(t,e)=>[t.getTrackId(),e]}),$k=Pn(),tM=Pf("LocalAudioTrack","_enabledMutex"),eM=Wt({argsMap:(t,e)=>[t.getTrackId(),e]}),nM=Pn(),iM=Pf("LocalAudioTrack","_enabledMutex"),rM=Wt({argsMap:(t,e)=>[t.getTrackId(),e]}),sM=Pn(),aM=Pn(),oM=Pn(),cM=Wt({argsMap:t=>[t.getTrackId()]}),lM=Pn(),uM=Wt({argsMap:t=>[t.getTrackId()]}),dM=Pn(),hM=Wt({argsMap:t=>[t.getTrackId()]}),pM=Wt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),fM=Wt({argsMap:t=>[t.getTrackId()]}),ve((En=class extends Gf{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Cr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,n,i){super(t,n),X(this,"trackMediaType",jf.AUDIO),X(this,"_encoderConfig",void 0),X(this,"_trackSource",void 0),X(this,"metadata",[]),X(this,"_enabled",!0),X(this,"_volume",100),X(this,"_useAudioElement",!0),X(this,"_bypassWebAudio",!1),X(this,"processor",void 0),X(this,"_processorContext",void 0),X(this,"_processorDestination",void 0),X(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!i,this._trackSource=new sw,U("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),U("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Ni()&&!bs?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){He(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Cr.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void v.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,Xe(this,Ot.NEED_REPLACE_TRACK,this).then(()=>{v.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{v.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!bk())throw new Z(P.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Cr.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,n){return this._setEnabled(t,e,n)}async _setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Xe(this,Ot.NEED_ENABLE_TRACK,this),v.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(i){throw n||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Xe(this,Ot.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Xe(this,Ot.NEED_MUTE_TRACK,this):await Xe(this,Ot.NEED_UNMUTE_TRACK,this))}getStats(){return Tu(()=>{v.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Ts(this,Ot.GET_STATS)||dn({},ZI)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(vs.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(vs.ON_AUDIO_BUFFER),this._source.on(vs.ON_AUDIO_BUFFER,n=>t(n))}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Cr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Cr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Cr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Xe(this,Ot.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return Et.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new Z(P.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new Z(P.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(t){t.on(dr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await Xe(this,Ot.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Xe(this,Ot.NEED_REPLACE_TRACK,this))}),t.on(dr.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(t){t.removeAllListeners(dr.ON_TRACK),t.removeAllListeners(dr.ON_NODE)}bindProcessorContextEvents(t){t.on(Cs.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Cs.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof sw&&(this._trackSource=new Mk(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new Kk(this._source.context,this.getTrackId(),"local"),e=new Wk(t);return this._processorContext=t,this._processorDestination=e,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(e),this._source.on(vs.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Cr.stop(this.getTrackId()),this._source.play()),Xe(this,Ot.NEED_REPLACE_MIXING_TRACK,this).then(()=>{v.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{v.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:t,processorDestination:e}}}).prototype,"setVolume",[Qk],Object.getOwnPropertyDescriptor(En.prototype,"setVolume"),En.prototype),ve(En.prototype,"setPlaybackDevice",[Zk,$k],Object.getOwnPropertyDescriptor(En.prototype,"setPlaybackDevice"),En.prototype),ve(En.prototype,"setEnabled",[tM,eM,nM],Object.getOwnPropertyDescriptor(En.prototype,"setEnabled"),En.prototype),ve(En.prototype,"setMuted",[iM,rM,sM],Object.getOwnPropertyDescriptor(En.prototype,"setMuted"),En.prototype),ve(En.prototype,"getStats",[aM],Object.getOwnPropertyDescriptor(En.prototype,"getStats"),En.prototype),ve(En.prototype,"setAudioFrameCallback",[oM],Object.getOwnPropertyDescriptor(En.prototype,"setAudioFrameCallback"),En.prototype),ve(En.prototype,"play",[cM,lM],Object.getOwnPropertyDescriptor(En.prototype,"play"),En.prototype),ve(En.prototype,"stop",[uM,dM],Object.getOwnPropertyDescriptor(En.prototype,"stop"),En.prototype),ve(En.prototype,"close",[hM],Object.getOwnPropertyDescriptor(En.prototype,"close"),En.prototype),ve(En.prototype,"pipe",[pM],Object.getOwnPropertyDescriptor(En.prototype,"pipe"),En.prototype),ve(En.prototype,"unpipe",[fM],Object.getOwnPropertyDescriptor(En.prototype,"unpipe"),En.prototype),En),$y=(mM=Wt({argsMap:(t,e)=>[t.getTrackId(),e]}),_M=Pn(),EM=Pf("MicrophoneAudioTrack","_enabledMutex"),gM=Wt({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),SM=Pn(),TM=Wt({argsMap:t=>[t.getTrackId()]}),ve((ac=class extends bn{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,n,i){super(t,e.encoderConfig?Xy(e.encoderConfig):{},i,U("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),X(this,"_config",void 0),X(this,"_deviceName","default"),X(this,"_constraints",void 0),X(this,"_originalConstraints",void 0),X(this,"_enabled",!0),this._config=e,this._constraints=n,this._originalConstraints=n,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(Nf()||II())&&Fe.bindInterruptDetectorTrack(this)}async setDevice(t){if(v.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await Is.getDeviceById(t),n={};n.audio=dn({},this._constraints),n.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let i=null;try{i=await As(n,this.getTrackId())}catch(r){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),i=await As({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await Is.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}v.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,n){if(e)return v.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),U("AUTO_RESET_AUDIO_ROUTE")&&(ur()||ya())){const c=navigator.audioSession;c&&(t||(c.type="playback"),c.type="auto")}if(!t){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await Xe(this,Ot.NEED_DISABLE_TRACK,this)}catch(c){throw v.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const r=dn({},this._constraints),a=Is.searchDeviceIdByName(this._deviceName);a&&!r.deviceId&&(r.deviceId=a);try{n||(this._enabled=!0);const c=await As({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await Xe(this,Ot.NEED_ENABLE_TRACK,this)}catch(c){throw n||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}v.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Nf()||II())&&Fe.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ur()||ya())&&this._enabled&&!this._isClosed&&Fe.duringInterruption){const t=async()=>{Fe.off(yi.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Fe.on(yi.IOS_INTERRUPTION_END,t)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Bf.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=Is.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId=n),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const i=await As({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Cs.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Cs.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[mM,_M],Object.getOwnPropertyDescriptor(ac.prototype,"setDevice"),ac.prototype),ve(ac.prototype,"setEnabled",[EM,gM,SM],Object.getOwnPropertyDescriptor(ac.prototype,"setEnabled"),ac.prototype),ve(ac.prototype,"close",[TM],Object.getOwnPropertyDescriptor(ac.prototype,"close"),ac.prototype),ac),HH=(RM=Wt({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),yM=Pn(),vM=Wt({argsMap:t=>[t.getTrackId()]}),CM=Pn(),bM=Wt({argsMap:t=>[t.getTrackId()]}),AM=Pn(),IM=Wt({argsMap:t=>[t.getTrackId()]}),wM=Pn(),OM=Wt({argsMap:t=>[t.getTrackId()]}),NM=Pn(),DM=Wt({argsMap:t=>[t.getTrackId()]}),LM=Wt({argsMap:t=>[t.getTrackId()]}),PM=Pn(),ve((ki=class extends bn{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,n,i){super(e.createOutputTrack(),n,i),X(this,"source",void 0),X(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=e,this._bufferSource.on(vs.AUDIO_SOURCE_STATE_CHANGE,r=>{this.safeEmit(Bf.SOURCE_STATE_CHANGE,r)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){He(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[RM,yM],Object.getOwnPropertyDescriptor(ki.prototype,"startProcessAudioBuffer"),ki.prototype),ve(ki.prototype,"pauseProcessAudioBuffer",[vM,CM],Object.getOwnPropertyDescriptor(ki.prototype,"pauseProcessAudioBuffer"),ki.prototype),ve(ki.prototype,"seekAudioBuffer",[bM,AM],Object.getOwnPropertyDescriptor(ki.prototype,"seekAudioBuffer"),ki.prototype),ve(ki.prototype,"resumeProcessAudioBuffer",[IM,wM],Object.getOwnPropertyDescriptor(ki.prototype,"resumeProcessAudioBuffer"),ki.prototype),ve(ki.prototype,"stopProcessAudioBuffer",[OM,NM],Object.getOwnPropertyDescriptor(ki.prototype,"stopProcessAudioBuffer"),ki.prototype),ve(ki.prototype,"close",[DM],Object.getOwnPropertyDescriptor(ki.prototype,"close"),ki.prototype),ve(ki.prototype,"setAudioBufferPlaybackSpeed",[LM,PM],Object.getOwnPropertyDescriptor(ki.prototype,"setAudioBufferPlaybackSpeed"),ki.prototype),ki);class Xn extends bn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=Hf().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,Je(8,"track-mix-")),X(this,"trackList",void 0),X(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(v.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):v.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){v.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}By(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(n=>{n instanceof Xn?n.emit(ah.TRANSCEIVER_UPDATED,e):n._updateRtpTransceiver(e)}))}}class WH extends kk{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(vs.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),X(this,"audioBuffer",void 0),X(this,"sourceNode",void 0),X(this,"startPlayTime",0),X(this,"startPlayOffset",0),X(this,"pausePlayTime",0),X(this,"options",void 0),X(this,"currentLoopCount",0),X(this,"currentPlaybackSpeed",100),X(this,"_currentState","stopped"),this.audioBuffer=e,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):v.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const kM=new Map;class ow{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const e=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(v.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var n;e!==this._videoState&&(this._videoState=e,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(e){X(this,"trackId",void 0),X(this,"config",void 0),X(this,"onFirstVideoFrameDecoded",void 0),X(this,"onVideoStateChanged",void 0),X(this,"freezeTimeCounterList",[]),X(this,"renderFreezeAccTime",0),X(this,"isKeepLastFrame",!1),X(this,"timeUpdatedCount",0),X(this,"freezeTime",0),X(this,"playbackTime",0),X(this,"lastTimeUpdatedTime",0),X(this,"autoplayFailed",!1),X(this,"videoTrack",void 0),X(this,"videoElement",void 0),X(this,"cacheVideoElement",void 0),X(this,"renderStats",void 0),X(this,"_videoState",sc.VideoStateStopped),X(this,"videoElementCheckInterval",void 0),X(this,"videoElementFreezeTimeout",void 0),X(this,"_videoElementStatus",Qi.NONE),X(this,"isGettingVideoDimensions",!1),X(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return v.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),X(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Fe.curState==="running"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(MP())),GP()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),X(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Qi.PLAYING;break;case"loadeddata":if(this.videoState=sc.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Qi.CANPLAY;break;case"stalled":this.videoElementStatus=Qi.STALLED;break;case"suspend":this.videoElementStatus=Qi.SUSPEND;break;case"pause":this.videoElementStatus=Qi.PAUSED,ur()||ya()||Ni()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Qi.WAITING;break;case"abort":this.videoElementStatus=Qi.ABORT;break;case"ended":this.videoElementStatus=Qi.ENDED;break;case"emptied":this.videoElementStatus=Qi.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=Qi.ERROR,v.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const r=i-this.lastTimeUpdatedTime,a=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,ul.lastVisibleTime<ul.lastHiddenTime||a<ul.lastHiddenTime||a<ul.lastVisibleTime)return;for(r>U("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=r),this.playbackTime+=r;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),X(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(MP())),GP()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),Fe.on(yi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Fe.on(yi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const n=this.videoElement.play();n&&n.catch&&n.catch(r=>{e&&jk(e,"video",r.message,this.trackId),r.name==="NotAllowedError"?(v.warning("detected video element autoplay failed",r),this.autoplayFailed=!0,this.handleAutoPlayFailed()):v.warning("[".concat(this.trackId,"] play warning: "),r)});const i=Re();if((i.name==="Safari"&&Number(i.version)===15||Nf())&&n&&n.then){const r=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(r).catch(r)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");if(!n)return v.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height);return e.remove(),i}async getCurrentFrameToUint8Array(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const r=i.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,i.width,i.height),new Et((a,c)=>{i.toBlob(async l=>{if(i.remove(),l){const d=await Jk(l);a({buffer:d,width:i.width,height:i.height})}else c(new Z(P.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,n<0?.1:n>1?1:n)})):await aw(e)}destroy(){this.renderStats=void 0,Fe.off(yi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Fe.off(yi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=sc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Qi.INIT,!this.videoElementCheckInterval&&(MM.forEach(a=>{this.videoElement.addEventListener(a,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(a){return a!==document.body&&document.body.contains(a)})(this.videoElement)||(this.videoElementStatus=Qi.DESTROYED)},1e3),U("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,n;let a;const c=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",c),this.videoElementFreezeTimeout=window.setTimeout(l,U("VIDEO_FREEZE_DURATION")))},l=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===sc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=sc.VideoStateFrozen:document.addEventListener("visibilitychange",c))},d=(h,p)=>{if(this.videoElementStatus===Qi.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=p.mediaTime):this.renderStats={lastTs:p.mediaTime,curTs:p.mediaTime,lastRenderNum:0,renderNum:0},a){const R=p.presentationTime-a.presentationTime;this.videoState===sc.VideoStateStarting&&(this.videoState=sc.VideoStateDecoding),this.videoState===sc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(l,U("VIDEO_FREEZE_DURATION"))),R<U("VIDEO_FREEZE_DURATION")&&this.videoState===sc.VideoStateFrozen&&(this.videoState=sc.VideoStateDecoding),R>U("VIDEO_FREEZE_DURATION")&&ul.lastVisibleTime>=ul.lastHiddenTime&&a.timestamp>ul.lastVisibleTime&&a.timestamp>ul.lastHiddenTime&&(this.renderFreezeAccTime+=R)}a=dn(dn({},p),{},{timestamp:h})}var m,S;U("ENABLE_VIDEO_FRAME_CALLBACK")&&((m=(S=this.videoElement).requestVideoFrameCallback)===null||m===void 0||m.call(S,d))};(e=(n=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(n,d)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Vy()&&!U("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=Re();i.name==="Safari"&&Number(i.version)===15||Nf()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Sn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Sn()&&this.videoElement.load());const r=this.videoElement.play();r!==void 0&&r.catch(a=>{v.debug("[".concat(this.trackId,"] playback interrupted"),a.toString())})}resetVideoElement(){MM.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Qi.NONE}handleAutoPlayFailed(){const e=n=>{n.preventDefault(),this.videoElement.play().then(()=>{v.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{v.error(i)}),this.autoplayFailed=!1,pg()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};pg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),Fk()}}const MM=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class UM extends ow{constructor(e){super(e),X(this,"container",void 0),X(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const n=e.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,i):await aw(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",U("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var xM,VM,BM,FM,jM,GM,HM,WM,KM,YM,qM,zM,XM,JM,QM,ZM,$M,t1,e1,n1,i1,r1,s1,a1,ge,o1,c1,l1,u1,d1,h1,p1,f1,Os;let cn=(xM=Wt({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),VM=Pn(),BM=Wt({argsMap:t=>[t.getTrackId()]}),FM=Pf("LocalVideoTrack","_enabledMutex"),jM=Wt({argsMap:(t,e)=>[t.getTrackId(),e]}),GM=Pn(),HM=Pf("LocalVideoTrack","_enabledMutex"),WM=Wt({argsMap:(t,e)=>[t.getTrackId(),e]}),KM=Pn(),YM=Wt({argsMap:(t,e)=>[t.getTrackId(),e]}),qM=Pn(),zM=Pn(),XM=Wt({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),JM=Pn(),QM=Pn(),ZM=Pn(),$M=Pn(),t1=Pn(),e1=Pn(),n1=Pn(),i1=Wt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),r1=Wt({argsMap:t=>[t.getTrackId()]}),s1=Wt({argsMap:t=>[t.getTrackId()]}),a1=Wt({argsMap:(t,e,n)=>[t.getTrackId(),e.label,n]}),ge=class VB extends Gf{get videoHeight(){if(Ni()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(Ni()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Qi.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,n,i,r,a,c){if(super(e,a),X(this,"trackMediaType",jf.VIDEO),X(this,"_player",void 0),X(this,"isUseScaleResolutionDownBy",!1),X(this,"_videoVisibleTimer",null),X(this,"_previousVideoVisibleStatus",void 0),X(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),X(this,"_encoderConfig",void 0),X(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),X(this,"_optimizationMode",void 0),X(this,"_videoHeight",void 0),X(this,"_videoWidth",void 0),X(this,"_forceBitrateLimit",void 0),X(this,"_enabled",!0),X(this,"_processorDestination",void 0),X(this,"_processorContext",void 0),Ni()){const{width:l,height:d}=e.getSettings();this._videoWidth=l,this._videoHeight=d}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=i,this._optimizationMode=r,this._hints=c||[],this._hints.indexOf(Qe.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(CI(Oe.CHROME,115)&&Uy().indexOf("Windows")!==-1){const l=function(d,h){if("VideoFrame"in window&&"TransformStream"in window&&Ae().supportWebRTCInsertableStream){const p=new MediaStreamTrackProcessor(d),m=new MediaStreamTrackGenerator({kind:"video"});let S,R,O=Date.now();const A=()=>{I&&(clearInterval(I),I=void 0),S&&(S.close(),S=void 0),d.stop(),R=void 0,m.removeEventListener("ended",A)};let I=window.setInterval(()=>{if(R&&S&&Date.now()-O>1e3)try{m.readyState==="live"?R.enqueue(S.clone()):A()}catch{A()}},1e3);const D=new TransformStream({transform:(L,V)=>{m.readyState==="live"?(R=V,O=Date.now(),S===void 0?(S=L,V.enqueue(L.clone())):(V.enqueue(S),S=L)):L.close()}});return m.addEventListener("ended",A),p.readable.pipeThrough(D).pipeTo(m.writable),m}}(e);l&&(v.info("local screen video track begin to inject frame"),this._mediaStreamTrack=l)}n&&this._hints.indexOf(Qe.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new Hk(this.getTrackId(),"local"),this._processorDestination=new Gk(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const r=document.getElementById(e);r?e=r:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=dn(dn(dn({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new ow(i):this._player=new UM(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(Bf.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},U("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await Xe(this,Ot.NEED_DISABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Xe(this,Ot.NEED_ENABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Xe(this,Ot.NEED_MUTE_TRACK,this):await Xe(this,Ot.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,n){if(!this._enabled)throw new Z(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=rc(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const i=Zy({encoderConfig:e});(Ni()||ur()||ya())&&(i.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(r){const a=new Z(P.UNEXPECTED_ERROR,r.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}}this._encoderConfig=e,this._hints.indexOf(Qe.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Xe(this,Ot.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(v)}}getStats(){return Tu(()=>{v.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Ts(this,Ot.GET_STATS)||dn({},$I)}async setBeautyEffect(e){v.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,n):await aw(e)}async setBitrateLimit(e){v.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void v.error(P.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=e,await Xe(this,Ot.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,v.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return v.error(P.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,v.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){Yk(this._originMediaStreamTrack).then(e=>{let[n,i]=e;this._videoHeight=i,this._videoWidth=n}).catch(jy)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new Z(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");v.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=rc(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(Qe.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Xe(this,Ot.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(v)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!e||!n||!i)return;const{bitrateMax:r,bitrateMin:a}=this._encoderConfig;if(a==null||r==null){const{max:c,min:l}=function(d,h,p,m,S){const R=U("BITRATE_ADAPTER_TYPE");if(R==="DEFAULT_BITRATE")return{min:m,max:S};if(S===void 0){var O;const I=Math.floor(200*Math.pow(p/15,.6)*Math.pow(d*h/640/360,.75));S=R==="STANDARD_BITRATE"?4*I:2*I,m=(O=m)!==null&&O!==void 0?O:I}else{var A;m=(A=m)!==null&&A!==void 0?A:Math.floor(S/10)}return{min:m,max:S}}(e,n,i,a,r);this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=c,v.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(c,", brMin: ").concat(l,"]"))}}getVideoElementVisibleStatus(){try{var e,n;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:a,slot:c}=r;if(this.isPlaying&&a instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=qP.checkOneElementVisible(a),d=Object.assign({},l);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;const h=kt.reportApiInvoke(null,{tag:Rn.TRACER,name:Wn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(i){throw new Z(P.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new Z(P.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=dn(dn({},i),rc(e))),i=nh(i);const r=Je(8,"track-video-cloned-"),a=new VB(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,nh(this._scalabilityMode),this._optimizationMode,r,nh(this._hints));return e&&i&&a.setEncoderConfiguration(i),v.debug("clone video track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),a}async replaceTrack(e,n){if(!(e instanceof MediaStreamTrack))throw new Z(P.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new Z(P.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(Tu(()=>{kt.reportApiInvoke(null,{name:Wn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Rn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!U("ENABLE_VIDEO_SEI")||!U("ENABLE_ENCODED_TRANSFORM"))return void v.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new Z(P.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void v.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const r=i.codecs[0].mimeType.toLocaleLowerCase();r==="video/h264"?this.safeEmit("sei-to-send",e):v.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(dr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await Xe(this,Ot.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Xe(this,Ot.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(dr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Cs.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Cs.REQUEST_CONSTRAINTS)}},ve(ge.prototype,"play",[xM,VM],Object.getOwnPropertyDescriptor(ge.prototype,"play"),ge.prototype),ve(ge.prototype,"stop",[BM],Object.getOwnPropertyDescriptor(ge.prototype,"stop"),ge.prototype),ve(ge.prototype,"setEnabled",[FM,jM,GM],Object.getOwnPropertyDescriptor(ge.prototype,"setEnabled"),ge.prototype),ve(ge.prototype,"setMuted",[HM,WM,KM],Object.getOwnPropertyDescriptor(ge.prototype,"setMuted"),ge.prototype),ve(ge.prototype,"setEncoderConfiguration",[YM,qM],Object.getOwnPropertyDescriptor(ge.prototype,"setEncoderConfiguration"),ge.prototype),ve(ge.prototype,"getStats",[zM],Object.getOwnPropertyDescriptor(ge.prototype,"getStats"),ge.prototype),ve(ge.prototype,"setBeautyEffect",[XM,JM],Object.getOwnPropertyDescriptor(ge.prototype,"setBeautyEffect"),ge.prototype),ve(ge.prototype,"getCurrentFrameData",[QM],Object.getOwnPropertyDescriptor(ge.prototype,"getCurrentFrameData"),ge.prototype),ve(ge.prototype,"getCurrentFrameImage",[ZM],Object.getOwnPropertyDescriptor(ge.prototype,"getCurrentFrameImage"),ge.prototype),ve(ge.prototype,"setBitrateLimit",[$M],Object.getOwnPropertyDescriptor(ge.prototype,"setBitrateLimit"),ge.prototype),ve(ge.prototype,"setOptimizationMode",[t1],Object.getOwnPropertyDescriptor(ge.prototype,"setOptimizationMode"),ge.prototype),ve(ge.prototype,"setScalabiltyMode",[e1],Object.getOwnPropertyDescriptor(ge.prototype,"setScalabiltyMode"),ge.prototype),ve(ge.prototype,"updateMediaStreamTrackResolution",[n1],Object.getOwnPropertyDescriptor(ge.prototype,"updateMediaStreamTrackResolution"),ge.prototype),ve(ge.prototype,"pipe",[i1],Object.getOwnPropertyDescriptor(ge.prototype,"pipe"),ge.prototype),ve(ge.prototype,"unpipe",[r1],Object.getOwnPropertyDescriptor(ge.prototype,"unpipe"),ge.prototype),ve(ge.prototype,"close",[s1],Object.getOwnPropertyDescriptor(ge.prototype,"close"),ge.prototype),ve(ge.prototype,"replaceTrack",[a1],Object.getOwnPropertyDescriptor(ge.prototype,"replaceTrack"),ge.prototype),ge),cw=(o1=Wt({argsMap:(t,e)=>[t.getTrackId(),e]}),c1=Pn(),l1=Pf("CameraVideoTrack","_enabledMutex"),u1=Wt({argsMap:(t,e)=>[t.getTrackId(),e]}),d1=Pn(),h1=Wt({argsMap:(t,e)=>[t.getTrackId(),e]}),p1=Pn(),f1=Wt({argsMap:t=>[t.getTrackId()]}),Os=class BB extends cn{get __className__(){return"CameraVideoTrack"}constructor(e,n,i,r,a,c){super(e,rc(n.encoderConfig),r,a,c),X(this,"_config",void 0),X(this,"_originalConstraints",void 0),X(this,"_constraints",void 0),X(this,"_enabled",!0),X(this,"_deviceName","default"),X(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Nf()||II())&&!function(){const l=Re();if(l.os!==ri.IOS||!l.osVersion)return!1;const d=l.osVersion.split(".");return Number(d[0])===15&&Number(d[1])>=2}()&&HP()&&this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=e.label,this._encoderConfig=rc(this._config.encoderConfig),Fe.on(yi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Fe.on(yi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(v.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const n=await Is.getDeviceById(e),i={};i.video=dn({},this._constraints),i.video.deviceId={exact:e},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await As(i,this.getTrackId())}catch(a){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),r=await As({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await Is.getDeviceById(e);this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}v.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){v.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const n={video:dn(dn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await As(n,this.getTrackId())}catch(r){throw v.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),r.toString()),i=await As({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=dn({},n.video),v.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await As({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await Xe(this,Ot.NEED_ENABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Xe(this,Ot.NEED_DISABLE_TRACK,this)}catch(i){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new Z(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=rc(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const i=yn(this._config);i.encoderConfig=e;const r=Zy(i);(Ni()||ur()||ya())&&(r.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(a){const c=new Z(P.UNEXPECTED_ERROR,a.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=i,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,this._hints.indexOf(Qe.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Xe(this,Ot.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(v)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ur()||ya())&&this._enabled&&!this._isClosed&&Fe.duringInterruption){const e=async()=>{Fe.off(yi.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Fe.on(yi.IOS_INTERRUPTION_END,e)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Bf.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,i=Is.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const r=await As({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Fe.off(yi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Fe.off(yi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=dn(dn({},i),rc(e))),i=nh(i);const r=Je(8,"track-cam-cloned-"),a=new BB(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,nh(dn(dn({},this._config),{},{encoderConfig:i})),nh(this._constraints),nh(this._scalabilityMode),this._optimizationMode,r);return e&&i&&a.setEncoderConfiguration(i),v.debug("clone track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),a}bindProcessorContextEvents(){this.processorContext.on(Cs.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}}),this.processorContext.on(Cs.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},ve(Os.prototype,"setDevice",[o1,c1],Object.getOwnPropertyDescriptor(Os.prototype,"setDevice"),Os.prototype),ve(Os.prototype,"setEnabled",[l1,u1,d1],Object.getOwnPropertyDescriptor(Os.prototype,"setEnabled"),Os.prototype),ve(Os.prototype,"setEncoderConfiguration",[h1,p1],Object.getOwnPropertyDescriptor(Os.prototype,"setEncoderConfiguration"),Os.prototype),ve(Os.prototype,"close",[f1],Object.getOwnPropertyDescriptor(Os.prototype,"close"),Os.prototype),Os);function lw(t,e,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=dn(dn({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?v.debug("[".concat(t,"] set content hint to"),n.optimizationMode):v.debug("[".concat(t,"] set content hint failed")))):v.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var m1,_1,E1,g1,Xs,S1,T1,R1,y1,v1,C1,Zi;class b1 extends Dk{getUserId(){return this._userId}constructor(e,n,i,r){super(e,"track-".concat(e.kind,"-").concat(n,"-").concat(r.clientId,"_").concat(Je(5,""))),X(this,"_userId",void 0),X(this,"_uintId",void 0),X(this,"_isDestroyed",!1),X(this,"store",void 0),X(this,"processor",void 0),X(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,v.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Kf=(m1=Wt({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),_1=Wt({argsMap:t=>[t.getTrackId()]}),E1=Wt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),g1=Wt({argsMap:t=>[t.getTrackId()]}),ve((Xs=class extends b1{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Qi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,n,i){super(t,e,n,i),X(this,"_videoVisibleTimer",null),X(this,"_previousVideoVisibleStatus",void 0),X(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),X(this,"trackMediaType",jf.VIDEO),X(this,"_videoWidth",void 0),X(this,"_videoHeight",void 0),X(this,"_player",void 0),X(this,"processorDestination",void 0),X(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new Hk(this.getTrackId(),"remote"),this.processorDestination=new Gk(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Tu(()=>{v.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Ts(this,Ot.GET_STATS)||dn({},Ok)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=dn(dn({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new ow(n):this._player=new UM(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Ff.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=i=>{this.safeEmit(Ff.VIDEO_STATE_CHANGED,i)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Ff.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},U("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Yk(this._originMediaStreamTrack).then(t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e}).catch(jy)}_updatePlayerSource(){v.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:r,slot:a}=i;if(this.isPlaying&&r instanceof HTMLVideoElement&&a instanceof HTMLElement){const c=qP.checkOneElementVisible(r),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const d=kt.reportApiInvoke(null,{tag:Rn.TRACER,name:Wn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?d.onSuccess("Video is visible"):d.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(n){throw new Z(P.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new Z(P.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(dr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(dr.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(ah.SEI_RECEIVED,t)}}).prototype,"play",[m1],Object.getOwnPropertyDescriptor(Xs.prototype,"play"),Xs.prototype),ve(Xs.prototype,"stop",[_1],Object.getOwnPropertyDescriptor(Xs.prototype,"stop"),Xs.prototype),ve(Xs.prototype,"pipe",[E1],Object.getOwnPropertyDescriptor(Xs.prototype,"pipe"),Xs.prototype),ve(Xs.prototype,"unpipe",[g1],Object.getOwnPropertyDescriptor(Xs.prototype,"unpipe"),Xs.prototype),Xs),Yf=(S1=Wt({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),T1=Wt({argsMap:(t,e)=>[t.getTrackId(),e]}),R1=Wt({argsMap:t=>[t.getTrackId()]}),y1=Wt({argsMap:t=>[t.getTrackId()]}),v1=Wt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),C1=Wt({argsMap:t=>[t.getTrackId()]}),ve((Zi=class extends b1{get isPlaying(){return this._useAudioElement?Cr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,n,i){super(t,e,n,i),X(this,"trackMediaType",jf.AUDIO),X(this,"_source",void 0),X(this,"_useAudioElement",!0),X(this,"_volume",100),X(this,"processorContext",void 0),X(this,"processorDestination",void 0),X(this,"_played",!1),X(this,"_bypassWebAudio",!1),U("DISABLE_WEBAUDIO")?(this._source=new sw,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Mk(t,!0),U("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(vs.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Ff.FIRST_FRAME_DECODED)}),this.processorContext=new Kk(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Wk(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(vs.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(vs.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(vs.ON_AUDIO_BUFFER),this._source.on(vs.ON_AUDIO_BUFFER,n=>t(n))}setVolume(t){this._volume=t,this._useAudioElement?Cr.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!bk())throw new Z(P.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Cr.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Tu(()=>{v.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Ts(this,Ot.GET_STATS)||dn({},wk)}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] use audio element to play")),Cr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Cr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Cr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new Z(P.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new Z(P.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new Z(P.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(dr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(dr.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(dr.ON_TRACK),this.processorDestination.removeAllListeners(dr.ON_NODE)}}).prototype,"setVolume",[S1],Object.getOwnPropertyDescriptor(Zi.prototype,"setVolume"),Zi.prototype),ve(Zi.prototype,"setPlaybackDevice",[T1],Object.getOwnPropertyDescriptor(Zi.prototype,"setPlaybackDevice"),Zi.prototype),ve(Zi.prototype,"play",[R1],Object.getOwnPropertyDescriptor(Zi.prototype,"play"),Zi.prototype),ve(Zi.prototype,"stop",[y1],Object.getOwnPropertyDescriptor(Zi.prototype,"stop"),Zi.prototype),ve(Zi.prototype,"pipe",[v1],Object.getOwnPropertyDescriptor(Zi.prototype,"pipe"),Zi.prototype),ve(Zi.prototype,"unpipe",[C1],Object.getOwnPropertyDescriptor(Zi.prototype,"unpipe"),Zi.prototype),Zi);const ul=new class extends _n{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),X(this,"_lastHiddenTime",0),X(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),v.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class A1 extends _n{constructor(e,n){super(),X(this,"trackMediaType",jf.DATA),X(this,"_version",1),X(this,"_type",3),X(this,"_config",void 0),X(this,"_originDataChannel",void 0),X(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),X(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),X(this,"_datachannelEventMap",new Map),this._config=e,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return U("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Et((e,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const i=setTimeout(()=>{var r;n(new Z(P.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((r=this._originDataChannel)===null||r===void 0?void 0:r.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new Z(P.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new Z(P.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[Jy.OPEN,Jy.CLOSE,Jy.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),e.addEventListener(n,i)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,r]=n;e.removeEventListener(i,r)}),this._datachannelEventMap.clear()}}class KH extends A1{constructor(e){super(e),X(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),r=new DataView(i).getUint8(3);if(r!==this.id)return void(U("SHOW_DATASTREAM2_LOG")&&v.debug("invalid datachannel id: ".concat(r," !== ").concat(this.id)));let a=n.data.slice(this._dataStreamPacketHeader.byteLength);a=this._dataStreamPacketHandler.deserialize(a),this.emit(Jy.MESSAGE,a)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class YH extends A1{send(e){if(this._originDataChannel){let n=e;n=this._dataStreamPacketHandler.serialize(e);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function tv(){const t=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>ty.revokeObjectURL(t),0),new Worker(ty.createObjectURL(t))}const I1=71,uw=1,dw=2,hw=1,w1=2;var dl=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(dl||{});function O1(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=t.getUint8(0);if(n!==I1)return;const i=t.getUint16(1),r=uw+dw+i,a=new Uint8Array(t.byteLength-r);a.set(new Uint8Array(t.buffer,r,t.byteLength-r));const c={m:n,tlvLen:i,tlv:[],frame:a};let l=uw+dw;for(;l<r;){const d=t.getUint8(l),h=t.getUint16(l+hw),p=hw+w1;if(d===dl.AUDIO_LEVEL){let m=t.getUint8(l+p);for(let S=1;S<h;S++)m=m<<8|t.getUint8(l+p+S);c.tlv.push({tag:d,length:h,value:e?127^m>>1:127&m})}else if(d===dl.METADATA||d===dl.AUDIO_64_BIT_PTS){const m=new Uint8Array(h);for(let S=0;S<h;S++)m[S]=t.getUint8(l+p+S);c.tlv.push({tag:d,length:h,value:m})}l+=p+h}return c}const ev=new Map,nv=127,lh=1e-10,pw=139/13,iv=new Map;function fw(t,e,n){const i="".concat(t,"-").concat(e,"-").concat(n);let r=0;return iv.has(i)?r=iv.get(i):(r=Math.log(function(c,l){const d=c-l;l<d&&(l=d);let h=1;for(let p=c,m=1;p>l;p--,m++)h=h*p/m;return h}(e,t))+t*Math.log(.5)+(e-t)*Math.log(1-.5)-Math.log(n)+n*t,iv.set(i,r)),r<lh&&(r=lh),r}function N1(t,e,n){const i=e.length,r=t.length/i;let a=!1;for(let c=0,l=0;c<i;c++){let d=0;for(let h=l+r;l<h;l++)t[l]>n&&d++;e[c]!==d&&(e[c]=d,a=!0)}return a}window.cache=iv;let qH=0;class D1{constructor(e){X(this,"id",void 0),X(this,"immediates",[]),X(this,"lastNonSilence",-1),X(this,"immediateSpeechActivityScore",lh),X(this,"lastLevelChangedTime",Date.now()),X(this,"levels",[]),X(this,"longs",[]),X(this,"longSpeechActivityScore",lh),X(this,"mediums",[]),X(this,"mediumSpeechActivityScore",lh),X(this,"minLevel",0),X(this,"nextMinLevel",0),X(this,"nextMinLevelWindowLength",0),X(this,"energyScore",0),this.id=e||"".concat(qH++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,n=this.levels,i=this.minLevel+pw;let r=!1;for(let a=0;a<e.length;++a){let c=n[a];c<i&&(c=0);const l=Math.floor(c/pw);e[a]!==l&&(e[a]=l,r=!0)}return r}computeLongs(){return N1(this.mediums,this.longs,4)}computeMediums(){return N1(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=fw(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=fw(this.longs[0],10,47),this.longSpeechActivityScore>lh&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=fw(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(lp(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=e;return e<0&&(i=0),e>nv&&(i=nv),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+pw?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(e!==0){if(this.minLevel===0||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>nv&&(n=nv),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class zH{constructor(e){X(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?e=!0:setTimeout(this.execute.bind(this),n)}catch{e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class mw{constructor(e,n,i){X(this,"isDominant",void 0),X(this,"energyRanking",void 0),X(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=n,this.energyScore=i}}class XH extends _n{constructor(e){super(),X(this,"dominantId",null),X(this,"lastDecisionTime",0),X(this,"lastLevelChangedTime",0),X(this,"lastLevelIdleTime",0),X(this,"relativeSpeechActivities",[]),X(this,"speakers",new Map),X(this,"enableSilence",!1),X(this,"timeoutToSilenceInterval",0),X(this,"decisionMaker",null),X(this,"loudest",[]),X(this,"numLoudestToTrack",3),X(this,"energyExpireTimeMs",250),X(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(n=>n.id===e)}levelChanged(e,n){const i=Date.now(),r=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const a=r.levelChanged(n,i);return this.updateLoudestList(r,a,i)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(e){e.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(e){let n=this.speakers.get(e);return n||(n=new D1(e),this.speakers.set(e,n),this.maybeStartDecisionMaker()),n}updateLoudestList(e,n,i){const r=e.id===this.dominantId;if(n<0){let d=0;for(;d<this.loudest.length&&this.loudest[d]!==e;)++d;return new mw(r,d,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*e.energyScore+50)/100),this.numLoudestToTrack===0)return new mw(r,0,e.energyScore);const a=i-this.energyExpireTimeMs;let c=0;for(;c<this.loudest.length;){const d=this.loudest[c];if(d.getLastLevelChangedTime()<a&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(c,1);else if(d.id!==e.id)++c;else if(this.loudest.splice(c,1),this.loudest.length<this.numLoudestToTrack)break}let l=0;for(;l<this.loudest.length&&!(this.loudest[l].energyScore<e.energyScore);)++l;return l<this.numLoudestToTrack&&(this.loudest.splice(l,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new mw(r,l,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new zH(this),this.decisionMaker.execute())}makeDecision(e){let n=null,i=null;const r=this.speakers.size;let a=null;if(r===0)a=null;else if(r===1){var c;const l=gi(c=this.speakers).call(c).next().value;this.enableSilence&&l&&(a=l.id,l.evaluateSpeechActivityScores(e),e-l.lastNonSilence>this.timeoutToSilenceInterval&&(a=null))}else{let l=this.dominantId==null?null:this.speakers.get(this.dominantId);if(l==null){const p=this.speakers.entries().next();p.value&&(a=p.value[0],l=p.value[1])}else a=l.id;l!=null&&l.evaluateSpeechActivityScores(e);const d=this.relativeSpeechActivities;let h=2;for(const p of this.speakers.entries()){const[m,S]=p;if(S===l)continue;S.evaluateSpeechActivityScores(e);for(let I=0;I<d.length;++I){const D=l==null?lh:l.getSpeechActivityScore(I);d[I]=Math.log(S.getSpeechActivityScore(I)/D)}const R=d[0],O=d[1],A=d[2];R>3&&O>2&&A>0&&O>h&&(h=O,a=m)}this.enableSilence&&l!=null&&a===l.id&&e-l.lastNonSilence>this.timeoutToSilenceInterval&&(a=null)}a==null&&!this.enableSilence||a===this.dominantId||(n=this.dominantId,this.dominantId=a,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const e=Date.now(),n=300-(e-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):i=n;let r=300-(e-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=e,this.makeDecision(e),r=300-(Date.now()-e)),r>0&&i>r&&(i=r),i}timeoutIdleLevels(e){const n=[];for(const r of gi(i=this.speakers).call(i)){var i;const a=e-r.getLastLevelChangedTime();36e5<a&&(this.dominantId==null||r.id!==this.dominantId)?n.push(r.id):300<a&&r.levelTimedOut()}n.forEach(r=>this.speakers.delete(r))}}const qf=new Map;let So=null,rv=null;const L1=3;let uh=[];const To=new Map,sv=new Map;class JH{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,n){X(this,"id",void 0),X(this,"track",void 0),X(this,"score",0),X(this,"active",!0),X(this,"muted",!1),X(this,"timer",0),X(this,"actives",0),X(this,"inactives",0),this.id=e,this.track=n,this.setActive(To.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const r=[],a=[];return Array.from(gi(To).call(To)).forEach(c=>{c.active?r.push(c):a.push(c)}),{actives:r,inactives:a}}();if(n.length>3){let r;n.forEach(a=>{(!r||r.score>a.score)&&(r=a)}),r&&r.setActive(!1)}if(n.length<3&&i.length>0){let r;i.forEach(a=>{(!r||r.score<a.score)&&a.id!==this.id&&(r=a)}),r&&e&&!this.active&&(r.samples>40&&r.activeRate-this.activeRate>.4?r.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(n){let i;return Array.from(gi(To).call(To)).forEach(r=>{!r.active||r.id===n||r.samples<40||(!i||r.score<i.score)&&(i=r)}),i}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(n){let i;return Array.from(gi(To).call(To)).forEach(r=>{r.active||r.id===n||r.samples<40||(!i||r.score>i.score)&&(i=r)}),i}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let av;function P1(t){const e=To.get(t);e&&(To.delete(t),e.clearTimer())}const ov=new Map,QH=new Map;function ZH(t,e,n){let i=new Uint8Array(t,e,n),r=[],a=0;for(;r.length<n;)a+3<n&&i[a]===0&&i[a+1]===0&&i[a+2]===3&&(i[a+3]===0||i[a+3]===1||i[a+3]===2||i[a+3]===3)?(r.push(i[a],i[a+1],i[a+3]),a+=4):(r.push(i[a]),a++);return new Uint8Array(r)}const cv=new Map,vg=new Map;(function(){const t=Re();Ri.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ri.getStreamFromExtension=t.name===Oe.CHROME&&Number(t.version)>34,Ri.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let n=!1;try{e.addTransceiver("audio"),n=!0}catch{}return e.close(),n}(),Ri.supportMinBitrate=t.name===Oe.CHROME||t.name===Oe.EDGE,Ri.supportSetRtpSenderParameters=function(){const e=Re();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!ol()||!(!Ni()&&!xy())||e.name===Oe.FIREFOX&&Number(e.version)>=64)}(),t.name===Oe.SAFARI&&(Number(t.version)>=14?Ri.supportDualStream=!0:Ri.supportDualStream=!1),Ri.webAudioMediaStreamDest=function(){const e=Re();return!(e.name===Oe.SAFARI&&Number(e.version)<12)}(),Ri.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Ri.supportWebGL=typeof WebGLRenderingContext<"u",Ri.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ol()||(Ri.webAudioWithAEC=!0),Ri.supportShareAudio=function(){const e=Re();return(e.os===ri.WIN_10||e.os===ri.WIN_81||e.os===ri.WIN_7||e.os===ri.LINUX||e.os===ri.MAC_OS||e.os===ri.CHROMIUM_OS)&&e.name===Oe.CHROME&&Number(e.version)>=74}(),Ri.supportDataChannel=!!(hg(76)||function(e){const n=Re();return!(n.name!==Oe.FIREFOX||!n.osVersion)&&Number(n.version)>=e}(68)||VP(14)),Ri.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!Sn()&&!!e&&e.prototype.setConfiguration instanceof Function}(),Ri.supportWebRTCEncodedTransform=function(){const e=Re();return e.name==="Chrome"&&Number(e.version)>=87||e.name==="Safari"&&Number(e.version)>=15}(),Ri.supportWebRTCInsertableStream=function(){const e=Re();return(e.name===Oe.CHROME||e.name===Oe.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Ri.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Ri.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Fy(()=>{Ri.supportDualStreamEncoding=function(){const e=Re();return!!U("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&U("CHROME_DUAL_STREAM_USE_ENCODING"))}(),v.debug("browser ua: ",navigator.userAgent),v.info("browser info: ",t),v.info("browser compatibility: ",Ri)})})();const $H=["CHINA","GLOBAL"],k1=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],dh=[],zf=[];function hh(t,e){return!!e&&dh.some(n=>n.uid===t&&n.channelName===e)}function _w(){return zf.length>0}var t6=nL.forEach,M1=Ha("forEach")?[].forEach:function(t){return t6(this,t,arguments.length>1?arguments[1]:void 0)};Ue({target:"Array",proto:!0,forced:[].forEach!=M1},{forEach:M1});var e6=Sr("Array").forEach,n6=ks,i6=di,r6=ht,s6=e6,Ew=Array.prototype,a6={DOMTokenList:!0,NodeList:!0},o6=function(t){var e=t.forEach;return t===Ew||r6(Ew,t)&&e===Ew.forEach||i6(a6,n6(t))?s6:e},c6=w(o6),l6=Dr,U1=hi;Ue({target:"Object",stat:!0,forced:M(function(){U1(1)})},{keys:function(t){return U1(l6(t))}});var x1=w(zr.Object.keys),u6=w(Pc),d6=w(n_),h6=Ue,V1=ra,p6=js,f6=er,B1=tp,m6=ja,_6=Ls,E6=ff,g6=In,S6=Ad,T6=YD("slice"),R6=g6("species"),gw=Array,y6=Math.max;h6({target:"Array",proto:!0,forced:!T6},{slice:function(t,e){var n,i,r,a=_6(this),c=m6(a),l=B1(t,c),d=B1(e===void 0?c:e,c);if(V1(a)&&(n=a.constructor,(p6(n)&&(n===gw||V1(n.prototype))||f6(n)&&(n=n[R6])===null)&&(n=void 0),n===gw||n===void 0))return S6(a,l,d);for(i=new(n===void 0?gw:n)(y6(d-l,0)),r=0;l<d;l++,r++)l in a&&E6(i,r,a[l]);return i.length=r,i}});var v6=Sr("Array").slice,C6=ht,b6=v6,Sw=Array.prototype,A6=function(t){var e=t.slice;return t===Sw||C6(Sw,t)&&e===Sw.slice?b6:e},I6=w(A6);function Dt(t,e,n,i,r){var a,c,l,d={};return c6(a=x1(i)).call(a,function(h){d[h]=i[h]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u6(c=d6(l=I6(n).call(n)).call(l)).call(c,function(h,p){return p(t,e,h)||h},d),r&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(r):void 0,d.initializer=void 0),d.initializer===void 0&&(GD(t,e,d),d=null),d}let lv=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),Tw=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),ba=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),hr=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),Ht=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),nn=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),qt=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),Yt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),Cg=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),ue=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),pr=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),te=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function uv(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw v.error("Invalid Channel Name ".concat(t)),new J(P.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function dv(t){if(e=t,!(typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295||YP(t,1,255)))throw new J(P.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;typeof t=="string"&&v.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let hl=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const w6={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Rw={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function yw(t,e){Si(t.url,"".concat(e,".url"),1,1e3,!1),Tn(t.x)||He(t.x,"".concat(e,".x"),0,1e4),Tn(t.y)||He(t.y,"".concat(e,".y"),0,1e4),Tn(t.width)||He(t.width,"".concat(e,".width"),0,1e4),Tn(t.height)||He(t.height,"".concat(e,".height"),0,1e4),Tn(t.zOrder)||He(t.zOrder,"".concat(e,".zOrder"),0,255),Tn(t.alpha)||He(t.alpha,"".concat(e,".alpha"),0,1,!1)}const O6={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let vu=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),vw=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Jn=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function F1(t){if(!t.channelName)throw new J(P.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new J(P.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Si(t.token,"info.token",1,2047),dv(t.uid),uv(t.channelName),!0}let fr=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),pl=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Fr=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),Xf=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),Me=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),fi=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),hv=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),ai=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Ne=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const j1=[Ne.AFRICA,Ne.ASIA,Ne.CHINA,Ne.EUROPE,Ne.GLOBAL,Ne.INDIA,Ne.JAPAN,Ne.NORTH_AMERICA,Ne.OCEANIA,Ne.OVERSEA,Ne.SOUTH_AMERICA];let Vi=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const pv={CHINA:{},ASIA:{CODE:Vi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Vi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Vi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Vi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Vi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Vi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Vi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Vi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Vi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Vi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Vi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Vi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Vi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};WI&&(pv.CHINA={CODE:Vi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let bg=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function G1(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class H1 extends _n{constructor(e,n){super(),N(this,"onICEConnectionStateChange",void 0),N(this,"onConnectionStateChange",void 0),N(this,"onDTLSTransportStateChange",void 0),N(this,"onDTLSTransportError",void 0),N(this,"onICETransportStateChange",void 0),N(this,"onFirstAudioReceived",void 0),N(this,"onFirstVideoReceived",void 0),N(this,"onFirstAudioDecoded",void 0),N(this,"onFirstVideoDecoded",void 0),N(this,"onFirstVideoDecodedTimeout",void 0),N(this,"onSelectedLocalCandidateChanged",void 0),N(this,"onSelectedRemoteCandidateChanged",void 0),N(this,"onICECandidateError",void 0),N(this,"getLocalVideoStats",void 0)}}class W1 extends H1{constructor(e,n){super(e,n),N(this,"establishPromise",void 0)}}let wt=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Bi=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),fl=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const K1=["disconnected","failed"];let ct=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),ke=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),jt=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),Aa=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Ia=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),mi=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Y1=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),oc=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),Js=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Ro=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Jf=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),kn=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),Qf=function(t){return t.ABORT="abort",t}({}),Cu=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),N6=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const D6={[lv.ACCESS_POINT]:{[hr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[hr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[hr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[hr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[hr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[hr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[hr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[hr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[hr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[hr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[hr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[hr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[hr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[hr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[hr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[hr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[hr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[hr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[lv.UNILBS]:{[ba.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ba.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ba.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ba.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ba.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ba.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ba.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ba.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ba.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ba.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ba.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ba.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[lv.STRING_UID_ALLOCATOR]:{[Tw.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Tw.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Tw.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Zf(t){const e=D6[Math.floor(t/1e4)];if(!e)return{desc:"unknown error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===lv.ACCESS_POINT){const i=t%1e4;if(i.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const L6={[Ht.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ht.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ht.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ht.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ht.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ht.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ht.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ht.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ht.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ht.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ht.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ht.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Ht.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ht.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ht.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ht.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ht.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ht.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ht.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ht.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ht.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ht.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ht.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ht.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ht.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ht.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ht.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ht.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ht.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ht.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ht.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ht.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ht.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ht.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ht.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ht.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ht.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ht.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ht.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ht.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ht.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ht.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ht.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ht.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ht.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ht.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ht.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ht.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ht.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ht.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ht.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ht.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ht.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ht.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ht.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ht.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ht.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ht.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ht.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ht.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ht.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ht.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ht.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ht.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Ag(t){return L6[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function q1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Cw(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?q1(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):q1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function z1(t,e){if(typeof t=="string")return t;const{proxy:n,host:i,port:r}=t;if(e){const a=U("JOIN_GATEWAY_FALLBACK_PORT")||443;return a===443?"wss://".concat(i,"/ws/?p=").concat(Number(r)+150):"wss://".concat(i,":").concat(a,"/ws/?p=").concat(Number(r)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(r):"wss://".concat(i,":").concat(r)}const P6=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,k6=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,M6=/wss:\/\/(.+):([0-9]+)\/?/,U6=/wss:\/\/(.[^\/]+)\/?/;let x6=0;class V6{constructor(e,n){N(this,"id",0),N(this,"store",void 0),N(this,"recordIndex",void 0),N(this,"websockets",[]),N(this,"try443PortDuration",2e3),N(this,"forceCloseWSDuration",5e3),N(this,"try443PortTimeout",null),N(this,"forceCloseTimeout",null),N(this,"isTry443PortFailed",!1),N(this,"isNormalPortFailed",!1),N(this,"useDoubleDomain",!1),N(this,"useProxy",!1),N(this,"startTime",Date.now()),this.id=++x6,this.try443PortDuration=U("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const n=Date.now()-this.startTime;for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];v.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...r)}createWebSocket(e,n,i){this.logger("createWebSocket:",e,{isTry443Port:n,hasTimeoutDetection:i});const r=U("GATEWAY_DOMAINS"),a=Date.now(),c=[],l=r.find(S=>{var R;return _t(R=e.host).call(R,S)});l||(this.useDoubleDomain=!1);const d=[];if(this.useDoubleDomain)r.forEach(S=>{d.push(z1(Cw(Cw({},e),{},{host:e.host.replace(l,S)}),n))});else{const S=Cw({},e);if(n&&l){const R=r.find(O=>O!==l);R&&(S.host=S.host.replace(l,R))}d.push(z1(S,n))}try{d.forEach(S=>{const R=new WebSocket(S);R.binaryType="arraybuffer",c.push(R),this.logger("ws is connecting:",R.url)})}catch(S){if(this.logger("ws create failed"),c.forEach(R=>R.close()),c.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,n,i);if(!n&&Number(e.port)!==443)return this.createWebSocket(e,!0,i);throw new J(P.WS_ERR,"init websocket failed! Error: ".concat(S.toString()))}const h=dg();this.store&&this.store.recordJoinChannelService({urls:c.map(S=>S.url),service:"gateway"},this.recordIndex),c.forEach(S=>{S.onopen=()=>{this.logger("onopen: ws ".concat(S.url," open cost ").concat(Date.now()-a,"ms")),this.websockets.forEach(R=>{R!==S&&(R.onopen=null,R.onclose=null,R.onmessage=null,R.close(),this.logger("close backup websocket: ".concat(R.url)))}),this.websockets.length=0,h.resolve(S)},S.onclose=R=>{this.logger("onclose: ws ".concat(S.url," closed cost ").concat(Date.now()-a,"ms state: ").concat(S.readyState));const O=c.every(A=>A.readyState===WebSocket.CLOSED||A.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(O)),O&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(R.reason)),h.reject({code:R.code,reason:hv.A_ROUND_WS_FAILED})):!n&&O&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),m()),n?this.isTry443PortFailed=O:this.isNormalPortFailed=O},S.onmessage=R=>this.logger("".concat(S.url," onmessage: ").concat(R.data))}),this.websockets.push(...c);const p=()=>{this.websockets.forEach(S=>S.readyState!==WebSocket.OPEN&&S.close())},m=()=>{if(h.isResolved)return p();Re().os===ri.MAC_OS&&Sn()&&p(),this.createWebSocket(e,!0,!0).then(S=>{h.resolve(S)}).catch(S=>{this.isNormalPortFailed&&h.reject(S),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",h.isResolved),this.forceCloseTimeout=null,p()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,p()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",h.isResolved),this.try443PortTimeout=null,m()},this.try443PortDuration)})(),h.promise}chooseBestWebsocket(e,n,i,r){return this.useDoubleDomain=!!n,typeof e=="string"&&(e=function(a){let c,l,d;return[,c,l,d]=a.match(P6)||[],c||([,l,d]=a.match(k6)||[]),l&&d||([,l,d]=a.match(M6)||[]),l&&d||([,l]=a.match(U6)||[]),l||v.warning("un-destructible url: ",a),{proxy:c,host:l,port:d||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,i&&this.useProxy&&(v.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(e,!!i,!1).finally(()=>this.clearTimeout())}}function X1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class J1 extends _n{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var n;_t(n=["tryNext","recover"]).call(n,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(te.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(te.CONNECTED):this._state==="closed"?this.emit(te.CLOSED):this._state==="failed"&&this.emit(te.FAILED))}resetReconnectCount(e){v.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],a=arguments.length>4&&arguments[4]!==void 0&&arguments[4],c=arguments.length>5?arguments[5]:void 0;super(),N(this,"connectionID",0),N(this,"currentURLIndex",0),N(this,"urls",[]),N(this,"_reconnectMode","tryNext"),N(this,"reconnectReason",void 0),N(this,"_initMutex",void 0),N(this,"name",void 0),N(this,"_state","closed"),N(this,"reconnectInterrupter",void 0),N(this,"websocket",void 0),N(this,"retryConfig",void 0),N(this,"reconnectCount",0),N(this,"forceCloseTimeout",5e3),N(this,"onlineReconnectListener",void 0),N(this,"useCompress",void 0),N(this,"tryDoubleDomain",!1),N(this,"use443PortOnly",!1),N(this,"wsInflateLength",0),N(this,"wsDeflateLength",0),N(this,"closeEstablishingWs",()=>{}),N(this,"store",void 0),N(this,"joinGatewayRecordIndex",void 0),this.store=c,this.name=e,this.retryConfig=function(m){for(var S=1;S<arguments.length;S++){var R=arguments[S]!=null?arguments[S]:{};S%2?X1(Object(R),!0).forEach(function(O){N(m,O,R[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(R)):X1(Object(R)).forEach(function(O){Object.defineProperty(m,O,Object.getOwnPropertyDescriptor(R,O))})}return m}({},n),this.useCompress=i,this.tryDoubleDomain=r,this.use443PortOnly=a,this._initMutex=new xi("websocket",c?c.clientId:void 0);const{timeout:l,timeoutFactor:d}=n,h=Math.max(300,Math.floor(3*l/5)),p=Math.max(1.2,Math.floor(8*d)/10);ss.ONLINE&&(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p),xn.on(Df.NETWORK_STATE_CHANGE,(m,S)=>{m!==S&&(this.resetReconnectCount("network state change: ".concat(S," -> ").concat(m)),m===ss.ONLINE?(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p):(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=d))})}getConnection(){return this.websocket||void 0}async init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=e,this.state="connecting";try{const r=dg(),a=this.urls[this.currentURLIndex];U("ENABLE_PREALLOC_PC")&&this.emit(Y1.PRE_CONNECT_PC),this.createWebSocketConnection(a).then(r.resolve).catch(r.reject),this.once(te.CLOSED,()=>{r.reject(new Z(P.WS_DISCONNECT))}),this.once(te.CONNECTED,r.resolve),await r.promise}catch{}finally{i()}}close(e,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,n){if(!this.websocket)return void v.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),v.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Z(P.WS_ABORT,"websocket is not ready");try{n||(e=JSON.stringify(e)),this.websocket.send(e)}catch(i){throw new Z(P.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var n;const i=dg();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=p=>{var m;(m=this.store)===null||m===void 0||m.signalChannelOpen(),v.debug("[".concat(this.name,"] websocket opened:"),p),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},a=async p=>{var m;if(v.debug("[".concat(this.name,"] websocket close ").concat((m=this.websocket)===null||m===void 0?void 0:m.url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new Z(P.WS_DISCONNECT,"websocket close: ".concat(p.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");const S=Ts(this,te.WILL_RECONNECT,this.reconnectMode,p.reason)||this.reconnectMode,R=await this.reconnectWithAction(S);if(this.state==="closed")return void v.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!R)return i.reject(new Z(P.WS_DISCONNECT,"websocket reconnect failed: ".concat(p.code))),this.close(!0);i.resolve()}},c=p=>{this.emit(te.ON_MESSAGE,p)},l=p=>{v.warn("[".concat(this.connectionID,"] ws open error ").concat(p))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),U("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=U("GATEWAY_WSS_ADDRESS")),v.debug("[".concat(this.name,"] start connect, url:"),e);const d=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var h;const p=await this.chooseBestWebsocketConnection(e);this.websocket=p,r&&r(this.websocket.url),this.websocket.onclose=a,this.websocket.onmessage=c,this.websocket.onerror=l,(h=this.store)===null||h===void 0||h.recordJoinChannelService({endTs:Date.now(),status:"success"},d),this.joinGatewayRecordIndex=d}catch(p){const m=this.state==="closed",S=p instanceof Z,R=S&&p.code===P.WS_ABORT,O=S&&p.code===P.WS_ERR,A=S?p.message:p&&(p.reason||p.toString());v.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(A)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:R?"aborted":"error",errors:[p]},d),m||O?(i.reject(m?new Z(P.WS_DISCONNECT,"websocket is closed: ".concat(A)):new Z(P.WS_ERR,"init websocket failed: ".concat(A))),O&&v.error("[".concat(this.name,"] init websocket failed: ").concat(A))):a&&a(p)}return i.promise}async reconnectWithAction(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;v.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||xn.isOnline||!xn.onlineWaiter||(this.onlineReconnectListener=xn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const c=UI(this.reconnectCount,this.retryConfig);v.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(e)),await Et.race([Ti(c),this.onlineReconnectListener||new Et(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const r=async(c,l)=>{this.emit(te.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(c)};try{if(e==="retry")await r(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);v.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],e)}else e==="recover"&&(v.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Li(this,te.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(c){var a;v.error("[".concat(this.name,"] reconnect failed ").concat(c&&c.toString()));const l=c==null||(a=c.data)===null||a===void 0?void 0:a.desc;return Array.isArray(l)&&_t(l).call(l,"dynamic key expired")?(this.emit(te.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,n)}return!0}}class bw extends J1{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){const i=dg(),r=function(c,l){return new V6(c,l)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{v.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),i.reject(new Z(P.WS_ABORT,"choose best websocket aborted"))};const a=U("GATEWAY_DOMAINS");return v.debug("[choose-best-ws] currentDomain: ",e,", domains: ",a,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Ig extends J1{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){return new Et((i,r)=>{let a=!1;const c=[];this.closeEstablishingWs=()=>{v.debug("[choose-best-ws] close establishing websockets"),c.forEach(O=>{O.onclose=null,O.onopen=null,O.onmessage=null,O.close()}),r(new Z(P.WS_ABORT,"choose best websocket aborted"))};const l=U("GATEWAY_DOMAINS");let d;const h=e.indexOf("?h="),p=l.find(O=>h!==-1?_t(e).call(e,O,h):_t(e).call(e,O));v.debug("[choose-best-ws] currentDomain: ",p,", domains: ",l);let m=!this.tryDoubleDomain||!p;if(!m&&p){var S;const O=Date.now();try{l.forEach(A=>{const I=h===-1?e.replace(p,A):e.substr(0,h)+e.substr(h).replace(p,A),D=new WebSocket(I);D.binaryType="arraybuffer",c.push(D),v.debug("[choose-best-ws] ws is connecting:",D.url)})}catch{for(v.debug("[choose-best-ws] ws create failed, fallback to single url"),c.forEach(I=>I.close());c.length;)c.pop();m=!0}(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:c.map(A=>A.url),service:"gateway"},n),c.forEach(A=>{A.onopen=()=>{if(a)return;const I=Date.now()-O;v.debug("[choose-best-ws] ws open cost ".concat(I,"ms")),c.filter(D=>D!==A).forEach(D=>{v.debug("[choose-best-ws]close backup websocket: ".concat(D.url)),D.close()}),a=!0,i(A)},A.onclose=I=>{d=I,!a&&(c.find(D=>!(D.readyState===WebSocket.CLOSED||D.readyState===WebSocket.CLOSING))||(v.debug("[choose-best-ws] all websocket is closed"),a=!0,r(d)))},A.onmessage=I=>{v.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(I.data))}}),Ti(this.forceCloseTimeout).then(()=>{c.forEach(A=>{A.readyState!==WebSocket.OPEN&&A.close()})})}if(m){var R;let O;v.debug("[choose-best-ws] use single url: ",e),(R=this.store)===null||R===void 0||R.recordJoinChannelService({urls:[e],service:"gateway"},n);try{O=new WebSocket(e),c.push(O),O.binaryType="arraybuffer"}catch(A){const I=new Z(P.WS_ERR,"init websocket failed! Error: ".concat(A.toString()));return v.error("[".concat(this.name,"]").concat(I)),void r(I)}O.onopen=()=>{i(O)},O.onclose=A=>{r(A)},O.onmessage=A=>{v.debug("[choose-best-ws]".concat(O.url," onmessage: ").concat(A.data))},Ti(this.forceCloseTimeout).then(()=>{O&&O.readyState!==WebSocket.OPEN&&O.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class B6 extends _n{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===nn.CONNECTED?this.emit(qt.WS_CONNECTED):e===nn.RECONNECTING?this.emit(qt.WS_RECONNECTING,this._websocketReconnectReason):e===nn.CLOSED&&this.emit(qt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),N(this,"_disconnectedReason",void 0),N(this,"_websocketReconnectReason",void 0),N(this,"_connectionState",nn.CLOSED),N(this,"reconnectToken",void 0),N(this,"websocket",void 0),N(this,"openConnectionTime",void 0),N(this,"clientId",void 0),N(this,"lastMsgTime",Date.now()),N(this,"uploadCache",[]),N(this,"uploadCacheInterval",void 0),N(this,"rttRolling",new ck(5)),N(this,"pingpongTimer",void 0),N(this,"wsInflateDataTimer",void 0),N(this,"pingpongTimeoutCount",0),N(this,"joinResponse",void 0),N(this,"multiIpOption",void 0),N(this,"initError",void 0),N(this,"spec",void 0),N(this,"store",void 0),N(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(qt.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const a="res-@".concat(r._id);this.emit(a,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){if(this.emit(r._type,r._message),r._type===ue.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===ue.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Pe.UID_BANNED);break;case 15:this.close(Pe.IP_BANNED);break;case 16:this.close(Pe.CHANNEL_BANNED)}if(r._type===ue.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case Ht.ERR_LICENSE_MISSING:this.close(Pe.LICENSE_MISSING);break;case Ht.ERR_LICENSE_EXPIRED:this.close(Pe.LICENSE_EXPIRED);break;case Ht.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Pe.LICENSE_MINUTES_EXCEEDED);break;case Ht.ERR_LICENSE_PERIOD_INVALID:this.close(Pe.LICENSE_PERIOD_INVALID);break;case Ht.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Pe.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ht.ERR_LICENSE_ILLEGAL:this.close(Pe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new bw("gateway-".concat(this.clientId),this.spec.retryConfig,!0,U("JOIN_GATEWAY_USE_DUAL_DOMAIN"),U("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===nn.CONNECTED&&this.reconnect("retry",Di.OFFLINE)})}async request(e,n,i,r){const a=Je(6,""),c={_id:a,_type:e,_message:n},l=this.websocket.connectionID,d=()=>new Et((O,A)=>{if(this.connectionState===nn.CONNECTED)return O();const I=()=>{this.off(qt.WS_CLOSED,D),O()},D=()=>{this.off(qt.WS_CONNECTED,I),A(new J(P.WS_ABORT))};this.once(qt.WS_CONNECTED,I),this.once(qt.WS_CLOSED,D),e!==Yt.PUBLISH&&e!==Yt.PUBLISH_DATASTREAM&&e!==Yt.SUBSCRIBE&&e!==Yt.SUBSCRIBE_DATASTREAM&&e!==Yt.UNSUBSCRIBE&&e!==Yt.UNSUBSCRIBE_DATASTREAM&&e!==Yt.UNPUBLISH&&e!==Yt.UNPUBLISH_DATASTREAM&&e!==Yt.CONTROL&&e!==Yt.RESTART_ICE||this.once(qt.DISCONNECT_P2P,()=>{A(new J(P.DISCONNECT_P2P))}),e!==Yt.PUBLISH&&e!==Yt.RESTART_ICE||this.once(qt.ABORT_P2P_EXECUTION,()=>{A(new J(P.DISCONNECT_P2P))})});if(this.connectionState!==nn.CONNECTING&&this.connectionState!==nn.RECONNECTING||e===Yt.JOIN||e===Yt.REJOIN||await d(),this.websocket.sendMessage(c,!0),r)return;const h=new Et((O,A)=>{let I=!1;const D=(V,W)=>{I=!0,O({isSuccess:V==="success",message:W||{}}),this.off(qt.WS_CLOSED,L),this.off(qt.WS_RECONNECTING,L),this.emit(qt.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(a),D);const L=()=>{A(new J(P.WS_ABORT,"type: ".concat(e))),this.off(qt.WS_CLOSED,L),this.off(qt.WS_RECONNECTING,L),this.off("res-@".concat(a),D)};this.once(qt.WS_CLOSED,L),this.once(qt.WS_RECONNECTING,L),Ti(U("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||I||(v.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(qt.REQUEST_TIMEOUT,e,n))})});let p=null;try{p=await h}catch(O){if(this.connectionState===nn.CLOSED||e===Yt.LEAVE)throw new J(P.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?O.throw():e===Yt.JOIN||e===Yt.REJOIN?null:(await d(),await this.request(e,n))}if(p.isSuccess)return p.message;const m=Number(p.message.error_code||p.message.code),S=Ag(m),R=new J(P.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(p.message.error_str),{code:m,data:p.message,desc:S.desc});return S.action==="success"?p.message:(v.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(m,", message: ").concat(S.desc,", action: ").concat(S.action)),m===Ht.ERR_TOO_MANY_BROADCASTERS?((e===Yt.JOIN||e===Yt.REJOIN)&&(this.initError=R,this.close()),R.throw()):S.action==="failed"?R.throw():S.action==="quit"?(this.initError=R,this.close(),R.throw()):(m===Ht.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Di.MULTI_IP)):this.reconnect(S.action,Di.SERVER_ERROR),e===Yt.JOIN||e===Yt.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new Et(i=>{const r=a=>{(!n||n(a))&&(this.off(e,r),i(a))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void v.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Cg.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const a=U("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==nn.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},U("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Et((n,i)=>{this.once(qt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(qt.WS_CLOSED,r=>i(this.initError||new J(P.WS_ABORT,r))),this.connectionState=nn.CONNECTING,this.websocket.init(e).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Pe.LEAVE,this.connectionState=nn.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(qt.ABORT_P2P_EXECUTION);const e=await Li(this,qt.REQUEST_JOIN_INFO),n=await this.request(Yt.JOIN,e);if(!n)return this.emit(qt.REPORT_JOIN_GATEWAY,hv.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(qt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=nn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new J(P.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=Eg(this,qt.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const n=await this.request(Yt.REJOIN,e);return!!n&&(this.connectionState=nn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(ue.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(ue.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(ue.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(ue.MUTE_AUDIO,{uid:i.uid}):this.emit(ue.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(ue.MUTE_VIDEO,{uid:i.uid}):this.emit(ue.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(ue.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(ue.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(ue.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(ue.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(ue.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleNotification(e){v.debug("[".concat(this.clientId,"] receive notification: "),e);const n=Ag(e.code);if(e.code===28&&"detail"in e&&(v.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(qt.RECOVER_NOTIFICATION,e.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Pe.UID_BANNED),void this.close()):void this.reconnect(n.action,Di.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=U("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(v.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>U("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Di.TIMEOUT):this.request(Yt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),U("REPORT_STATS")&&this.send(Yt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:n}=this.websocket.getWsInflateData();e!==0&&n!==0&&this.upload(Cg.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(te.RECONNECT_CREATE_CONNECTION,e=>{this.emit(qt.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(te.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(te.CLOSED,()=>{this.connectionState=nn.CLOSED}),this.websocket.on(te.FAILED,()=>{this._disconnectedReason=Pe.NETWORK_ERROR,this.connectionState=nn.CLOSED}),this.websocket.on(te.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===nn.CONNECTED?this.connectionState=nn.RECONNECTING:this.connectionState=nn.CONNECTING}),this.websocket.on(te.WILL_RECONNECT,(e,n,i)=>{const r=Eg(this,qt.IS_P2P_DISCONNECTED),a=r||e!=="retry";r&&e==="retry"&&(v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",n=hv.P2P_DISCONNECTED),a&&(v.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(qt.REPORT_JOIN_GATEWAY,n||hv.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(qt.DISCONNECT_P2P)),i(e)}),this.websocket.on(te.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",Di.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(qt.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof J){if(e.code===P.UNEXPECTED_RESPONSE&&e.data.code===Ht.ERR_NO_AUTHORIZED)return this.initError=new J(P.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Pe.TOKEN_EXPIRE);v.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Di.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(te.REQUEST_NEW_URLS,(e,n)=>{Li(this,qt.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(te.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Y1.PRE_CONNECT_PC,()=>{this.emit(qt.PRE_CONNECT_PC)})}}let F6=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),Vn=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function Q1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function fv(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Q1(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Q1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function bu(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(U("TURN_DOMAIN")):(v.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function Aw(t,e){t.addresses||(t.addresses=[]);const n=function(l,d){if(U("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return l.map(m=>{let{ip:S,port:R}=m;return{address:"".concat(S,":").concat(R)}});const h=U("GATEWAY_DOMAINS");let p=h[1]&&_t(d).call(d,h[1])?1:0;return l.map(m=>{let{domain_prefix:S,port:R,ip:O}=m;if(S)return{address:"".concat(S,".").concat(h[p++%h.length],":").concat(R)};const A=/^[\.\:\d]+$/.test(O),I=A?"".concat(O.replace(/[^\d]/g,"-"),".").concat(h[p++%h.length],":").concat(R):"".concat(O,":").concat(R);return A||v.debug("Cannot recognized as ip address: ".concat(O,", use as host")),{ip:O,port:R,address:I}})}(t.addresses,e),i=Array.isArray(t.detail)&&t.detail[18];if(i&&typeof i=="string"){const l=i.split(";");for(let d=0;d<l.length;d++){var r;const h=Ji(r=l[d]).call(r);n[d]&&h&&(n[d].ip6=h)}}const a=t.detail&&t.detail.candidate;let c;if(a){const[l,d]=a.split(":");l&&d&&(c={port:Number(d),ip:l,address:"".concat(l,":").concat(d)})}return{gatewayAddrs:n,apGatewayAddress:c,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function as(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function Z1(t){const e=t._encoderConfig;if(!e)return{};const n={resolution:e.width&&e.height?"".concat(as(e.width),"x").concat(as(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}function $1(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function wg(t,e){let n,i,r;switch(e){case Vn.CHOOSE_SERVER:i=4096,r="choose server";break;case Vn.CLOUD_PROXY:i=1048576,r="proxy";break;case Vn.CLOUD_PROXY_5:i=4194304,r="proxy5";break;case Vn.CLOUD_PROXY_FALLBACK:i=4194310,r="proxy fallback";break;default:throw new J(P.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(a=>{a.buffer&&a.buffer.flag===i&&(n={code:a.buffer.code,addresses:(a.buffer.edges_services||[]).map(c=>fv(fv({},c),{},{ticket:a.buffer.cert})),server_ts:t.enter_ts,uid:a.buffer.uid,cid:a.buffer.cid,cname:a.buffer.cname,detail:fv(fv({},a.buffer.detail),t.detail),flag:a.buffer.flag,opid:t.opid,cert:a.buffer.cert})}),!n)throw new J(P.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return n}async function tU(t,e){return await Et.all(t.addresses.map(async n=>({address:U("USE_TURN_IP")?n.ip:bu(n.ip),tcpport:n.port,udpport:n.port,username:e&&U("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():Pi.username,password:e&&U("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await LI(e.toString()):Pi.password})))}function Iw(t,e){const n=e.getMediaStreamTrack(!0).getSettings(),i=e.videoHeight||n.height,r=e.videoWidth||n.width;return i&&r?Math.max(Math.min(i,r)/Math.min(as(t.height),as(t.width)),1):(v.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Au(t){let{candidateType:e,relayProtocol:n,type:i,address:r,port:a,protocol:c}=t;const l={candidateType:e,relayProtocol:n,protocol:c};if(i!=="local-candidate"){const d=r.split(".");d.length>=4&&(d[1]="*",d[2]="*"),l.address=d.join("."),l.port=a}return l}function mv(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:U("SVC_MODE");if(U("ENABLE_SVC"))return function(e){return e in Wy}(t)?t:Wy.L1T3}const eU={[wt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[wt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function _v(t,e,n){e.forEach(i=>{var r;const a=eU[t].find(l=>{var d;let{key:h}=l;return _t(d=i.extensionName).call(d,h)});if(!a)return;const c=n.find(l=>{let{extensionName:d}=l;return _t(d).call(d,a.key)});c&&_t(r=c.extensionName).call(r,"gdpr_forbidden")&&(i.extensionName=c.extensionName)})}function $f(t,e){e.forEach(n=>{var i;const r=eU[t].find(a=>{var c;let{key:l}=a;return _t(c=n.extensionName).call(c,l)});_t(i=n.extensionName).call(i,"gdpr_forbidden")&&r&&(n.extensionName=r.extensionName)})}function nU(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||_t(t).call(t,"abs-send-time")}function Ev(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||_t(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function iU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function rU(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?iU(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):iU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Og(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:r,filterVideoFec:a,filterAudioFec:c,filterAudioCodec:l,filterVideoCodec:d}=e,{useXR:h}=n;let p=[],m=[],S=[],R=[],O=!1,A=!1;if(Br(t).mediaDescriptions.forEach(D=>{i&&i!==D.attributes.direction||(D.media.mediaType!=="video"||O||(m=D.attributes.payloads,R=D.attributes.extmaps,O=!0),D.media.mediaType!=="audio"||A||(p=D.attributes.payloads,S=D.attributes.extmaps,A=!0))}),!R||m.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!S||p.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(m.forEach(D=>{var L;(L=D.rtpMap)!==null&&L!==void 0&&L.clockRate&&(D.rtpMap.clockRate=parseInt(D.rtpMap.clockRate)),h&&D.rtcpFeedbacks.push({type:"rrtr"})}),p.forEach(D=>{var L;(L=D.rtpMap)!==null&&L!==void 0&&L.clockRate&&(D.rtpMap.clockRate=parseInt(D.rtpMap.clockRate)),h&&D.rtcpFeedbacks.push({type:"rrtr"})}),r&&(p=p.filter(D=>{var L;return((L=D.rtpMap)===null||L===void 0?void 0:L.encodingName.toLowerCase())!=="rtx"}),m=m.filter(D=>{var L;return((L=D.rtpMap)===null||L===void 0?void 0:L.encodingName.toLowerCase())!=="rtx"})),a&&(m=m.filter(D=>{var L;return!/(red)|(ulpfec)|(flexfec)/i.test(((L=D.rtpMap)===null||L===void 0?void 0:L.encodingName)||"")})),c&&(p=p.filter(D=>{var L;return!/(red)|(ulpfec)|(flexfec)/i.test(((L=D.rtpMap)===null||L===void 0?void 0:L.encodingName)||"")})),l&&(l==null?void 0:l.length)>0&&(p=p.filter(D=>{var L;return _t(l).call(l,((L=D.rtpMap)===null||L===void 0?void 0:L.encodingName.toLowerCase())||"")})),d&&(d==null?void 0:d.length)>0){const D=m.filter(L=>{var V;return _t(d).call(d,((V=L.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"")});m=D.concat(r?[]:Nw(D,m))}const I=U("UNSUPPORTED_VIDEO_CODEC");return I&&I.length>0&&(m=m.filter(D=>!(D.rtpMap&&_t(I).call(I,D.rtpMap.encodingName.toLowerCase())))),{audioCodecs:p,videoCodecs:m,audioExtensions:S,videoExtensions:R}}function Iu(t){const e=Br(t);let n,i;for(const r of e.mediaDescriptions){if(!n){const a=r.attributes.iceUfrag,c=r.attributes.icePwd;if(!a||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:a,icePwd:c}}if(!i){const a=r.attributes.fingerprints;a.length>0&&(i={fingerprints:a})}}if(!i&&e.attributes.fingerprints.length>0&&(i={fingerprints:e.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function sU(t,e){const n=[],i=t.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),r=t.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),a=t.attributes.ssrcs;if(r)r.ssrcIds.forEach(c=>{var l;const d=(l=i.find(h=>h.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];n.push({ssrcId:c,rtx:e?d:void 0})});else if(i.length>0){const c=i[0].ssrcIds[0],l=i[0].ssrcIds[1];n.push({ssrcId:c,rtx:e?l:void 0})}else{if(a.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:a[0].ssrcId})}return n}function aU(t,e,n){const{cname:i}=t;let r=[];e&&(r=oU(e)),r.length===0&&(r=t.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}})),v.debug("Using candidates from gateway."));const a={fingerprints:t.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},c={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let l;switch(t.dtlsParameters.role){case"server":l="passive";break;case"client":l="active";break;case"auto":l="actpass"}const d=Sv(t.rtpCapabilities),h=[];return Array.isArray(n)&&n.length>0&&n.forEach(p=>{h.push({kind:wt.VIDEO,ssrcId:p.v,rtx:p.v_rtx,mslabel:"".concat(p.v,"_").concat(p.a)},{kind:wt.AUDIO,ssrcId:p.a,mslabel:"".concat(p.v,"_").concat(p.a)})}),{dtlsParameters:a,iceParameters:c,candidates:r,rtpCapabilities:d,setup:l,cname:i,preSSRCs:h}}function oU(t){let e=[];return t.ip&&typeof t.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],v.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),v.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),e}function ph(t,e,n){const i=[],r=[];return t.forEach(a=>{let{ssrcId:c,rtx:l}=a;const d=Je(8,"track-"),h={ssrcId:c,attributes:rU({label:d,mslabel:n=n||Je(10,""),msid:"".concat(n," ").concat(d)},e&&{cname:e})};if(i.push(h),l!==void 0){const p={ssrcId:l,attributes:rU({label:d,mslabel:n,msid:"".concat(n," ").concat(d)},e&&{cname:e})};i.push(p),r.push({semantic:"FID",ssrcIds:[c,l]})}}),t.length>1&&r.push({semantic:"SIM",ssrcIds:t.map(a=>{let{ssrcId:c}=a;return c})}),{ssrcs:i,ssrcGroups:r}}function tm(t,e){e instanceof bn&&t.attributes.payloads.forEach(n=>{var i;const r=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!r||["opus","pcmu","pcma","g722"].indexOf(r)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const a=e._encoderConfig;a&&r!=="pcmu"&&r!=="pcma"&&r!=="g722"&&(a.bitrate&&!Sn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*a.bitrate))),a.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(a.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(a.sampleRate)),a.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function ww(t){const e=t.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");e!==-1&&t.attributes.unrecognized.splice(e,1)}function Ow(t,e){var n;if(!(e instanceof cn&&e._encoderConfig&&e._hints.indexOf(Qe.SCREEN_TRACK)===-1))return;const i=e._encoderConfig;Ae().supportMinBitrate&&i.bitrateMin&&t.attributes.payloads.forEach(r=>{var a,c;_t(a=["h264","h265","vp8","vp9","av1"]).call(a,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),Ae().supportMinBitrate&&!_t(n=e._hints).call(n,Qe.LOW_STREAM)&&i.bitrateMax&&t.attributes.payloads.forEach(r=>{var a,c;_t(a=["h264","h265","vp8","vp9","av1"]).call(a,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-start-bitrate"]="".concat(U("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function cU(t){if(t.media.mediaType!=="video")return;const e=Re();if(e.name!==Oe.SAFARI&&e.os!==ri.IOS)return;const n=t.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&t.attributes.extmaps.splice(n,1)}function gv(t,e,n){if(!e)return;let i,r;if(t.media.mediaType==="video"?(i=n.videoExtensions,r=n.videoCodecs):(i=n.audioExtensions,r=n.audioCodecs),e.twcc===!0){const a=i.find(c=>Ev(c.extensionName));if(a){const c=a.extensionName;t.attributes.extmaps.find(d=>Ev(d.extensionName))||t.attributes.extmaps.push({entry:a.entry,extensionName:c}),function(d,h){return h.filter(p=>!!d.find(m=>m.payloadType===p.payloadType&&!!m.rtcpFeedbacks.find(S=>S.type==="transport-cc")))}(r,t.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(h=>h.type==="transport-cc")||d.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(e.twcc===!1){const a=t.attributes.extmaps.findIndex(c=>Ev(c.extensionName));a!==-1&&t.attributes.extmaps.splice(a,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(d=>d.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(e.remb===!0){const a=i.find(c=>nU(c.extensionName));if(a){const c=a.extensionName;t.attributes.extmaps.find(d=>d.extensionName===c)||t.attributes.extmaps.push({entry:a.entry,extensionName:c}),function(d,h){return h.filter(p=>!!d.find(m=>m.payloadType===p.payloadType&&!!m.rtcpFeedbacks.find(S=>S.type==="goog-remb")))}(r,t.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(h=>h.type==="goog-remb")||d.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(e.remb===!1){const a=t.attributes.extmaps.findIndex(c=>nU(c.extensionName));a!==-1&&t.attributes.extmaps.splice(a,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(d=>d.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function lU(t,e,n){if(Sn()||t.media.mediaType!=="video"||!(e instanceof cn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!U("SIMULCAST")||n==="vp9"&&U("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:e._scalabilityMode.numSpatialLayers,r=t.attributes.ssrcs[0],a=t.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===r.ssrcId),c={semantic:"SIM",ssrcIds:[r.ssrcId]};for(let l=1;l<i;l++)t.attributes.ssrcs.push({ssrcId:r.ssrcId+l,attributes:yn(r.attributes)}),c.ssrcIds.push(r.ssrcId+l),a&&(t.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+l,attributes:yn(r.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[r.ssrcId+l,a.ssrcIds[1]+l]}));t.attributes.ssrcGroups.unshift(c)}async function uU(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:r,recv:a,sendrecv:c}=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const p=Og(h,l,d,"sendonly"),m=Og(h,l,d,"recvonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(wa(p,m,"videoExtensions",S,R,O),wa(p,m,"videoCodecs",S,R,O),wa(p,m,"audioExtensions",S,R,O),wa(p,m,"audioCodecs",S,R,O),U("RAISE_H264_BASELINE_PRIORITY")){const A=[],I=[];O.videoCodecs.forEach((D,L)=>{var V;if(((V=D.rtpMap)===null||V===void 0?void 0:V.encodingName.toLocaleLowerCase())==="h264"){var W,K;const G=O.videoCodecs[L+1],Q=G&&mU(D,G),lt=(W=D.fmtp)===null||W===void 0?void 0:W.parameters["profile-level-id"],Tt=(K=D.fmtp)===null||K===void 0?void 0:K.parameters["packetization-mode"];!lt||lt!==U("FIRST_H264_PROFILE_LEVEL_ID")||U("FIRST_PACKETIZATION_MODE")&&Tt!==U("FIRST_PACKETIZATION_MODE")?Q?I.push([D,G]):I.push([D]):Q?A.push([D,G]):A.push([D])}}),A.length>0&&I.length>0&&(v.debug("raising H264 baseline profile priority"),O.videoCodecs.forEach((D,L)=>{var V;if(((V=D.rtpMap)===null||V===void 0?void 0:V.encodingName.toLocaleLowerCase())==="h264"){const W=mU(D,O.videoCodecs[L+1]),K=A.shift()||I.shift()||[];K.length>0&&(W?O.videoCodecs.splice(L,2,...K):O.videoCodecs.splice(L,1,...K))}}),R.videoCodecs=R.videoCodecs.filter(D=>{var L,V;return!(((L=D.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"&&((V=D.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!==U("FIRST_H264_PROFILE_LEVEL_ID"))}),U("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(D=>{var L,V;return!(((L=D.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"&&((V=D.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!==U("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:S,recv:R,sendrecv:O}}(t,e,i);try{n.close()}catch{}return{send:r,recv:a,sendrecv:c}}function dU(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=Og(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(wa(t,e,"videoExtensions",n,i,r),wa(t,e,"videoCodecs",n,i,r),wa(t,e,"audioExtensions",n,i,r),wa(t,e,"audioCodecs",n,i,r),U("RAISE_H264_BASELINE_PRIORITY")){const a=r.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f");if(a!==-1){const c=r.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(c<a){v.debug("raising H264 baseline profile priority");const l=r.videoCodecs[a];r.videoCodecs.splice(a,1),r.videoCodecs.splice(c,0,l)}c!==-1&&(i.videoCodecs=i.videoCodecs.filter(l=>!(l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:r}}function wa(t,e,n,i,r,a){if(n==="videoExtensions"||n==="audioExtensions"){const c=[];return t[n].forEach(l=>{e[n].some((d,h)=>{if(l.entry===d.entry&&l.extensionName===d.extensionName)return c.push(h),!0})?a[n].push(l):i[n].push(l)}),void e[n].forEach((l,d)=>{c.indexOf(d)===-1&&r[n].push(l)})}if(n==="videoCodecs"||n==="audioCodecs"){const c=[];return t[n].forEach(l=>{e[n].some((d,h)=>{if(l.payloadType===d.payloadType&&JSON.stringify(l)===JSON.stringify(d))return c.push(h),!0})?a[n].push(l):i[n].push(l)}),void e[n].forEach((l,d)=>{c.indexOf(d)===-1&&r[n].push(l)})}}function Sv(t){const{send:e,recv:n,sendrecv:i}=t;if(!i){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let r,a;return e?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...e.audioCodecs,...i.audioCodecs],r.videoCodecs=[...e.videoCodecs,...i.videoCodecs],r.audioExtensions=[...e.audioExtensions,...i.audioExtensions],r.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):r=i,n?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...n.audioCodecs,...i.audioCodecs],a.videoCodecs=[...n.videoCodecs,...i.videoCodecs],a.audioExtensions=[...n.audioExtensions,...i.audioExtensions],a.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):a=i,{send:r,recv:a}}function em(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(e=>{var n;return((n=e.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function Ng(t,e,n,i){let r=[];if(t===wt.VIDEO){if(U("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(r=e.videoCodecs.filter(a=>{var c;return _t(c=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(c,i)&&a&&a.fmtp&&a.fmtp.parameters["profile-level-id"]===U("H264_PROFILE_LEVEL_ID")})),!Array.isArray(r)||r.length===0){let a=[];const c=[],l=[],d=[];if(n.videoCodecs.forEach(h=>{const p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"";_t(p).call(p,i)?a.push(h):_t(p).call(p,"vp9")?c.push(h):_t(p).call(p,"vp8")?l.push(h):_t(p).call(p,"h264")&&d.push(h)}),a.length===0){let h="";c.length!==0?(a=c,h="vp9"):l.length!==0?(a=l,h="vp8"):d.length!==0&&(a=d,h="h264"),v.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(h))}a.length!==0&&(r=e.videoCodecs.filter(h=>a.some(p=>p.payloadType===h.payloadType)))}if(r.length===0&&(v.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),r=e.videoCodecs),U("USE_PUB_RTX")||U("USE_SUB_RTX")){const a=Nw(r,e.videoCodecs);r=[...r,...a]}}else r=e.audioCodecs.filter(a=>{var c;return _t(c=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(c,i)}),r.length===0&&(v.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),r=e.audioCodecs.filter(a=>{var c;return _t(c=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")}));return r}function Nw(t,e){const n=t.map(i=>i.payloadType.toString());return e.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&_t(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function Dg(t,e,n){const i=e.toString(),r=pU(i,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:i});const a=await t.createAnswer();if(!a.sdp)throw new Error("cannot get answer sdp");let c=a.sdp;c=hU(c,n||{}),r==null||r(c||""),await t.setLocalDescription({type:"answer",sdp:c})}function hU(t,e,n){const i=Br(t),{useXR:r}=e;return i.mediaDescriptions.forEach(a=>{var c;a.attributes.mid&&(Array.isArray(n)&&!_t(n).call(n,a.attributes.mid)||(a.media.mediaType==="audio"&&em(a),r&&_t(c=["audio","video"]).call(c,a.media.mediaType)&&a.attributes.payloads.forEach(l=>{l.rtcpFeedbacks.findIndex(d=>d.type==="rrtr")===-1&&l.rtcpFeedbacks.push({type:"rrtr"})})))}),yu(i)}function pU(t,e,n,i){if(U("SDP_LOGGING"))return v.upload("exchanging ".concat(n," ").concat(e," SDP during P2PConnection.").concat(i,`
`),t),e==="offer"?r=>{pU(r,"answer",n==="local"?"remote":"local",i)}:void 0}function fU(t){const e=U("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(e)&&e.length>0)&&e.some(n=>_t(t).call(t,n))}function mU(t,e){try{var n;return((n=t.fmtp)===null||n===void 0?void 0:n.parameters.apt)===e.payloadType.toString()}catch{return!1}}function _U(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Qs(t,e){return typeof U(t)===e?U(t):void 0}function j6(){try{const t=U("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?_U(Object(i),!0).forEach(function(r){N(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_U(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t)}catch(t){return v.debug("handle gateway attributes failed: ",t),{}}}const EU={};function wu(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&v.debug("install service ".concat(t.name)),EU[t.name]=t}function ml(t){const e=EU[t];if(!e)throw new Z(P.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return e}function gU(t,e){return ml("DataStream").create(t,e)}function Tv(){return ml("InterceptFrame").create()}function SU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function _l(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?SU(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):SU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Dw=new Map;class G6 extends _n{get state(){return this._state}set state(e){if(e===this._state)return;const n=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(fi.CONNECTION_STATE_CHANGE,e,n,this._disconnectedReason):this.emit(fi.CONNECTION_STATE_CHANGE,e,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){v.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,n){var i,r,a;super(),N(this,"store",void 0),N(this,"joinInfo",void 0),N(this,"key",void 0),N(this,"ntpOffset",0),N(this,"signal",void 0),N(this,"role",void 0),N(this,"inChannelInfo",{joinAt:null,duration:0}),N(this,"spec",void 0),N(this,"_state","DISCONNECTED"),N(this,"_statsCollector",void 0),N(this,"_disconnectedReason",void 0),N(this,"isSignalRecover",!1),N(this,"hasChangeBGPAddress",!1),N(this,"trafficStatsInterval",void 0),N(this,"networkQualityInterval",void 0),N(this,"_joinGatewayStartTime",0),N(this,"_signalTimeout",!1),N(this,"_clientRoleOptions",void 0),N(this,"_isProactiveJoin",!1),this.store=e,this.spec=n,this.signal=this.store.useP2P?(i={spec:_l(_l({},n),{},{retryConfig:n.websocketRetryConfig}),store:e},(r=(a=ml("P2PChannel")).createSubmodule)===null||r===void 0?void 0:r.call(a,i)):new B6(_l(_l({},n),{},{retryConfig:n.websocketRetryConfig}),e),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(e,n,i){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const r=Date.now();let a=Dw.get(e.cname);if(a||(a=new Map,Dw.set(e.cname,a)),this._isProactiveJoin=!0,a.has(e.uid)){const h=new J(P.UID_CONFLICT);throw kt.joinGateway(e.sid,{lts:r,succ:!1,ec:h.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),h}a.set(e.uid,!0),this.joinInfo=e,this.key=n;let c=0;this.joinGatewayStartTime=r;const l=e.proxyServer;try{v.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(c));const h=e.gatewayAddrs.map(p=>{let{address:m}=p;const[S,R]=m.split(":"),O={host:S,port:R};return e.proxyServer&&(O.proxy=e.proxyServer),O});c=(await this.signal.init(h)).uid,v.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){var d;throw v.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),kt.joinGateway(e.sid,{lts:r,succ:!1,ec:((d=h.data)===null||d===void 0?void 0:d.desc)||h.code,errorMsg:h.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!l,signalChannel:"0",preload:e.preload}),a.delete(e.uid),this.signal.close(),h}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),v.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(h=>{v.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(fi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(fi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(fi.NETWORK_QUALITY,{uplinkNetworkQuality:$1(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:$1(this._statsCollector.trafficStats.B_dnq)}):this.emit(fi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Pe.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==nn.CONNECTED||await function(i,r){return r===1/0?i:Et.race([i,pH(r)])}(this.signal.request(Yt.LEAVE,void 0,!0),3e3)}catch(i){v.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==Pe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:U("PUB_EXTEND"),twcc:!!U("PUBLISH_TWCC"),rtx:!!U("USE_PUB_RTX")};try{return(await this.signal.request(Yt.PUBLISH,r,!0))._message}catch(a){if(i&&a.data&&a.data.code===Ht.ERR_PUBLISH_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),a.toString()),await this.tryUnpubBeforeRepub(e,n),this.publish(e,n,!1);throw a}}async publishDataChannel(e,n,i){var r;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const a={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(r=n.maxRetransmits)!==null&&r!==void 0?r:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(Yt.PUBLISH_DATASTREAM,a,!0)}catch(c){if(i&&c.data&&c.data.code===Ht.ERR_PUBLISH_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),c.toString()),await this.tryUnpubDataChannelBeforeRepub(e,n),this.publishDataChannel(e,n,!1);throw c}}async unpublish(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Yt.UNPUBLISH,{stream_id:n,ortc:e},!0)}catch(i){v.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Et.all(e.map(n=>this.signal.request(Yt.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){v.warning("unpublish datachannels warning: ",n)}}async presubscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!U("SUBSCRIBE_TWCC"),rtx:!!U("USE_SUB_RTX")||void 0,extend:U("SUB_EXTEND"),svc:Array.isArray(U("SVC"))&&U("SVC").length!==0?U("SVC"):void 0};try{return await this.signal.request(Yt.PRE_SUBSCRIBE,r,!0)}catch(a){if(i&&a.data&&a.data.code===Ht.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),a.toString()),this.presubscribe(e,n,!1);throw a}}async subscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!U("SUBSCRIBE_TWCC"),rtx:!!U("USE_SUB_RTX"),extend:U("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(U("SVC"))&&U("SVC").length!==0?U("SVC"):void 0};try{return(await this.signal.request(Yt.SUBSCRIBE,r,!0))._message}catch(a){if(i&&a.data&&a.data.code===Ht.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),a.toString()),await this.tryUnsubBeforeResub(e,n),await this.subscribe(e,n,!1);throw a}}async subscribeDataChannel(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:e,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(Yt.SUBSCRIBE_DATASTREAM,r,!0)}catch(a){if(i&&a.data&&a.data.code===Ht.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),a.toString()),await this.tryUnsubDataChannelBeforeResub(e,n),await this.subscribeDataChannel(e,n,!1);throw a}}async subscribeAll(e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!U("USE_SUB_RTX"),twcc:!!U("SUBSCRIBE_TWCC"),svc:Array.isArray(U("SVC"))&&U("SVC").length!==0?U("SVC"):void 0};try{return await this.signal.request(Yt.SUBSCRIBE_STREAMS,i,!0)}catch(r){if(n&&r.data&&r.data.code===Ht.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw r}}async setVideoProfile(e){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let r=i.frameRate,a=i.width,c=i.height,l=!0;return typeof r!="number"&&(r=r.exact||r.ideal||r.max||r.min||0,r||(l=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,r||(l=!1)),l?{stream_type:0,width:a,height:c,fps:r,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(e);if(n)return this.signal.request(Yt.SET_VIDEO_PROFILE,n);v.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,n){try{await this.signal.request(Yt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:n},!0)}catch(i){v.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Et.all(e.map(i=>this.signal.request(Yt.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){v.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(e){try{await this.signal.request(Yt.UNSUBSCRIBE_STREAMS,e,!0)}catch(n){v.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(e){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(Yt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Yt.GATEWAY_INFO)}async renewToken(e){await this.signal.request(Yt.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,n){n&&(this._clientRoleOptions=Object.assign({},n)),U("CLIENT_ROLE_OPTIONS")&&(v.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(U("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},U("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),U("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},U("CLIENT_ROLE_OPTIONS")),v.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(U("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=e);let i,r=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(Yt.SET_CLIENT_ROLE,{role:e,level:r,delay:i,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,n){await this.signal.request(Yt.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:n})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(Yt.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,n){await this.signal.request(Yt.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:n})}async pickSVCLayer(e,n){await this.signal.request(Yt.PICK_SVC_LAYER,{stream_id:e,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(e){await this.signal.request(Yt.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),_l({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Yt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=Dw.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:Pi.username,password:Pi.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(_l(_l({},Pi),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(Yt.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(r=>r.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&Fy(()=>{this.emit(fi.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new J(P.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let i=U("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}var r;i&&i.length>128&&(i=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(fi.UPDATE_GATEWAY_CONFIG),r=this.store.clientId,_t(zf).call(zf,r)||zf.push(r);const a=!(Sn()||xP(87)||Ak())&&typeof U("ENABLE_PRE_SUB")=="boolean"&&U("ENABLE_PRE_SUB"),c=!Ak()&&Qs("ENABLE_PREALLOC_PC","boolean"),l=j6(),d=hg(87)||function(){const p=Re();if(p.name!==Oe.SAFARI||!p.browserVersion)return!1;const m=p.browserVersion.split(".");return Number(m[0])>15||Number(m[0])===15&&Number(m[1])>=4}(),h=_l({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:qs,browser:navigator.userAgent,process_id:U("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:U("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:_l({enableEncodedTransform:!!U("ENABLE_AUDIO_METADATA")&&d||!!U("ENABLE_AUDIO_TOPN")&&CI(Oe.CHROME,87,116)||void 0,enableAudioMetadata:!!U("ENABLE_AUDIO_METADATA")&&d,enableAudioPts:!!U("ENABLE_AUDIO_PTS_METADATA")&&d,topnSmoothLevel:U("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:U("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:U("TOPN_SWITCH_HOLD_MS"),topnAudioGain:U("TOPN_AUDIO_GAIN"),enablePublishedUserList:U("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:U("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Qs("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Qs("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Qs("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:U("USE_PUB_RTX")===!0||U("USE_SUB_RTX")===!0||void 0,disableFEC:U("DISABLE_FEC"),enableNTPReport:!!U("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!U("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!U("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Qs("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!U("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!U("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Qs("USE_XR","boolean"),enableLossbasedBwe:Qs("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!U("ENABLE_AUT_CC")||void 0,enableCCFallback:Qs("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:c,preSubNum:a?Qs("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Qs("PUBLISH_TWCC","boolean"),enableSubTWCC:Qs("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Qs("USE_PUB_RTX","boolean"),enableSubRTX:Qs("USE_SUB_RTX","boolean"),enableSubSVC:U("ENABLE_SVC")?U("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(U("SVC"))&&U("SVC").length!==0?U("SVC"):void 0,enableSvcExtended:U("ENABLE_SVC")&&Array.isArray(U("SVC_EXTENDED"))&&U("SVC_EXTENDED").length!==0?U("SVC_EXTENDED"):void 0},l)},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(h.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(h.aes_mode=this.joinInfo.aesmode,U("ENCRYPT_AES")?(h.aes_secret=this.joinInfo.aespassword,h.aes_encrypt=!0):h.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(h.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(h.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(h.default_video_stream=this.joinInfo.defaultVideoStream),h}getRejoinMessage(){if(!this.joinInfo)throw new J(P.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(qt.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(qt.WS_RECONNECTING,e=>{this.joinInfo&&kt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||Di.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",kt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(qt.WS_CLOSED,e=>{let n;switch(e){case Pe.LEAVE:n=Di.LEAVE;break;case Pe.UID_BANNED:case Pe.IP_BANNED:case Pe.CHANNEL_BANNED:case Pe.SERVER_ERROR:n=Di.SERVER_ERROR;break;case Pe.FALLBACK:n=Di.FALLBACK;break;case Pe.LICENSE_MISSING:case Pe.LICENSE_EXPIRED:case Pe.LICENSE_MINUTES_EXCEEDED:case Pe.LICENSE_PERIOD_INVALID:case Pe.LICENSE_MULTIPLE_SDK_SERVICE:case Pe.LICENSE_ILLEGAL:case Pe.TOKEN_EXPIRE:n=e;break;default:n=Di.NETWORK_ERROR}v.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Di.NETWORK_ERROR)),this.joinInfo&&kt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===Pe.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=e,e!==Pe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(qt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const e=U("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(v.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(kt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void v.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));Be("EVENT_REPORT_DOMAIN",e[1]),Be("EVENT_REPORT_BACKUP_DOMAIN",e[1]),Be("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(ue.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(qt.REQUEST_RECOVER,(e,n,i)=>{if(!this.joinInfo)return i(new J(P.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Li(this,fi.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(qt.REQUEST_JOIN_INFO,async(e,n,i)=>{var r;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const a=yn((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(U("NEW_TURN_MODE")&&a){let h=a.servers,p=a.serversFromGateway;const m=this.signal.currentURLIndex;h.length>0&&(h=[h[m%h.length]],a.servers=h),Array.isArray(p)&&p.length>0&&(p=[p[0]],a.serversFromGateway=p),v.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(m))}const{iceParameters:c,dtlsParameters:l,rtpCapabilities:d}=await Li(this,fi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:a});try{e(this.getJoinMessage({ortc:{iceParameters:c,dtlsParameters:l,rtpCapabilities:d,version:"2"}}))}catch(h){n(h)}}),this.signal.on(qt.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(qt.REPORT_JOIN_GATEWAY,(e,n)=>{if(!this.joinInfo)return;let i,r="";var a;e instanceof J?(i=((a=e.data)===null||a===void 0?void 0:a.desc)||e.code,r=e.message):i=e,kt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:r,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(qt.IS_P2P_DISCONNECTED,e=>{e(Eg(this,fi.IS_P2P_DISCONNECTED))}),this.signal.on(qt.DISCONNECT_P2P,()=>{this.emit(fi.DISCONNECT_P2P)}),this.signal.on(qt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(qt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(qt.JOIN_RESPONSE,e=>{const n=this.getCurrentGatewayAddress();this.emit(fi.JOIN_RESPONSE,e,n)}),this.signal.on(qt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const e=this.getCurrentGatewayAddress(),n=U("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&n){const i=oU(e);this.emit(fi.PRE_CONNECT_PC,{candidates:i,fingerprint:n})}}}),this.signal.on(qt.RECOVER_NOTIFICATION,e=>{this.joinInfo&&typeof U("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(U("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,n){try{await this.signal.request(Yt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[n]},!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(e,n){try{await this.signal.request(Yt.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw v.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(e,n){try{await this.signal.request(Yt.UNPUBLISH,{stream_id:e,ortc:n},!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(e,n){try{await this.signal.request(Yt.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw v.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(e){const n={users:e.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(Yt.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(e,n){const i={action:e.find(r=>r.stream_type===Me.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(Yt.CONTROL,i,!0,!0)}catch(r){throw v.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),r),r}}async unmuteLocal(e,n){const i={action:e.find(r=>r.stream_type===Me.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(Yt.CONTROL,i,!0,!0)}catch(r){throw v.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),r),r}}async muteRemote(e,n){const i={action:e===wt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Yt.CONTROL,i,!0,!0)}catch(r){throw v.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),r),r}}async unmuteRemote(e,n){const i={action:e===wt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Yt.CONTROL,i,!0,!0)}catch(r){throw v.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),r),r}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,n){this.signal.upload(e,n)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(Yt.RESTART_ICE,n,!0)}catch(i){throw v.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(e,n){this.state==="CONNECTED"&&this.signal.reconnect(e||void 0,n||Di.P2P_FAILED)}getCurrentGatewayAddress(){var e,n;if(!U("GATEWAY_WSS_ADDRESS"))return U("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(v.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(Yt.SET_PARAMETER,{enablePublishAudioFilter:e})}}let Rv=0,Lw=0;function yo(t,e,n,i){return new Et((r,a)=>{e.timeout=e.timeout||U("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),Rv+=nc(e.data)):n&&(e.data.size?Rv+=e.data.size:e.data instanceof FormData?Rv+=ek(e.data):Rv+=nc(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,vr.request(e).then(c=>{typeof c.data=="string"?Lw+=nc(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?Lw+=c.data.byteLength:Lw+=nc(JSON.stringify(c.data)),i&&r({data:c.data,headers:c.headers}),r(c.data)}).catch(c=>{vr.isCancel(c)?a(new J(P.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?a(new J(P.NETWORK_TIMEOUT,c.message)):c.response?a(new J(P.NETWORK_RESPONSE_ERROR,c.response.status)):a(new J(P.NETWORK_ERROR,c.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function e(it){var ft=0;return function(){return ft<it.length?{done:!1,value:it[ft++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(it,ft,Lt){return it==Array.prototype||it==Object.prototype||(it[ft]=Lt.value),it},i,r=function(it){it=[typeof globalThis=="object"&&globalThis,it,typeof window=="object"&&window,typeof self=="object"&&self,typeof y=="object"&&y];for(var ft=0;ft<it.length;++ft){var Lt=it[ft];if(Lt&&Lt.Math==Math)return Lt}throw Error("Cannot find global object")}(this);function a(it,ft){if(ft)t:{var Lt=r;it=it.split(".");for(var at=0;at<it.length-1;at++){var b=it[at];if(!(b in Lt))break t;Lt=Lt[b]}(ft=ft(at=Lt[it=it[it.length-1]]))!=at&&ft!=null&&n(Lt,it,{configurable:!0,writable:!0,value:ft})}}function c(it){return(it={next:it})[Symbol.iterator]=function(){return this},it}function l(it){var ft=typeof Symbol<"u"&&Symbol.iterator&&it[Symbol.iterator];return ft?ft.call(it):{next:e(it)}}if(a("Symbol",function(it){function ft(b,x){this.A=b,n(this,"description",{configurable:!0,writable:!0,value:x})}if(it)return it;ft.prototype.toString=function(){return this.A};var Lt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",at=0;return function b(x){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new ft(Lt+(x||"")+"_"+at++,x)}}),a("Symbol.iterator",function(it){if(it)return it;it=Symbol("Symbol.iterator");for(var ft="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Lt=0;Lt<ft.length;Lt++){var at=r[ft[Lt]];typeof at=="function"&&typeof at.prototype[it]!="function"&&n(at.prototype,it,{configurable:!0,writable:!0,value:function(){return c(e(this))}})}return it}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var d;t:{var h={};try{h.__proto__={a:!0},d=h.a;break t}catch{}d=!1}i=d?function(it,ft){if(it.__proto__=ft,it.__proto__!==ft)throw new TypeError(it+" is not extensible");return it}:null}var p=i;function m(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function S(it){if(it.m)throw new TypeError("Generator is already running");it.m=!0}function R(it,ft){return it.h=3,{value:ft}}function O(it){this.g=new m,this.G=it}function A(it,ft,Lt,at){try{var b=ft.call(it.g.j,Lt);if(!(b instanceof Object))throw new TypeError("Iterator result "+b+" is not an object");if(!b.done)return it.g.m=!1,b;var x=b.value}catch(F){return it.g.j=null,it.g.s(F),I(it)}return it.g.j=null,at.call(it.g,x),I(it)}function I(it){for(;it.g.h;)try{var ft=it.G(it.g);if(ft)return it.g.m=!1,{value:ft.value,done:!1}}catch(Lt){it.g.v=void 0,it.g.s(Lt)}if(it.g.m=!1,it.g.l){if(ft=it.g.l,it.g.l=null,ft.F)throw ft.D;return{value:ft.return,done:!0}}return{value:void 0,done:!0}}function D(it){this.next=function(ft){return it.o(ft)},this.throw=function(ft){return it.s(ft)},this.return=function(ft){return function(Lt,at){S(Lt.g);var b=Lt.g.j;return b?A(Lt,"return"in b?b.return:function(x){return{value:x,done:!0}},at,Lt.g.return):(Lt.g.return(at),I(Lt))}(it,ft)},this[Symbol.iterator]=function(){return this}}function L(it,ft){return ft=new D(new O(ft)),p&&it.prototype&&p(ft,it.prototype),ft}if(m.prototype.o=function(it){this.v=it},m.prototype.s=function(it){this.l={D:it,F:!0},this.h=this.C||this.u},m.prototype.return=function(it){this.l={return:it},this.h=this.u},O.prototype.o=function(it){return S(this.g),this.g.j?A(this,this.g.j.next,it,this.g.o):(this.g.o(it),I(this))},O.prototype.s=function(it){return S(this.g),this.g.j?A(this,this.g.j.throw,it,this.g.o):(this.g.s(it),I(this))},a("Array.prototype.entries",function(it){return it||function(){return function(ft,Lt){ft instanceof String&&(ft+="");var at=0,b=!1,x={next:function(){if(!b&&at<ft.length){var F=at++;return{value:Lt(F,ft[F]),done:!1}}return b=!0,{done:!0,value:void 0}}};return x[Symbol.iterator]=function(){return x},x}(this,function(ft,Lt){return[ft,Lt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var V=function(it,ft){for(var Lt=0;Lt<it.length;Lt++)ft(it[Lt])},W=function(it){return it.replace(/\r?\n|\r/g,`\r
`)},K=function(it,ft,Lt){return ft instanceof Blob?(Lt=Lt!==void 0?Lt+"":typeof ft.name=="string"?ft.name:"blob",ft.name===Lt&&Object.prototype.toString.call(ft)!=="[object Blob]"||(ft=new File([ft],Lt)),[String(it),ft]):[String(it),String(ft)]},G=function(it,ft){if(it.length<ft)throw new TypeError(ft+" argument required, but only "+it.length+" present.")},Q=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,lt=Q.FormData,Tt=Q.XMLHttpRequest&&Q.XMLHttpRequest.prototype.send,At=Q.Request&&Q.fetch,de=Q.navigator&&Q.navigator.sendBeacon,he=Q.Element&&Q.Element.prototype,Ze=Q.Symbol&&Symbol.toStringTag;Ze&&(Blob.prototype[Ze]||(Blob.prototype[Ze]="Blob"),"File"in Q&&!File.prototype[Ze]&&(File.prototype[Ze]="File"));try{new File([],"")}catch{Q.File=function(ft,Lt,at){return ft=new Blob(ft,at||{}),Object.defineProperties(ft,{name:{value:Lt},lastModified:{value:+(at&&at.lastModified!==void 0?new Date(at.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Ze&&Object.defineProperty(ft,Ze,{value:"File"}),ft}}var Mn=function(it){return it.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},An=function(it){this.i=[];var ft=this;it&&V(it.elements,function(Lt){if(Lt.name&&!Lt.disabled&&Lt.type!=="submit"&&Lt.type!=="button"&&!Lt.matches("form fieldset[disabled] *"))if(Lt.type==="file"){var at=Lt.files&&Lt.files.length?Lt.files:[new File([],"",{type:"application/octet-stream"})];V(at,function(b){ft.append(Lt.name,b)})}else Lt.type==="select-multiple"||Lt.type==="select-one"?V(Lt.options,function(b){!b.disabled&&b.selected&&ft.append(Lt.name,b.value)}):Lt.type==="checkbox"||Lt.type==="radio"?Lt.checked&&ft.append(Lt.name,Lt.value):(at=Lt.type==="textarea"?W(Lt.value):Lt.value,ft.append(Lt.name,at))})};if((t=An.prototype).append=function(it,ft,Lt){G(arguments,2),this.i.push(K(it,ft,Lt))},t.delete=function(it){G(arguments,1);var ft=[];it=String(it),V(this.i,function(Lt){Lt[0]!==it&&ft.push(Lt)}),this.i=ft},t.entries=function it(){var ft,Lt=this;return L(it,function(at){if(at.h==1&&(ft=0),at.h!=3)return ft<Lt.i.length?at=R(at,Lt.i[ft]):(at.h=0,at=void 0),at;ft++,at.h=2})},t.forEach=function(it,ft){G(arguments,1);for(var Lt=l(this),at=Lt.next();!at.done;at=Lt.next()){var b=l(at.value);at=b.next().value,b=b.next().value,it.call(ft,b,at,this)}},t.get=function(it){G(arguments,1);var ft=this.i;it=String(it);for(var Lt=0;Lt<ft.length;Lt++)if(ft[Lt][0]===it)return ft[Lt][1];return null},t.getAll=function(it){G(arguments,1);var ft=[];return it=String(it),V(this.i,function(Lt){Lt[0]===it&&ft.push(Lt[1])}),ft},t.has=function(it){G(arguments,1),it=String(it);for(var ft=0;ft<this.i.length;ft++)if(this.i[ft][0]===it)return!0;return!1},t.keys=function it(){var ft,Lt,at,b,x=this;return L(it,function(F){if(F.h==1&&(ft=l(x),Lt=ft.next()),F.h!=3)return Lt.done?void(F.h=0):(at=Lt.value,b=l(at),R(F,b.next().value));Lt=ft.next(),F.h=2})},t.set=function(it,ft,Lt){G(arguments,2),it=String(it);var at=[],b=K(it,ft,Lt),x=!0;V(this.i,function(F){F[0]===it?x&&(x=!at.push(b)):at.push(F)}),x&&at.push(b),this.i=at},t.values=function it(){var ft,Lt,at,b,x=this;return L(it,function(F){if(F.h==1&&(ft=l(x),Lt=ft.next()),F.h!=3)return Lt.done?void(F.h=0):(at=Lt.value,(b=l(at)).next(),R(F,b.next().value));Lt=ft.next(),F.h=2})},An.prototype._asNative=function(){for(var it=new lt,ft=l(this),Lt=ft.next();!Lt.done;Lt=ft.next()){var at=l(Lt.value);Lt=at.next().value,at=at.next().value,it.append(Lt,at)}return it},An.prototype._blob=function(){var it="----formdata-polyfill-"+Math.random(),ft=[],Lt="--"+it+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(at,b){return typeof at=="string"?ft.push(Lt+Mn(W(b))+`"\r
\r
`+W(at)+`\r
`):ft.push(Lt+Mn(W(b))+'"; filename="'+Mn(at.name)+`"\r
Content-Type: `+(at.type||"application/octet-stream")+`\r
\r
`,at,`\r
`)}),ft.push("--"+it+"--"),new Blob(ft,{type:"multipart/form-data; boundary="+it})},An.prototype[Symbol.iterator]=function(){return this.entries()},An.prototype.toString=function(){return"[object FormData]"},he&&!he.matches&&(he.matches=he.matchesSelector||he.mozMatchesSelector||he.msMatchesSelector||he.oMatchesSelector||he.webkitMatchesSelector||function(it){for(var ft=(it=(this.document||this.ownerDocument).querySelectorAll(it)).length;0<=--ft&&it.item(ft)!==this;);return-1<ft}),Ze&&(An.prototype[Ze]="FormData"),Tt){var Or=Q.XMLHttpRequest.prototype.setRequestHeader;Q.XMLHttpRequest.prototype.setRequestHeader=function(it,ft){Or.call(this,it,ft),it.toLowerCase()==="content-type"&&(this.B=!0)},Q.XMLHttpRequest.prototype.send=function(it){it instanceof An?(it=it._blob(),this.B||this.setRequestHeader("Content-Type",it.type),Tt.call(this,it)):Tt.call(this,it)}}At&&(Q.fetch=function(it,ft){return ft&&ft.body&&ft.body instanceof An&&(ft.body=ft.body._blob()),At.call(this,it,ft)}),de&&(Q.navigator.sendBeacon=function(it,ft){return ft instanceof An&&(ft=ft._asNative()),de.call(this,it,ft)}),Q.FormData=An}})();const Lg=()=>{const t=U("AREAS");return t.length===0&&t.push(Ne.GLOBAL),ds(t).call(t,(e,n,i)=>{const r=TU(n);return r?i===0?r:"".concat(e,",").concat(r):e},"")},TU=t=>t===Ne.OVERSEA?"".concat(Vi.ASIA,",").concat(Vi.EUROPE,",").concat(Vi.AFRICA,",").concat(Vi.NORTH_AMERICA,",").concat(Vi.SOUTH_AMERICA,",").concat(Vi.OCEANIA):Vi[t],H6=t=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(n=>{const i=pv[n],r=Object.keys(i);r&&r.map(a=>{a!=="CODE"&&(e[a]=e[a].concat(i[a]))})}),e},yv={GLOBAL:{ASIA:[Ne.CHINA,Ne.JAPAN,Ne.INDIA,Ne.KOREA,Ne.HKMC],EUROPE:[],NORTH_AMERICA:[Ne.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},vv=Object.keys(yv[Ne.GLOBAL]),Pw=[Ne.CHINA,Ne.NORTH_AMERICA,Ne.EUROPE,Ne.ASIA,Ne.JAPAN,Ne.INDIA,Ne.OCEANIA,Ne.SOUTH_AMERICA,Ne.AFRICA,Ne.KOREA,Ne.HKMC,Ne.US],W6=function(t,e){let n=[];if(_t(t).call(t,Ne.GLOBAL)){const a=[Ne.GLOBAL,Ne.OVERSEA],c=Object.keys(pv);if(e===Ne.GLOBAL)throw new J(P.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===Ne.CHINA)n=[Ne.OVERSEA];else if(r=e,_t(vv).call(vv,r)){const l=(i=e,yv[Ne.GLOBAL][i]||[]),d=[...a,e,...l];n=c.filter(h=>!_t(d).call(d,h))}else if(function(l){let d=!1;return vv.forEach(h=>{var p;_t(p=yv[Ne.GLOBAL][h]).call(p,l)&&(d=!0)}),d}(e)){const l=function(h){let p;return vv.forEach(m=>{var S;_t(S=yv[Ne.GLOBAL][m]).call(S,h)&&(p=m)}),p}(e),d=[...a,l,e];n=c.filter(h=>!_t(d).call(d,h))}else n=t;n=function(l){const d=[];return Pw.forEach(h=>{_t(l).call(l,h)&&d.push(h)}),d.concat(l.filter(h=>!_t(Pw).call(Pw,h)))}(n)}else n=t;var i,r;return n};function RU(t){var e,n;if(!t&&_t(e=U("AREAS")).call(e,Ne.EXTENSIONS))return v.debug("update area from ap : reset"),void kw($H,!0);if(!_t(n=U("AREAS")).call(n,Ne.GLOBAL)||!t)return;let i=pv.EXTENSIONS;i&&(i={CODE:TU(Ne.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},v.debug("update area from ap success: ".concat(t,",config is "),i),Be("AREAS",[Ne.EXTENSIONS],!0),Object.keys(i).map(r=>{r==="LOG_UPLOAD_SERVER"||r==="EVENT_REPORT_DOMAIN"||r==="EVENT_REPORT_BACKUP_DOMAIN"||r==="PROXY_SERVER_TYPE3"?Be(r,i[r][0]):Be(r,i[r])}))}function kw(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=kt.reportApiInvoke(null,{name:Wn.SET_AREA,options:t,tag:Rn.TRACER});try{let i=[];if(typeof t=="string"&&(i=[t]),Array.isArray(t)&&(t.forEach(a=>{if(!_t(j1).call(j1,a))throw new J(P.INVALID_PARAMS,"invalid area code")}),i=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:a,excludedArea:c}=t;if(!a)throw new J(P.INVALID_PARAMS,"area code is needed");let l=a;typeof a=="string"&&(l=[a]),i=c?W6(l,c):l}if(!e){if(go.AREAS){const a=new J(P.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(a),void v.warning("setArea is prohibited because of config-distribute")}if(_t(i).call(i,Ne.GLOBAL)&&U("AREAS")===Ne.EXTENSIONS){const a=new J(P.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(a),void v.warning("setArea is prohibited because of ap extensions")}}Be("AREAS",i,e);const r=H6(i);Object.keys(r).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?Be(a,r[a][0]):Be(a,r[a])}),v.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function yU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function cc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?yU(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let Mw=1;function K6(t,e,n,i,r){Mw+=1;const a={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:Mw,requestId:Mw,version:qs,cname:n.cname},c={service_name:e,json_body:JSON.stringify(a)};let l,d,h=t[0];return Eo(async()=>{l=Date.now();const p=await yo(h,{data:c,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(d=Date.now()-l,p.code!==0){const R=new J(P.UNEXPECTED_RESPONSE,"live streaming ap error, code"+p.code,{retry:!0,responseTime:d});throw v.error(R.toString()),R}const m=JSON.parse(p.json_body);if(m.code!==200){const R=new J(P.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(m.code,", reason: ").concat(m.reason),{code:m.code,responseTime:d});throw v.error(R.toString()),R}if(!m.servers||m.servers.length===0){const R=new J(P.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:m.code,responseTime:d});throw v.error(R.toString()),R}const S=function(R,O){return{addressList:R.servers.map(A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(U("WORKER_DOMAIN"),":").concat(A.wss,"?serviceName=").concat(encodeURIComponent(O))),workerToken:R.workerToken,vid:R.vid}}(m,e);return U("LIVE_STREAMING_ADDRESS")&&(S.addressList=U("LIVE_STREAMING_ADDRESS")instanceof Array?U("LIVE_STREAMING_ADDRESS"):[U("LIVE_STREAMING_ADDRESS")]),cc(cc({},S),{},{responseTime:d})},(p,m)=>(kt.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(p.addressList),firstSuccess:m===0,responseTime:d,serverIp:t[m%t.length]}),!1),(p,m)=>(kt.apworkerEvent(n.sid,{success:!1,sc:p.data&&p.data.code||200,serviceName:e,responseTime:d,serverIp:t[m%t.length]}),!!(p.code!==P.OPERATION_ABORTED&&p.code!==P.UNEXPECTED_RESPONSE||p.data&&p.data.retry)&&(h=t[(m+1)%t.length],!0)),r)}let Uw=1;function vU(t,e,n,i){let{url:r,areaCode:a}=t;const{clientId:c,sid:l}=e,d=Date.now();let h;const p=e.role,[m,S]=Vw(e,a,[Vn.CHOOSE_SERVER]);let R=xn.networkState;return Eo(async()=>{R&&xn.networkState===ss.OFFLINE&&xn.onlineWaiter&&await Et.race([xn.onlineWaiter,Ti(i&&i.maxRetryTimeout||Kn.maxRetryTimeout)]),R=xn.networkState;const{data:O,headers:A}=await yo(r,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=A.http3==="1"?1:-1,kt.reportResourceTiming(r,l),bU(O,r,e,d,[Vn.CHOOSE_SERVER],h);const I=wg(O,Vn.CHOOSE_SERVER);return xw(I),Aw(I,r)},O=>(O&&kt.joinChooseServer(l,{role:p,lts:d,succ:!0,csAddr:r,opid:S,serverList:O.gatewayAddrs.map(A=>A.address),ec:null,cid:O.cid.toString(),uid:O.uid.toString(),csIp:O.csIp,unilbsServerIds:[Vn.CHOOSE_SERVER].toString(),isHttp3:h,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:O.res.detail&&O.res.detail[38]}),!1),O=>O.code!==P.OPERATION_ABORTED&&(O.code===P.CAN_NOT_GET_GATEWAY_SERVER?O.data.retry:(kt.joinChooseServer(l,{role:p,lts:d,succ:!1,csAddr:r,serverList:null,opid:S,ec:O.code,csIp:O.data&&O.data.csIp,unilbsServerIds:[Vn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:R}),isHttp3:h,corssRegionTagReq:e.apRequestDetail}),v.warning("[".concat(c||"sid-".concat(l.slice(0,6)),"] Choose server network error, retry"),O),!0)),i)}function CU(t,e,n,i){let r,{url:a,areaCode:c,serviceIds:l}=t;const d=Date.now(),h=e.role,[p,m]=Vw(e,c,l);let S;return Eo(async()=>{S&&xn.networkState===ss.OFFLINE&&xn.onlineWaiter&&await Et.race([xn.onlineWaiter,Ti(i&&i.maxRetryTimeout||Kn.maxRetryTimeout)]),S=xn.networkState;const{data:R,headers:O}=await yo(a,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r=O.http3==="1"?1:-1,kt.reportResourceTiming(a,e.sid),bU(R,a,e,d,l,r);const A=wg(R,Vn.CHOOSE_SERVER),I=wg(R,e.cloudProxyServer==="proxy5"?Vn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Vn.CLOUD_PROXY:Vn.CLOUD_PROXY_FALLBACK);return xw(A),{gatewayInfo:Aw(A,a),proxyInfo:I,url:a}},R=>(R.gatewayInfo&&kt.joinChooseServer(e.sid,{role:h,lts:d,succ:!0,csAddr:a,serverList:R.gatewayInfo.gatewayAddrs.map(O=>O.address),ec:null,opid:m,cid:R.gatewayInfo.cid.toString(),uid:R.gatewayInfo.uid.toString(),csIp:R.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:r,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:R.gatewayInfo.res.detail&&R.gatewayInfo.res.detail[38]}),R.proxyInfo&&kt.joinWebProxyAP(e.sid,{lts:d,sucess:1,apServerAddr:a,turnServerAddrList:R.proxyInfo.addresses.map(O=>O.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:l.toString()}),!1),R=>R.code!==P.OPERATION_ABORTED&&(R.code===P.CAN_NOT_GET_GATEWAY_SERVER?R.data.retry:(kt.joinWebProxyAP(e.sid,{lts:d,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:R.code,eventType:e.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:S})}),v.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),R),!0)),i)}const bU=(t,e,n,i,r,a)=>{const{sid:c,clientId:l,cloudProxyServer:d}=n,h=[],p=m=>{m.flag===4096?kt.joinChooseServer(c,{role:n.role,lts:i,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:r.toString(),isHttp3:a,corssRegionTagReq:n.apRequestDetail}):m.flag!==1048576&&m.flag!==4194304&&m.flag!==4194310||kt.joinWebProxyAP(c,{lts:i,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:m.error.code,eventType:d,unilbsServerIds:r.toString()})};if(t.response_body.forEach(m=>{const S=m.buffer.code;if(m.uri===23&&S===0&&!m.buffer.edges_services)if(m.buffer.flag===4194310)v.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{const R={error:new J(P.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:m.buffer.flag};h.push(R),p(R)}if(S!==0){const R=Zf(S),O={error:new J(P.CAN_NOT_GET_GATEWAY_SERVER,R.desc,{desc:R.desc,retry:R.retry,csIp:t.detail[502]}),flag:m.buffer.flag};m.buffer.flag===4194310?v.warning(O.error.toString()):h.push(O),p(O)}}),h.length)throw v.warning("[".concat(l||"sid-".concat(c.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new J(P.CAN_NOT_GET_GATEWAY_SERVER,h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!h.find(m=>m.error.data.retry),csIp:t.detail[502],desc:[...new Set(h.map(m=>{var S;return m==null||(S=m.error)===null||S===void 0||(S=S.data)===null||S===void 0?void 0:S.desc}).filter(m=>!!m))]})},xw=t=>{var e,n,i,r;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new J(P.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(U("AP_AREA")&&((i=t.detail)!==null&&i!==void 0&&i[23]&&typeof((r=t.detail)===null||r===void 0?void 0:r[23])=="string"?RU(t.detail[23].toLowerCase()):RU()),(e=t.detail)!==null&&e!==void 0&&e[19]&&typeof((n=t.detail)===null||n===void 0?void 0:n[19])=="string"){const c=t.detail[19],l=c==null?void 0:c.split(";");for(let d=0;d<l.length;d++){var a;const h=Ji(a=l[d]).call(a);t.addresses[d]&&l&&(t.addresses[d].fingerprint=h)}}if(U("GATEWAY_ADDRESS")&&U("GATEWAY_ADDRESS").length>0){v.debug("assign gateway address to",U("GATEWAY_ADDRESS"));const c=U("GATEWAY_ADDRESS").map(l=>{var d,h;const p=(d=(h=t.addresses.find(m=>m.ip===l.ip&&m.port===l.port))===null||h===void 0?void 0:h.fingerprint)!==null&&d!==void 0?d:"";return{ip:l.ip,port:l.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:p}});t.addresses=c}},Y6=(t,e)=>{if(t.response_body&&t.response_body.length){const n=t.response_body[0];if(n.buffer.code!==0){const i=Zf(n.buffer.code);throw new J(P.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw v.debug("update ticket request received ap response without response body:",e),new J(P.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Vw=(t,e,n)=>{const i=Math.floor(Math.random()*1e12),r=t.role==="host"?"1":t.role==="audience"?"2":void 0,a={appid:t.appId,client_ts:Date.now(),opid:i,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:cc(cc(cc({6:t.stringUid,11:e,12:U("USE_NEW_TOKEN")?"1":void 0},r?{17:r}:{}),{},{22:e},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:n,uid:t.uid||0}}]};a.request_bodies.forEach(l=>{t.multiIP&&t.multiIP.gateway_ip&&(l.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const c=new FormData;return c.append("request",JSON.stringify(a)),[c,i]},q6=(t,e)=>{const n=Math.floor(Math.random()*1e12),i={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map(a=>({ip:a.ip,port:a.port}))}}]},r=new FormData;return r.append("request",JSON.stringify(i)),[r,n]};let nm=0;function im(t){return Et.all(t.map(e=>e.then(n=>{throw n},n=>n))).then(e=>{throw e},e=>e)}const Pg=async t=>{let{fragementLength:e,referenceList:n,asyncMapHandler:i,allFailedhandler:r,promisesCollector:a}=t,c=0;const l=e;let d,h=0;const p=async()=>{const m=(()=>{const S=c*l,R=S+l;return n.slice(S,R).map(i)})();a&&a.push(...m);try{d=await im(m)}catch(S){if(h+=l,c++,!(h>=n.length))return void await p();r(S)}m.forEach(S=>S.cancel())};return await p(),d},AU=async t=>{let{referenceList:e,asyncMapHandler:n,closeFn:i}=t;const r=e.length;let a=0;const c=async()=>{const l=n(e.shift());try{return await l}catch(d){if(a++,a>=r||i!=null&&i(d))throw d;return c()}};return c()};async function Bw(t,e,n,i){return{gatewayInfo:await async function(a,c,l,d){let h=null;const p=[],m=async()=>{const R=U("WEBCS_DOMAIN").slice(0,U("AJAX_REQUEST_CONCURRENT")).map(I=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(I+"/api/v2/transpond/webrtc?v=2"):"https://".concat(I,"/api/v2/transpond/webrtc?v=2"),areaCode:Lg()})),O=d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(I=>I.url)}),A=await Pg({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:I=>(v.debug("[".concat(a.clientId,"] Connect to choose_server:"),I.url),vU(I,a,c,l)),allFailedhandler:I=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},O),I[0]},promisesCollector:p});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},O),A},S=async()=>{if(await Ti(1e3),h!==null)return h;const R=U("WEBCS_DOMAIN_BACKUP_LIST").map(I=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(I+"/api/v2/transpond/webrtc?v=2"):"https://".concat(I,"/api/v2/transpond/webrtc?v=2"),areaCode:Lg()})),O=d.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(I=>I.url)}),A=await Pg({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:I=>(v.debug("[".concat(a.clientId,"] Connect to backup choose_server:"),I.url),vU(I,a,c,l)),allFailedhandler:I=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},O),I[0]},promisesCollector:p});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},O),A};try{return h=await im([m(),S()]),p.length&&p.forEach(R=>R.cancel&&typeof R.cancel=="function"&&R.cancel()),h}catch(R){throw R[0]}}(t,e,n,i)}}async function IU(t,e,n,i,r){const a=t.cloudProxyServer;if(a==="disabled"){if(t.useLocalAccessPoint)return await Bw(t,e,n,r);if(U("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:S,proxyInfo:R}=await NU(t,e,n,r);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:S};const O=R.map(A=>({turnServerURL:A.address,tcpport:A.tcpport||Pi.tcpport,udpport:A.udpport||Pi.udpport,username:A.username||Pi.username,password:A.password||Pi.password,forceturn:!1,security:!0}));if(r.useP2P){var c;const A=(c=t.uid)!==null&&c!==void 0?c:S.uid,I="glb:".concat(A.toString()),D=await LI(I),L=R.map(V=>({turnServerURL:V.address,tcpport:V.tcpport||Pi.tcpport,udpport:V.udpport||Pi.udpport,username:I,password:D,forceturn:!1,security:!0}));O.push(...L)}return t.turnServer={mode:"manual",servers:O},{gatewayInfo:S}}return await Bw(t,e,n,r)}const{proxyInfo:l,gatewayInfo:d}=await NU(t,e,n,r),h={gatewayInfo:d},p=l.map(S=>({turnServerURL:S.address,tcpport:a==="proxy3"?void 0:S.tcpport?S.tcpport:Pi.tcpport,udpport:a==="proxy4"?void 0:S.udpport?S.udpport:Pi.udpport,username:S.username||Pi.username,password:S.password||Pi.password,forceturn:a!=="proxy4",security:a==="proxy5"}));if(r.useP2P){var m;const S=(m=t.uid)!==null&&m!==void 0?m:d.uid,R="glb:".concat(S.toString()),O=await LI(R),A=l.map(I=>({turnServerURL:I.address,tcpport:a==="proxy3"?void 0:I.tcpport||Pi.tcpport,udpport:a==="proxy4"?void 0:I.udpport||Pi.udpport,username:R,password:O,forceturn:a!=="proxy4",security:a==="proxy5"}));p.push(...A)}return t.turnServer={mode:"manual",servers:p},v.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(a)),h}async function wU(t,e,n,i,r){const a=U("ACCOUNT_REGISTER").slice(0,U("AJAX_REQUEST_CONCURRENT"));let c=[];c=e.proxyServer?a.map(d=>"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1")):a.map(d=>"https://".concat(d,"/api/v1"));const l=r==null?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const d=await async function(h,p,m,S,R){const O=Date.now(),A={sid:m.sid,opid:10,appid:m.appId,string_uid:p};let I=h[0];const D=await Eo(()=>yo(I+"".concat(I.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(L,V)=>{if(L.code===0){if(L.uid<=0||L.uid>=Math.pow(2,32))throw v.error("Invalid Uint Uid ".concat(p," => ").concat(L.uid),L),kt.reqUserAccount(A.sid,{lts:O,success:!1,serverAddr:I,stringUid:A.string_uid,uid:L.uid,errorCode:P.INVALID_UINT_UID_FROM_STRING_UID,extend:A}),new J(P.INVALID_UINT_UID_FROM_STRING_UID);return kt.reqUserAccount(A.sid,{lts:O,success:!0,serverAddr:I,stringUid:A.string_uid,uid:L.uid,errorCode:null,extend:A}),!1}const W=Zf(L.code);return W.retry&&(I=h[(V+1)%h.length]),kt.reqUserAccount(A.sid,{lts:O,success:!1,serverAddr:I,stringUid:A.string_uid,uid:L.uid,errorCode:W.desc,extend:A}),W.retry},(L,V)=>L.code!==P.OPERATION_ABORTED&&(kt.reqUserAccount(A.sid,{lts:O,success:!1,serverAddr:I,stringUid:A.string_uid,uid:null,errorCode:L.code,extend:A}),I=h[(V+1)%h.length],!0),R);if(D.code!==0){const L=Zf(D.code);throw new J(P.UNEXPECTED_RESPONSE,L.desc)}return D}(c,t,e,n,i);return r==null||r.recordJoinChannelService({status:"success",endTs:Date.now()},l),d.uid}catch(d){throw r==null||r.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[d]},l),d}}async function z6(t,e,n){const i=U("ACCOUNT_REGISTER");let r=[];r=e.proxyServer?i.map(a=>"https://".concat(e.proxyServer,"/ap/?url=").concat(a+"/api/v1")):i.map(a=>"https://".concat(a,"/api/v1"));try{return await AU({referenceList:r,asyncMapHandler:c=>async function(l,d,h,p){const m=Date.now(),S={sid:h.sid,opid:10,appid:h.appId,string_uid:d};try{const R=await yo(l+"".concat(l.indexOf("?")===-1?"?":"&","action=stringuid"),{data:S,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(R.code!==0){const O=Zf(R.code);throw new J(P.UNEXPECTED_RESPONSE,"preload sua error:".concat(O.desc),O)}if(R.uid<=0||R.uid>=Math.pow(2,32))throw new J(P.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:m,url:l,req:S,uid:R.uid,elapse:Date.now()-m}}catch(R){throw R}}(c,t,e,n),closeFn:c=>c.code===P.OPERATION_ABORTED||c.code===P.UNEXPECTED_RESPONSE&&!c.data.retry})}catch(a){throw a}}async function X6(t,e,n){const i=U("CDS_AP").slice(0,U("AJAX_REQUEST_CONCURRENT")).map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1"):"https://".concat(d,"/api/v1?action=config")),r=i.map(d=>function(h,p,m,S){const R=Re(),O={flag:64,cipher_method:0,features:cc(cc(cc(cc(cc({install_id:HI(),device:R.name,system:R.os,system_general:navigator.userAgent,vendor:p.appId,version:qs,cname:p.cname,session_id:p.sid,proxyServer:p.proxyServer,sdk_type:F6.WEB_RTC,browser_name:R.name,browser_version:R.version,user_agent:navigator.userAgent,channel_name:p.cname},p.stringUid&&{string_uid:p.stringUid}),p.uid&&{uid:p.uid+""}),R.os&&{os_name:R.os}),R.osVersion&&{os_version:R.osVersion}),{},{detail:""})};return Eo(()=>yo(h,{data:O,timeout:1e3,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,A=>A.code!==P.OPERATION_ABORTED,S)}(d,t,e,n));let a=null,c=null,l={};try{a=await im(r)}catch(d){if(d.code===P.OPERATION_ABORTED)throw d;c=d}if(r.forEach(d=>d.cancel()),kt.reportApiInvoke(t.sid,{name:Wn.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:a}}).onSuccess(),a&&a.test_tags)try{l=function(d){if(!d.test_tags)return{};const h=d.test_tags,p=Object.keys(h),m={};return p.forEach(S=>{var R;const O=Ji(R=S.slice(4)).call(R),A=JSON.parse(h[S]),I=A[1];m[O]={tag:A[0]||"",value:I}}),m}(a)}catch{}return l}async function OU(t,e){const n=U("WEBCS_DOMAIN").concat(U("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:Lg(),serviceIds:[Vn.CHOOSE_SERVER,Vn.CLOUD_PROXY_FALLBACK]}));try{return await AU({referenceList:n,asyncMapHandler:r=>async function(a,c,l){let d,{url:h,areaCode:p,serviceIds:m}=a;const S=Date.now(),[R,O]=Vw(c,p,m);let A=xn.networkState;try{A&&xn.networkState===ss.OFFLINE&&xn.onlineWaiter&&await Et.race([xn.onlineWaiter,Ti(Kn.maxRetryTimeout)]),A=xn.networkState;const{data:I,headers:D}=await yo(h,{data:R,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);d=D.http3==="1"?1:-1,(K=>{const G=[];if(K.response_body.forEach(Q=>{const lt=Q.buffer.code;if(Q.uri===23&&lt===0&&!Q.buffer.edges_services)if(Q.buffer.flag===4194310)Q.buffer.edges_services=[];else{const Tt={error:new J(P.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:K.detail[502]}),flag:Q.buffer.flag};G.push(Tt)}if(lt!==0){const Tt=Zf(lt),At={error:new J(P.CAN_NOT_GET_GATEWAY_SERVER,Tt.desc,{desc:Tt.desc,retry:Tt.retry,csIp:K.detail[502]}),flag:Q.buffer.flag};Q.buffer.flag===4194310?v.warning(At.error.toString()):G.push(At)}}),G.length)throw new J(P.CAN_NOT_GET_GATEWAY_SERVER,G.map(Q=>"flag: ".concat(Q.flag,", message: ").concat(Q.error.message)).join(" | "),{retry:!!G.find(Q=>Q.error.data.retry),csIp:K.detail[502],desc:[...new Set(G.map(Q=>{var lt;return Q==null||(lt=Q.error)===null||lt===void 0||(lt=lt.data)===null||lt===void 0?void 0:lt.desc}).filter(Q=>!!Q))]})})(I);const V=wg(I,Vn.CHOOSE_SERVER),W=wg(I,Vn.CLOUD_PROXY_FALLBACK);return xw(V),{gatewayInfo:Aw(V,h),proxyInfo:W,opid:O,requestTime:S,url:h,isHttp3:d,elapse:Date.now()-S}}catch(I){throw I}}(r,t,e),closeFn:r=>r.code===P.OPERATION_ABORTED||r.code===P.CAN_NOT_GET_GATEWAY_SERVER&&!r.data.retry})}catch(i){throw i}}async function NU(t,e,n,i){const r=U("PROXY_SERVER_TYPE3"),a=(R,O,A)=>{let I=A||r;return Array.isArray(I)&&(I=O%2==0?r[1]:r[0]),"https://".concat(I,"/ap/?url=").concat(R)};let c=null;const l=[],d=async()=>{const R=U("WEBCS_DOMAIN").slice(0,U("AJAX_REQUEST_CONCURRENT")).map((I,D)=>{let L;return L=t.cloudProxyServer==="disabled"&&t.proxyServer?a("".concat(I,"/api/v2/transpond/webrtc?v=2"),D,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(I,"/api/v2/transpond/webrtc?v=2"):a("".concat(I,"/api/v2/transpond/webrtc?v=2"),D),{url:L,areaCode:Lg(),serviceIds:[Vn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Vn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Vn.CLOUD_PROXY:Vn.CLOUD_PROXY_FALLBACK]}}),O=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(I=>I.url)}),A=await Pg({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:I=>(v.debug("[".concat(t.clientId,"] Connect to choose_server:"),I.url),CU(I,t,e,n)),allFailedhandler:I=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},O),I[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},O),A},h=async()=>{if(await Ti(1e3),c!==null)return c;const R=U("WEBCS_DOMAIN_BACKUP_LIST").map((I,D)=>{let L;return L=t.cloudProxyServer==="disabled"&&t.proxyServer?a("".concat(I,"/api/v2/transpond/webrtc?v=2"),D,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(I,"/api/v2/transpond/webrtc?v=2"):a("".concat(I,"/api/v2/transpond/webrtc?v=2"),D),{url:L,areaCode:Lg(),serviceIds:[Vn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Vn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Vn.CLOUD_PROXY:Vn.CLOUD_PROXY_FALLBACK]}}),O=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(I=>I.url)}),A=await Pg({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:I=>(v.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),I.url),CU(I,t,e,n)),allFailedhandler:I=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},O),I[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},O),A};let p,m,S;try{({gatewayInfo:p,proxyInfo:m,url:S}=await im([d(),h()]))}catch(R){throw R[0]}if(l.length&&l.forEach(R=>R.cancel&&typeof R.cancel=="function"&&R.cancel()),!p||!m)throw new J(P.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=S,t.cloudProxyServer!=="disabled"&&Array.isArray(r)&&S){const R=/^https?:\/\/(.+?)(\/.*)?$/.exec(S)[1];_t(r).call(r,R)&&(t.proxyServer=R,v.setProxyServer(R),kt.setProxyServer(R))}return c={gatewayInfo:p,proxyInfo:await tU(m,p.uid)},c}async function J6(t,e,n){const i=U("UAP_AP").slice(0,U("AJAX_REQUEST_CONCURRENT")).map(a=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap")),r=i.map(a=>function(c,l,d,h){const p={command:"convergeAllocateEdge",sid:l.sid,appId:l.appId,token:l.token,ts:Date.now(),version:qs,cname:l.cname,uid:l.uid.toString(),requestId:Uw,seq:Uw};Uw+=1;const m={service_name:"tele_channel",json_body:JSON.stringify(p)};return Eo(async()=>{const S=await yo(c,{data:m,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(S.code!==0){const O=new J(P.UNEXPECTED_RESPONSE,"cross channel ap error, code"+S.code,{retry:!0});throw v.error(O.toString()),O}const R=JSON.parse(S.json_body);if(R.code!==200){const O=new J(P.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(R.code,", reason: ").concat(R.reason));throw v.error(O.toString()),O}if(!R.servers||R.servers.length===0){const O=new J(P.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw v.error(O.toString()),O}return{vid:R.vid,workerToken:R.workerToken,addressList:(U("CHANNEL_MEDIA_RELAY_SERVERS")||R.servers).map(O=>"wss://".concat(O.address.replace(/\./g,"-"),".").concat(U("WORKER_DOMAIN"),":").concat(O.wss))}},void 0,S=>!!(S.code!==P.OPERATION_ABORTED&&S.code!==P.UNEXPECTED_RESPONSE||S.data&&S.data.retry),h)}(a,t,e,n));try{const a=await im(r);return r.forEach(c=>c.cancel()),a}catch(a){throw a[0]}}async function Q6(t,e,n){let i=null;const r=[],a=async c=>{const l=U(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v2/transpond/webrtc?v=2"):"https://".concat(d,"/api/v2/transpond/webrtc?v=2"));return c&&(await Ti(1e3),i!==null)?i:await Pg({fragementLength:U("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:d=>(v.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),d),function(h,p,m,S){const[R]=q6(p,[Vn.CHOOSE_SERVER]);let O=xn.networkState;return Eo(async()=>{O&&xn.networkState===ss.OFFLINE&&xn.onlineWaiter&&await Et.race([xn.onlineWaiter,Ti(S&&S.maxRetryTimeout||Kn.maxRetryTimeout)]),O=xn.networkState;const A=await yo(h,{data:R,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0);return Y6(A,h)},()=>!1,A=>A.code!==P.OPERATION_ABORTED&&(A.code===P.UPDATE_TICKET_FAILED?A.data.retry:(v.warning("[".concat(p.clientId,"] update ticket network error, retry"),A),!0)),S)}(d,t,e,n)),allFailedhandler:d=>{throw d[0]},promisesCollector:r})};try{return i=await im([a(!1),a(!0)]),r.length&&r.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),i}catch(c){throw c[0]}}function DU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Fw(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?DU(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):DU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class Z6 extends _n{get isSuccess(){return!!this.configs}constructor(e,n){super(),N(this,"configs",void 0),N(this,"store",void 0),N(this,"joinInfo",void 0),N(this,"cancelToken",void 0),N(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),N(this,"interval",void 0),N(this,"mutex",void 0),N(this,"mutableParamsRead",!1),N(this,"configCache",{}),N(this,"limit_bitrate",void 0),this.mutex=new xi("config-distribute",e),this.store=n}startGetConfigDistribute(e,n){this.joinInfo=e,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),U("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},U("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,kt.reportApiInvoke(null,{options:void 0,name:Wn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Rn.TRACER}).onSuccess(JSON.stringify(go))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void v.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const n=await this.mutex.lock();try{e=await X6(this.joinInfo,this.cancelToken,this.retryConfig),v.debug("[config-distribute] get config distribute",JSON.stringify(e));const i=function(r){var a;const c=tg(a=Object.keys(r).filter(h=>/^webrtc_ng_global_parameter/.test(h))).call(a);for(let h=0;h<c.length;h++)for(let p=c.length-1;p>h;p--){const m=c[p],S=r[m].value;if(typeof S.__priority=="number"){const R=S.__priority,O=c[p-1],A=r[O].value;if(typeof A.__priority=="number"){if(!(R>A.__priority))continue;{const I=m;c[p]=c[p-1],c[p-1]=I}}else{const I=m;c[p]=c[p-1],c[p-1]=I}}}const l=Date.now();let d={};return c.forEach(h=>{const p=r[h].value.__expires;p&&p<=l||(d[h]=r[h])}),d}(e);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const r=new J(P.NETWORK_RESPONSE_ERROR,i);v.warning("[config-distribute] ".concat(r.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){G1(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(bg.UPDATE_BITRATE_LIMIT,e):this.emit(bg.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&Fw({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const n={},i=Object.keys(e),r=[];i.forEach(a=>{const c=e[a].value;n[a]=c;const l=c.__id;if(l&&this.configCache[a]&&this.configCache[a].__id===l)return;const d=c.__type,h=e[a].value,p=e[a].tag;let m=0;d?d===Ek.REALTIME&&(m=1):Object.keys(h).some(S=>Object.prototype.hasOwnProperty.call(qI,S)||!_w()&&Object.prototype.hasOwnProperty.call(Ky,S)?(m=1,!0):void 0),r.push({tag:p,isApplied:m,feature:a,params:JSON.stringify(c)})}),r.forEach(a=>{let{tag:c,feature:l,params:d,isApplied:h}=a;this.store.sessionId&&kt.abTest(this.store.sessionId,{intSucc:1,isApplied:h,tag:c,feature:l,params:d,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){v.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(e){const n=function(r){const a={};return Object.keys(r).forEach(c=>{const l=r[c].value,d=l.__expires,h=l.__type;Object.keys(l).forEach(p=>{p==="__id"||p==="__type"||p==="__priority"||p==="__expires"||Object.prototype.hasOwnProperty.call(a,p)||(a[p]=Fw(Fw({value:l[p]},d&&{expires:d}),h&&{type:h}))})}),a}(e);try{var i;const r=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,r&&G1(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(e),function(l){try{const d=Date.now();Object.keys(l).forEach(h=>{const{value:p,type:m,expires:S}=l[h];S&&S<=d||((m===Ek.REALTIME||Object.prototype.hasOwnProperty.call(qI,h))&&(go[h]=p,on[h]=p,v.debug("Update realtime parameters from config distribute",h,p)),m||_w()||!Object.prototype.hasOwnProperty.call(Ky,h)||(go[h]=p,on[h]=p,v.debug("Update gateway parameters from config distribute",h,p)))})}catch(d){v.error("Error update config immediately: ".concat(l),d.message)}}(n);const a=JSON.stringify(n),c=window.btoa(a);window.localStorage.setItem("websdk_ng_global_parameter",c),v.debug("Caching global parameters ".concat(a))}catch(r){v.error("Error caching global parameters:",r.message)}}handleGlobalParameterConfig(e){try{const n=Date.now();Object.keys(e).forEach(i=>{if(i==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(on,i)){const{value:r,expires:a}=e[i];if(a&&a<=n)return;(function(c,l){try{return typeof c=="object"&&typeof l=="object"&&JSON.stringify(c)===JSON.stringify(l)}catch{return!1}})(on[i],r)||(go[i]=r,on[i]=r,this.emit(bg.UPDATE_CLIENT_ROLE_OPTIONS,r),v.debug("Updating client role options: ".concat(JSON.stringify(r))))}})}catch(n){v.error("Error handling global parameter config:",n.message)}}}class $6 extends _n{constructor(){super(...arguments),N(this,"resultStorage",new Map)}setLocalAudioStats(e,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(e,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(i))}setRemoteAudioStats(e,n){const i=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(e,n){const i=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(e,n,i){if(U("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(r&&(r.result.push(i),r.result.length>=5)){var a;const c=_t(a=r.result).call(a,!0);r.isPrevNormal&&!c&&this.emit("exception",LU[e],e,n),!r.isPrevNormal&&c&&this.emit("exception",LU[e]+2e3,e+"_RECOVER",n),r.isPrevNormal=c,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,n){return n instanceof Xn&&!n.isActive||!!n.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=as(n._encoderConfig.frameRate));const r=e.captureFrameRate;return!i||!r||!(i>10&&r<5||i<10&&i>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,n){return!!n.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,n){return n instanceof Xn&&!n.isActive||!!n.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const LU={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Fi=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function PU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function fh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?PU(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):PU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class kg{constructor(e){N(this,"store",void 0),N(this,"onStatsException",void 0),N(this,"onUploadPublishDuration",void 0),N(this,"onStatsChanged",void 0),N(this,"localStats",new Map),N(this,"remoteStats",new Map),N(this,"updateStatsInterval",void 0),N(this,"trafficStats",void 0),N(this,"trafficStatsPeerList",[]),N(this,"uplinkStats",void 0),N(this,"exceptionMonitor",void 0),N(this,"p2pChannel",void 0),N(this,"scalabilityMode",Wy.L1T1),N(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new $6,this.exceptionMonitor.on("exception",(n,i,r)=>{this.onStatsException&&this.onStatsException(n,i,r)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ct.LocalAudioTrack)||fh({},ZI)}getLocalVideoTrackStats(){return this.localStats.get(ct.LocalVideoTrack)||fh({},$I)}getRemoteAudioTrackStats(e){const n=(a,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(d=>d.peer_uid===a);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const a=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.audioStats;a&&(i[e]=n(e,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{audioStats:l}]=a;l&&(i[c]=n(c,l))});return i}getRemoteNetworkQualityStats(e){const n={};if(e){var i;const r=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.networkStats;r&&(n[e]=r)}else Array.from(this.remoteStats.entries()).forEach(r=>{let[a,{networkStats:c}]=r;c&&(n[a]=c)});return n}getRemoteVideoTrackStats(e){const n=(a,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(d=>d.peer_uid===a);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const a=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.videoStats;a&&(i[e]=n(e,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{videoStats:l}]=a;l&&(i[c]=n(c,l))});return i}getRTCStats(){let e=0,n=0,i=0,r=0;const a=this.localStats.get(ct.LocalAudioTrack);a&&(e+=a.sendBytes,n+=a.sendBitrate);const c=this.localStats.get(ct.LocalVideoTrack);c&&(e+=c.sendBytes,n+=c.sendBitrate);const l=this.localStats.get(ct.LocalVideoLowTrack);l&&(e+=l.sendBytes,n+=l.sendBitrate),this.remoteStats.forEach(h=>{let{audioStats:p,videoStats:m}=h;p&&(i+=p.receiveBytes,r+=p.receiveBitrate),m&&(i+=m.receiveBytes,r+=m.receiveBitrate)});let d=1;return this.trafficStats&&(d+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:d,SendBitrate:n,SendBytes:e,RecvBytes:i,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),e.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const r=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),a=r!=null&&r.videoSSRC?Fi.measureFromSubscribeStart(this.store.clientId,r.videoSSRC):0,c=r!=null&&r.audioSSRC?Fi.measureFromSubscribeStart(this.store.clientId,r.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,a>c?a:c),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&v.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,n,i){if(!e)return!1;const r=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,a=!i||n.framesDecodeCount>i.framesDecodeCount;return r||!a}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(n=>{let[i,r]=n;switch(i){case ct.LocalVideoTrack:case ct.LocalVideoLowTrack:{const c=r,l=fh({},$I),d=e.getStats(),h=e.getLocalMedia(i);if(d){const p=d.videoSend.find(m=>m.ssrc===(h==null?void 0:h.ssrcs[0].ssrcId));if(p){const m=e.getLocalVideoSize(),S=e.getEncoderConfig(ct.LocalVideoTrack);p.codec!=="H264"&&p.codec!=="H265"&&p.codec!=="VP8"&&p.codec!=="VP9"&&p.codec!=="AV1X"&&p.codec!=="AV1"||(l.codecType=p.codec),l.sendBytes=p.bytes,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0,p.inputFrame?(l.captureFrameRate=p.inputFrame.frameRate,l.captureResolutionHeight=p.inputFrame.height,l.captureResolutionWidth=p.inputFrame.width):m&&(l.captureResolutionWidth=m.width,l.captureResolutionHeight=m.height),p.sentFrame?(l.sendFrameRate=p.sentFrame.frameRate,l.sendResolutionHeight=p.sentFrame.height,l.sendResolutionWidth=p.sentFrame.width):m&&(l.sendResolutionWidth=m.width,l.sendResolutionHeight=m.height),p.avgEncodeMs&&(l.encodeDelay=p.avgEncodeMs),S&&S.bitrateMax&&(l.targetSendBitrate=1e3*S.bitrateMax),l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.sendJitterMs=p.jitterMs,l.sendRttMs=p.rttMs,l.totalDuration=c?c.totalDuration+1:1,l.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(p)&&(l.totalFreezeTime+=1),p.scalabilityMode&&this.scalabilityMode!==p.scalabilityMode&&(v.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(p.scalabilityMode)),this.scalabilityMode=p.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var a;this.localStats.set(i,l),((c==null?void 0:c.sendResolutionWidth)!==l.sendResolutionWidth||(c==null?void 0:c.sendResolutionHeight)!==l.sendResolutionHeight)&&((a=this.onStatsChanged)===null||a===void 0||a.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&h&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,h.track,l);break}case ct.LocalAudioTrack:{const c=r,l=fh({},ZI),d=e.getStats(),h=e.getLocalMedia(i);if(d){const p=d.audioSend.find(m=>m.ssrc===(h==null?void 0:h.ssrcs[0].ssrcId));if(p){if(p.codec!=="opus"&&p.codec!=="aac"&&p.codec!=="PCMU"&&p.codec!=="PCMA"&&p.codec!=="G722"||(l.codecType=p.codec),p.inputLevel)l.sendVolumeLevel=Math.round(32767*p.inputLevel);else{const m=e.getLocalAudioVolume();m&&(l.sendVolumeLevel=Math.round(32767*m))}l.sendBytes=p.bytes,l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.sendJitterMs=p.jitterMs,l.sendRttMs=p.rttMs,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ct.LocalAudioTrack,l),l&&h&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,h.track,l);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(n=>{var i,r;let[a,{videoStats:c,audioStats:l,videoPcStats:d}]=n;const h=l,p=c,m=d,S=fh({},wk),R=fh({},Ok),O=fh({},xH),{audioTrack:A,videoTrack:I,audioSSRC:D,videoSSRC:L}=e.getRemoteMedia(a);let V;V=this.store.useP2P?e.getStats(!0):e.getStats();const W=(i=V)===null||i===void 0?void 0:i.audioRecv.find(lt=>lt.ssrc===D),K=(r=V)===null||r===void 0?void 0:r.videoRecv.find(lt=>lt.ssrc===L),G=this.trafficStats&&this.trafficStats.peer_delay.find(lt=>lt.peer_uid===a);if(W&&(W.codec!=="opus"&&W.codec!=="aac"&&W.codec!=="PCMU"&&W.codec!=="PCMA"&&W.codec!=="G722"||(S.codecType=W.codec),W.outputLevel?S.receiveLevel=Math.round(32767*W.outputLevel):A&&(S.receiveLevel=Math.round(32767*A.getVolumeLevel())),S.receiveBytes=W.bytes,S.receivePackets=W.packets,S.receivePacketsLost=W.packetsLost,S.receivePacketsDiscarded=W.packetsDiscarded,S.packetLossRate=S.receivePacketsLost/(S.receivePackets+S.receivePacketsLost),S.receiveBitrate=h?8*Math.max(0,S.receiveBytes-h.receiveBytes):0,S.totalDuration=h?h.totalDuration+1:1,S.totalFreezeTime=h?h.totalFreezeTime:0,S.freezeRate=S.totalFreezeTime/S.totalDuration,S.receiveDelay=W.jitterBufferMs,S.totalDuration>10&&kg.isRemoteAudioFreeze(A)&&(S.totalFreezeTime+=1)),K){var Q;K.codec!=="H264"&&K.codec!=="H265"&&K.codec!=="VP8"&&K.codec!=="VP9"&&K.codec!=="AV1X"&&K.codec!=="AV1"||(R.codecType=K.codec),R.receiveBytes=K.bytes,R.receiveBitrate=p?8*Math.max(0,R.receiveBytes-p.receiveBytes):0,R.decodeFrameRate=K.decodeFrameRate<0?0:K.decodeFrameRate,R.renderFrameRate=K.decodeFrameRate<0?0:K.decodeFrameRate,K.outputFrame&&(R.renderFrameRate=K.outputFrame.frameRate),K.receivedFrame?(R.receiveFrameRate=K.receivedFrame.frameRate,R.receiveResolutionHeight=K.receivedFrame.height,R.receiveResolutionWidth=K.receivedFrame.width):I&&(R.receiveResolutionHeight=I._videoHeight||0,R.receiveResolutionWidth=I._videoWidth||0),K.framesRateFirefox!==void 0&&(R.receiveFrameRate=Math.round(K.framesRateFirefox)),R.receivePackets=K.packets,R.receivePacketsLost=K.packetsLost,R.packetLossRate=R.receivePacketsLost/(R.receivePackets+R.receivePacketsLost);const lt=p?p.totalFreezeTime:0,Tt=p?p.totalDuration:0;R.totalDuration=p?p.totalDuration+1:1,R.totalFreezeTime=(Q=K.totalFreezesDuration)!==null&&Q!==void 0?Q:lt||0,R.receiveDelay=K.jitterBufferMs||0;const At=!!L&&e.getRemoteVideoIsReady(L);K.totalFreezesDuration===void 0&&I&&At&&kg.isRemoteVideoFreeze(I,K,m)&&(R.totalFreezeTime+=1),R.freezeRate=Math.max(0,Math.min((R.totalFreezeTime-lt)/(R.totalDuration-Tt),1))}G&&(S.end2EndDelay=G.B_ad,R.end2EndDelay=G.B_vd,S.transportDelay=G.B_ed,R.transportDelay=G.B_ed,S.currentPacketLossRate=G.B_ealr4/100,R.currentPacketLossRate=G.B_evlr4/100,O.uplinkNetworkQuality=G.B_punq?G.B_punq:0,O.downlinkNetworkQuality=G.B_pdnq?G.B_pdnq:0),this.remoteStats.set(a,{audioStats:S,videoStats:R,videoPcStats:K,networkStats:O}),A&&this.exceptionMonitor.setRemoteAudioStats(A,S),I&&this.exceptionMonitor.setRemoteVideoStats(I,R)})}}class kU{constructor(){N(this,"destChannelMediaInfos",new Map),N(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){F1(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){F1(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){uv(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function MU(t){if(!(t instanceof kU))return new J(P.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();if(!e)return new J(P.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new J(P.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Ou{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,n){N(this,"uid",void 0),N(this,"_uintid",void 0),N(this,"_trust_in_room_",!0),N(this,"_trust_audio_enabled_state_",!0),N(this,"_trust_video_enabled_state_",!0),N(this,"_trust_audio_mute_state_",!0),N(this,"_trust_video_mute_state_",!0),N(this,"_audio_muted_",!1),N(this,"_video_muted_",!1),N(this,"_audio_enabled_",!0),N(this,"_video_enabled_",!0),N(this,"_audio_added_",!1),N(this,"_video_added_",!1),N(this,"_is_pre_created",!1),N(this,"_video_pre_subscribed",!1),N(this,"_audio_pre_subscribed",!1),N(this,"_trust_video_stream_added_state_",!0),N(this,"_trust_audio_stream_added_state_",!0),N(this,"_audioTrack",void 0),N(this,"_videoTrack",void 0),N(this,"_dataChannels",[]),N(this,"_audioSSRC",void 0),N(this,"_videoSSRC",void 0),N(this,"_audioOrtc",void 0),N(this,"_videoOrtc",void 0),N(this,"_cname",void 0),N(this,"_rtxSsrcId",void 0),N(this,"_videoMid",void 0),N(this,"_audioMid",void 0),this.uid=e,this._uintid=n}}function UU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function xU(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?UU(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):UU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Mg="9",VU=4e4;function BU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function El(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?BU(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):BU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var rm=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(rm||{});const Cv=new Map;function FU(t,e,n,i){let{scale:r}=t;if(r===0&&i===rm.UP||r>=e.length-1&&i===rm.DOWN)return t;let a=El(El({},t),{},{scale:i===rm.DOWN?++r:--r});switch(n){case"maintain-framerate":a=El(El({},a),e[r].motion);break;case"maintain-resolution":a=El(El({},a),e[r].detail);break;case"balanced":a=El(El({},a),e[r].balanced)}return a}function jU(t,e){if(e){const n={overUse:0,underUse:0,adaptationList:GU(e)};Cv.set(t,n)}else Cv.delete(t)}function GU(t){const e=El({},t),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:r,bitrateMin:a}=e,{MIN_FRAME_RATE:c,MAX_THRESHOLD_FRAMERATE:l,MAX_SCALE:d,BITRATE_MIN_THRESHOLD:h,BITRATE_MAX_THRESHOLD:p,BWE_SCALE_UP_THRESHOLD:m,BWE_SCALE_DOWN_THRESHOLD:S,PERF_SCALE_DOWN_THRESHOLD:R,PERF_SCALE_UP_THRESHOLD:O,BALANCE_BITRATE_FACTOR:A,BALANCE_FRAMERATE_FACTOR:I,BALANCE_RESOLUTION_FACTOR:D,MOTION_RESOLUTION_FACTOR:L,MOTION_BITRATE_FACTOR:V,DETAIL_FRAMERATE_FACTOR:W,DETAIL_BITRATE_FACTOR:K}=KI,G=Math.min(e.frameRate,l),Q=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(S,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(R,1)*G),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:a},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:a},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:a}}];for(let lt=1;lt<=d;lt++){const Tt={bwe_up:Math.round(Math.pow(m,lt)*n),bwe_down:Math.round(Math.pow(S,lt+1)*n),fps_up:Math.round(Math.pow(O,lt)*G),fps_down:Math.round(Math.pow(R,lt+1)*G)},At={scaleResolutionDownBy:r/Math.pow(D,lt),frameRate:Math.max(Math.round(Math.pow(I,lt)*i),c),bitrateMax:Math.max(Math.round(Math.pow(A,lt)*n),p),bitrateMin:Math.max(Math.round(Math.pow(A,lt)*a),h)},de={scaleResolutionDownBy:r/Math.pow(L,lt),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(V,lt)*n),p),bitrateMin:Math.max(Math.round(Math.pow(V,lt)*a),h)},he={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(W,lt)*i),c),bitrateMax:Math.max(Math.round(Math.pow(K,lt)*n),p),bitrateMin:Math.max(Math.round(Math.pow(K,lt)*a),h)};Q.push({scale:lt,threshold:Tt,balanced:At,motion:de,detail:he})}return Q}function tW(t,e,n,i,r,a){const c=Cv.get(t)||{overUse:0,underUse:0,adaptationList:GU(r)},{adaptationList:l}=c;Cv.set(t,c);const{OVERUSE_TIMES_THRESHOLD:d,UNDERUSE_TIMES_THRESHOLD:h}=KI,{scale:p}=i;let m,S;return typeof e=="number"&&e>0&&function(R,O,A,I){if(O>=A.length)return!1;let{threshold:{fps_down:D}}=A[O];return U("FORCE_AG_HIGH_FRAMERATE")&&I==="maintain-framerate"&&(D=A[0].threshold.fps_down),R<D}(e,p,l,a)&&(c.overUse++,S=Sg.CPU,c.overUse>d)||typeof n=="number"&&n>0&&function(R,O,A){if(O>=A.length)return!1;const{threshold:{bwe_down:I}}=A[O];return R<I}(n,p,l)&&(c.overUse++,S=Sg.BANDWIDTH,c.overUse>d)?(c.overUse=0,c.underUse=0,m=FU(i,l,a,rm.DOWN),[m,S]):(typeof e=="number"&&e>0&&typeof n=="number"&&n>0&&function(R,O,A,I){if(O===0)return;let{threshold:{fps_up:D}}=A[O];return U("FORCE_AG_HIGH_FRAMERATE")&&I==="maintain-framerate"&&(D=A[1].threshold.fps_up),R>D}(e,p,l,a)&&function(R,O,A){if(O===0)return;const{threshold:{bwe_up:I}}=A[O];return R>I}(n,p,l)&&(c.underUse++,c.underUse>h&&(c.overUse=0,c.underUse=0,m=FU(i,l,a,rm.UP),m.scale===0&&(S=Sg.NONE))),[m,S])}function HU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function jw(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?HU(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):HU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function eW(t){var e;return!!U("ENABLE_AG_ADAPTATION")&&!!(t instanceof cw||_t(e=t._hints).call(e,Qe.CUSTOM_TRACK))&&(!!U("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const i=Re();if(i.os!==ri.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return Number(r[0])>=n}(14)&&BP(17,4)||VP(14)&&FP(17,4,!0)))}const bv=new Map;function Av(t,e){const n=bv.get(t);if(n){const{timer:i}=n;window.clearTimeout(i),bv.delete(t)}e.qualityLimitationReason=Sg.NONE,jU(t)}function nW(t,e){var n;let i;switch(e){case ct.LocalAudioTrack:i=Me.Audio;break;case ct.LocalVideoTrack:i=_t(n=t._hints).call(n,Qe.SCREEN_TRACK)?Me.Screen:Me.High;break;case ct.LocalVideoLowTrack:i=Me.Low}return i}function Gw(t){const e=Ae();if(t.some(n=>n._bypassWebAudio))throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function Hw(t,e){Gw(t);const n=new Xn;return t.forEach(i=>n.addAudioTrack(i)),n}const iW=!Ae().supportUnifiedPlan||U("CHROME_FORCE_PLAN_B")&&ol();function Iv(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return iW?(n={spec:e,store:t},ml("PlanBConnection").create(n)):new lc(e,t)}function Ww(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function WU(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(_g(t.turnServer.servers))return!1;if(U("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch{return!1}}var Se;function KU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function vo(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?KU(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):KU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let lc=(Se=class Nh extends W1{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return _t(n=Object.keys(Yy)).call(n,e)}))]}constructor(e,n){super(e,n),N(this,"id",Je(5,"connection-")),N(this,"store",void 0),N(this,"peerConnection",void 0),N(this,"forceTurn",!1),N(this,"remoteSDP",void 0),N(this,"initialOffer",void 0),N(this,"transportEventReceiver",void 0),N(this,"statsFilter",void 0),N(this,"extension",{useXR:U("USE_XR")}),N(this,"localCapabilities",void 0),N(this,"remoteCodecs",void 0),N(this,"localCandidateCount",0),N(this,"allCandidatesReceived",!1),N(this,"isPreallocation",!1),N(this,"preSSRCMap",new Map),N(this,"dataStreamChannelMap",new Map),N(this,"establishPromise",void 0),N(this,"recoveredDataChannelIds",[]),N(this,"currentDataChannelId",1),N(this,"supportAV1RtpSpec",!1),N(this,"mutex",void 0),N(this,"qualityLimitationReason",Sg.NONE),N(this,"isFirstConnected",!1),this.store=n,this.forceTurn=WU(e),this.mutex=new xi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Nh.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=GI(this.peerConnection,U("STATS_UPDATE_INTERVAL"),void 0,Sn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){const n=this.preSSRCMap.get(e);if(n!==void 0){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);if(i)return{transceiver:i,track:i.receiver.track,id:n}}}async updateRemoteRTPCapabilities(e,n){if(this.remoteCodecs=n,!this.remoteSDP)return void v.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(e,n,this.store.codec)){const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const a=this.remoteSDP.toString();r==null||r(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}else v.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Iu(i.sdp),a=await uU({filterRTX:!U("USE_PUB_RTX")&&!U("USE_SUB_RTX"),filterVideoFec:U("FILTER_VIDEO_FEC"),filterAudioFec:U("FILTER_AUDIO_FEC"),filterVideoCodec:U("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=Sv(a),this.initialOffer=i,U("ENABLE_SVC")&&this.store.codec=="av1"){const l=await async function(){try{const d=new RTCPeerConnection;d.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Wy.L1T3}]});const h=await d.createOffer();if(!h.sdp)return void d.close();const p=Br(h.sdp).mediaDescriptions[0];if(!p)return;const m=p.attributes.extmaps.find(S=>S.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return d.close(),m}catch{return}}();var e;l&&(this.supportAV1RtpSpec=!0,(e=a.send)===null||e===void 0||e.videoExtensions.push(l))}let c;return i.sdp&&fU(i.sdp)&&(c=yn(a),(n=c).send&&($f(wt.VIDEO,n.send.videoExtensions),$f(wt.AUDIO,n.send.audioExtensions)),n.recv&&($f(wt.VIDEO,n.recv.videoExtensions),$f(wt.AUDIO,n.recv.audioExtensions)),n.sendrecv&&($f(wt.VIDEO,n.sendrecv.videoExtensions),$f(wt.AUDIO,n.sendrecv.audioExtensions))),vo(vo({},r),{},{rtpCapabilities:c||a,offerSDP:i.sdp})}catch(i){throw new Z(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}var n}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&fU(this.initialOffer.sdp)&&(n=e.rtpCapabilities,i=this.localCapabilities,n.send&&(_v(wt.VIDEO,n.send.videoExtensions,i.send.videoExtensions),_v(wt.AUDIO,n.send.audioExtensions,i.send.audioExtensions)),n.recv&&(_v(wt.VIDEO,n.recv.videoExtensions,i.recv.videoExtensions),_v(wt.AUDIO,n.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return yn(this._localCapabilities)}get rtpCapabilities(){return yn(this._rtpCapabilities)}get candidates(){return yn(this._candidates)}get iceParameters(){return yn(this._iceParameters)}get dtlsParameters(){return yn(this._dtlsParameters)}constructor(h){let p=arguments.length>1&&arguments[1]!==void 0&&arguments[1];N(this,"sessionDesc",void 0),N(this,"_localCapabilities",void 0),N(this,"_rtpCapabilities",void 0),N(this,"_candidates",void 0),N(this,"_originCandidates",void 0),N(this,"_iceParameters",void 0),N(this,"_isUseExtmapAllowMixed",void 0),N(this,"_dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname",void 0),N(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=p,h=yn(h);const{iceParameters:m,dtlsParameters:S,candidates:R,rtpCapabilities:O,setup:A,localCapabilities:I,cname:D}=h;this._rtpCapabilities=O,this._candidates=R,this._originCandidates=yn(R),this._iceParameters=m,this._dtlsParameters=S,this._localCapabilities=I,this.setup=A,this.cname=D,this.sessionDesc=this.updateRemoteRTPCapabilities(O),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(h){const p=this.candidates,m=this.dtlsParameters,S=this.iceParameters,R=this.rtpCapabilities.send;let O=this.sessionDesc.mediaDescriptions.length-1;for(let A=1;A<h;A++){const I=2*A+2e4,D=2*A+VU,{ssrcs:L,ssrcGroups:V}=ph([{ssrcId:I}],this.cname),{ssrcs:W,ssrcGroups:K}=ph([{ssrcId:D,rtx:U("USE_SUB_RTX")?D+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Mg,protos:["UDP","TLS","RTP","SAVPF"],fmts:R.videoCodecs.map(G=>G.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:S.iceUfrag,icePwd:S.icePwd,unrecognized:[],candidates:p,extmaps:R.videoExtensions,fingerprints:m.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:W,ssrcGroups:K,rtcpFeedbackWildcards:[],payloads:R.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++O)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Mg,protos:["UDP","TLS","RTP","SAVPF"],fmts:R.audioCodecs.map(G=>G.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:S.iceUfrag,icePwd:S.icePwd,unrecognized:[],candidates:p,extmaps:R.audioExtensions,fingerprints:m.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:L,ssrcGroups:V,rtcpFeedbackWildcards:[],payloads:R.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++O)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return yu(this.sessionDesc)}send(h,p,m,S){const{ssrcs:R,ssrcGroups:O}=ph(p,this.cname,U("SYNC_GROUP")?m:void 0),A=this.findPreloadMediaDesc(R);if(A){if(Sn()&&this.firefoxSsrcMidMap.set(R[0].ssrcId,A.attributes.mid),S&&(S.twcc||S.remb)){const I=this.sessionDesc.mediaDescriptions.indexOf(A);return this.sessionDesc.mediaDescriptions[I]=this.mungSendMediaDesc(A,S),{mid:A.attributes.mid,needExchangeSDP:!0}}return{mid:A.attributes.mid,needExchangeSDP:!1}}{const I=this.findAvailableMediaIndex(h,R);let D;return I===-1||I===1&&(Ni()||function(){const L=Re();return!(L.name!==Oe.CHROME||!L.osVersion)&&Number(L.version)<=90}()||U("ENABLE_ENCODED_TRANSFORM")&&al())||I===0&&U("USE_SUB_RTX")||jP()?(D=this.createOrRecycleSendMedia(h,R,O,"sendonly",S),this.updateBundleMids()):(D=yn(this.sessionDesc.mediaDescriptions[I]),D.attributes.direction="sendonly",D.attributes.ssrcs=R,D.attributes.ssrcGroups=O,this.sessionDesc.mediaDescriptions[I]=this.mungSendMediaDesc(D,S)),Sn()&&this.firefoxSsrcMidMap.set(R[0].ssrcId,D.attributes.mid),{mid:D.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:h,needExchangeSDP:p}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:h.attributes.mid,needExchangeSDP:p}}batchSend(h){const p=h.map(R=>{let{kind:O,ssrcMsg:A,mslabel:I}=R;return this.send(O,A,I)}),m=[];let S=!1;return p.forEach(R=>{let{mid:O,needExchangeSDP:A}=R;A&&(S=!0),m.push(O)}),{mids:m,needExchangeSDP:S}}stopSending(h){const p=this.sessionDesc.mediaDescriptions.filter(m=>m.attributes.mid&&h.indexOf(m.attributes.mid)!==-1);if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");p.forEach(m=>{m.attributes.mid==="0"||Sn()||jP()?m.attributes.ssrcs=[]:(m.attributes.ssrcs=[],m.attributes.direction="inactive",m.media.port="0")}),this.updateBundleMids()}mute(h){const p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h);if(!p)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.mute."));p.attributes.direction="inactive"}unmute(h){const p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h);if(!p)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.unmute."));p.attributes.direction="sendonly"}muteRemote(h){const p=this.sessionDesc.mediaDescriptions.filter(m=>_t(h).call(h,m.attributes.mid||""));if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(m=>{m.attributes.direction="inactive"})}unmuteRemote(h){const p=this.sessionDesc.mediaDescriptions.filter(m=>_t(h).call(h,m.attributes.mid||""));if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(m=>{m.attributes.direction="recvonly"})}receive(h,p,m,S){h.forEach((R,O)=>{this.createOrRecycleRecvMedia(R,[],"recvonly",p,m,S[O])}),this.updateBundleMids()}stopReceiving(h){const p=this.sessionDesc.mediaDescriptions.filter(m=>h.indexOf(m.attributes.mid)!==-1);if(p.length!==h.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");p.forEach(m=>{m.media.port="0",m.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(h){const p=this.sessionDesc||Br((m=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(m?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var m;this._rtpCapabilities=h;const S=this.rtpCapabilities.send,R=this.localCapabilities.send;for(const O of p.mediaDescriptions){if(O.attributes.iceUfrag=this._iceParameters.iceUfrag,O.attributes.icePwd=this._iceParameters.icePwd,O.attributes.fingerprints=this._dtlsParameters.fingerprints,O.attributes.candidates=this._candidates,O.attributes.setup=this.setup,O.media.mediaType==="application"&&(O.attributes.sctpPort="5000"),O.media.mediaType==="video"){if(S.videoCodecs.length===0){const A=R.videoCodecs.filter(I=>{var D,L;return(D=I.rtpMap)===null||D===void 0?void 0:_t(L=D.encodingName.toLowerCase()).call(L,"vp8")})||[R.videoCodecs[0]];O.media.fmts=A.map(I=>I.payloadType.toString(10)),O.attributes.payloads=A,O.attributes.extmaps=[]}else if(O.media.fmts=S.videoCodecs.map(A=>A.payloadType.toString(10)),O.attributes.payloads=S.videoCodecs,O.attributes.extmaps=S.videoExtensions,U("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:A,ssrcGroups:I}=ph([{ssrcId:VU,rtx:U("USE_SUB_RTX")?40001:void 0}],this.cname);O.attributes.ssrcs=A,O.attributes.ssrcGroups=I}}if(O.media.mediaType==="audio"){if(S.audioCodecs.length===0){const A=R.audioCodecs.filter(I=>{var D,L;return(D=I.rtpMap)===null||D===void 0?void 0:_t(L=D.encodingName.toLowerCase()).call(L,"opus")})||[R.audioCodecs[0]];O.media.fmts=A.map(I=>I.payloadType.toString(10)),O.attributes.payloads=A,O.attributes.extmaps=[]}else if(O.media.fmts=S.audioCodecs.map(A=>A.payloadType.toString(10)),O.attributes.payloads=S.audioCodecs,O.attributes.extmaps=S.audioExtensions,em(O),U("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:A,ssrcGroups:I}=ph([{ssrcId:2e4}],this.cname);O.attributes.ssrcs=A,O.attributes.ssrcGroups=I}}}return this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(h){const p=this._originCandidates.filter(S=>S.transport==="udp"),m=[];if(p.forEach(S=>{m.push(xU(xU({},S),{},{foundation:"tcpcandidate",priority:Number(S.priority)-1+"",transport:"tcp",port:Number(S.port)+90+""}))}),p.length!==0){switch(h){case Bi.TCP_RELAY:this._candidates=m;break;case Bi.UDP_TCP_RELAY:case Bi.RELAY:this._candidates=[...p,...m];break;default:this._candidates=p}for(const S of this.sessionDesc.mediaDescriptions)S.attributes.candidates=this.candidates}}restartICE(h){h=yn(h),this._iceParameters=h,this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.iceUfrag=h.iceUfrag,p.attributes.icePwd=h.icePwd})}predictReceivingMids(h){const p=[];for(let m=0;m<h;m++)p.push((this.currentMidIndex+m+1).toString(10));return p}findAvailableMediaIndex(h,p){return this.sessionDesc.mediaDescriptions.findIndex(m=>{const S=m.media.mediaType===h&&m.media.port!=="0"&&(m.attributes.direction==="sendonly"||m.attributes.direction==="sendrecv")&&m.attributes.ssrcs.length===0;if(Sn()){if(S){const R=this.firefoxSsrcMidMap.get(p[0].ssrcId);return!(R||m.attributes.mid!=="0"&&m.attributes.mid!=="1")||!(!R||R!==m.attributes.mid)}return!1}return S})}createOrRecycleDataChannel(){for(const m of this.sessionDesc.mediaDescriptions)if(m.media.mediaType==="application")return{mediaDesc:m,needExchangeSDP:!1};this.currentMidIndex+=1;const h="".concat(this.currentMidIndex),p={media:{mediaType:"application",port:Mg,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(h),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(p),{mediaDesc:p,needExchangeSDP:!0}}createOrRecycleRecvMedia(h,p,m,S,R,O){const A=h._mediaStreamTrack.kind,I=this.rtpCapabilities.recv,D=Ng(A,I,this.localCapabilities.send,A===wt.VIDEO?S:R),L=A===wt.VIDEO?I.videoExtensions:I.audioExtensions;this.currentMidIndex+=1;const V="".concat(this.currentMidIndex);let W={media:{mediaType:A,port:Mg,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.map(G=>G.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:L,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:D,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:m,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(V)}};W=this.mungRecvMediaDsec(W,h,O);const K=this.findFirstClosedMedia(A);if(K){const G=this.sessionDesc.mediaDescriptions.indexOf(K);this.sessionDesc.mediaDescriptions[G]=W}else this.sessionDesc.mediaDescriptions.push(W);return W}updateRemoteCodec(h,p,m){const S=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(W=>W.rtpMap&&W.rtpMap.encodingName.toLowerCase()||"").filter(W=>{var K;return _t(K=Object.keys(Yy)).call(K,W)}))],R=new Set(p);if(S.every(W=>R.has(W)))return v.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(p)),!1;const O=this._rtpCapabilities.recv.videoCodecs.filter(W=>p.some(K=>{var G;return _t(G=W.rtpMap&&W.rtpMap.encodingName.toLowerCase()||"").call(G,K)}));if(O.length===0)return v.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(S," codecs: ").concat(p)),!1;const A=[...new Set(O.map(W=>W.rtpMap&&W.rtpMap.encodingName.toLowerCase()||""))];let I;if(v.debug("updateRemoteCodec, from ".concat(S," to ").concat(A)),h.length===0)I=this.sessionDesc.mediaDescriptions.filter(W=>W.media.mediaType==="video"&&W.attributes.direction==="recvonly");else if(I=this.sessionDesc.mediaDescriptions.filter(W=>W.attributes.mid&&_t(h).call(h,W.attributes.mid)&&W.attributes.direction==="recvonly"),I.length!==h.length)return v.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(h,", codecs: ").concat(p)),!1;if(U("USE_PUB_RTX")||U("USE_SUB_RTX")){const W=Nw(O,this.rtpCapabilities.recv.videoCodecs);O.push(...W)}this._rtpCapabilities.recv.videoCodecs=O;const D=this.localCapabilities.send,L=this.rtpCapabilities.recv,V=Ng(wt.VIDEO,L,D,m);return I.forEach(W=>{const K=V.map(G=>G.payloadType.toString(10));v.debug("updateRemoteCodec mid: ".concat(W.attributes.mid,", from"),W.attributes.payloads,"to",V),W.attributes.payloads=V,W.media.fmts=K}),!0}createOrRecycleSendMedia(h,p,m,S,R){const O=this.rtpCapabilities.send,A=h===wt.VIDEO?O.videoCodecs:O.audioCodecs,I=h===wt.VIDEO?O.videoExtensions:O.audioExtensions;this.currentMidIndex+=1;const D="".concat(this.currentMidIndex);let L={media:{mediaType:h,port:Mg,protos:["UDP","TLS","RTP","SAVPF"],fmts:A.map(W=>W.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:I,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:A,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:S,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(D)}};L=this.mungSendMediaDesc(L,R);const V=this.findFirstClosedMedia(h);if(V){const W=this.sessionDesc.mediaDescriptions.indexOf(V);this.sessionDesc.mediaDescriptions[W]=L}else this.sessionDesc.mediaDescriptions.push(L);return L}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(h=>h.media.port!=="0").map(h=>h.attributes.mid)}mungRecvMediaDsec(h,p,m){const S=yn(h);return ww(S),tm(S,p),Ow(S,p),cU(S),gv(S,m,this.localCapabilities.send),S}mungSendMediaDesc(h,p){const m=yn(h);return gv(m,p,this.localCapabilities.recv),em(m),m}updateRecvMedia(h,p){const m=this.sessionDesc.mediaDescriptions.findIndex(S=>S.attributes.mid===h);if(m!==-1){const S=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],p);this.sessionDesc.mediaDescriptions[m]=S}}bumpMid(h){this.currentMidIndex+=h}findFirstClosedMedia(h){return this.sessionDesc.mediaDescriptions.find(p=>Sn()?p.media.port==="0"&&p.media.mediaType===h:p.media.port==="0")}findPreloadMediaDesc(h){return this.sessionDesc.mediaDescriptions.find(p=>{var m;return((m=p.attributes)===null||m===void 0||(m=m.ssrcs[0])===null||m===void 0?void 0:m.ssrcId)===h[0].ssrcId})}getSSRC(h){var p;return(p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h))===null||p===void 0?void 0:p.attributes.ssrcs}}(vo(vo({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),a=hU(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(a||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),c==null||c(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),U("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(U("PRELOAD_MEDIA_COUNT"));const h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(p)}const{preSSRCs:d}=e;if(Array.isArray(d)&&d.length>0){const{mids:h}=this.remoteSDP.batchSend(d.map(p=>({kind:p.kind,ssrcMsg:[{ssrcId:p.ssrcId,rtx:p.rtx}],mslabel:p.mslabel})));h.forEach((p,m)=>{this.preSSRCMap.set(d[m].ssrcId,p)}),await Dg(this.peerConnection,this.remoteSDP,this.extension),v.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(r){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}var n,i}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=e;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:i}=e;if(Array.isArray(i)&&i.length>0){const{mids:r}=this.remoteSDP.batchSend(i.map(a=>Object.assign({},{kind:a.kind,ssrcMsg:[{ssrcId:a.ssrcId,rtx:a.rtx}],mslabel:a.mslabel})));r.forEach((a,c)=>{this.preSSRCMap.set(i[c].ssrcId,a)})}await Dg(this.peerConnection,this.remoteSDP,this.extension),v.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return Ys(function*(){const a=yield Te(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=mv();e.forEach(I=>{const D=r.peerConnection.addTransceiver(I._mediaStreamTrack,vo({direction:"sendonly"},I.trackMediaType==="video"&&r.supportAV1RtpSpec&&l?{sendEncodings:[{scalabilityMode:l}]}:{}));c.push(D),I._updateRtpTransceiver(D)}),Sn()&&U("SIMULCAST")===!0&&(yield Te(r.applySimulcastForFirefox(c,e)));const d=yield Te(r.peerConnection.createOffer()),h=r.remoteSDP.predictReceivingMids(e.length),p=r.mungSendOfferSDP(d.sdp,e,h),m=Br(p),S=h.map(I=>{const D=m.mediaDescriptions.find(L=>L.attributes.mid===I);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return sU(D,U("USE_PUB_RTX"))});let R;try{R=yield S}catch(I){R=[],r.remoteSDP.receive(e,n,i,R);const D=r.remoteSDP.toString();throw yield Te(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Te(r.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield Te(r.stopSending(h,!0)),I}r.remoteSDP.receive(e,n,i,R);const O=r.remoteSDP.toString(),A=r.logSDPExchange(p,"offer","local","send");return yield Te(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Te(r.applySimulcastEncodings(c,e)),yield Te(r.applySendEncodings(c,e)),A==null||A(O),yield Te(r.peerConnection.setRemoteDescription({type:"answer",sdp:O})),c.map((I,D)=>{const L=h[D];return{localSSRC:S[D],id:L,transceiver:I}})}catch(c){throw c instanceof Z?c:new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async createDataChannels(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(e);if(i&&i.readyState==="open")v.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const a=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof a!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:a,negotiated:!0,ordered:!1,maxRetransmits:U("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,i)}n.forEach(a=>{a._updateOriginDataChannel(i)});const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),v.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else v.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof Z?i:new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(e){try{const n=this.dataStreamChannelMap.get(e);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(e)}catch(n){throw n instanceof Z?n:new Z(P.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(d=>e.indexOf(d.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(d=>{var h;Av(this.id+d.mid,this),d.direction="inactive",(h=d.stop)===null||h===void 0||h.call(d)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);c&&(await Dg(this.peerConnection,this.remoteSDP,this.extension),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const l=this.peerConnection.getTransceivers().find(d=>d.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a,transceiver:l}}catch(a){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(e);return i&&(await Dg(this.peerConnection,this.remoteSDP,this.extension),v.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(r=>{const a=this.peerConnection.getTransceivers().find(c=>c.mid===r);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:r,transceiver:a}})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(a=>{Array.from(this.preSSRCMap.entries()).some(c=>{let[l,d]=c;if(d===a)return this.preSSRCMap.delete(l),!0})}),this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const a=this.remoteSDP.toString();r==null||r(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const a=this.remoteSDP.toString();r==null||r(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Ys(function*(){const i=yield Te(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=Ae().supportPCSetConfiguration,a=U("FORCE_TURN_TCP")||n.forceTurn;if(e===Bi.RELAY&&!r)return;if(r&&!a){const m=e===Bi.RELAY?"relay":"all",S=n.peerConnection.getConfiguration();S.iceTransportPolicy!==m&&(v.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(S.iceTransportPolicy,"] to [").concat(m,"]")),S.iceTransportPolicy=m,n.peerConnection.setConfiguration(S))}n.remoteSDP.updateCandidates(e);const c=yield Te(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=Iu(c.sdp),{remoteIceParameters:d}=yield l.iceParameters;n.remoteSDP.restartICE(d);const h=n.remoteSDP.toString(),p=n.logSDPExchange(c.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Te(n.peerConnection.setLocalDescription(c)),p==null||p(h),yield Te(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(r){v.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Bi.TCP_RELAY),await Dg(this.peerConnection,this.remoteSDP,this.extension)}catch(n){v.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(n=>{Av(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return vo(vo({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const a=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new Z(P.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?Sn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:vo(vo({},ic),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:vo(vo({},ic),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var n;const i="code: ".concat(e.errorCode,", message: ").concat(e.errorText),r=e.port?"local: ".concat(e.port):"";v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(e.url||"",", host_candidate:").concat(r)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},U("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&(_g(e.turnServer.servers)?n.iceServers=e.turnServer.servers:U("NEW_TURN_MODE")&&n.iceServers?(U("USE_TURN_SERVER_OF_GATEWAY")?e.turnServer.serversFromGateway&&n.iceServers.push(...Nh.newTurnServerConfigToIceServers(e.turnServer.serversFromGateway)):n.iceServers.push(...Nh.newTurnServerConfigToIceServers(e.turnServer.servers)),U("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):e.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Nh.turnServerConfigToIceServers(e.turnServer.servers)),U("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...Nh.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),U("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),U("ENABLE_ENCODED_TRANSFORM")&&Ae().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(bu(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!U("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{const r=U("NEW_TURN_MODE");r===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):r===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):r===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(bu(i.turnServerURL),":443?transport=tcp")}):r===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(bu(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(e){const n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=()=>{var r;n!=null&&n.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,n.state))},n.onerror=r=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in r?r.error:r)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const r=n==null?void 0:n.iceTransport.state;var a;r&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:r,remote:a}=i.getSelectedCandidatePair();v.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i,r;if(n||(n=this.peerConnection.getSenders().find(I=>I.track===e._mediaStreamTrack)),!n)return v.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return v.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ae().supportSetRtpSenderParameters)return v.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const a={},c={};switch(e._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;case"balanced":a.degradationPreference="balanced"}const l=function(A,I){return A.getTransceivers().find(D=>D.sender.track===I||D.receiver.track===I)}(this.peerConnection,e._mediaStreamTrack),d=GH(e);if(eW(e)&&l&&n&&d&&this.getLocalVideoStats&&_t(i=["vp8","vp9"]).call(i,this.store.codec)){var h;const A=a.degradationPreference||(_t(h=e._hints).call(h,Qe.CUSTOM_TRACK)?U("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(I,D,L,V,W,K){if(Av(I,L),W(D),V!=="balanced"&&V!=="maintain-framerate"&&V!=="maintain-resolution")return;let G=-1;jU(I,D);const Q=window.setInterval(()=>{const Tt=bv.get(I);if(!U("ENABLE_AG_ADAPTATION")||!Tt)return Av(I,L),void W(D);const At=K();if(At.sendPackets>0&&At.OutgoingAvailableBandwidth>0){if(G===-1)return void(G=Date.now());if(Date.now()-G<1e3)return;const de=At.sendFrameRate,he=At.OutgoingAvailableBandwidth,[Ze,Mn]=tW(I,de,he,Tt.adaptationConfig,D,V);Mn&&(L.qualityLimitationReason=Mn),Ze&&Tt.adaptationConfig.scale!==Ze.scale&&(v.debug("[".concat(I,"] applyAdaptation: ").concat(L.qualityLimitationReason,`
           sendFps `).concat(de,", bwe ").concat(he,", switch from ").concat(Tt.adaptationConfig.scale," to ").concat(Ze.scale," ")),Tt.adaptationConfig=jw(jw({},Tt.adaptationConfig),Ze),W(Ze))}},U("CHECK_LOCAL_STATS_INTERVAL")),lt=jw({},D);bv.set(I,{timer:Q,adaptationConfig:lt,originConfig:D,adaptationFunc:W}),v.debug("[".concat(I,"] start adaptation, originConfig: ").concat(JSON.stringify(D),", degradationPreference: ").concat(V))})(this.id+l.mid,d,this,A,I=>{n&&this.updateAdaptation(n,I)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var p;const{bitrateMax:A,frameRate:I,scaleResolutionDownBy:D}=e._encoderConfig;A&&(c.maxBitrate=1e3*A),(_t(p=e._hints).call(p,Qe.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(I&&(c.maxFramerate=as(I)),D&&D>=1&&(c.scaleResolutionDownBy=D))}const{maxFramerate:m}=U("ENCODER_CONFIG_LIMIT");if(m&&typeof m=="number"&&(c.maxFramerate=c.maxFramerate?Math.min(c.maxFramerate,m):m),U("DSCP_TYPE")&&ol()){var S;const A=U("DSCP_TYPE");_t(S=["very-low","low","medium","high"]).call(S,A)&&(c.networkPriority=A)}const R=n.getParameters(),O=(r=R.encodings)===null||r===void 0?void 0:r[0];Sn()&&!O&&(a.encodings=[c]),O&&Object.assign(O,c),Object.assign(R,a),v.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(R.encodings))),await n.setParameters(R),await async function(A,I,D){try{var L;if(!Ae().supportSetRtpSenderParameters||!function(Q){return Q==="vp9"||Q==="av1"}(A)||!U("ENABLE_SVC"))return;const V={},W={},K=I.getParameters(),G=(L=K.encodings)===null||L===void 0?void 0:L[0];W.scalabilityMode=mv(D),G&&Object.assign(G,W),Object.assign(K,V),await I.setParameters(K),v.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(K.encodings)))}catch(V){v.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",V)}}(this.store.codec,n,U("SVC_MODE"))}async updateAdaptation(e,n){var i,r;if(!e)return v.debug("[updateAdaptation] no rtpSender found");if(!Ae().supportSetRtpSenderParameters)return v.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const a={},{bitrateMax:c,frameRate:l,scaleResolutionDownBy:d}=n;c&&(a.maxBitrate=1e3*c),l&&(a.maxFramerate=as(l)),d&&d>=1&&_t(i=["vp8","vp9"]).call(i,this.store.codec)&&(a.scaleResolutionDownBy=d);const h=e.getParameters(),p=(r=h.encodings)===null||r===void 0?void 0:r[0];p&&Object.assign(p,a),Object.assign(h,{});try{await e.setParameters(h),v.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(h.encodings)))}catch(m){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?v.debug("[updateAdaptation] peerConnection not connected}"):v.debug("[updateAdaptation] updateRtpSenderEncodings failed",m):v.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,n){try{if(!Ae().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],a=n[i];a instanceof cn&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,r.sender)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=Br(e);return n.forEach((a,c)=>{const l=i[c],d=r.mediaDescriptions.find(h=>h.attributes.mid===l);d&&(tm(d,a),lU(d,a,this.store.codec))}),yu(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let d=0;d<e.length;d++){var i,r,a,c,l;const h=e[d],p=n[d];if(p instanceof cn&&!_t(i=p._hints).call(i,Qe.LOW_STREAM)&&(r=p._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((a=p._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},S={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const R=h.sender.getParameters();await h.sender.setParameters(Object.assign(R,m))}}}async applySimulcastEncodings(e,n){if(!Sn()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof cn&&this.isVP8Simulcast(r)){const a=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const d=a.sender.getParameters();await a.sender.setParameters(Object.assign(d,c))}}}isVP8Simulcast(e){var n,i,r,a,c;return!!(e instanceof cn&&U("SIMULCAST")&&this.store.codec==="vp8"&&!_t(n=e._hints).call(n,Qe.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(a=e._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(U("SDP_LOGGING"))return v.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(e){if(Ae().supportPCSetConfiguration){const n=Nh.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Dt(Se.prototype,"updateRemoteRTPCapabilities",[br],Object.getOwnPropertyDescriptor(Se.prototype,"updateRemoteRTPCapabilities"),Se.prototype),Dt(Se.prototype,"connect",[br],Object.getOwnPropertyDescriptor(Se.prototype,"connect"),Se.prototype),Dt(Se.prototype,"updateRemoteConnect",[br],Object.getOwnPropertyDescriptor(Se.prototype,"updateRemoteConnect"),Se.prototype),Dt(Se.prototype,"createDataChannels",[br],Object.getOwnPropertyDescriptor(Se.prototype,"createDataChannels"),Se.prototype),Dt(Se.prototype,"receive",[br],Object.getOwnPropertyDescriptor(Se.prototype,"receive"),Se.prototype),Dt(Se.prototype,"batchReceive",[br],Object.getOwnPropertyDescriptor(Se.prototype,"batchReceive"),Se.prototype),Dt(Se.prototype,"stopReceiving",[br],Object.getOwnPropertyDescriptor(Se.prototype,"stopReceiving"),Se.prototype),Dt(Se.prototype,"muteRemote",[br],Object.getOwnPropertyDescriptor(Se.prototype,"muteRemote"),Se.prototype),Dt(Se.prototype,"unmuteRemote",[br],Object.getOwnPropertyDescriptor(Se.prototype,"unmuteRemote"),Se.prototype),Dt(Se.prototype,"muteLocal",[br],Object.getOwnPropertyDescriptor(Se.prototype,"muteLocal"),Se.prototype),Dt(Se.prototype,"unmuteLocal",[br],Object.getOwnPropertyDescriptor(Se.prototype,"unmuteLocal"),Se.prototype),Dt(Se.prototype,"close",[br],Object.getOwnPropertyDescriptor(Se.prototype,"close"),Se.prototype),Dt(Se.prototype,"updateEncoderConfig",[br],Object.getOwnPropertyDescriptor(Se.prototype,"updateEncoderConfig"),Se.prototype),Dt(Se.prototype,"updateSendParameters",[br],Object.getOwnPropertyDescriptor(Se.prototype,"updateSendParameters"),Se.prototype),Dt(Se.prototype,"replaceTrack",[br],Object.getOwnPropertyDescriptor(Se.prototype,"replaceTrack"),Se.prototype),Dt(Se.prototype,"updateAdaptation",[br],Object.getOwnPropertyDescriptor(Se.prototype,"updateAdaptation"),Se.prototype),Dt(Se.prototype,"getRemoteSSRC",[br],Object.getOwnPropertyDescriptor(Se.prototype,"getRemoteSSRC"),Se.prototype),Se);function br(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,a=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{a()}},n}function Kw(t,e){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=as(e.width),i.height=as(e.height);const r=as(e.framerate||15);document.body.append(n),document.body.append(i);let a=t._mediaStreamTrack;n.srcObject=new MediaStream([a]),n.play();const c=i.getContext("2d");if(!c)throw new J(P.UNEXPECTED_ERROR,"can not get canvas context");const l=Ae(),d=i.captureStream(l.supportRequestFrame?0:r).getVideoTracks()[0];d.canvas||(d.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const p=n.videoWidth,m=n.videoHeight/p,S=i.width*m;Math.abs(S-i.height)>=2&&(v.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(S)),i.height=S)}c.drawImage(n,0,0,i.width,i.height),d.requestFrame&&d.requestFrame(),a!==t._mediaStreamTrack&&(a=t._mediaStreamTrack,n.srcObject=new MediaStream([a]))},i.stopCapture=nw(()=>i.startCapture&&i.startCapture(),r);const h=d.stop;return d.stop=()=>{h.call(d),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),v.debug("clean low stream renderer")},d}var wv=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(wv||{}),Bn=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(Bn||{}),mh=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(mh||{}),Fn=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(Fn||{}),_h=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(_h||{}),YU=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(YU||{}),uc=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}(uc||{}),Ar=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t[t.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",t}(Ar||{}),qU=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(qU||{}),Ir=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Ir||{}),Ov=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(Ov||{});const Eh=1e3,gh=6,Nv=3,rW=Math.max(gh,Nv);function Kt(t,e,n){n!=null&&Number.isFinite(n)&&(t[e]=Math.round(Math.max(0,n)))}function zU(t){const e={[Ir.CONN_TYPE]:0,[Ir.RTT]:t.rtt,[Ir.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=t.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(e[Ir.CONN_TYPE]=1),n==="tcp"&&(e[Ir.CONN_TYPE]=3),n==="tls"&&(e[Ir.CONN_TYPE]=4);break}case"srflx":e[Ir.CONN_TYPE]=2;break;case"unknown":e[Ir.CONN_TYPE]=5;break;default:e[Ir.CONN_TYPE]=0}return e}function XU(t){let e=0;switch(t){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class JU extends _n{constructor(e){super(),N(this,"store",void 0),N(this,"uploadWRTCStatsTimer",void 0),N(this,"uploadOutboundDenoiserStatsTimer",void 0),N(this,"uploadExtStatsTimer",void 0),N(this,"uploadExtUsageStatsTimer",void 0),N(this,"uploadInboundExtStatsTimer",void 0),N(this,"requestStats",void 0),N(this,"requestTransportStats",void 0),N(this,"requestLocalMedia",void 0),N(this,"requestRemoteMedia",void 0),N(this,"requestAllTracks",void 0),N(this,"requestVideoIsReady",void 0),N(this,"requestUploadStats",void 0),N(this,"requestUpload",void 0),N(this,"uploadOutboundStarted",!1),N(this,"uploadInboundStarted",!1),N(this,"uploadTransportStarted",!1),N(this,"uploadBaseStatsStarted",!1),N(this,"uploadExtensionUsageStarted",!1),N(this,"lastRecvStats",void 0),N(this,"lastSendStats",void 0),N(this,"lastRefRecvStats",void 0),N(this,"lastRefSendStats",void 0),N(this,"lastFullRecvStats",void 0),N(this,"lastFullSendStats",void 0),N(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const n=e%Nv==0,i=e%gh==0;let r,a;if(this.uploadTransportStarted&&(r=this.requestStats(),this.store.useP2P&&(a=this.requestStats(!0))),!r&&this.uploadOutboundStarted&&(r=this.requestStats()),!a&&this.uploadInboundStarted&&(a=this.requestStats(!0)),r||a){var c;const l={};if(this.uploadTransportStarted&&r){const h=this.getTransportStats(r,a,n);h&&(l.misc=[h])}if(this.uploadOutboundStarted&&r){const h=this.getOutboundStats(r,i?this.lastFullSendStats:n?this.lastRefSendStats:this.lastSendStats,n,i);h&&(l.outbound=[h])}if(this.uploadInboundStarted&&a){const h=this.getInboundStats(a,i?this.lastFullRecvStats:n?this.lastRefRecvStats:this.lastRecvStats,n,i);h&&(l.inbound=h)}const d=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;d&&(Array.isArray(l.misc)?l.misc[0]&&l.misc[0].addition&&(l.misc[0].addition[Ov.RTC_PEER_CONNECTION_STATE]=jI[d]):l.misc=[{addition:{[Ov.RTC_PEER_CONNECTION_STATE]:jI[d]}}]),this.requestUploadStats(l)}this.lastRecvStats=a,this.lastSendStats=r,i&&(this.lastFullRecvStats=a,this.lastFullSendStats=r),n&&(this.lastRefRecvStats=a,this.lastRefSendStats=r)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const r=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(r&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[Ov.RTC_PEER_CONNECTION_STATE]:jI[r.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===rW+1&&(e=1)},Eh)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,n,i){if(!this.requestStats)return;if(!i)return e.rtt==null?void 0:{addition:{[Ir.RTT]:e.rtt,[Ir.CONN_TYPE]:void 0,[Ir.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const r=zU(e);if(this.store.useP2P){if(n){const a=zU(n);r[Ir.CONN_TYPE]+=a[Ir.CONN_TYPE]<<3}r[Ir.CONN_TYPE]+=110}else r[Ir.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,n,i,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;const a=this.requestLocalMedia();if(!a||a.length===0)return;let c,l,d;return a.forEach(h=>{let[p,{track:m,ssrcs:S}]=h;switch(p){case ct.LocalVideoLowTrack:case ct.LocalVideoTrack:if(p===ct.LocalVideoTrack){const R=function(I,D,L,V,W,K){const G=D.videoSend.find(At=>At.ssrc===I);if(!G)return;const Q={},{sentFrame:lt,inputFrame:Tt}=G;if(K&&(Kt(Q,Bn.QP_SUM,G.qpSumPerFrame),Tt&&lt)){const At=Tt.frameRate,de=lt.frameRate;Q[Bn.FREEZE]=function(he,Ze){let Mn=!0;return Mn=!(he<=5)&&(he<=10?Ze<3:he<=20?Ze<4:Ze<5),Mn}(At,de)?1:0}if(W){switch(lt&&(Kt(Q,Bn.HEIGHT,lt.height),Kt(Q,Bn.WIDTH,lt.width),Kt(Q,Bn.FRAME_RATE,lt.frameRate)),Q[Bn.DISABLED]=V._originMediaStreamTrack&&!V._originMediaStreamTrack.enabled||V._mediaStreamTrack&&!V._mediaStreamTrack.enabled?1:0,G.adaptionChangeReason){case"none":Q[Bn.ADAPTATION]=0;break;case"cpu":Q[Bn.ADAPTATION]=1;break;case"bandwidth":Q[Bn.ADAPTATION]=2;break;case"other":Q[Bn.ADAPTATION]=3}let At=0;G.adaptionChangeReason&&(At+=XU(G.adaptionChangeReason)),D.qualityLimitationReason&&(At+=XU(D.qualityLimitationReason)<<3),Q[Bn.ADAPTATION]=At,Q[Bn.PLAYER_STATUS]=tw[V._player?V._player.videoElementStatus:"uninit"],Kt(Q,Bn.NACKS,G.nacksCount),Kt(Q,Bn.PLIS,G.plisCount),Kt(Q,Bn.FIRS,G.firsCount),Kt(Q,Bn.AVG_ENCODE,G.avgEncodeMs),Kt(Q,Bn.HUGE_FRAME_SENT,G.hugeFramesSent),Kt(Q,Bn.BYTES_RETRANSMIT,G.retransmittedBytesSent),Kt(Q,Bn.PACKAGES_RETRANSMIT,G.retransmittedPacketsSent),Kt(Q,Bn.KEY_FRAMES_ENCODED,G.keyFramesEncoded);const de=L&&L.videoSend.find(he=>he.ssrc===I);if(de){let he=W?Eh:Eh*gh;de.timestamp&&G.timestamp&&(he=G.timestamp-de.timestamp),de.packets!=null&&G.packets!=null&&Kt(Q,Bn.PACKAGE_RATE,1e3*(G.packets-de.packets)/he),G.packetsLost!=null&&de.packetsLost!=null&&Kt(Q,Bn.PACKAGE_LOST,G.packetsLost-de.packetsLost),de.bytes!=null&&G.bytes!=null&&Kt(Q,Bn.BITRATE,8*(G.bytes-de.bytes)/he)}}return Q}(S[0].ssrcId,e,n,m,i,r),O=m&&function(I,D,L,V){const W=D.videoSend.find(G=>G.ssrc===I);if(!W)return null;const K={};if(V){const G=W.inputFrame,Q=G&&G.height||L.videoHeight||0,lt=G&&G.width||L.videoWidth||0,Tt=G&&G.frameRate||0;Kt(K,wv.HEIGHT,Q),Kt(K,wv.WIDTH,lt),Kt(K,wv.FRAME_RATE,Tt)}return K}(S[0].ssrcId,e,m,i),A=function(I,D){const L={};return D&&(Kt(L,Bn.RETRANSMIT,I.bitrate.retransmit),Kt(L,Bn.TARGET_ENCODED,I.bitrate.targetEncoded),Kt(L,Bn.ACTUAL_ENCODED,I.bitrate.actualEncoded),Kt(L,Bn.TRANSMIT,I.bitrate.transmit),Kt(L,Bn.BANDWIDTH,I.sendBandwidth)),L}(e,i);l=Object.assign({},R,O,A)}else d=function(R,O,A,I){const D=O.videoSend.find(V=>V.ssrc===R);if(!D)return;const L={};if(I){const V=D.sentFrame;if(V&&(Kt(L,mh.HEIGHT,V.height),Kt(L,mh.WIDTH,V.width),Kt(L,mh.FRAME_RATE,V.frameRate)),A){const W=A.videoSend.find(K=>K.ssrc===R);if(W){let K=Eh*gh;W.timestamp&&D.timestamp&&(K=D.timestamp-W.timestamp),W.packets!=null&&D.packets!=null&&Kt(L,mh.PACKAGE_RATE,1e3*(D.packets-W.packets)/K),D.packetsLost!=null&&W.packetsLost!=null&&Kt(L,mh.PACKAGE_LOST,D.packetsLost-W.packetsLost),W.bytes!=null&&D.bytes!=null&&Kt(L,mh.BITRATE,8*(D.bytes-W.bytes)/K)}}}return L}(S[0].ssrcId,e,n,i);break;case ct.LocalAudioTrack:c=m&&function(R,O,A,I,D){const L=O.audioSend.find(W=>W.ssrc===R);if(!L)return;const V={};if(D){V[uc.DISABLED]=I._originMediaStreamTrack&&!I._originMediaStreamTrack.enabled||I._mediaStreamTrack&&!I._mediaStreamTrack.enabled?1:0;const W=100*I._source.getAccurateVolumeLevel(),K=L.inputLevel;if(K!=null){const Q=Math.ceil(50*Math.log10(100*K+1));Kt(V,uc.LEVEL,Q)}Kt(V,YU.PCM_LEVEL,W),Kt(V,uc.AEC_RETURN_LOSS,L.aecReturnLoss),Kt(V,uc.AEC_RETURN_LOSS_ENH,L.aecReturnLossEnhancement),Kt(V,uc.BYTES_RETRANSMIT,L.retransmittedBytesSent),Kt(V,uc.PACKAGES_RETRANSMIT,L.retransmittedPacketsSent),V[uc.FREEZE]=0;const G=A&&A.audioSend.find(Q=>Q.ssrc===R);if(G){let Q=Eh*gh;G.timestamp&&L.timestamp&&(Q=L.timestamp-G.timestamp),G.bytes!=null&&L.bytes!=null&&Kt(V,uc.BITRATE,8*(L.bytes-G.bytes)/Q),G.packets!=null&&L.packets!=null&&Kt(V,uc.PACKAGE_RATE,1e3*(L.packets-G.packets)/Q)}}return V}(S[0].ssrcId,e,n,m,i)}}),{high:l,low:d,audio:c}}getInboundStats(e,n,i,r){if(!this.requestRemoteMedia)return;const a=this.requestRemoteMedia()||[],c=[];return a.forEach(l=>{let[d,h]=l;const p={peer:d.uid};if(h.has(wt.VIDEO)&&d.videoTrack){const m=d._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(d._videoSSRC)||!1,S=d.videoTrack?function(R,O,A,I,D,L,V,W){const K=O.videoRecv.find(he=>he.ssrc===R);if(!K)return;const G={},{receivedFrame:Q,outputFrame:lt,decodeFrameRate:Tt}=K,At=A&&A.videoRecv.find(he=>he.ssrc===R);if(Kt(G,_h.FRAME_RATE_DECODE,Tt),K.framesRateFirefox&&Kt(G,Fn.FRAME_RATE,K.framesRateFirefox),Q&&Kt(G,Fn.FRAME_RATE,Q.frameRate),Kt(G,Fn.FRAMES_DROPPED,K.framesDroppedCount),Kt(G,Fn.BYTES_RETRANSMIT,K.retransmittedBytesReceived),Kt(G,Fn.PACKAGES_RETRANSMIT,K.retransmittedPacketsReceived),Kt(G,Fn.PACKAGES_DISCARDED,K.packetsDiscarded),Kt(G,Fn.AVG_DECODE,K.avgDecodeMs),Kt(G,Fn.AVG_PROCESSING_DELAY,K.avgProcessingDelayMs),Kt(G,Fn.AVG_ASSEMBLY_TIME,K.avgFramesAssembledFromMultiplePacketsMs),Kt(G,Fn.AVG_INTER_FRAME_DELAY,K.avgInterFrameDelayMs),Kt(G,Fn.KEY_FRAMES_DECODED,K.keyFramesDecoded),At){const he=O.timestamp-A.timestamp||Eh*(W?gh:V?Nv:1);K.packetsLost!=null&&At.packetsLost!=null&&Kt(G,Fn.PACKAGE_LOST,K.packetsLost-At.packetsLost),At.bytes!=null&&K.bytes!=null&&Kt(G,Fn.BITRATE,8*(K.bytes-At.bytes)/he),At.packets!=null&&K.packets!=null&&Kt(G,Fn.PACKAGE_RATE,1e3*(K.packets-At.packets)/he)}if(W&&(Kt(G,Fn.QP_SUM,K.qpSumPerFrame),G[Fn.FREEZE]=D&&kg.isRemoteVideoFreeze(I,K,At)?1:0),V){var de;Q?(Kt(G,Fn.HEIGHT,Q.height),Kt(G,Fn.WIDTH,Q.width)):I&&(Kt(G,Fn.HEIGHT,I._videoHeight||0),Kt(G,Fn.WIDTH,I._videoWidth||0)),lt&&Kt(G,_h.FRAME_RATE_OUTPUT,lt.frameRate);const he=(de=I._player)===null||de===void 0?void 0:de.rendFrameRate.toFixed(0);if(he&&Kt(G,_h.FRAME_RATE_RENDER,+he),Kt(G,Fn.JITTER_BUFFER,K.jitterBufferMs),Kt(G,Fn.CURRENT_DELAY,K.currentDelayMs),Kt(G,Fn.FIRS,K.firsCount),Kt(G,Fn.NACKS,K.nacksCount),Kt(G,Fn.PLIS,K.plisCount),I){G[Fn.DISABLED]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1;const Ze=I._player;if(Ze){const{freezeTimeCounterList:Mn,renderFreezeAccTime:An,videoElementStatus:Or}=Ze;if(Mn&&Mn.length>0&&Kt(G,_h.FREEZE_TIME,Mn.splice(0,1)[0]),L&&ul.visibility==="visible"&&Or===Qi.PLAYING&&Ae().supportRequestVideoFrameCallback){const it=Math.min(6e3,An);Ze.renderFreezeAccTime=Math.max(0,An-it),Kt(G,_h.FREEZE_TIME_RENDER,it)}if(typeof K.totalFreezesDuration=="number"){const it=At&&At.totalFreezesDuration?K.totalFreezesDuration-At.totalFreezesDuration:K.totalFreezesDuration;Kt(G,_h.FREEZE_DURATION,1e3*it)}}}if(G[Fn.PLAYER_STATUS]=tw[I._player?I._player.videoElementStatus:"uninit"],At&&K.totalInterFrameDelay!==void 0&&K.totalSquaredInterFrameDelay!==void 0&&At.totalInterFrameDelay!==void 0&&At.totalSquaredInterFrameDelay!==void 0){const Ze=K.totalInterFrameDelay-At.totalInterFrameDelay,Mn=K.totalSquaredInterFrameDelay-At.totalSquaredInterFrameDelay,An=K.framesDecodeCount-At.framesDecodeCount,Or=Ze/An*1e3,it=Math.round(1e3*Math.sqrt((Mn-Math.pow(Ze,2)/An)/An));!isNaN(it)&&Or+it>Math.max(3*Or,Or+150)&&(G[Fn.I_FRAME_DELAY]=it)}}return G}(d._videoSSRC,e,n,d.videoTrack,m===!0,this.needUploadRenderFreezeTime,i,r):void 0;S&&(p.video=S)}if(h.has(wt.AUDIO)&&d.audioTrack){const m=d.audioTrack?function(S,R,O,A,I,D){const L=R.audioRecv.find(G=>G.ssrc===S);if(!L)return;const V={},W=O&&O.audioRecv.find(G=>G.ssrc===S);if(Kt(V,Ar.JITTER,L.jitterMs),Kt(V,Ar.BYTES_RETRANSMIT,L.retransmittedBytesReceived),Kt(V,Ar.PACKAGES_RETRANSMIT,L.retransmittedPacketsReceived),Kt(V,Ar.PACKAGES_DISCARDED,L.packetsDiscarded),Kt(V,Ar.AVG_PROCESSING_DELAY,L.avgProcessingDelayMs),W){const G=R.timestamp-O.timestamp||Eh*(D?gh:I?Nv:1);L.packets!=null&&W.packets!=null&&Kt(V,Ar.PACKAGE_RATE,1e3*(L.packets-W.packets)/G),I&&W.bytes!=null&&L.bytes!=null&&Kt(V,Ar.BITRATE,8*(L.bytes-W.bytes)/G),L.packetsLost!=null&&W.packetsLost!=null&&Kt(V,Ar.PACKAGE_LOST,L.packetsLost-W.packetsLost)}if(D){const{receivedFrames:G,droppedFrames:Q}=L;G!=null&&Q!=null&&(V[Ar.FREEZE]=(K=G)===0||100*Q/K>20?1:0)}var K;if(I){const G=100*A._source.getAccurateVolumeLevel(),Q=L.outputLevel;if(Q!=null){const lt=Math.ceil(50*Math.log10(100*Q+1));Kt(V,qU.LEVEL,lt)}if(Kt(V,Ar.PCM_LEVEL,G),A&&(V[Ar.DISABLED]=A._originMediaStreamTrack.enabled&&A._mediaStreamTrack.enabled?0:1),Kt(V,Ar.JITTER_BUFFER,L.jitterBufferMs),Kt(V,Ar.CURRENT_DELAY,L.jitterBufferMs),V[Ar.PLAYER_STATUS]=tw[Cr.getPlayerState(A.getTrackId())],W){const lt=L.concealedSamples-W.concealedSamples;lt>0&&Kt(V,Ar.CONCEALED_SAMPLES,lt);const Tt=L.totalSamplesReceived-W.totalSamplesReceived;Tt>0&&Kt(V,Ar.TOTAL_SAMPLES_RECEIVED,Tt)}}return V}(d._audioSSRC,e,n,d.audioTrack,i,r):void 0;m&&(p.audio=m)}(p.video||p.audio)&&c.push(p)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,c}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(n=>n instanceof $y);if(e&&e._external.getDenoiserStats){const n=e._external.getDenoiserStats();n&&this.requestUpload(Cg.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[n,i]=e;i.has(wt.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}),i.has(wt.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:U("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let r=[];const a=this.requestAllTracks&&this.requestAllTracks()||[];for(const h of a)!h.muted&&h.enabled&&(r=r.concat(await h.getProcessorUsage()));const c=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[h,p]of c)p.has(wt.VIDEO)&&h.videoTrack&&(r=r.concat(await h.videoTrack.getProcessorUsage())),p.has(wt.AUDIO)&&h.audioTrack&&(r=r.concat(await h.audioTrack.getProcessorUsage()));if(r.length===0)return;i.details=function(h,p){const m={};for(const{id:A,value:I,level:D,direction:L}of h){var S;const V=(S=p.get(A))!==null&&S!==void 0?S:0,W=I===2?V+U("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:V;var R,O;p.set(A,W),m[A]?(I===2&&(m[A].value=I),D>m[A].level&&(m[A].level=D),L==="remote"&&(m[A].remoteUidCount+=1),m[A].totalTs=(R=p.get(A))!==null&&R!==void 0?R:0):m[A]={value:I,level:D,remoteUidCount:L==="local"?0:1,totalTs:(O=p.get(A))!==null&&O!==void 0?O:0}}return Object.keys(m).map(A=>{const{level:I,value:D,totalTs:L}=m[A];return{id:A,level:I,value:D,totalTs:L}})}(r,e);const l=Date.now(),d=l>n?l:n+1;this.requestUpload&&this.requestUpload(Cg.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:d})},U("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const sW=U("ICE_RESTART_INTERVAL");let Dv=new Map,sm=new Map,Nu=[Bi.UDP_TCP_RELAY,Bi.TCP_RELAY,Bi.RELAY],Yw=U("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ae().supportPCSetConfiguration;function QU(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Dv.get(t.id);n&&(window.clearTimeout(n),Dv.delete(t.id));const i=sm.get(t.id);e&&i&&i.index===Nu.length-1&&(v.debug("[".concat(t.id,"] reset ICE restart policy")),sm.delete(t.id))}function ZU(t,e,n){if(Dv.size===0&&sm.size===0&&(Array.isArray(U("RESTART_SEQUENCE"))&&U("RESTART_SEQUENCE").length>0&&!function(l,d){if(l.length!==d.length)return!1;for(let h=0;h<l.length;h+=1){const p=l[h];if(l.filter(m=>m===p).length!==d.filter(m=>m===p).length)return!1}return!0}(Nu,U("RESTART_SEQUENCE"))&&(Nu=U("RESTART_SEQUENCE").filter(l=>{var d;if(_t(d=Object.values(Bi)).call(d,l))return!0}),v.debug("use reconnection policy from config distribution, queues: ".concat(Nu.join(" => ")))),Yw=U("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ae().supportPCSetConfiguration),Nu.length===0)return void n();let i,{index:r=0,type:a}=sm.get(t.id)||{};if(Yw&&a===Bi.RELAY)return void n();let c=a&&r>=Nu.length-1;if(Yw)a=Bi.RELAY;else{if(c)return void n();a?(r++,a=Nu[r]):(a=Nu[0],r=0)}v.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(a,", index: ").concat(r)),e(a),sm.set(t.id,{index:r,type:a}),i=window.setTimeout(()=>ZU(t,e,n),sW),Dv.set(t.id,i)}var ae;function $U(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function dc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$U(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$U(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function t2(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=_I,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new Lv(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Lv(t){function e(n){if(Object(n)!==n)return Et.reject(new TypeError(n+" is not an object."));var i=n.done;return Et.resolve(n.value).then(function(r){return{value:r,done:i}})}return Lv=function(n){this.s=n,this.n=n.next},Lv.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?Et.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?Et.reject(n):e(i.apply(this.s,arguments))}},new Lv(t)}let Ug=(ae=class extends _n{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(jt.StateChange,e,this._state)}constructor(t,e){super(),N(this,"isPlanB",void 0),N(this,"store",void 0),N(this,"statsUploader",void 0),N(this,"connection",void 0),N(this,"localTrackMap",new Map),N(this,"remoteUserMap",new Map),N(this,"localDataChannels",[]),N(this,"remoteDataChannelMap",new Map),N(this,"pendingLocalTracks",[]),N(this,"pendingRemoteTracks",[]),N(this,"pendingLocalDataChannels",[]),N(this,"pendingRemoteDataChannels",[]),N(this,"statsCollector",void 0),N(this,"shouldForwardP2PCreation",void 0),N(this,"iceFailedCount",0),N(this,"dtlsFailedCount",0),N(this,"mutex",void 0),N(this,"_state",ke.Disconnected),N(this,"_pcStatsUploadType",U("NEW_ICE_RESTART")?fl.FIRST_CONNECTION:fl.OLD_FIRST_CONNECTION),N(this,"_isStartRestartIce",!1),N(this,"_restartTimer",void 0),N(this,"_isTryConnecting",!1),N(this,"_iceError",null),N(this,"_forceTurn",!1),N(this,"_isWaitPcToRePub",!1),N(this,"handleMuteLocalTrack",async(n,i,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==ke.Connected)return void r(new Z(P.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void i();const l=c.find(h=>h[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const d=this.createMuteMessage(c);await Xe(this,jt.RequestMuteLocal,d),i()}catch(c){r(c)}finally{a()}}),N(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==ke.Connected)return void r(new Z(P.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();const l=c.find(h=>h[0]==="videoLowTrack");if(l){const h=l[1];if(h.track._originMediaStreamTrack.stop(),!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ae().supportDualStreamEncoding){const p=n._mediaStreamTrack.clone();h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}else{const p=Kw(n,Eg(this,jt.RequestLowStreamParameter));h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}await new Et((p,m)=>{this.handleReplaceTrack(h.track,p,m,!0)})}await this.connection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const d=this.createUnmuteMessage(c);await Xe(this,jt.RequestUnmuteLocal,d),i()}catch(c){r(c)}finally{a()}}),N(this,"handleUpdateVideoEncoder",async(n,i,r,a)=>{let c;a||(c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(ct.LocalVideoTrack);if(!this.connection||!d||d.track!==n||this.state!==ke.Connected)return void i();const{id:h,track:p}=d;await this.connection.updateSendParameters(h,p),await this.connection.updateEncoderConfig(h,p),this.emit(jt.UpdateVideoEncoder,p),i()}catch(d){r(d)}finally{var l;(l=c)===null||l===void 0||l()}}),N(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(ct.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==ke.Connected)return void i();const{id:l,track:d}=c;await this.connection.updateSendParameters(l,d),i()}catch(c){r(c)}finally{a()}}),N(this,"handleReplaceMixingTrack",async(n,i,r,a)=>{if(!this.connection||this.state!==ke.Connected)return void i();const c=Hw([n]);let l;v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),typeof a=="boolean"&&a||(l=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,c),i()}catch(h){r(h)}finally{var d;(d=l)===null||d===void 0||d()}}),N(this,"handleReplaceTrack",async(n,i,r,a)=>{let c;v.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof a=="boolean"&&a||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:m}]=p;return n===m});if(!this.connection||!h||this.state!==ke.Connected)return void i();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(n,h[1].id)),this.isPlanB){const p=h[1];p.id=n._mediaStreamTrack.id,this.localTrackMap.set(h[0],p)}if(h[0]===ct.LocalVideoTrack&&!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ae().supportDualStreamEncoding){const p=this.localTrackMap.get(ct.LocalVideoLowTrack);if(p){const m=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m,await new Et((S,R)=>{this.handleReplaceTrack(p.track,S,R,!0)})}}i()}catch(h){r(h)}finally{var d;(d=c)===null||d===void 0||d()}}),N(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),N(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),N(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),N(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),N(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new JU(this.store),this.bindStatsUploaderEvents(),this.mutex=new xi("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Ae().supportUnifiedPlan||U("CHROME_FORCE_PLAN_B")&&ol(),this.shouldForwardP2PCreation=U("FORWARD_P2P_CREATION")&&Ae().supportPCSetConfiguration&&wI(),this.shouldForwardP2PCreation&&(this.connection=Iv(this.store),this.emit(jt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var e;this.state=ke.New,this._forceTurn=WU(t),v.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=Iv(this.store,t),this.emit(jt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Z(P.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=U("NEW_ICE_RESTART")?fl.FIRST_CONNECTION:fl.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new Z(P.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");U("ENABLE_PREALLOC_PC")&&this.state===ke.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ke.Connected)}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(r=>{var a;let[c]=r;return _t(a=[ct.LocalVideoLowTrack,ct.LocalVideoTrack]).call(a,c)}),n=e.map(r=>{let[,{id:a}]=r;return a}),i=e.map(r=>{let[a]=r;return a});if(this.connection instanceof lc){if(kt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!_t(t).call(t,this.store.codec)){const r=["vp9","vp8","h264"].find(a=>_t(t).call(t,a));r&&(this.store.codec=r,v.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(r,".")))}this.connection.updateRemoteRTPCapabilities(n,t)}}async getEstablishParams(){var t;if(this.connection instanceof lc&&this.connection.peerConnectionState!=="closed"&&_t(t=[ke.New,ke.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==ke.Connected){if(this.state===ke.Disconnected)throw new Z(P.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(n=>{var i;_t(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const e=this.filterTobePublishedDataChannels(t);return e.length===0?[]:(e.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),t.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(t,e,n){var i=this;return Ys(function*(){const r=yield Te(i.mutex.lock("From P2PChannel.publish"));try{var a;const c=i.connection&&_t(a=["disconnected","failed"]).call(a,i.connection.peerConnectionState);if(!i.connection||i.state!==ke.Connected||c){if(i.state===ke.Disconnected)throw new Z(P.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(t);const d=t.filter(h=>i.pendingLocalTracks.indexOf(h)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(d),void(c&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,Fi.markPublishStart(i.store.clientId,i.store.pubId);const l=i.filterTobePublishedTracks(t,e,n);if(l.length===0)return void(yield Te(i.tryToUnmuteAudio(t)));yield*Ay(t2(i.doPublish(i.connection,l)))}finally{r()}})()}doPublish(t,e){var n=this;return Ys(function*(){e.forEach(S=>{let{track:R,type:O}=S;const A=Date.now();n.store.publish(R.getTrackId(),O===ct.LocalAudioTrack?"audio":"video",A)}),n.bindLocalTrackEvents(e);const i=e.map(S=>{let{track:R}=S;return R}),r=yield Te(t.send(i,n.store.codec,n.store.audioCodec)),a=(yield Te(r.next())).value,c=n.createGatewayPublishMessage(e,a);let l;try{l=yield c}catch(S){throw r.throw(S),(S==null?void 0:S.code)===P.WS_ABORT&&e.forEach(R=>{let{track:O}=R;n.pendingLocalTracks.indexOf(O)===-1&&n.pendingLocalTracks.push(O)}),n.unbindLocalTrackEvents(e),S}const d=n.mapPubResToRemoteConfig(c,l,i),h=(yield Te(r.next(d))).value;if(n.state===ke.Disconnected)throw new Z(P.UNEXPECTED_ERROR,"PeerConnection already disconnected.");U("ENABLE_VIDEO_SEI");const p=U("ENABLE_ENCODED_TRANSFORM"),m=U("ENABLE_AUDIO_METADATA");i.forEach(async S=>{const R=S.getRTCRtpTransceiver();if(!R||!p)return;const{interceptLocalVideoFrame:O,interceptLocalAudioFrame:A}=Tv();S.trackMediaType===wt.VIDEO?await O(R.sender,S):S.trackMediaType===wt.AUDIO&&await A(R.sender,{metadata:m?()=>{const I=S.metadata.shift();return I&&I.value}:void 0})}),e.forEach(S=>{let{type:R}=S;n.statsCollector.addLocalStats(R)}),n.assignLocalTracks(e,h),n.statsUploader.startUploadOutboundStats(),e.forEach(S=>{let{track:R,type:O}=S;const A=Date.now();n.store.publish(R.getTrackId(),O===ct.LocalAudioTrack?"audio":"video",void 0,A)})})()}async updateVideoStreamParameter(t,e){const n=this.localTrackMap.get(e);if(!n||!this.connection)return;if(!(n.track instanceof cn))return v.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,r=function(a,c){const l={};return a.height&&a.width&&(l.scaleResolutionDownBy=Iw(a,c)),l.maxFramerate=a.framerate?as(a.framerate):void 0,l.maxBitrate=a.bitrate?1e3*a.bitrate:void 0,l}(t,i);if(i._encoderConfig||(i._encoderConfig={}),e!==ct.LocalVideoLowTrack||!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ae().supportDualStreamEncoding)r.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{const a=i._originMediaStreamTrack;if(!a.canvas)return v.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(c,l){const d=c.canvas;l.width&&(d.width=as(l.width)),l.height&&(d.height=as(l.height)),l.framerate&&(d.stopCapture&&d.stopCapture(),d.stopCapture=nw(()=>{!d.startCapture&&d.stopCapture&&d.stopCapture(),d.startCapture&&d.startCapture()},as(l.framerate)))})(a,t)}r.maxBitrate!=null&&(i._encoderConfig.bitrateMax=r.maxBitrate/1e3),r.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=r.maxFramerate:i._encoderConfig.frameRate={max:r.maxFramerate}),v.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(t){var e=this;return Ys(function*(){if(!e.connection||e.state!==ke.Connected)return;const n=yield Te(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const r=e.localTrackMap.get(ct.LocalVideoTrack);if(!r)throw new Z(P.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(ct.LocalVideoLowTrack))throw new Z(P.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const a=[{track:e.getLowVideoTrack(r.track,t),type:ct.LocalVideoLowTrack}];if(yield*Ay(t2(e.doPublish(e.connection,a))),r.track.muted||!r.track.enabled){var i;const c=(i=e.localTrackMap.get(ct.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;c!==void 0&&(yield Te(e.connection.muteLocal([c])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(v.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Li(this,jt.RequestRePublish,this.pendingLocalTracks),this.emit(jt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(v.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Li(this,jt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:n,kind:i}=this.pendingRemoteTracks[e];(i!==wt.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==wt.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await Li(this,jt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:n}of this.pendingRemoteTracks)await this.subscribe(e,n,n===wt.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:n}=e;this.emit(jt.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==ke.Connected)return void t.forEach(i=>{const r=this.pendingLocalTracks.indexOf(i);r!==-1&&this.pendingLocalTracks.splice(r,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==ke.Connected)return void t.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==ke.Connected)return;const t=this.localTrackMap.get(ct.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[ct.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(i=>{let[,{id:r}]=i;return r})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(i=>{let[r,{track:a}]=i;return{type:r,track:a}})),e.forEach(i=>{let[r]=i;this.statsCollector.removeLocalStats(r)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(t,e){if(!this.connection||this.state!==ke.Connected)throw new Z(P.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=e.filter(i=>{var r;return!((r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(t.uid,n),n.forEach(i=>{var r;this.remoteDataChannelMap.has(t)?(r=this.remoteDataChannelMap.get(t))===null||r===void 0||r.set(i.id,i):this.remoteDataChannelMap.set(t,new Map([[i.id,i]]));const a=this.pendingRemoteDataChannels.findIndex(c=>{let{user:l,id:d}=c;return l.uid===t.uid&&d===i.id});a!==-1&&this.pendingRemoteDataChannels.splice(a,1)}),n.map(i=>i.id)}async subscribe(t,e,n,i,r){var a;if(!this.connection||this.state!==ke.Connected)throw new Z(P.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((a=this.remoteUserMap.get(t))!==null&&a!==void 0&&a.has(e))return;let c,l,d;const h=this.connection.getPreMedia(n);if(h)v.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),d=h.transceiver,c=h.track,l=h.id;else if(r){const S=r.find(O=>{let{stream_type:A}=O;return A===e});if(!S)throw new Z(P.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const R=await this.connection.receive(e,S.ssrcs,String(t._uintid),S.attributes);this.connection instanceof lc&&(d=R.transceiver),c=R.track,l=R.id}else{const S=await this.connection.receive(e,[{ssrcId:n,rtx:i}],String(t._uintid),void 0);this.connection instanceof lc&&(d=S.transceiver),c=S.track,l=S.id}if(e===wt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(c):(t._audioTrack=new Yf(c,t.uid,t._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),d&&t._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(c):(t._videoTrack=new Kf(c,t.uid,t._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),d&&t._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(t,t._videoTrack)),d&&U("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:S,interceptRemoteAudioFrame:R}=Tv();e==wt.VIDEO?await S(d.receiver,{onSei:U("ENABLE_VIDEO_SEI")&&(O=>{var A;return(A=t._videoTrack)===null||A===void 0?void 0:A._onSei(O)})}):e==wt.AUDIO&&await R(d.receiver,{enableTopn:!!U("ENABLE_AUDIO_TOPN"),enableMetadata:!!U("ENABLE_AUDIO_METADATA"),onMetadata:O=>{this.safeEmit(jt.AudioMetadata,O)}})}const p=this.remoteUserMap.get(t);p?p.set(e,l):this.remoteUserMap.set(t,new Map([[e,l]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const m=this.pendingRemoteTracks.findIndex(S=>{let{user:R,kind:O}=S;return R.uid===t.uid&&e===O});m!==-1&&(this.pendingRemoteTracks.splice(m,1),this.emit(jt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==ke.Connected)throw new Z(P.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(r=>{var a;let{user:c,mediaType:l}=r;return!((a=this.remoteUserMap.get(c))!==null&&a!==void 0&&a.has(l))});const e=[],n=new Map;t.forEach(r=>{if(!this.connection)return;const a=this.connection.getPreMedia(r.ssrcId);a?n.set(r.ssrcId,a):e.push(r)});const i=await this.connection.batchReceive(e.map(r=>{let{user:a,mediaType:c,ssrcId:l,rtxSsrcId:d}=r;return{kind:c,ssrcMsg:[{ssrcId:l,rtx:d}],mslabel:String(a._uintid)}}));e.forEach((r,a)=>{n.set(r.ssrcId,i[a])});for(const{user:r,mediaType:a,ssrcId:c}of t){const l=n.get(c);if(!l)return void v.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(r.uid," subscribe data,").concat(a,", ").concat(c));const{track:d,id:h,transceiver:p}=l;if(p&&U("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:R,interceptRemoteAudioFrame:O}=Tv();a==wt.VIDEO?await R(p.receiver,{onSei:U("ENABLE_VIDEO_SEI")&&(A=>{var I;return(I=r._videoTrack)===null||I===void 0?void 0:I._onSei(A)})}):a==wt.AUDIO&&await O(p.receiver,{enableTopn:!!U("ENABLE_AUDIO_TOPN"),enableMetadata:!!U("ENABLE_AUDIO_METADATA"),onMetadata:A=>{this.safeEmit(jt.AudioMetadata,A)}})}if(a===wt.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(d):(r._audioTrack=new Yf(d,r.uid,r._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),p&&r._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(d):(r._videoTrack=new Kf(d,r.uid,r._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),p&&r._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(r,r._videoTrack)),U("ENABLE_VIDEO_SEI")&&p){const{interceptRemoteVideoFrame:R,interceptRemoteAudioFrame:O}=Tv();a==wt.VIDEO?await R(p.receiver,{onSei:A=>{var I;(I=r._videoTrack)===null||I===void 0||I._onSei(A)}}):a==wt.AUDIO&&await O(p.receiver)}const m=this.remoteUserMap.get(r);m?m.set(a,h):this.remoteUserMap.set(r,new Map([[a,h]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats();const S=this.pendingRemoteTracks.findIndex(R=>{let{user:O,kind:A}=R;return O.uid===r.uid&&a===A});S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit(jt.MediaReconnectEnd,r.uid))}}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:d}=c;return e!==void 0?l.uid===t.uid&&e===d:l.uid===t.uid});if(i.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===ke.Connected||n||i.forEach(c=>{let{kind:l}=c;var d;if(l===wt.AUDIO)(d=t._audioTrack)===null||d===void 0||d._destroy(),t._audioTrack=void 0;else if(l===wt.VIDEO){var h;(h=t._videoTrack)===null||h===void 0||h._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==ke.Connected)return;const r=this.filterTobeUnSubscribedTracks(t,e);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:l}]=c;return l}));const a=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(c=>{let[l,{kind:d}]=c;var h,p;if(d===wt.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),d===wt.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((p=l._videoTrack)===null||p===void 0||p._destroy(),l._videoTrack=void 0);else if(d===wt.AUDIO){var m;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((m=l._audioTrack)===null||m===void 0||m._destroy(),l._audioTrack=void 0)}}),a}async unsubscribeDataChannel(t,e){if(e.forEach(r=>{const a=this.pendingRemoteDataChannels.findIndex(c=>c.id===r.id);a!==-1&&this.pendingRemoteDataChannels.splice(a,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(t,e);if(n.length===0)return;e.forEach(r=>{r._close()});const i=this.remoteDataChannelMap.get(t);return n.forEach(r=>{i&&i.delete(r.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),n.map(r=>r.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:r,mediaType:a}of t){const c=this.pendingRemoteTracks.filter(l=>{let{user:d,kind:h}=l;return a!==void 0?d.uid===r.uid&&a===h:d.uid===r.uid});c.forEach(l=>{const d=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(d,1)}),e=e.concat(c)}if(!this.connection||this.state!==ke.Connected)return void e.forEach(r=>{let{user:a,kind:c}=r;var l;if(c===wt.AUDIO)(l=a._audioTrack)===null||l===void 0||l._destroy(),a._audioTrack=void 0;else if(c===wt.VIDEO){var d;(d=a._videoTrack)===null||d===void 0||d._destroy(),a._videoTrack=void 0}});const n=ds(t).call(t,(r,a)=>{let{user:c,mediaType:l}=a;const d=this.filterTobeUnSubscribedTracks(c,l);return r.concat(d)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(r=>{let[,{id:a}]=r;return a}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(r=>{let[a,{kind:c}]=r;var l,d;if(c===wt.VIDEO&&a._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),c===wt.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),(d=a._videoTrack)===null||d===void 0||d._destroy(),a._videoTrack=void 0;else if(c===wt.AUDIO){var h;this.unbindRemoteTrackEvents(a._audioTrack),(h=a._audioTrack)===null||h===void 0||h._destroy(),a._audioTrack=void 0}}),i}isPreSubScribe(t){return!this.connection||this.state!==ke.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===wt.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}addAudioMetadata(t){const e=this.localTrackMap.get(ct.LocalAudioTrack),n=e&&e.track;n&&n.metadata.push(t)}getAllTracks(t){const e=this.localTrackMap.get(ct.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Xn){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==ct.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===ct.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===ct.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(ct.LocalAudioTrack),l=i?this.localTrackMap.get(ct.LocalVideoLowTrack):this.localTrackMap.get(ct.LocalVideoTrack);kt.publish(this.store.sessionId,{eventElapse:Fi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Qe.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var a;n||(n=[]);const c=n.find(d=>d instanceof bn),l=i?(a=this.localTrackMap.get(ct.LocalVideoTrack))===null||a===void 0?void 0:a.track:n.find(d=>d instanceof cn);kt.publish(this.store.sessionId,{eventElapse:Fi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Qe.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===wt.VIDEO?n._videoSSRC:n._audioSSRC;r&&kt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===wt.VIDEO,audio:i===wt.AUDIO,peerid:n.uid,subscribeRequestid:r,p2pid:this.store.p2pId,eventElapse:Fi.measureFromSubscribeStart(this.store.clientId,r),preSsrc:this.isPreSubScribe(r)})}reset(){v.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new xi("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=Iv(this.store),this.emit(jt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(ct.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Xn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=ke.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(ct.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(ct.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof cn||e&&e.track instanceof bn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(ys(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(ct.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=tg(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.connection&&(v.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=ke.Reconnecting,U("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=Iv(this.store),this.emit(jt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case ct.LocalVideoTrack:_t(e=i._hints).call(e,Qe.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ct.LocalAudioTrack:i instanceof Xn?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ct.LocalVideoLowTrack:}}),this.emit(jt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(ys(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(jt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,n]=t;Array.from(ys(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(e,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),v.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const n of this.pendingRemoteDataChannels){const{user:i,id:r}=n;if((t instanceof Ou?t.uid:t)===i.uid&&r===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof Ou?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return Ys(function*(){if(!e.connection||e.state!==ke.Connected)return;const n=yield Te(e.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield Te(e.connection.restartICE(t));const a=yield Te(i.next());if(a.done)return;const c=a.value,l=yield c;switch(Ww(e.connection)&&e.reportPCStats(Date.now(),!1,e._pcStatsUploadType),t){case Bi.UDP_TCP_RELAY:e._pcStatsUploadType=fl.UDP_TCP_RESTART;break;case Bi.TCP_RELAY:e._pcStatsUploadType=fl.TCP_RESTART;break;case Bi.RELAY:e._pcStatsUploadType=fl.RELAY_RESTART;break;default:e._pcStatsUploadType=fl.OLD_RESTART}e._isTryConnecting=!0,i.next(l)}catch(a){var r;(r=i)===null||r===void 0||r.throw(a)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(ct.LocalVideoTrack),n=this.localTrackMap.get(ct.LocalAudioTrack),i=t.videoSend.find(R=>R.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),r=t.audioSend.find(R=>R.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!r)return 1;const a=Ts(this,jt.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,d=c&&l?(c+l)/2:c||l,h=(d&&a?(d+a)/2:d||a)||0,p=100*t.sendPacketLossRate*.7/50+.3*h/1500,m=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,S=e==null?void 0:e.track;if(S&&S._encoderConfig&&S._hints.indexOf(Qe.SCREEN_TRACK)===-1){const R=S._encoderConfig.bitrateMax,O=t.bitrate.actualEncoded;if(R&&O){const A=(1e3*R-O)/(1e3*R);return k1[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,a=i._videoSSRC,c=t.audioRecv.find(O=>O.ssrc===r),l=t.videoRecv.find(O=>O.ssrc===a);if(!c&&!l)return void(e+=1);const d=Ts(this,jt.NeedSignalRTT),h=t.rtt,p=(h&&d?(h+d)/2:h||d)||0,m=c?c.jitterMs:void 0,S=t.recvPacketLossRate;let R=.7*S*100/50+.3*p/1500;m&&(R=.6*S*100/50+.2*p/1500+.2*m/400),e+=R<.1?1:R<.17?2:R<.36?3:R<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new Et((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}async replaceTrack(t,e){var n;if(v.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==ke.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:c}]=a;return t===c});if(!i)return;const r=i[0];if(t!==e&&(this.unbindLocalTrackEvents([{track:t,type:r}]),this.bindLocalTrackEvents([{track:e,type:r}]),i[1].track=e),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(e,i[1].id)),this.isPlanB){const a=i[1];a.id=e._mediaStreamTrack.id,this.localTrackMap.set(r,a)}if(r===ct.LocalVideoTrack&&!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ae().supportDualStreamEncoding){const a=this.localTrackMap.get(ct.LocalVideoLowTrack);if(a){const c=t._mediaStreamTrack.clone();a.track._originMediaStreamTrack.stop(),a.track._mediaStreamTrack=c,a.track._originMediaStreamTrack=c,await new Et((l,d)=>{this.handleReplaceTrack(a.track,l,d,!0)})}}}filterTobePublishedTracks(t,e,n){const i=[],r=this.getAllTracks();t=Lf(t=t.filter(d=>r.indexOf(d)===-1));let a,c=!1;const l=this.localTrackMap.get(ct.LocalAudioTrack);for(const d of t){if(d instanceof cn&&(this.localTrackMap.has(ct.LocalVideoTrack)||c?new Z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:d,type:ct.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(d,n);i.push({track:h,type:ct.LocalVideoLowTrack})}if(d instanceof bn)if(l){const h=l.track;if(h instanceof Xn)Gw([d]),h.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0);else{const p=Hw([h,d]);v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(p.getTrackId(),"]")),this.replaceTrack(h,p)}}else a instanceof Xn?(Gw([d]),a.addAudioTrack(d)):a||!d._useAudioElement&&Ae().webAudioMediaStreamDest&&!d._bypassWebAudio?a=Hw(a?[d,a]:[d]):a=d}return a&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(a.getTrackId(),"]")),i.push({track:a,type:ct.LocalAudioTrack})),i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=Lf(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof bn){const r=this.localTrackMap.get(ct.LocalAudioTrack);if(!r)continue;r.track instanceof Xn?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([ct.LocalAudioTrack,r]),r.track.close())):e.push([ct.LocalAudioTrack,r])}if(i instanceof cn){const r=this.localTrackMap.get(ct.LocalVideoTrack);if(!r)continue;e.push([ct.LocalVideoTrack,r]);const a=this.localTrackMap.get(ct.LocalVideoLowTrack);a&&e.push([ct.LocalVideoLowTrack,a])}}return e}filterTobePublishedDataChannels(t){return t=(t=Lf(t)).filter(e=>this.localDataChannels.findIndex(n=>n.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Lf(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case ct.LocalVideoTrack:n.addListener(Ot.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ot.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Ot.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ot.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ot.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ot.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ot.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ot.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ot.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ct.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ct.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof Xn?t.trackList.forEach(n=>{n.addListener(Ot.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ot.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ot.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ot.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ot.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Ot.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Ot.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Ot.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Ot.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Ot.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(t.addListener(Ot.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Ot.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case ct.LocalVideoTrack:n.off(Ot.GET_STATS,this.handleGetLocalVideoStats),n.off(Ot.GET_RTC_STATS,this.handleGetRTCStats),n.off(Ot.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ot.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ot.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ot.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ot.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ot.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ot.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ct.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ct.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Xn?t.trackList.forEach(e=>{e.off(Ot.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ot.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ot.GET_STATS,this.handleGetLocalAudioStats),e.off(Ot.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ot.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Ot.GET_STATS,this.handleGetLocalAudioStats),t.off(Ot.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ot.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ot.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Ot.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(Ot.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ot.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof Kf&&e.addListener(Ot.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof Yf&&e.addListener(Ot.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Ot.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(wt.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(wt.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let a,c,{track:l,type:d}=n;switch(d){case ct.LocalAudioTrack:a=Me.Audio,c={dtx:l instanceof $y&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ct.LocalVideoTrack:a=_t(r=l._hints).call(r,Qe.SCREEN_TRACK)?Me.Screen:Me.High,c=dc(dc({},Z1(l)),{},{codec:this.store.codec,svc_mode:mv()});break;case ct.LocalVideoLowTrack:a=Me.Low,c=dc(dc({},Z1(l)),{},{codec:this.store.codec,svc_mode:mv()})}return{stream_type:a,attributes:c,ssrcs:e[i]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case ct.LocalVideoTrack:i=_t(n=a._hints).call(n,Qe.SCREEN_TRACK)?Me.Screen:Me.High;break;case ct.LocalAudioTrack:i=Me.Audio;break;case ct.LocalVideoLowTrack:i=Me.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:a}=n;this.localTrackMap.set(a,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(jt.PeerConnectionStateChange,e),e==="connecting"&&t instanceof lc&&!Sn()&&U("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{e==="connecting"&&t.extendCandidate()},U("FIRST_TCP_CANDIDATE_INTERVAL")),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof lc&&QU(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=fl.DISCONNECTED_OR_FAILED,Ts(this,jt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(r=>r.getTrackId()),i=this.pendingLocalDataChannels.map(r=>"dc_".concat(r.id));kt.reportApiInvoke(this.store.sessionId,{name:Wn.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:Rn.TRACER}).onSuccess(),this.republish()}if(U("NEW_ICE_RESTART")&&t instanceof lc&&!Sn()&&!this._forceTurn){if(_t(K1).call(K1,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=r=>{Ww(t)&&(v.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(r)),Ts(this,jt.QueryClientConnectionState)==="CONNECTED"&&this.emit(jt.RequestRestartICE,r))},i=()=>{Ww(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),v.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(jt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{ZU(t,n,i)},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&U("ICE_RESTART")&&Ts(this,jt.QueryClientConnectionState)==="CONNECTED"&&this.emit(jt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(jt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(jt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),kt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Rn.TRACER}).onSuccess(),this.emit(jt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(ys(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(Ff.FIRST_FRAME_DECODED),kt.firstRemoteFrame(this.store.sessionId,si.FIRST_AUDIO_DECODE,un.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Fi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(ys(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&kt.firstRemoteFrame(this.store.sessionId,si.FIRST_AUDIO_RECEIVED,un.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Fi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(ys(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&kt.firstRemoteFrame(this.store.sessionId,si.FIRST_VIDEO_RECEIVED,un.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Fi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(jt.ConnectionTypeChange,i),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Au(n))," -> ").concat(JSON.stringify(Au(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Au(n))," -> ").concat(JSON.stringify(Au(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return dc(dc({},e),n)},t.onICECandidateError=e=>{this._iceError=e}}resetConnection(t){t instanceof lc&&function(e){sm.delete(e.id),QU(e)}(t),t.close(),this.emit(jt.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(ct.LocalAudioTrack);if(t instanceof bn&&(n==null?void 0:n.track)instanceof Xn)return n.track.isActive||e.push([ct.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return t===a});if(i&&(e.push(i),i[0]===ct.LocalVideoTrack)){const r=this.localTrackMap.get(ct.LocalVideoLowTrack);r&&e.push([ct.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(ct.LocalAudioTrack);if(t instanceof bn&&(n==null?void 0:n.track)instanceof Xn)return n.track.isActive&&e.push([ct.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return t===a});if(i)if(i[0]===ct.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(ct.LocalVideoLowTrack);r&&e.push([ct.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case ct.LocalAudioTrack:i=Me.Audio;break;case ct.LocalVideoTrack:i=_t(n=a._hints).call(n,Qe.SCREEN_TRACK)?Me.Screen:Me.High;break;case ct.LocalVideoLowTrack:i=Me.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case ct.LocalAudioTrack:i=Me.Audio;break;case ct.LocalVideoTrack:i=_t(n=a._hints).call(n,Qe.SCREEN_TRACK)?Me.Screen:Me.High;break;case ct.LocalVideoLowTrack:i=Me.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[a,c]=r;n.push([t,{kind:a,id:c}])});return n}filterTobeUnSubscribedDataChannels(t,e){const n=[];return e.forEach(i=>{var r;(r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:a}]=n;switch(r){case wt.VIDEO:return void(i._videoSSRC&&e.push({stream_type:wt.VIDEO,ssrcId:i._videoSSRC}));case wt.AUDIO:return void(i._audioSSRC&&e.push({stream_type:wt.AUDIO,ssrcId:i._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(n=>{let[i,{kind:r}]=n;if(e.has(i)){let a=e.get(i);r===wt.VIDEO?a|=ai.Video:a|=ai.Audio,e.set(i,a)}else r===wt.VIDEO?e.set(i,ai.Video):e.set(i,ai.Audio)}),{users:Array.from(e.entries()).map(n=>{let[i,r]=n;return{stream_id:i.uid,stream_type:r}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(ct.LocalVideoTrack),n=this.localTrackMap.get(ct.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new Et((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new Et((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e,n){return t.map((i,r)=>{var a;let{stream_type:c}=i;const l=(a=e.find(d=>{let{stream_type:h}=d;return c===h}))===null||a===void 0?void 0:a.attributes;if(l&&U("DISABLE_SCREEN_SHARE_REMB")){const d=n[r]._hints;(_t(d).call(d,Qe.SCREEN_TRACK)||_t(d).call(d,Qe.SCREEN_LOW_TRACK))&&(l.remb=!1,v.debug("disable remb for screen share, hints:",d))}return l})}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof bn){var e;const i=this.filterTobeUnmutedTracks(t[n]);if(i.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(i.map(a=>{let[,{id:c}]=a;return c})));const r=this.createUnmuteMessage(i);return void await Xe(this,jt.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(jt.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(jt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ti(UI(this.dtlsFailedCount,Kn)),this.emit(jt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await Li(this,jt.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(jt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ct.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof cn)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof cn).length>1)throw new Z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof bn).length>1&&(t.some(e=>e instanceof bn&&e._bypassWebAudio)||!Ae().webAudioMediaStreamDest))throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof cn&&this.pendingLocalTracks.some(n=>n instanceof cn))throw new Z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof bn&&this.pendingLocalTracks.some(n=>n instanceof bn)&&(!Ae().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof bn&&n._bypassWebAudio)))throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){var n;const i=!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ae().supportDualStreamEncoding,r=dc(dc({},{width:160,height:120,framerate:15,bitrate:50}),e);let a;a=i?t._mediaStreamTrack.clone():Kw(t,r);const c=Je(8,"track-low-"),l=new cn(a,dc(dc({},i&&{scaleResolutionDownBy:Iw(r,t)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,c);return l.on(ah.TRANSCEIVER_UPDATED,d=>{t._updateRtpTransceiver(d,Vf.LOW_STREAM)}),l._hints.push(Qe.LOW_STREAM),_t(n=t._hints).call(n,Qe.SCREEN_TRACK)&&l._hints.push(Qe.SCREEN_LOW_TRACK),t.on("sei-to-send",d=>{l.emit("sei-to-send",d)}),t.addListener(Ot.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof lc){var r,a,c,l;const d=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:h,dtlsTransportState:p,peerConnectionState:m}=this.connection,{local:S,remote:R}=await this.connection.getSelectedCandidatePair();kt.pcStats(this.store.sessionId,{startTime:d,eventElapse:t-d||0,iceconnectionsate:h,dtlsstate:p,connectionstate:m,intSucc:e?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(r=S==null?void 0:S.protocol)!==null&&r!==void 0?r:"",selectedLocalCandidateType:(a=S.candidateType)!==null&&a!==void 0?a:"",selectedLocalCandidateAddress:"".concat(S.address,":").concat(S.port),selectedRemoteCandidateProtocol:(c=R.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=R.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(R.address,":").concat(R.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,e,n,i){var r;const a=Array.from(ys(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(a){i||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(d=>d.userId===a.uid&&d.type==="video");kt.firstRemoteVideoDecode(this.store.sessionId,si.FIRST_VIDEO_DECODE,un.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:e,videoheight:n,subscribeElapse:Fi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0,firstFrame:(l==null?void 0:l.firstFrame)||0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const a=await this.connection.getRemoteSSRC(r);return a!==void 0&&a!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===ct.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Vf.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Dt(ae.prototype,"startP2PConnection",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"startP2PConnection"),ae.prototype),Dt(ae.prototype,"connect",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"connect"),ae.prototype),Dt(ae.prototype,"updateRemoteRTPCapabilities",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"updateRemoteRTPCapabilities"),ae.prototype),Dt(ae.prototype,"publishDataChannel",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"publishDataChannel"),ae.prototype),Dt(ae.prototype,"unpublish",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"unpublish"),ae.prototype),Dt(ae.prototype,"unpublishDataChannel",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"unpublishDataChannel"),ae.prototype),Dt(ae.prototype,"unpublishLowStream",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"unpublishLowStream"),ae.prototype),Dt(ae.prototype,"subscribeDataChannel",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"subscribeDataChannel"),ae.prototype),Dt(ae.prototype,"subscribe",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"subscribe"),ae.prototype),Dt(ae.prototype,"massSubscribe",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"massSubscribe"),ae.prototype),Dt(ae.prototype,"unsubscribe",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"unsubscribe"),ae.prototype),Dt(ae.prototype,"unsubscribeDataChannel",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"unsubscribeDataChannel"),ae.prototype),Dt(ae.prototype,"massUnsubscribe",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"massUnsubscribe"),ae.prototype),Dt(ae.prototype,"muteRemote",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"muteRemote"),ae.prototype),Dt(ae.prototype,"unmuteRemote",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"unmuteRemote"),ae.prototype),Dt(ae.prototype,"hasRemoteMediaWithLock",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"hasRemoteMediaWithLock"),ae.prototype),Dt(ae.prototype,"disconnectForReconnect",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"disconnectForReconnect"),ae.prototype),Dt(ae.prototype,"updateBitrateLimit",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"updateBitrateLimit"),ae.prototype),Dt(ae.prototype,"remoteMediaSsrcChanged",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"remoteMediaSsrcChanged"),ae.prototype),ae);function $i(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,a=await r.lock("From P2PChannel.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{a()}},n}function e2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function n2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?e2(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const aW=Date.now(),oW=20,qw=new Map,Pv=new Map;async function i2(t){const e=qw.get(t),n=Array.isArray(e)&&e[e.length-1],i=Pv.get(t);if(!n)return void(i.isSyncing=!1);const r={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const a=n.sendTs-i.firstSendTs,c=a-(Date.now()-i.firstRecvTs);c>0&&(i.firstRecvTs=Date.now()-a);let l=n.mediaDelay+c;l<=0?(e.pop(),r2(n.context,r),l=0):l=Math.min(l,oW),setTimeout(()=>e.length&&i2(t),l)}function r2(t,e){t.safeEmit(ce.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function cW(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return r2(n,{uid:t.uid,payload:t.payload});const i="".concat(n.id,"-").concat(t.uid),r=qw.get(i)||[],a=r.findIndex(h=>t.sendTs>=h.sendTs),c=n2(n2({},t),{},{context:n,mediaDelay:e,recvTs:Date.now()});a===-1?r.push(c):r.splice(a,0,c),qw.set(i,r);let l=!1;var d;Pv.has(i)?l=!((d=Pv.get(i))===null||d===void 0||!d.isSyncing):Pv.set(i,{isSyncing:l,firstRecvTs:0,firstSendTs:0}),l||i2(i)}const lW=Re().name;function s2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function a2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?s2(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const am="websdk_ng_cache_parameter",uW=U("MAX_PRELOAD_ASYNC_LENGTH"),dW=1e4,Sh=new Map,Th=[];let zw=null,Xw=0,Jw=0;const kv=new Map,hW=function(t,e){const n=[];let i=0;const r=async()=>{const a=n.shift();a&&await a(),n.length>0&&i<e?r():i--};return async function(){for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return new Et(async(d,h)=>{n.push(async()=>{try{const p=await t(...c);d(p)}catch(p){h(p)}}),i<e&&(i++,r())})}}(o2,uW),Qw=vr.CancelToken.source();async function o2(t,e,n,i,r,a){try{if(!U("ENABLE_PRELOAD"))return;if(!Ae().supportWebCrypto)return void Tu(()=>{v.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new Z(P.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Si(n,"token",1,2047),Si(t,"appid",1,2047),uv(e),i&&dv(i);const c=rh();v.debug("preload channel ".concat(e,", uid is ").concat(i));const l={appId:t,cname:e,token:n||t,uid:typeof i!="string"?i:null,sid:c,proxyServer:r};let d,h;typeof i=="string"?(l.stringUid=i,[h,d]=await Et.all([z6(i,{sid:c,appId:t},Qw.token),OU(a2(a2({},l),{},{token:n||t,uid:0}),Qw.token)]),l.uid=h.uid,d.gatewayInfo.uid=l.uid,d.gatewayInfo.res.uid=l.uid):(a&&(l.stringUid=a),d=await OU(l,Qw.token));const p={sid:c,appId:t,cname:e,token:n||t,uid:l.stringUid||i,intUid:l.uid||d.gatewayInfo.uid,stringUid:l.stringUid,ts:Date.now(),sua:h,ap:d};await async function(m){let S;try{m.uid&&l2({appId:m.appId,cname:m.cname,token:m.token,uid:m.uid,stringUid:m.stringUid});const R=p2(m),O=await async function(I,D){try{const L=await window.crypto.subtle.importKey("raw",$P(D),"AES-GCM",!1,["encrypt"]),V=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},L,ih(window.btoa(JSON.stringify(I))));return Ru(new Uint8Array(V))}catch{return}}(m,m.token||m.appId);if(!O)return;S=h2(am);const A=S?JSON.parse(S):[];A.push({[R]:O}),A.length>U("AP_CACHE_NUM")&&A.shift(),Mv(am,JSON.stringify(A))}catch(R){v.warn("Error caching server parameters:",R.message),Mv(am,"")}}(p),Xw++}catch(c){throw Jw++,function(l){zw||(zw=window.setTimeout(()=>{let h="";kv.forEach((p,m)=>{h+="".concat(m,": ").concat(p," ;")}),kt.reportApiInvoke(null,{name:Wn.PRELOAD,options:{success:Xw,failed:Jw,err:h}}).onError(l),Xw=0,Jw=0,kv.clear(),zw=null},dW));const d=kv.get(l.code)||0;kv.set(l.code,d+1)}(c),c}}async function c2(t){try{if(U("AP_REQUEST_DETAIL")||U("ENABLE_ROLE_SELECT_EDGE"))return;const e=l2(t);if(!e||t.cloudProxyServer!=="disabled")return;const n=await async function(i,r){try{const a=await window.crypto.subtle.importKey("raw",$P(r),"AES-GCM",!1,["decrypt"]),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},a,ih(i));return JSON.parse(window.atob(Ru(new Uint8Array(c))))}catch{return}}(e,t.token||t.appId);if(!n||!function(i,r){return i.cname===r.cname&&i.appId===r.appId&&i.token===r.token?r.stringUid?i.stringUid===r.stringUid:typeof r.uid=="number"?i.uid===r.uid:i.uid==r.uid:!1}(n,t))return;if(n&&Date.now()-n.ts<U("AP_CACHE_LIFETIME"))return n}catch(e){v.warn("Error get preloadInfo",e.message)}}function l2(t){let e;try{if(e=h2(am),!e)return;const n=JSON.parse(e),i=p2(t),r=function(c,l){for(let d=c.length-1;d>=0;d--)if(l(c[d]))return d;return-1}(n,c=>i in c);if(r===-1)return;const a=n.splice(r,1)[0];return Mv(am,JSON.stringify(n)),a[i]}catch(n){v.warn("Error delete preload info: ".concat(e),n.message),Mv(am,"")}}function Zw(t){if(t){let e=Sh.get(t);e&&(window.clearTimeout(e),e=null,Sh.delete(t)),_t(Th).call(Th,t)||t.cloudProxyServer!=="disabled"||Th.push(t)}if(Sh.size<U("AP_CACHE_NUM")&&Th.length>0){const e=Th.shift();Sh.set(e,window.setTimeout(async()=>{const{appId:n,cname:i,token:r,stringUid:a,uid:c,proxyServer:l}=e;try{await hW(n,i,r,c,l,a),Sh.has(e)&&Zw(e)}catch(d){v.warn("update preload failed",d.message),u2(e)}},U("AP_UPDATE_INTERVAL")))}}function u2(t){const e=Th.indexOf(t);e!==-1&&Th.splice(e,1);let n=Sh.get(t);n&&(window.clearTimeout(n),n=null,Sh.delete(t),Zw())}function d2(t,e){const n=t.sua,i=t.ap;e&&n&&kt.reqUserAccount(t.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:e,uid:t.intUid,errorCode:null,extend:n.req}),kt.reportResourceTiming(t.ap.url,t.sid),kt.joinWebProxyAP(t.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(r=>r.ip).join(","),eventType:"disabled",unilbsServerIds:[Vn.CHOOSE_SERVER,Vn.CLOUD_PROXY_FALLBACK].toString()}),kt.joinChooseServer(t.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(r=>r.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[Vn.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function h2(t){return window.atob(window.localStorage.getItem(t)||"")}function Mv(t,e){window.localStorage.setItem(t,window.btoa(e))}function p2(t){let e="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(e+="_s_".concat(t.uid)),typeof t.uid=="number"&&(e+="_".concat(t.uid)),t.token&&(e+="_".concat(t.token)),ak(e)}function pW(t){let e=function(){const n=_W.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let r=n.appId;r!==void 0&&(jn(i,10),Du(i,r));let a=n.cid;a!==void 0&&(jn(i,16),jn(i,a));let c=n.cname;c!==void 0&&(jn(i,26),Du(i,c));let l=n.deviceId;l!==void 0&&(jn(i,34),Du(i,l));let d=n.elapse;d!==void 0&&(jn(i,40),Lu(i,d));let h=n.fileSize;h!==void 0&&(jn(i,48),Lu(i,om(h)));let p=n.height;p!==void 0&&(jn(i,56),Lu(i,om(p)));let m=n.jpg;m!==void 0&&(jn(i,66),jn(i,m.length),m2(i,m));let S=n.networkType;S!==void 0&&(jn(i,72),Lu(i,om(S)));let R=n.osType;R!==void 0&&(jn(i,80),Lu(i,om(R)));let O=n.requestId;O!==void 0&&(jn(i,90),Du(i,O));let A=n.sdkVersion;A!==void 0&&(jn(i,98),Du(i,A));let I=n.sequence;I!==void 0&&(jn(i,104),Lu(i,om(I)));let D=n.sid;D!==void 0&&(jn(i,114),Du(i,D));let L=n.timestamp;L!==void 0&&(jn(i,120),Lu(i,L));let V=n.uid;V!==void 0&&(jn(i,128),jn(i,V));let W=n.vid;W!==void 0&&(jn(i,136),jn(i,W));let K=n.width;K!==void 0&&(jn(i,144),Lu(i,om(K)));let G=n.service;G!==void 0&&(jn(i,152),jn(i,G));let Q=n.callbackData;Q!==void 0&&(jn(i,162),jn(i,Q.length),m2(i,Q));let lt=n.ticket;lt!==void 0&&(jn(i,170),Du(i,lt));let Tt=n.vendorConfigs;Tt!==void 0&&(jn(i,178),Du(i,Tt))}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function fW(t){return function(n){let i={};t:for(;!EW(n);){let r=xg(n);switch(r>>>3){case 0:break t;case 1:i.code=xg(n);break;case 2:i.msg=_2(n,xg(n));break;case 3:i.requestId=_2(n,xg(n));break;case 4:i.timestamp=gW(n,!1);break;default:mW(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function mW(t,e){switch(e){case 0:for(;128&Oa(t););break;case 2:$w(t,xg(t));break;case 5:$w(t,4);break;case 1:$w(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function om(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let _W=[];function $w(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function EW(t){return t.offset>=t.limit}function Uv(t,e){let n=t.bytes,i=t.offset,r=t.limit,a=i+e;if(a>n.length){let c=new Uint8Array(2*a);c.set(n),t.bytes=c}return t.offset=a,a>r&&(t.limit=a),i}function f2(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function m2(t,e){let n=Uv(t,e.length);t.bytes.set(e,n)}function _2(t,e){let n=f2(t,e),i=String.fromCharCode,r=t.bytes,a="",c="";for(let l=0;l<e;l++){let d,h,p,m,S=r[l+n];(128&S)==0?c+=i(S):(224&S)==192?l+1>=e?c+=a:(d=r[l+n+1],(192&d)!=128?c+=a:(m=(31&S)<<6|63&d,m<128?c+=a:(c+=i(m),l++))):(240&S)==224?l+2>=e?c+=a:(d=r[l+n+1],h=r[l+n+2],(49344&(d|h<<8))!=32896?c+=a:(m=(15&S)<<12|(63&d)<<6|63&h,m<2048||m>=55296&&m<=57343?c+=a:(c+=i(m),l+=2))):(248&S)==240?l+3>=e?c+=a:(d=r[l+n+1],h=r[l+n+2],p=r[l+n+3],(12632256&(d|h<<8|p<<16))!=8421504?c+=a:(m=(7&S)<<18|(63&d)<<12|(63&h)<<6|63&p,m<65536||m>1114111?c+=a:(m-=65536,c+=i(55296+(m>>10),56320+(1023&m)),l+=3))):c+=a}return c}function Du(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}jn(t,i);let r=Uv(t,i),a=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?a[r++]=l:(l<2048?a[r++]=l>>6&31|192:(l<65536?a[r++]=l>>12&15|224:(a[r++]=l>>18&7|240,a[r++]=l>>12&63|128),a[r++]=l>>6&63|128),a[r++]=63&l|128)}}function Oa(t){return t.bytes[f2(t,1)]}function E2(t,e){let n=Uv(t,1);t.bytes[n]=e}function xg(t){let e,n=0,i=0;do e=Oa(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function jn(t,e){for(e>>>=0;e>=128;)E2(t,127&e|128),e>>>=7;E2(t,e)}function gW(t,e){let n,i=0,r=0,a=0;return n=Oa(t),i=127&n,128&n&&(n=Oa(t),i|=(127&n)<<7,128&n&&(n=Oa(t),i|=(127&n)<<14,128&n&&(n=Oa(t),i|=(127&n)<<21,128&n&&(n=Oa(t),r=127&n,128&n&&(n=Oa(t),r|=(127&n)<<7,128&n&&(n=Oa(t),r|=(127&n)<<14,128&n&&(n=Oa(t),r|=(127&n)<<21,128&n&&(n=Oa(t),a=127&n,128&n&&(n=Oa(t),a|=(127&n)<<7))))))))),{low:i|r<<28,high:r>>>4|a<<24,unsigned:e}}function Lu(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,a=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=Uv(t,a),l=t.bytes;switch(a){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=a!==9?128|r:127&r;case 8:l[c+7]=a!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=a!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=a!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=a!==5?128|i:127&i;case 4:l[c+3]=a!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=a!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=a!==2?n>>>7|128:n>>>7&127;case 1:l[c]=a!==1?128|n:127&n}}const g2={},S2={},xv=4294967296,SW=xv*xv,TW=SW/2;R2(0,!0);const T2=R2(0),RW=Vg(0,-2147483648,!1),yW=Vg(-1,2147483647,!1);function R2(t,e){let n,i,r;return e?(r=0<=(t>>>=0)&&t<256)&&(i=S2[t],i)?i:(n=Vg(t,0,!0),r&&(S2[t]=n),n):(r=-128<=(t|=0)&&t<128)&&(i=g2[t],i)?i:(n=Vg(t,t<0?-1:0,!1),r&&(g2[t]=n),n)}function Vg(t,e,n){return{low:0|t,high:0|e,unsigned:!!n}}function y2(t,e){if(isNaN(t))return T2;{if(t<=-9223372036854776e3)return RW;if(t+1>=TW)return yW}return t<0?T2:Vg(t%xv|0,t/xv|0,e)}function v2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class tO extends _n{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(Ro.CONNECTION_STATE_CHANGE,e,n)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var n;super(),N(this,"name","AgoraRTCImageModeration"),N(this,"_connectionState",Js.CONNECTING),N(this,"_sequence",0),N(this,"_moderationStartTime",void 0),N(this,"_workerConnection",void 0),N(this,"_workerMessageLengthLimit",void 0),N(this,"_qualityRatio",void 0),N(this,"_connectInfo",void 0),N(this,"_cancelTokenSource",vr.CancelToken.source()),N(this,"_retryConfig",void 0),N(this,"_moderationInterval",void 0),N(this,"_moderationTimer",null),N(this,"_moderationMode",1),N(this,"_quality",1),N(this,"_qualityTimer",null),N(this,"_ticket",void 0),N(this,"_moderationIntervalMinimum",void 0),N(this,"_uploadFailedNum",0),N(this,"_uploadNum",0),N(this,"_uploadTimer",null),N(this,"_extraInfo",void 0),N(this,"_vendor",""),N(this,"_encoder",new TextEncoder),N(this,"_moderationId",void 0),N(this,"inspectImage",()=>{if(this.connectionState!==Js.CONNECTED)throw new J(P.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Js.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Je(5,"image-moderation-"),this._workerMessageLengthLimit=U("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=U("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=U("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Ig("worker-"+this._moderationId,Kn),this.on(Ro.STATE_CHANGE,(i,r)=>{v.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Jf[i]," ").concat(r||""))}),this.handleWorkerEvents()}async init(e,n){this.emit(Ro.STATE_CHANGE,Jf.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new Et((r,a)=>{this.on(Ro.CONNECTION_STATE_CHANGE,(c,l)=>{c===Js.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorker(c)}).catch(c=>{a(c)})})}updateConfig(e){var n;this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),v.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===Js.CONNECTED&&this.inspectImage()}async requestAP(e,n,i){const r=U("WEBCS_DOMAIN").map(d=>"https://".concat(d,"/api/v1")),a=await function(d,h,p,m){let{appId:S,areaCode:R,cname:O,sid:A,token:I,uid:D}=h;nm++;const L="moderation_plugin",V={service_name:L,json_body:JSON.stringify({appId:S,areaCode:R,cname:O,command:"allocateEdge",requestId:nm,seq:nm,sid:A,appToken:I,ts:Date.now(),uid:D+""})};let W,K,G=d[0];return Eo(async()=>{W=Date.now();const Q=await yo(G,{data:V,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-W,Q.code!==0){const At=new J(P.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Q.code,{retry:!0,responseTime:K});throw v.error(At.toString()),At}const lt=JSON.parse(Q.json_body);if(lt.code!==200){const At=new J(P.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(lt.code,", reason: ").concat(lt.reason),{code:lt.code,responseTime:K});throw v.error(At.toString()),At}if(!lt.servers||!Array.isArray(lt.servers)||lt.servers.length===0){const At=new J(P.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:lt.code,responseTime:K});throw v.error(At.toString()),At}if(!lt.servers.some(At=>!!At.wss)){const At=new J(P.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:lt.code,responseTime:K});throw v.error(At.toString()),At}const Tt=U("IMAGE_MODERATION_WORKER_HOST");return{addressList:lt.servers.map(At=>{let{address:de,wss:he}=At;if(de&&he)return"wss://".concat(de.replace(/\./g,"-"),".").concat(Tt,":").concat(he,"/moderation")}).filter(At=>!!At),workerToken:lt.workerToken,vid:lt.vid,ticket:lt.appTicket,responseTime:K}},(Q,lt)=>(kt.apworkerEvent(A,{success:!0,sc:200,serviceName:L,responseDetail:JSON.stringify(Q.addressList),firstSuccess:lt===0,responseTime:K,serverIp:d[lt%d.length]}),!1),(Q,lt)=>(kt.apworkerEvent(A,{success:!1,sc:Q.data&&Q.data.code||200,serviceName:L,responseTime:K,serverIp:d[lt%d.length]}),!!(Q.code!==P.OPERATION_ABORTED&&Q.code!==P.UNEXPECTED_RESPONSE||Q.data&&Q.data.retry)&&(G=d[(lt+1)%d.length],!0)),m)}(r,e,n,i);this.emit(Ro.STATE_CHANGE,Jf.AP_CONNECTED);const{addressList:c,ticket:l}=a;return this._ticket=l,c}async connectWorker(e){this.emit(Ro.STATE_CHANGE,Jf.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(te.CONNECTED,async()=>{this.emit(Ro.STATE_CHANGE,Jf.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Js.CONNECTED}),this._workerConnection.on(te.CLOSED,()=>{this.connectionState=Js.CLOSED}),this._workerConnection.on(te.FAILED,()=>{this.connectionState=Js.CLOSED}),this._workerConnection.on(te.RECONNECTING,()=>{this.connectionState=this.connectionState===Js.CONNECTED?Js.RECONNECTING:Js.CONNECTING}),this._workerConnection.on(te.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=fW(new Uint8Array(e.data));U("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,v.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{kt.reportApiInvoke(this._connectInfo.sid||null,{name:Wn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Rn.TRACER}).onError(new J(P.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},U("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else v.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(te.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this._workerConnection.on(te.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=Ts(this,Ro.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(U("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(e,n);this._workerConnection.sendMessage(i,!0,!0)}else U("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being published can be inspected")}async generateRequestData(e,n){let{appId:i,cname:r,cid:a,vid:c,sid:l,uid:d}=n;const h=Date.now(),p=await e.getCurrentFrameImage("image/jpeg",this.quality),m=await Xk(p,i,r),S=this._sequence+"-"+a+"-"+d+"-"+h+"-"+Je(12,""),R={appId:i,cid:a,cname:r,deviceId:"",elapse:tO.intToLong(Number(h-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:m,networkType:6,osType:7,requestId:S,sdkVersion:"4.23.2",sequence:this._sequence,sid:l,timestamp:y2(h),uid:d,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete R.callbackData;const O=pW(R);if(O.byteLength<this._workerMessageLengthLimit){if(U("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const A=function(I){for(var D=1;D<arguments.length;D++){var L=arguments[D]!=null?arguments[D]:{};D%2?v2(Object(L),!0).forEach(function(V){N(I,V,L[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(L)):v2(Object(L)).forEach(function(V){Object.defineProperty(I,V,Object.getOwnPropertyDescriptor(L,V))})}return I}({},R);delete A.jpg,v.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(A))}return O}{const A=this.quality*this._qualityRatio;return this.quality=A,await this.generateRequestData(e,{appId:i,cname:r,cid:a,vid:c,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=vr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Js.CLOSED,this.emit(Ro.STATE_CHANGE,Jf.CLOSED)}}function C2(t){if(He(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new J(P.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new J(P.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const vW={name:"ImageModeration",create:function(t){let{config:e}=t;return C2(e),new tO(e)}};var b2,A2,I2,w2,O2,N2,D2,L2,P2,k2,M2,U2,x2,V2,B2,F2,j2,G2,H2,W2,K2,Y2,q2,z2,X2,J2,Q2,Z2,$2,tx,ex,nx,ix,rx,sx,ax,ox,cx,lx,ux,dx,Ct;function hx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Na(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?hx(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):hx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}xi.setLogger(v);let CW=(b2=Wt(),A2=Wt({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof Gf))return[e];e=[e]}return e.map(n=>n?Object(n).toString():"null")}}),I2=Wt({argsMap:(t,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==jf.DATA?(Array.isArray(e)||(e=[e]),e.map(n=>n.getTrackId())):[e.getChannelId()])}),w2=Wt({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),O2=Wt({argsMap:(t,e,n)=>[e,n]}),N2=Wt({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return[i==null?void 0:i.uid,r]})}),D2=Wt({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),L2=Wt({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return{uid:i==null?void 0:i.uid,mediaType:r}})}),P2=Wt(),k2=Wt(),M2=Wt(),U2=Wt(),x2=Wt(),V2=Wt(),B2=Wt(),F2=Wt(),j2=Wt(),G2=Wt(),H2=Wt(),W2=Wt(),K2=Wt(),Y2=Wt(),q2=Wt(),z2=Wt({argsMap:(t,e)=>[e]}),X2=Wt(),J2=Wt(),Q2=Wt(),Z2=Wt(),$2=Wt(),tx=Wt(),ex=Wt(),nx=Wt(),ix=Wt({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),rx=Wt(),sx=Wt(),ax=Wt(),ox=Wt(),cx=Wt(),lx=Wt(),ux=Wt({reportResult:!0}),dx=Wt(),Ct=class extends _n{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,e){let n;if(super(),N(this,"store",void 0),N(this,"_uid",void 0),N(this,"_channelName",void 0),N(this,"_uintUid",void 0),N(this,"_users",[]),N(this,"_config",void 0),N(this,"_clientId",void 0),N(this,"_appId",void 0),N(this,"_sessionId",null),N(this,"_key",void 0),N(this,"_rtmConfig",{}),N(this,"_joinInfo",void 0),N(this,"_gateway",void 0),N(this,"_statsCollector",void 0),N(this,"_configDistribute",void 0),N(this,"_leaveMutex",void 0),N(this,"_publishMutex",void 0),N(this,"_renewTokenMutex",void 0),N(this,"_subscribeMutex",void 0),N(this,"_encryptionMode","none"),N(this,"_encryptionSecret",null),N(this,"_encryptionSalt",null),N(this,"_encryptDataStream",!1),N(this,"_encryptDataStreamKey",null),N(this,"_encryptDataStreamIv",null),N(this,"_proxyServer",void 0),N(this,"_turnServer",{servers:[],mode:"auto"}),N(this,"_cloudProxyServerMode","disabled"),N(this,"_isDualStreamEnabled",!1),N(this,"_defaultStreamFallbackType",void 0),N(this,"_lowStreamParameter",void 0),N(this,"_streamFallbackTypeCacheMap",new Map),N(this,"_remoteStreamTypeCacheMap",new Map),N(this,"_axiosCancelSource",vr.CancelToken.source()),N(this,"_audioVolumeIndicationInterval",void 0),N(this,"_networkQualityInterval",void 0),N(this,"_userOfflineTimeout",void 0),N(this,"_streamRemovedTimeout",void 0),N(this,"_liveTranscodeStreamingClient",void 0),N(this,"_liveRawStreamingClient",void 0),N(this,"_channelMediaRelayClient",void 0),N(this,"_networkQualitySensitivity","normal"),N(this,"_p2pChannel",void 0),N(this,"_useLocalAccessPoint",!1),N(this,"_setLocalAPVersion",void 0),N(this,"_joinAndNotLeaveYet",!1),N(this,"_numberOfJoinCount",0),N(this,"_remoteDefaultVideoStreamType",void 0),N(this,"_inspect",void 0),N(this,"_moderation",void 0),N(this,"_license",void 0),N(this,"_pendingPublishedUsers",[]),N(this,"ntpAlignErrorCount",0),N(this,"remoteInboundOffset",0),N(this,"_peerConnectionState",void 0),N(this,"_handleLocalTrackEnable",(r,a,c)=>{this.publish(r,!1).then(a).catch(c)}),N(this,"_handleLocalTrackDisable",(r,a,c)=>{this.unpublish(r).then(a).catch(c)}),N(this,"_handleUserOnline",r=>{if(U("BLOCK_LOCAL_CLIENT")&&hh(r.uid,this.channelName))return void v.debug("[".concat(r.uid,"] will be ignored in local"));this.isStringUID&&typeof r.uid!="string"&&v.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const a=this._users.find(c=>c.uid===r.uid);if(a)a._trust_in_room_=!0,a._is_pre_created&&(a._is_pre_created=!1,this.safeEmit(ce.USER_JOINED,a));else{const c=new Ou(r.uid,r.uint_id||r.uid);this._users.push(c),v.debug("[".concat(this._clientId,"] user online"),r.uid),this.safeEmit(ce.USER_JOINED,c)}}),N(this,"_handleUserOffline",r=>{if(U("BLOCK_LOCAL_CLIENT")&&hh(r.uid,this.channelName))return;const a=this._users.find(c=>c.uid===r.uid);a&&(this._handleRemoveStream(r),this._handleRemoveDataChannels(r),a._audio_pre_subscribed||a._video_pre_subscribed?a._is_pre_created=!0:By(this._users,a),this._remoteStreamTypeCacheMap.delete(a.uid),this._streamFallbackTypeCacheMap.delete(a.uid),v.debug("[".concat(this._clientId,"] user offline"),r.uid,"reason:",r.reason),this.safeEmit(ce.USER_LEAVED,a,r.reason))}),N(this,"_handleAddAudioOrVideoStream",(r,a,c,l,d,h,p)=>{if(U("BLOCK_LOCAL_CLIENT")&&hh(a,this.channelName))return;const m=this._users.find(R=>R.uid===a);if(!m)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));v.debug("[".concat(this._clientId,"] stream added with uid ").concat(a,", type ").concat(r)),this.store.subscribe(m.uid,r,void 0,void 0,void 0,Date.now());const S=r==="audio"?m.hasAudio:m.hasVideo;m._uintid||(m._uintid=d||a),r==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,r==="audio"?(m._audio_added_=!0,c!==void 0&&(m._audioSSRC=c),l!==void 0&&(m._cname=l),h&&(m._audioOrtc=h)):(m._video_added_=!0,c!==void 0&&(m._videoSSRC=c),l!==void 0&&(m._cname=l),p!==void 0&&(m._rtxSsrcId=p),h&&(m._videoOrtc=h)),(r==="audio"?m.hasAudio:m.hasVideo)&&!S&&(v.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(r)),this.safeEmit(ce.USER_PUBLISHED,m,r)),r==="video"?kt.onGatewayStream(this._sessionId,si.ON_ADD_VIDEO_STREAM,un.ON_ADD_VIDEO_STREAM,{peer:d||a,ssrc:m._videoSSRC}):kt.onGatewayStream(this._sessionId,si.ON_ADD_AUDIO_STREAM,un.ON_ADD_AUDIO_STREAM,{peer:d||a,ssrc:m._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(m,r,c).then(R=>{if(R&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(m.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Ug))return this._p2pChannel.unsubscribe(m,r,!0).then(()=>this._subscribe(m,r,!0).catch(O=>{v.error("[".concat(this._clientId,"] resubscribe error"),O.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(m,r)&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,r,!0).catch(R=>{v.error("[".concat(this._clientId,"] resubscribe error"),R.toString())}))}),N(this,"_handleRemoveStream",r=>{if(U("BLOCK_LOCAL_CLIENT")&&hh(r.uid,this.channelName))return;const a=this._users.find(l=>l.uid===r.uid);if(!a)return void v.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));v.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r.uid));let c=()=>{};a.hasAudio&&a.hasVideo?c=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished audio track")),this.safeEmit(ce.USER_UNPUBLISHED,a,"audio"),v.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished video track")),this.safeEmit(ce.USER_UNPUBLISHED,a,"video")}:a.hasVideo?c=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished video track")),this.safeEmit(ce.USER_UNPUBLISHED,a,"video")}:a.hasAudio&&(c=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(a.uid," unpublished audio track")),this.safeEmit(ce.USER_UNPUBLISHED,a,"audio")}),a._video_pre_subscribed||a._audio_pre_subscribed||(a._trust_audio_stream_added_state_=!0,a._trust_video_stream_added_state_=!0,a._audio_added_=!1,a._video_added_=!1,this._p2pChannel instanceof Ug&&this._p2pChannel.unsubscribe(a).then(l=>{if(l)return this._gateway.unsubscribe(l,a.uid)}),a._audioSSRC=void 0,a._videoSSRC=void 0,a._audioOrtc=void 0,a._videoOrtc=void 0,a._rtxSsrcId=void 0),kt.onGatewayStream(this._sessionId,si.ON_REMOVE_STREAM,un.ON_REMOVE_STREAM,{peer:r.uint_id||r.uid}),c()}),N(this,"_handleSetStreamLocalEnable",(r,a,c)=>{if(U("BLOCK_LOCAL_CLIENT")&&hh(a,this.channelName))return;const l=this._users.find(p=>p.uid===a);if(!l)return void v.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));v.debug("[".concat(this._clientId,"] local ").concat(r," ").concat(c?"enabled":"disabled"," with uid ").concat(a));const d=r==="audio"?l.hasAudio:l.hasVideo;if(r==="audio"){l._trust_audio_enabled_state_=!0;const p=l._audio_enabled_;if(l._audio_enabled_=c,l._audio_enabled_===p)return;{const m=l._audio_enabled_?"enable-local-audio":"disable-local-audio";v.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(a,", msg: ").concat(m)),this.safeEmit(ce.USER_INFO_UPDATED,a,m)}}else{l._trust_video_enabled_state_=!0;const p=l._video_enabled_;if(l._video_enabled_=c,l._video_enabled_===p)return;{const m=l._video_enabled_?"enable-local-video":"disable-local-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(a,", msg: ").concat(m)),this.safeEmit(ce.USER_INFO_UPDATED,a,m)}}const h=r==="audio"?l.hasAudio:l.hasVideo;return d!==h?!d&&h?(v.info("[".concat(this._clientId,"] remote user ").concat(a," published ").concat(r)),void this.safeEmit(ce.USER_PUBLISHED,l,r)):(r==="video"&&l._videoTrack&&l._videoTrack._destroy(),r==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,r),v.info("[".concat(this._clientId,"] remote user ").concat(a," unpublished ").concat(r)),void this.safeEmit(ce.USER_UNPUBLISHED,l,r)):void 0}),N(this,"_handleMuteStream",(r,a,c)=>{if(U("BLOCK_LOCAL_CLIENT")&&hh(r,this.channelName))return;v.debug("[".concat(this._clientId,"] receive mute message"),r,a,c);const l=this._users.find(p=>p.uid===r);if(!l)return void v.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r));const d=a==="audio"?l.hasAudio:l.hasVideo;if(a==="audio"){l._trust_audio_mute_state_=!0;const p=l._audio_muted_;if(l._audio_muted_=c,l._audio_muted_===p)return;{const m=l._audio_muted_?"mute-audio":"unmute-audio";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(m)),this.safeEmit(ce.USER_INFO_UPDATED,r,m)}}else{l._trust_video_mute_state_=!0;const p=l._video_muted_;if(l._video_muted_=c,l._video_muted_===p)return;{const m=l._video_muted_?"mute-video":"unmute-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(m)),this.safeEmit(ce.USER_INFO_UPDATED,r,m)}}const h=a==="audio"?l.hasAudio:l.hasVideo;if(d!==h){if(!d&&h)return(a==="audio"?l._audioSSRC:l._videoSSRC)?(v.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(a)),void this.safeEmit(ce.USER_PUBLISHED,l,a)):void v.warning("[".concat(this._clientId,"] remote user ").concat(r," receive ").concat(a," unmute message  before add stream message, ").concat(a," SSRC doesn't exist yet."));a==="video"&&l._videoTrack&&!l._video_pre_subscribed&&l._videoTrack._destroy(),a==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,a),v.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(a)),this.safeEmit(ce.USER_UNPUBLISHED,l,a)}}),N(this,"_handleP2PLost",async r=>{v.debug("[".concat(this._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():v.warning("[".concat(this._clientId,"] P2PLost stream not found"),r)}),N(this,"_handleTokenWillExpire",()=>{v.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(ce.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),N(this,"_handleBeforeUnload",r=>{r.type==="beforeunload"&&r.returnValue!==void 0&&r.returnValue!==""||(this.leave(),v.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),N(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(ce.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(ce.NETWORK_QUALITY,r)}),N(this,"_handleP2PAddAudioOrVideoStream",(r,a,c,l)=>{const d=this._users.find(p=>p.uid===a);if(!d)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));v.debug("[".concat(this._clientId,"] stream added with uid ").concat(a,", type ").concat(r)),this.store.subscribe(d.uid,r,void 0,void 0,void 0,Date.now());const h=r==="audio"?d.hasAudio:d.hasVideo;r==="audio"?d._trust_audio_stream_added_state_=!0:d._trust_video_stream_added_state_=!0,r==="audio"?(d._audio_added_=!0,c!==void 0&&(d._audioSSRC=c),l!==void 0&&(d._audioMid=l)):(d._video_added_=!0,c!==void 0&&(d._videoSSRC=c),l!==void 0&&(d._videoMid=l)),(r==="audio"?d.hasAudio:d.hasVideo)&&!h&&(v.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published ").concat(r)),this.safeEmit(ce.USER_PUBLISHED,d,r)),this._p2pChannel.hasPendingRemoteMedia(d,r)&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(d.uid," after reconnect.")),this._subscribe(d,r,!0).catch(p=>{v.error("[".concat(this._clientId,"] resubscribe error"),p.toString())}))}),this._config=t,this._clientId=e||Je(5,"client-"),this.store=new class{constructor(r,a,c,l){Xt(this,"state",void 0),this.state={codec:r,audioCodec:a,mode:c,clientId:l,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:sh.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(r){this.state=function(a,c){switch(c.type){case le.SET_SESSION_ID:return It(It({},a),{},{sessionId:c.sessionId});case le.SET_P2P_ID:return It(It({},a),{},{p2pId:c.p2pId});case le.SET_UID:return It(It({},a),{},{uid:c.uid});case le.SET_INT_UID:return It(It({},a),{},{intUid:c.intUid});case le.SET_PUB_ID:return It(It({},a),{},{pubId:c.pubId});case le.KEY_METRIC_CLIENT_CREATED:return It(It({},a),{},{keyMetrics:It(It({},a.keyMetrics),{},{clientCreated:c.metric})});case le.KEY_METRIC_JOIN_START:return It(It({},a),{},{keyMetrics:It(It({},a.keyMetrics),{},{joinStart:c.metric})});case le.AVOID_JOIN_START:return It(It({},a),{},{avoidJoinStart:c.avoidJoinStart});case le.KEY_METRIC_JOIN_END:return It(It({},a),{},{keyMetrics:It(It({},a.keyMetrics),{},{joinEnd:c.metric})});case le.KEY_METRIC_REQUEST_AP_START:return It(It({},a),{},{keyMetrics:It(It({},a.keyMetrics),{},{requestAPStart:c.metric})});case le.KEY_METRIC_REQUEST_AP_END:return It(It({},a),{},{keyMetrics:It(It({},a.keyMetrics),{},{requestAPEnd:c.metric})});case le.KEY_METRIC_JOIN_GATEWAY_START:return It(It({},a),{},{keyMetrics:It(It({},a.keyMetrics),{},{joinGatewayStart:c.metric})});case le.KEY_METRIC_JOIN_GATEWAY_END:return It(It({},a),{},{keyMetrics:It(It({},a.keyMetrics),{},{joinGatewayEnd:c.metric})});case le.KEY_METRIC_PEER_CONNECTION_START:return It(It({},a),{},{keyMetrics:It(It({},a.keyMetrics),{},{peerConnectionStart:c.metric})});case le.KEY_METRIC_PEER_CONNECTION_END:return It(It({},a),{},{keyMetrics:It(It({},a.keyMetrics),{},{peerConnectionEnd:c.metric})});case le.KEY_METRIC_DESCRIPTION_START:return It(It({},a),{},{keyMetrics:It(It({},a.keyMetrics),{},{descriptionStart:c.metric})});case le.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return It(It({},a),{},{keyMetrics:It(It({},a.keyMetrics),{},{signalChannelOpen:c.metric})});case le.KEY_METRIC_ICE_CONNECTION_END:return It(It({},a),{},{keyMetrics:It(It({},a.keyMetrics),{},{iceConnectionEnd:c.metric})});case le.KEY_METRIC_PUBLISH:{const l=a.keyMetrics.publish,d=l.findIndex(h=>h.trackId===c.metric.trackId);return d!==-1?(l[d]=It(It({},l[d]),c.metric),It(It({},a),{},{keyMetrics:It(It({},a.keyMetrics),{},{publish:[...l]})})):It(It({},a),{},{keyMetrics:It(It({},a.keyMetrics),{},{publish:[...a.keyMetrics.publish,c.metric]})})}case le.KEY_METRIC_SUBSCRIBE:{const l=a.keyMetrics.subscribe,d=l.findIndex(h=>h.userId===c.metric.userId&&h.type===c.metric.type);return d!==-1?(l[d]=It(It({},l[d]),c.metric),It(It({},a),{},{keyMetrics:It(It({},a.keyMetrics),{},{subscribe:[...l]})})):It(It({},a),{},{keyMetrics:It(It({},a.keyMetrics),{},{subscribe:[...a.keyMetrics.subscribe,c.metric]})})}case le.SET_CLOUD_PROXY_SERVER_MODE:return a.cloudProxyServerMode=c.mode,a;case le.RECORD_JOIN_CHANNEL_SERVICE:return typeof c.index!="number"?a.joinChannelServiceRecords=[...a.joinChannelServiceRecords,c.record]:(a.joinChannelServiceRecords[c.index]=It(It({},a.joinChannelServiceRecords[c.index]),c.record),a.joinChannelServiceRecords=[...a.joinChannelServiceRecords]),a;case le.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return a.joinChannelServiceRecords=[],a;case le.RESET_KEY_METRICS:return a.keyMetrics={publish:[],subscribe:[]},a;case le.SET_USE_P2P:return It(It({},a),{},{useP2P:c.val});case le.SET_TRANSPORT_TYPE:return It(It({},a),{},{p2pTransport:c.val});default:return a}}(this.state,r)}set sessionId(r){this.dispatch({type:le.SET_SESSION_ID,sessionId:r})}get sessionId(){return this.state.sessionId}set cid(r){this.state.cid=r}get cid(){return this.state.cid}set codec(r){this.state.codec=r}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(r){this.dispatch({type:le.SET_P2P_ID,p2pId:r})}get p2pId(){return this.state.p2pId}set dcId(r){this.dispatch({type:le.SET_DC_ID,dcId:r})}get dcId(){return this.state.dcId}set uid(r){this.dispatch({type:le.SET_UID,uid:r})}get uid(){return this.state.uid}set intUid(r){this.dispatch({type:le.SET_INT_UID,intUid:r})}get intUid(){return this.state.intUid}set pubId(r){this.dispatch({type:le.SET_PUB_ID,pubId:r})}get pubId(){return this.state.pubId}set cloudProxyServerMode(r){this.dispatch({type:le.SET_CLOUD_PROXY_SERVER_MODE,mode:r})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(r){this.dispatch({type:le.SET_USE_P2P,val:r})}get useP2P(){return this.state.useP2P}set p2pTransport(r){this.dispatch({type:le.SET_TRANSPORT_TYPE,val:r})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(r){this.state.hasStartJoinChannel=r}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(r){this.state.isABTestSuccess=r}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:le.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:le.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:le.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:le.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:le.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:le.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:le.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:le.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:le.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:le.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:le.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:le.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(r,a,c,l){this.dispatch({type:le.KEY_METRIC_PUBLISH,metric:It(It({trackId:r,type:a},c&&{publishStart:c}),l&&{publishEnd:l})})}subscribe(r,a,c,l,d,h,p){this.dispatch({type:le.KEY_METRIC_SUBSCRIBE,metric:It(It(It(It(It({userId:r,type:a},c&&{subscribeStart:c}),l&&{subscribeEnd:l}),d&&{firstFrame:d}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(r,a,c,l){r.forEach(d=>{this.dispatch({type:le.KEY_METRIC_SUBSCRIBE,metric:It(It(It({userId:d.userId,type:d.type},a&&{subscribeStart:a}),c&&{subscribeEnd:c}),l&&{firstFrame:l})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(r,a){r.service==="gateway"&&Array.isArray(r.urls)&&(r.urls=r.urls.map(c=>c.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof a!="number"?(this.dispatch({type:le.RECORD_JOIN_CHANNEL_SERVICE,record:It(It({},r),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(a<0||a>=this.state.joinChannelServiceRecords.length||this.dispatch({type:le.RECORD_JOIN_CHANNEL_SERVICE,record:r,index:a}),a)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:le.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:le.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(r){this.dispatch({type:le.AVOID_JOIN_START,avoidJoinStart:r})}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new xi("client-leave",this._clientId),this._publishMutex=new xi("client-publish",this._clientId),this._renewTokenMutex=new xi("client-renewtoken",this._clientId),this._subscribeMutex=new xi("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),v.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(qs," build: ").concat(YI,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{PI(t.clientRoleOptions),n=Object.assign({},t.clientRoleOptions)}catch(r){v.warning("[".concat(this._clientId,"] ").concat(r.toString()))}var i;this._statsCollector=new kg(this.store),this._statsCollector.onStatsException=(r,a,c)=>{v.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(r,", msg: ").concat(a,", uid: ").concat(c)),this.safeEmit(ce.EXCEPTION,{code:r,msg:a,uid:c})},this._statsCollector.onUploadPublishDuration=(r,a,c,l)=>{const d=this._users.find(h=>h.uid===r);d&&kt.peerPublishStatus(this._sessionId,{subscribeElapse:l,audioPublishDuration:a,videoPublishDuration:c,peer:d._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new G6(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Kn,httpRetryConfig:t.httpRetryConfig||Kn,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:n}),this._configDistribute=new Z6(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},ml("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new Ug(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,n,i,r){let a=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Be("JOIN_GATEWAY_USE_443PORT_ONLY",a),Be("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);const l=this._gateway.signal.websocket;return l instanceof bw&&(l.use443PortOnly=a,l.tryDoubleDomain=c),async function(d,h,p){ky.get(d)||ky.set(d,[]),My.get(d)||My.set(d,h),ec.get(d)||ec.set(d,0);const m=ky.get(d),S=My.get(d);if(!m||!S)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(ec.get(d)===S){const D=dg();m.push(D),await D.promise}ec.set(d,ec.get(d)+1);for(var R=arguments.length,O=new Array(R>3?R-3:0),A=3;A<R;A++)O[A-3]=arguments[A];const I=await p(...O);return ec.set(d,ec.get(d)-1),ec.get(d)===S-1&&m.length>0&&(m[0].resolve(),m.shift()),ec.get(d)===0&&(ky.set(d,[]),My.set(d,0),ec.set(d,0)),I}("client.join",U("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,n,i,r)}async join(t,e,n,i,r){const a=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const c=(Gy||Gy||(Gy=(window.location.protocol.split(":")[0]||"").toUpperCase(),Gy))==="HTTPS",l=lk()?window.isSecureContext:"Browser Not Support";(!lk()&&!c||!window.isSecureContext)&&v.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),v.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),kt.setAppId(t);try{if(!n&&n!==null)throw new J(P.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Si(n,"token",1,2047),Si(t,"appid",1,2047),uv(e),i&&dv(i),r&&Si(r,"optionalInfo",1,2047)}catch(A){throw kt.reportApiInvoke(rh(),{name:Wn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:Rn.TRACER}).onError(A),A}if(this._leaveMutex.isLocked&&(v.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),v.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const A=new J(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw kt.reportApiInvoke(rh(),{name:Wn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:Rn.TRACER}).onError(A),A}this._gateway.state="CONNECTING";const d=await c2({appId:t,cname:e,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new J(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const h=(d==null?void 0:d.sid)||rh();v.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(a)),this._sessionId||(this._sessionId=h,this.store.sessionId=this._sessionId);const p=kt.reportApiInvoke(h,{id:this._clientId,name:Wn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:Rn.TRACER}),m=Na(Na(Na({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:r,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!d},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:U("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(m.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(m.stringUid=i,this._uintUid?(m.uid=this._uintUid,this._uintUid=void 0):m.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(m.aesmode=this._encryptionMode,m.aespassword=await(async A=>{const I=function(W){const K=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),G=new Uint8Array(new ArrayBuffer(K.length));for(let Q=0;Q<K.length;Q+=1)G[Q]=K.charCodeAt(Q);return G}(),D=await window.crypto.subtle.importKey("spki",I,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),L=DI(A),V=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},D,L);return function(W){let K="";for(let G=0;G<W.length;G+=1)K+=String.fromCharCode(W[G]);return window.btoa(K)}(new Uint8Array(V))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new J(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(m.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const A=new TextEncoder,I=U("USE_PURE_ENCRYPTION_MASTER_KEY")?A.encode(m.appId+this._encryptionSecret+this._encryptionSecret):A.encode(m.appId+m.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(D,L,V){const W=await window.crypto.subtle.importKey("raw",L,"PBKDF2",!1,["deriveBits","deriveKey"]),K=D==="aes-128-gcm2"?128:256,G=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:Sk,hash:"SHA-256",salt:V},W,K+gH);return new Uint8Array(G).subarray(K/8)}(this._encryptionMode,I,ih(this._encryptionSalt)),this._encryptDataStreamKey=await async function(D,L,V){const W=await window.crypto.subtle.importKey("raw",L,"PBKDF2",!1,["deriveBits","deriveKey"]),K=D==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:Sk,hash:"SHA-256",salt:V},W,{name:"AES-GCM",length:K},!0,["encrypt","decrypt"])}(this._encryptionMode,I,ih(this._encryptionSalt))}else l?v.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):v.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,v.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:t,stringUid:m.stringUid});const S=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&S===this._sessionId&&kt.joinChannelTimeout(this._sessionId,5)},5e3);try{var R;let A;const I=m.cloudProxyServer;if(_t(R=["proxy3","proxy4","proxy5"]).call(R,I)){const K=U("PROXY_SERVER_TYPE3");Array.isArray(K)?m.proxyServer=K[0]:m.proxyServer=K}if(kt.setProxyServer(m.proxyServer),v.setProxyServer(m.proxyServer),this.store.requestAPStart(),d){if(v.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(m.stringUid?", ".concat(m.stringUid," => ").concat(d.intUid):""," ")),m.stringUid&&!m.uid&&(m.uid=d.intUid),A={gatewayInfo:d.ap.gatewayInfo},U("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&m.turnServer.mode==="auto")if(d.ap.proxyInfo.addresses.length===0)v.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const K=(await tU(d.ap.proxyInfo,d.ap.gatewayInfo.uid)).map(G=>({turnServerURL:G.address,tcpport:G.tcpport||Pi.tcpport,udpport:G.udpport||Pi.udpport,username:G.username||Pi.username,password:G.password||Pi.password,forceturn:!1,security:!0}));m.turnServer={mode:"manual",servers:K}}d2(d,m.stringUid)}else{if(m.stringUid&&!m.uid){let K;[K,A]=await Et.all([wU(m.stringUid,m,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,this.store),IU(m,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,!0,this.store)]),v.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(m.stringUid," => ").concat(K)),m.uid=K,A.gatewayInfo.uid=K,A.gatewayInfo.res.uid=K}else A=await IU(m,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new J(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(m,this._axiosCancelSource.token),this._configDistribute.on(bg.UPDATE_BITRATE_LIMIT,K=>{this._p2pChannel.updateBitrateLimit(K)}),this._configDistribute.on(bg.UPDATE_CLIENT_ROLE_OPTIONS,K=>{this._setClientRoleOptions(K)})},0),this._key=n||t;const D=A.gatewayInfo,L=m.uid?m.uid:D.uid;this._joinInfo=Na(Na({},m),{},{cid:D.cid,uid:L,vid:D.vid,apResponse:D.res,apGatewayAddress:D.apGatewayAddress,uni_lbs_ip:D.uni_lbs_ip,gatewayAddrs:D.gatewayAddrs}),this.store.intUid=L,this.store.cid=D.cid;const V=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new J(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));p.onSuccess(V),this._appId=t,this._channelName=m.cname,this._uid=V,this.store.uid=V,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Ni()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const W=m.stringUid?"string uid: ".concat(m.stringUid,",uid: ").concat(m.uid):"uid: ".concat(this._uid);return v.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(W)),setTimeout(()=>{v.startUpload()},5e3),this.store.joinEnd(),O=this,_t(dh).call(dh,O)||dh.push(O),this._cloudProxyServerMode==="disabled"&&Ae().supportWebCrypto&&U("ENABLE_PRELOAD")&&Zw(this._joinInfo),V}catch(A){const I=Array.isArray(A)?A[0]:A;throw I&&I.code===P.OPERATION_ABORTED?v.warning("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),I):v.error("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),I),I.code!==P.OPERATION_ABORTED&&this._numberOfJoinCount===a&&(this._gateway.state="DISCONNECTED",this._reset()),p.onError(I),I}var O}_joinGateway(){if(!this._joinInfo||!this._key)throw new J(P.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!U("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){v.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Ni()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const n=dh.indexOf(e);n!==-1&&dh.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return v.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Pe.LEAVE),v.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Gf))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new J(P.INVALID_PARAMS,"param list is empty");const n=t;if(this._gateway.role==="audience")throw new J(P.INVALID_OPERATION,"audience can not publish stream");for(const r of n){if(!(r instanceof Gf))throw new J(P.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&e)throw new J(P.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}v.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&n.forEach(r=>{const a=this._configDistribute.getBitrateLimit();r instanceof cn&&a&&r.setBitrateLimit(a.uplink)});try{await this._publishHighStream(n),v.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw v.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{i()}}async _publishDataChannel(t){He(t.id,"id",0,65535,!0),cl(t.ordered,"ordered"),Si(t.metadata,"metadata",0,512),v.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(r=>r.id===t.id)!==-1)throw new J(P.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new J(P.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&U("FORCE_TURN")&&!U("TURN_ENABLE_TCP")&&!U("TURN_ENABLE_UDP"))throw new J(P.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(r){return gU(r,!1)}(t),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw v.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new J(P.CREATE_DATACHANNEL_ERROR);try{await Et.all(i.map(r=>this._uid&&this._gateway.publishDataChannel(this._uid,r,!0))),await n._waitTillOpen()}catch(r){if(r.code!==P.DISCONNECT_P2P)throw r}}return v.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw v.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new J(P.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof Gf))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);v.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.sendExtensionMessage(kn.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.unpublish(i,this._uid),v.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(r=>"".concat(r.getTrackId()))))}}catch(i){throw v.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),v.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(n=>"".concat(n.id," "))," "));const e=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(t);n&&await this._gateway.unpublishDataChannel(n),v.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(i=>"".concat(i.id))))}catch(n){throw v.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{e&&e()}}async subscribe(t,e,n){if(!(t instanceof Ou)){const i=this.remoteUsers.find(r=>r.uid===t);if(!i)throw new J(P.INVALID_REMOTE_USER,"user is not in the channel");t=i}return e==="datachannel"?this._subscribeDataChannel(t,n):this._subscribe(t,e)}async presubscribe(t,e){if(ei(e,"mediaType",["audio","video"]),this.store.useP2P)throw new J(P.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new J(P.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=e===wt.AUDIO,i=e===wt.VIDEO,r=await this._subscribeMutex.lock();try{const{ssrcId:a,ortc:c,rtxSsrcId:l,cname:d,uint_id:h}=await this._gateway.presubscribe(t,e,!0);if(a==null)throw new J(P.UNEXPECTED_RESPONSE,"no ssrc id");let p=this._users.find(S=>S.uid===t);p||(p=new Ou(t,h||t),p._is_pre_created=!0,this._users.push(p)),d&&(p._cname=d),p._uintid||(p._uintid=h||t),n&&(p._audioSSRC=a,p._audio_pre_subscribed=!0,c&&(p._audioOrtc=c)),i&&(p._videoSSRC=a,p._video_pre_subscribed=!0,c&&(p._videoOrtc=c),l!=null&&(p._rtxSsrcId=l)),v.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(a)),await this._p2pChannel.subscribe(p,e,a,l,c);const m=n?p._audioTrack:p._videoTrack;if(!m)throw new J(P.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(p._trust_audio_stream_added_state_=!0,p._audio_added_=!0),i&&(p._trust_video_stream_added_state_=!0,p._video_added_=!0),m}catch(a){throw v.error("[".concat(this._clientId,"] presub user ").concat(t," error"),a),a}finally{r()}}async _subscribeDataChannel(t,e){var n;if(He(e,"channelId",0,65535,!0),!this._joinInfo)throw new J(P.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===t))throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new J(P.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new J(P.INVALID_REMOTE_USER,"user is not published");const r=(n=t._dataChannels)===null||n===void 0?void 0:n.find(l=>l.id===e);if(!r)throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new J(P.REMOTE_USER_IS_NOT_PUBLISHED);const a=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const l=await this._p2pChannel.subscribeDataChannel(t,[r]);if(l&&_t(l).call(l,r.id))try{var c;if(typeof r._originDataChannelId!="number")throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new J(P.CREATE_DATACHANNEL_ERROR);const d={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:(c=r.metadata)!==null&&c!==void 0?c:""};await this._gateway.subscribeDataChannel(t.uid,d,!0),await r._waitTillOpen()}catch(d){if((d==null?void 0:d.code)!==P.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[r]),d;await this._p2pChannel.unsubscribeDataChannel(t,[r]),this._p2pChannel.setPendingRemoteDataChannel(t,r.id)}return v.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),r}finally{a()}}async _p2pSubscribe(t,e,n){if(ei(e,"mediaType",["audio","video"]),!this._joinInfo)throw new J(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===t)){const a=new J(P.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),a}if(!t.hasAudio&&!t.hasVideo){const a=new J(P.INVALID_REMOTE_USER,"user is not published");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),a}if(!n&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const a=new J(P.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),a}const r=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const c=e==="audio"?t._audioSSRC:t._videoSSRC,l=e==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,e,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,e,c,l)}catch(c){throw c}v.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(c=>{v.warning("[".concat(this._clientId,"] auto set fallback failed"),c)});const a=e==="audio"?t._audioTrack:t._videoTrack;if(!a)throw new J(P.UNEXPECTED_ERROR,"can not find remote track in user object");return a}catch(a){throw v.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),a),a}finally{r()}}async _subscribe(t,e,n){if(this.store.useP2P)return this._p2pSubscribe(t,e);if(ei(e,"mediaType",["audio","video"]),!this._joinInfo)throw new J(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===t)){const h=new J(P.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),h}if(!t.hasAudio&&!t.hasVideo){const h=new J(P.INVALID_REMOTE_USER,"user is not published");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),h}if(!(n||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const h=new J(P.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),h}let r=e==="audio"?t._audioSSRC:t._videoSSRC,a=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?wt.AUDIO:wt.VIDEO,ssrcId:r};const d=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const p=e==="audio"?t._audioSSRC:t._videoSSRC;p!==void 0&&p!==r&&(r=p,a=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?wt.AUDIO:wt.VIDEO,ssrcId:r}),Fi.markSubscribeStart(this.store.clientId,r),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,r,c,a);try{this._p2pChannel.isPreSubScribe(r)||await this._gateway.subscribe(t.uid,l,!0)}catch(m){if((m==null?void 0:m.code)!==P.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),m;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(p){throw this._p2pChannel.reportSubscribeEvent(!1,p==null?void 0:p.code,t,e),p}v.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(p=>{v.warning("[".concat(this._clientId,"] auto set fallback failed"),p)});const h=e==="audio"?t._audioTrack:t._videoTrack;if(!h)throw new J(P.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw v.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),h),h}finally{d()}}async massSubscribe(t){if(ll(t,"subscribeList"),!this._joinInfo)throw new J(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),n=new Map,i=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(l=>{let{user:d,mediaType:h}=l;return"user: ".concat(d==null?void 0:d.uid,", mediaType: ").concat(h)}).join("; ")));const r=(t=[...t]).map(l=>{let{user:d,mediaType:h}=l;return{user:d,mediaType:h}}),a=await this._p2pChannel.globalLock();try{var c;for(let d=t.length-1;d>=0;d--){const h=t[d],{user:p,mediaType:m}=h;if(ei(m,"mediaType",["audio","video"]),!p){const A=new J(P.INVALID_PARAMS,"user property does not exist in subscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),A}if(!this._users.find(A=>A===p)){const A=new J(P.INVALID_REMOTE_USER,"user is not in the channel");v.error("[".concat(this._clientId,"] can not massSubscribe ").concat(p.uid,", this user is not in the channel")),r[d].error=A,t.splice(d,1);continue}if(m==="audio"&&(!p.hasAudio||p._audioSSRC===void 0)||m==="video"&&(!p.hasVideo||p._videoSSRC===void 0)){const A=new J(P.REMOTE_USER_IS_NOT_PUBLISHED);v.error("[".concat(this._clientId,"] can not subscribe ").concat(p.uid," with mediaType ").concat(m,", remote user is not published")),r[d].error=A,t.splice(d,1);continue}const R=ai.Video|ai.LwoVideo,O=n.get(p);if(O){if(m==="video"?O&R:O&ai.Audio){t.splice(d,1),v.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(p.uid,", mediaType:").concat(m," twice"));continue}n.set(p,O|(m==="video"?R:ai.Audio))}else n.set(p,m==="video"?R:ai.Audio)}for(let d=t.length-1;d>=0;d--){const h=t[d],{user:p,mediaType:m}=h,S=ai.Video|ai.LwoVideo;if(this._p2pChannel.hasRemoteMedia(p,m)){await this._p2pChannel.unmuteRemoteNoLock(p,m);const R=n.get(p);n.set(p,m==="video"?R^S:R^ai.Audio),t.splice(d,1)}}this.store.massSubscribe(t.map(d=>({userId:d.user.uid,type:d.mediaType})),e);let l=ds(c=Array.from(n.entries())).call(c,(d,h)=>{let[p,m]=h;if(m===0)return d;const S={stream_id:p.uid,stream_type:m};return m&ai.Audio&&(S.audio_ssrc=p._audioSSRC),m&ai.Video&&(S.video_ssrc=p._videoSSRC),d.push(S),d},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(h=>{let{user:p,mediaType:m}=h;return{user:p,mediaType:m,ssrcId:m===wt.VIDEO?p._videoSSRC:p._audioSSRC,rtxSsrcId:m===wt.VIDEO?p._rtxSsrcId:void 0}}));const d=new Map;if(l=l.filter(h=>h.video_ssrc&&!this._p2pChannel.isPreSubScribe(h.video_ssrc)||h.audio_ssrc&&!this._p2pChannel.isPreSubScribe(h.audio_ssrc)||!h.video_ssrc&&!h.audio_ssrc),l.length>0){const h=await this._gateway.subscribeAll(l,!0);((h==null?void 0:h.users)||[]).forEach(p=>{let{stream_id:m,video_error_code:S,audio_error_code:R,error_code:O}=p;(S||R||O)&&d.set(m,{video_error_code:S,audio_error_code:R,error_code:O})})}if(Array.from(d.entries()).length>0){const h=[];Array.from(d.entries()).forEach(p=>{let[m,S]=p;const R=this.remoteUsers.find(O=>O.uid===m);if(R){let O;S.error_code||S.video_error_code&&S.audio_error_code?O=void 0:S.video_error_code?O=wt.VIDEO:S.audio_error_code&&(O=wt.AUDIO),h.push({user:R,mediaType:O})}}),h.length>0&&await this._p2pChannel.massUnsubscribeNoLock(h)}for(const h of r){const p=d.get(h.user.uid);if(p){const m=p.error_code||h.mediaType==="audio"&&p.audio_error_code||h.mediaType==="video"&&p.video_error_code;if(m){const S=Ag(m);v.error("user:".concat(h.user.uid," mediaType:").concat(h.mediaType," has massSubscribe error ").concat(S.desc)),h.error=new J(P.SUBSCRIBE_FAILED,"code ".concat(m,": ").concat(S.desc))}}h.error||(h.mediaType==="video"?h.track=h.user.videoTrack:h.track=h.user.audioTrack)}return this.store.massSubscribe(r.filter(h=>!h.error).map(h=>({userId:h.user.uid,type:h.mediaType})),void 0,Date.now()),r.forEach(h=>{var p;kt.subscribe(this.store.sessionId,{succ:!!h.error,ec:((p=h.error)===null||p===void 0?void 0:p.code)||null,video:h.mediaType===wt.VIDEO,audio:h.mediaType===wt.AUDIO,peerid:h.user.uid,subscribeRequestid:h.mediaType===wt.VIDEO?h.user._videoSSRC:h.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(h.user._videoSSRC)},!0)}),v.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(h=>{let{user:p,mediaType:m}=h;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(m)}).join("; "))),r}catch(d){throw await this._p2pChannel.massUnsubscribeNoLock(t),d}}finally{a(),i()}}async unsubscribe(t,e,n){if(!(t instanceof Ou)){const a=this.remoteUsers.find(c=>c.uid===t);if(!a)throw new J(P.INVALID_REMOTE_USER,"user is not in the channel");t=a}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,n)}else await this._unsubscribeDataChannel(t,n);if(e&&ei(e,"mediaType",["audio","video"]),!this._joinInfo)throw new J(P.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(a=>a===t)){const a=new J(P.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),a}v.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const r=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,e);else{const a=await this._p2pChannel.unsubscribe(t,e);a&&await this._gateway.unsubscribe(a,t.uid),e&&e!=="audio"||(t._audio_pre_subscribed=!1),e&&e!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&By(this._users,t),v.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(a){if(a.code===P.DISCONNECT_P2P)return void v.warning("disconnecting p2p, abort unsubscribe request.");throw v.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),a.toString()),a}finally{r()}}async _unsubscribeDataChannel(t,e){if(e&&He(e,"id",0,65535,!0),!this._joinInfo)throw new J(P.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(r=>r===t)){const r=new J(P.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),r}let i;if(typeof e=="number"){const r=t._dataChannels.find(a=>a.id===e);r&&(i=[r])}else i=t._dataChannels;if(i===void 0){const r=new J(P.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),r}v.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i.map(r=>r.id)));try{const r=await this._p2pChannel.unsubscribeDataChannel(t,i);r&&await this._gateway.unsubscribeDataChannel(r,t.uid),v.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(r))}catch(r){if(r.code===P.DISCONNECT_P2P)return void v.warning("disconnecting p2p, abort unsubscribe request.");throw v.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),r.toString()),r}}async massUnsubscribe(t){if(ll(t,"unsubscribeList"),!this._joinInfo)throw new J(P.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");v.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(n=>{let{user:i,mediaType:r}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(r,";")}).join())),t=[...t];const e=new Map;for(let n=t.length-1;n>=0;n--){const{user:i,mediaType:r}=t[n];if(!i){const l=new J(P.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),l}if(ei(r,"mediaType",["video","audio",void 0]),!this._users.find(l=>l===i)){v.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),t.splice(n,1);continue}const c=ai.Video|ai.LwoVideo;if(e.has(i)){const l=e.get(i);let d;switch(r){case"video":d=l&c;break;case"audio":d=l&ai.Audio;break;default:d=l&(ai.Audio|c)}if(d){v.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(r," twice.")),t.splice(n,1);continue}r?r==="audio"?e.set(i,l|ai.Audio):r==="video"&&e.set(i,l|c):e.set(i,l|ai.Audio|c)}else r?r==="audio"?e.set(i,ai.Audio):r==="video"&&e.set(i,c):e.set(i,ai.Audio|c)}try{const n=await this._p2pChannel.massUnsubscribe(t);n&&await this._gateway.massUnsubscribe(n),v.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(i=>{let{user:r,mediaType:a}=i;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(a,";")}).join()))}catch(n){if(n.code===P.DISCONNECT_P2P)return void v.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw v.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(t){(function(n){if(!n)throw new Z(P.INVALID_PARAMS);Tn(n.width)||OI(n.width,"streamParameter.width"),Tn(n.height)||OI(n.height,"streamParameter.height"),Tn(n.framerate)||OI(n.framerate,"streamParameter.framerate"),Tn(n.bitrate)||He(n.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&v.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),v.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,ct.LocalVideoLowTrack)}async enableDualStream(){if(!Ae().supportDualStream)throw kt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new J(P.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new J(P.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw kt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,kt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),v.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new J(P.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(ct.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw kt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,kt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),v.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(i){ei(i,"role",["audience","host"])}(t),e&&PI(e),this.mode==="rtc"||this.mode==="p2p")throw v.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new J(P.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&t==="host")throw new J(P.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new J(P.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==n&&U("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,e),this._config.role=t,this._gateway.reconnect("recover",Di.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,e),this._config.role=t),v.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let e=!1;try{t&&PI(t),await this._gateway.setClientRole(this._config.role,t),e=!0}catch{}finally{v.info("[".concat(this._clientId,"] set client role options ").concat(e?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const n=e.timestamp-Date.now();return Math.abs(n)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(Si(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new J(P.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new J(P.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,kt.setProxyServer(this._proxyServer),v.setProxyServer(this._proxyServer),v.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new J(P.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new J(P.INVALID_OPERATION,"You have already set the proxy")}if(_g(t))return this._turnServer={servers:t,mode:"original-manual"},void v.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(n=>n.urls).join(","),"."));t.forEach(n=>QP(n)),this._turnServer={servers:t,mode:"manual"},v.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new J(P.INVALID_OPERATION,"you should set license before join channel");if(Si(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new J(P.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,v.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new J(P.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new J(P.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let n;switch(t===void 0&&(t=3),t){case 1:case 2:throw new J(P.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new J(P.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new J(P.INVALID_OPERATION,"Stop proxy server after leave channel");kt.setProxyServer(),v.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new J(P.INVALID_PARAMS,"accessPoints is required.");ll(t.accessPoints.serverList,"accessPoints.serverList"),Si(t.accessPoints.domain,"accessPoints.domain");const e=(S,R)=>{He(S,R,0,65535,!0)};let n=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),n=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new J(P.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");U("CLOSE_AFB_FOR_LOCAL_AP")&&(Be("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Be("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=t.accessPoints.domain,a=t.accessPoints.serverList.map(S=>i.test(S)?"".concat(S.replace(/\./g,"-"),".").concat(r):S),c=a.map(S=>"".concat(S,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Be("WEBCS_DOMAIN",c),Be("WEBCS_DOMAIN_BACKUP_LIST",c),Be("GATEWAY_DOMAINS",[r]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(ll(t.report.hostname,"report.hostname"),Be("EVENT_REPORT_DOMAIN",t.report.hostname[0]),Be("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(Be("EVENT_REPORT_DOMAIN",a[0]),Be("EVENT_REPORT_BACKUP_DOMAIN",a[1]||a[0]));let l=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),l=t.report.port),Be("STATS_COLLECTOR_PORT",l),t.report?Be("ENABLE_EVENT_REPORT",!0):Be("ENABLE_EVENT_REPORT",!1);let d="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(ll(t.log.hostname,"log.hostname"),d=t.log.hostname[0]):d=a[0];let h=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),h=t.log.port),Be("LOG_UPLOAD_SERVER","".concat(d,":").concat(h));let p=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(ll(t.cds.hostname,"cds.hostname"),p=t.cds.hostname):p=a;let m=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),m=t.cds.port),Be("CDS_AP",p.map(S=>"".concat(S,":").concat(m))),t.cds?Be("ENABLE_CONFIG_DISTRIBUTE",!0):Be("ENABLE_CONFIG_DISTRIBUTE",!1),v.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(ll(t,"serverList"),Si(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new J(P.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(e):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Be("WEBCS_DOMAIN",t),Be("WEBCS_DOMAIN_BACKUP_LIST",t),Be("GATEWAY_DOMAINS",[e]),Be("EVENT_REPORT_DOMAIN",t[0]),Be("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),Be("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),v.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(ei(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw v.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else v.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){ei(e,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const n=this._users.find(i=>i.uid===t);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw v.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}v.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){ei(e,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(n){throw v.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}v.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,n,i){(function(a){ei(a,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Si(e,"secret");const r=["aes-128-gcm2","aes-256-gcm2"];if(_t(r).call(r,t)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new J(P.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new J(P.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(cl(i,"encryptDataStream"),!_t(r).call(r,t))throw new J(P.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||v.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=Ru(n))}async renewToken(t){if(Si(t,"token",1,2047),!this._key||!this._joinInfo)throw new J(P.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const n=await this._renewTokenMutex.lock();try{if(U("USE_NEW_TOKEN")){v.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await Q6(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn);v.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:i})}else v.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});v.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=e,this._joinInfo.token=e,v.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?v.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(ce.VOLUME_INDICATOR,t)},U("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new J(P.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new J(P.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new J(P.LIVE_STREAMING_TASK_CONFLICT);const n=e?hl.TRANSCODE:hl.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(t,n)}setLiveTranscoding(t){return this._createLiveStreamingClient(hl.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(t));if(!e.length)throw new J(P.INVALID_PARAMS,"can not find live streaming url to stop");await Et.all(e.map(n=>n&&n.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){MU(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){MU(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof Ug&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var e;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new J(P.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const r=new TextEncoder;t.payload=r.encode(t.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&_t(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(i=!0,t.payload=await async function(r,a,c){var l;const d=ds(l=Array.from(c)).call(l,(A,I)=>A+I,0),h={serverTs:0,seq:SH++,length:c.length,checkSum:d},p=new Uint8Array(sk(d,2)),m=new ArrayBuffer(Mf),S=new DataView(m);S.setUint32(0,h.serverTs),S.setUint16(4,h.seq),S.setUint16(6,h.length),S.setUint16(8,h.checkSum);const R=16-c.length%16;c=tk(c,new Uint8Array(R));const O=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:gk,additionalData:p},a,c);return tk(new Uint8Array(m),new Uint8Array(O))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new J(P.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Yt.DATA_STREAM,{payload:Ru(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-aW},!n)}sendMetadata(t){if(!this._joinInfo)throw new J(P.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new J(P.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Yt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Ru(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(wH),!this._joinInfo)throw new J(P.INVALID_OPERATION,"can not send custom report, not joined");await kt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){ei(e.spatialLayer,"spatialLayer",[0,1,2,3]),ei(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(n){throw v.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(t){const{apRTM:e=!1,rtmFlag:n}=t;if(cl(e,"apRTM"),He(n,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=n,v.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(v.debug("[".concat(this._clientId,"] reset client")),function(t){const e=zf.indexOf(t);e!==-1&&zf.splice(e,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=vr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&u2(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&kt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new xi("client-publish",this._clientId),this._subscribeMutex=new xi("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){var n;const i=t||rh();t?v.debug("[".concat(this._clientId,"] new Session ").concat(i)):v.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const r=t?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,kt.addSid(i);const a={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(e==null?void 0:e.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:r,clientRole:this.role==="audience"?2:1};kt.sessionInit(this._sessionId,Na({cname:e.channel,appid:e.appId},a)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new J(P.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&U("FORCE_TURN")&&!U("TURN_ENABLE_TCP")&&!U("TURN_ENABLE_UDP"))throw new J(P.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");v.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(kn.PUBLISH,i,!0)}catch(r){throw n.throw(r),r}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(a){if(a.code!==P.DISCONNECT_P2P)throw n.throw(a),a}await n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const r of t)r instanceof cn&&r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig).catch(a=>{v.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!r.muted&&r.enabled||await this._p2pChannel.muteLocalTrack(r)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,t),(n==null?void 0:n.code)===P.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new J(P.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new J(P.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));v.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(a){if(a.code!==P.DISCONNECT_P2P)throw n.throw(a),a}n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===P.WS_ABORT)return;throw n}}_createLiveStreamingClient(t){const e=()=>{if(!this._joinInfo||!this._appId)return new J(P.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},ml("LiveStreaming").create(i));var i;return n.onLiveStreamError=(r,a)=>{kt.reportApiInvoke(this._sessionId,{name:Wn.ON_LIVE_STREAM_ERROR,options:[r,a],tag:Rn.TRACER}).onSuccess(),this.safeEmit(ce.LIVE_STREAMING_ERROR,r,a)},n.onLiveStreamWarning=(r,a)=>{kt.reportApiInvoke(this._sessionId,{name:Wn.ON_LIVE_STREAM_WARNING,options:[r,a],tag:Rn.TRACER}).onSuccess(),this.safeEmit(ce.LIVE_STREAMING_WARNING,r,a)},n.on(vw.REQUEST_WORKER_MANAGER_LIST,(r,a,c)=>{if(!this._joinInfo)return c(new J(P.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(l,d,h,p){const m=U("UAP_AP").slice(0,U("AJAX_REQUEST_CONCURRENT")).map(S=>d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(S+"/api/v1?action=uap"):"https://".concat(S,"/api/v1?action=uap"));return await K6(m,l,d,h,p)})(r,this._joinInfo,this._axiosCancelSource.token,Kn).then(a).catch(c)}),n};return t===hl.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new J(P.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:n}},ml("ChannelMediaRelay").create(t));i.on("state",r=>{r===Fr.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(ce.CHANNEL_MEDIA_RELAY_STATE,r)}),i.on("event",r=>{this.safeEmit(ce.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(r,a)=>{var c;r==="resolution"&&((c=this._channelMediaRelayClient)===null||c===void 0||c.setVideoProfile(a))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:n,deleted:i}=t,r=[];if(e){const a=[];this._users.forEach(c=>{c._dataChannels.forEach(l=>{n.every(d=>d.uid!==c._uintid||d.stream_id!==l.id)&&a.push({uid:c._uintid,stream_id:l.id,ordered:l.ordered,max_retrans_times:l.maxRetransmits,metadata:l.metadata})})}),a.length>0&&this._handleUpdateDataChannel({added:[],deleted:a})}Array.isArray(n)&&n.length>0&&n.forEach(a=>{const{uid:c,stream_id:l,ordered:d,max_retrans_times:h,metadata:p}=a,m=this._users.find(S=>S._uintid===c);if(!m)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(v.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),_t(r).call(r,m)||r.push(m),m._uintid||(m._uintid=c),m._dataChannels.findIndex(S=>S.id===a.stream_id)===-1){const S={id:l,ordered:!!d,maxRetransmits:h,metadata:p},R=function(O){return gU(O,!0)}(S);m._dataChannels.push(R),v.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published datachannel")),e||this.safeEmit(ce.USER_PUBLISHED,m,"datachannel",S)}this._p2pChannel.hasPendingRemoteDataChannel(m,a.stream_id)&&(v.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(m.uid," after reconnect.")),this._subscribeDataChannel(m,a.stream_id).catch(S=>{v.error("[".concat(this._clientId,"] resubscribe datachannel error"),S.toString())}))}),e&&(this.safeEmit(ce.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(a=>{const{uid:c,stream_id:l}=a,d=this._users.find(p=>p._uintid===c);if(!d)return void v.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const h=d._dataChannels.find(p=>p.id===a.stream_id);h&&(v.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(d,[h]).then(p=>{if(d._dataChannels=d._dataChannels.filter(m=>m!==h),p)return this._gateway.unsubscribeDataChannel(p,d.uid)}),v.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(h.id)),this.safeEmit(ce.USER_UNPUBLISHED,d,"datachannel",h._config))})}_handleRemoveDataChannels(t){const e=this._users.find(n=>n.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){v.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const n=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(i=>{this.safeEmit(ce.USER_UNPUBLISHED,e,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,e.uid)}),n()}}else v.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(fi.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void v.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();Object.keys(e).forEach(i=>{const{value:r,type:a,expires:c}=e[i];c&&c<=n||a||_w()||!Object.prototype.hasOwnProperty.call(Ky,i)||(go[i]=r,on[i]=r,v.debug("Update gateway parameters from config distribute",i,r))})}catch(e){v.error("Error update config from local cache",e.message)}})()}),this._gateway.on(fi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(fi.CONNECTION_STATE_CHANGE,(t,e,n)=>{var i;if(n===Pe.FALLBACK)return;const r=()=>{this.safeEmit(ce.CONNECTION_STATE_CHANGE,t,e,n)};if(kt.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:Wn.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:Rn.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:n})),v.info("[".concat(this._clientId,"] signal connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void r();if(t==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._is_pre_created||(c._audio_pre_subscribed||(c._audioSSRC=void 0,c._audioOrtc=void 0),c._video_pre_subscribed||(c._videoSSRC=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),c._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var a;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(d=>{v.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),d)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(d=>{v.warning("[".concat(this._clientId,"] auto set remote stream type failed"),d)})}),this._remoteDefaultVideoStreamType!==void 0&&((a=this._joinInfo)===null||a===void 0?void 0:a.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{v.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{v.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{v.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,wt.AUDIO,!1)),c._trust_video_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,wt.VIDEO,!1)),c._trust_audio_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(v.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}r()}),this._gateway.on(fi.REQUEST_NEW_GATEWAY_LIST,async(t,e)=>{if(!this._joinInfo)return e(new J(P.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const i=await c2(Na(Na({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,d2(i),this._joinInfo.preload=!0):(n=await Bw(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const r=[];n.gatewayInfo.gatewayAddrs.forEach(a=>{let{address:c}=a;const[l,d]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:l,port:d}):r.push({host:l,port:d})}),t(r)}catch(n){e(n)}}),this._gateway.on(fi.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(ce.NETWORK_QUALITY,t)}),this._gateway.on(fi.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(ce.STREAM_TYPE_CHANGED,t,e),kt.reportApiInvoke(this._sessionId,{name:Wn.STREAM_TYPE_CHANGE,options:[t,e],tag:Rn.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.on(fi.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(fi.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,n)=>{try{let i=await this._p2pChannel.getEstablishParams();U("ENABLE_PREALLOC_PC")&&i||(i=await this._p2pChannel.startP2PConnection(t)),e(i)}catch(i){n(i)}}),this._gateway.on(fi.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;let n;t.attributes?n=t.attributes.userAttributes.preSubSsrcs:v.debug("no attributes in joinResponse");const i=aU(t.ortc,e,n);this._p2pChannel.connect(i)}),this._gateway.on(fi.PRE_CONNECT_PC,async t=>{const{candidates:e,fingerprint:n}=t;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){var i;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:r,cid:a}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(a,"_").concat(r),icePwd:"".concat(a,"_").concat(r)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=U("FINGERPRINT"))!==null&&i!==void 0?i:n}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(ue.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(ue.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(ue.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(ue.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(ue.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(ue.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(ue.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(ue.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(ue.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,wt.AUDIO,!0)),this._gateway.signal.on(ue.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,wt.AUDIO,!1)),this._gateway.signal.on(ue.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,wt.VIDEO,!0)),this._gateway.signal.on(ue.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,wt.VIDEO,!1)),this._gateway.signal.on(ue.RECEIVE_METADATA,t=>{const e=ih(t.metadata);this.safeEmit(ce.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(ue.ON_DATA_STREAM,async t=>{var e;if(!t)return;let n=ih(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&_t(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(t.payload.length<Mf)throw new J(P.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Mf));n=await async function(a,c,l){const d=l.subarray(0,Mf),h=d.slice(8,Mf),p=(h[0]<<8)+h[1],m=(d[6]<<8)+d[7],S=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:a,tagLength:gk,additionalData:new Uint8Array(sk(p,2))},c,l.subarray(Mf));return new Uint8Array(S).subarray(0,m)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(t.ordered||t.syncWithAudio){const r=this._p2pChannel.getStats(),a=this.remoteUsers.find(l=>l.uid===t.uid),c=r==null?void 0:r.audioRecv.find(l=>l.ssrc===(a==null?void 0:a._audioSSRC));i=c==null?void 0:c.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),cW(Na(Na({},t),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(ue.ON_CRYPT_ERROR,()=>{Tu(()=>{v.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(ce.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(ue.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{v.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Pe.TOKEN_EXPIRE),this.safeEmit(ce.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(ue.ON_STREAM_FALLBACK_UPDATE,t=>{v.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(ce.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(ue.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),v.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(ue.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(ue.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(qt.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case Yt.PUBLISH:{if(!e)return;const r=e.ortc;if(r){var n,i;const a=r.some(d=>{let{stream_type:h}=d;return h===Me.Audio}),c=r.some(d=>{let{stream_type:h}=d;return h!==Me.Audio}),l=r.some(d=>{let{stream_type:h}=d;return h===Me.Screen||h===Me.ScreenLow});e.state==="offer"&&kt.publish(this._joinInfo.sid,{eventElapse:Fi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:P.TIMEOUT,audio:a,video:c,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:a?(n=r.find(d=>{let{stream_type:h}=d;return h===Me.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:c?(i=r.find(d=>{let{stream_type:h}=d;return h!==Me.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case Yt.SUBSCRIBE:e&&kt.subscribe(this._joinInfo.sid,{succ:!1,ec:P.TIMEOUT,audio:e.stream_type===wt.AUDIO,video:e.stream_type===wt.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:Fi.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on(ue.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(ue.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;U("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(i=>!hh(i.string_id||i.stream_id,this.channelName)));const e=[],n=[];for(const i of t.users){let r=this._users.find(p=>p._uintid===i.stream_id);r?r._trust_in_room_=!0:(r=new Ou(i.string_id||i.stream_id,i.stream_id),this._users.push(r),this.getListeners(ce.PUBLISHED_USER_LIST).length===0&&(v.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(ce.USER_JOINED,r)));const a=ai.Audio&i.stream_type,c=(ai.Video|ai.LwoVideo)&i.stream_type,l=(65280&i.stream_type)!=0,d=a&&r.hasAudio,h=c&&r.hasVideo;c&&(r._trust_video_stream_added_state_=!0,r._video_added_=!0,r._videoSSRC=i.video_ssrc,r._rtxSsrcId=i.video_rtx),a&&(r._trust_audio_stream_added_state_=!0,r._audio_added_=!0,r._audioSSRC=i.audio_ssrc),a&&!d&&this.getListeners(ce.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published audio")),this.safeEmit(ce.USER_PUBLISHED,r,"audio")),c&&!h&&this.getListeners(ce.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published video")),this.safeEmit(ce.USER_PUBLISHED,r,"video")),(a&&!d||c&&!h||l)&&e.push(r),c&&this._p2pChannel.hasPendingRemoteMedia(r,"video")&&n.push({user:r,mediaType:"video"}),a&&this._p2pChannel.hasPendingRemoteMedia(r,"audio")&&n.push({user:r,mediaType:"audio"})}n.length>0&&(v.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{v.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(ce.PUBLISHED_USER_LIST).length>0?U("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(v.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(i=>i.uid).join(", "))),this.safeEmit(ce.PUBLISHED_USER_LIST,e)):v.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(ue.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof Ug&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(n=>n.toLowerCase()).filter(n=>{var i;return _t(i=Object.keys(Yy)).call(i,n)}))})}_handleP2PEvents(){this._gateway.signal.on(ue.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(kn.PUBLISH,(t,e,n)=>{const{uid:i}=t;t.forEach(r=>{const{kind:a,ssrcs:c,mid:l,isMuted:d}=r;this._handleP2PAddAudioOrVideoStream(a,i,c[0].ssrcId,l);const h=this._users.find(p=>p.uid===i);return h&&this.store.useP2P?this._p2pChannel.mockSubscribe(h,a,c[0].ssrcId,l).then(()=>{e()}).catch(n):e(),this._handleMuteStream(i,a,!!d)})}),this._gateway.signal.on(kn.CALL,async(t,e,n)=>{if(this.store.useP2P)try{var i;e(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},t))}catch(r){n(r)}}),this._gateway.signal.on(qt.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(kn.UNPUBLISH,async(t,e,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:r}=t,a=this._users.find(c=>c.uid===r);if(!a)return v.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void e();try{i.forEach(async c=>{let{stream_type:l}=c;const d=l===Me.Audio?wt.AUDIO:wt.VIDEO;await this._p2pChannel.unsubscribe(a,d),this._handleMuteStream(r,d,!0)}),e()}catch(c){n(c)}}}),this._gateway.signal.on(kn.CONTROL,async(t,e)=>{const{action:n}=t;switch(n){case Cu.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,wt.VIDEO,!0);break;case Cu.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,wt.AUDIO,!0);break;case Cu.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,wt.VIDEO,!1);break;case Cu.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,wt.AUDIO,!1)}}),this._gateway.signal.on(kn.RESTART_ICE,async(t,e,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:r}=t;i!==pr.SEND_ONLY||r?e(await this._p2pChannel.restartICE(i,r)):(this._p2pChannel.handleDisconnect(i),e())}catch(i){n(i)}}),this._gateway.signal.on(kn.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:e,direction:n}=t;this._p2pChannel.addRemoteCandidate(e,n)}}),this._p2pChannel.on(jt.RequestP2PRestartICE,async(t,e,n)=>{try{const{direction:i}=t;e(await this._gateway.sendExtensionMessage(kn.RESTART_ICE,t,i===pr.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(jt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(kn.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(jt.RequestP2PMuteLocal,async(t,e,n)=>{try{await this._gateway.sendExtensionMessage(kn.CONTROL,t,!0),e()}catch(i){n(i)}}),this._p2pChannel.on(jt.RequestP2PUnmuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===P.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(jt.RequestP2PMuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===P.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(jt.StateChange,(t,e)=>{e===ke.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(jt.PeerConnectionStateChange,t=>{const e=this._peerConnectionState;t!==e&&(this.safeEmit(ce.PEERCONNECTION_STATE_CHANGE,t,e),this._peerConnectionState=t)}),this._p2pChannel.on(jt.RequestMuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===P.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(jt.RequestUnmuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===P.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(jt.RequestRePublish,(t,e,n)=>{this.publish(t,!1).then(e).catch(n)}),this._p2pChannel.on(jt.RequestRePublishDataChannel,(t,e,n)=>{Et.all(t.map(async i=>{const r=await this._p2pChannel.publishDataChannel([i]);try{r.forEach(a=>{this._uid&&this._gateway.publishDataChannel(this._uid,a,!0)})}catch(a){if(a.code!==P.DISCONNECT_P2P)throw a}})).then(e).catch(n)}),this._p2pChannel.on(jt.RequestReSubscribe,async(t,e,n)=>{try{for(const{user:i,kind:r}of t)r===wt.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");e()}catch(i){n(i)}}),this._p2pChannel.on(jt.RequestUpload,(t,e)=>{this._gateway.upload(t,e)}),this._p2pChannel.on(jt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(jt.MediaReconnectStart,t=>{this.safeEmit(ce.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(jt.MediaReconnectEnd,t=>{this.safeEmit(ce.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(jt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(jt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const e=await this._p2pChannel.restartICE(t),n=await e.next();if(n.done)return;const i=n.value;let r;try{r=await this._gateway.restartICE({iceParameters:i})}catch(c){return void e.throw(c)}const{iceParameters:a}=function(c){const l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(r);await e.next({remoteIceParameters:a})}),this._p2pChannel.on(jt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(jt.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:r,gatewayAddress:a}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:i}),c=aU(r,a);await this._p2pChannel.connect(c),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(jt.RequestUnpublishForReconnectPC,async(t,e,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):n()}),this._p2pChannel.on(jt.P2PLost,()=>{this.safeEmit(ce.P2P_LOST,this.store.uid)}),this._p2pChannel.on(jt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(jt.ConnectionTypeChange,t=>{this.safeEmit(ce.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(jt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(jt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(jt.AudioMetadata,t=>{this.safeEmit(ce.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new J(P.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new J(P.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(e={config:t},ml("ContentInspect").create(e));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:r,sid:a,token:c,uid:l,cid:d,vid:h}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:r,sid:a,token:c,uid:l,cid:d,vid:h?Number(h):0},Kn)}catch(n){throw Array.isArray(n)?n[0]:n}var e}handleVideoInspectEvents(t){t.on(mi.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(ce.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,n),n===Aa.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(ce.CONTENT_INSPECT_ERROR,new J(P.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(mi.INSPECT_RESULT,(e,n)=>{var i;if((n==null?void 0:n.code)===P.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return v.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(ce.CONTENT_INSPECT_RESULT,e,n)}),t.on(mi.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new J(P.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(cl(t,"enabled"),t){if(!e)throw new J(P.INVALID_PARAMS,"config is required");if(C2(e),!this._joinInfo)throw new J(P.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{const i=(n={config:e},ml("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:r,cname:a,sid:c,token:l,uid:d,cid:h,vid:p}=this._joinInfo;await i.init({appId:r,areaCode:"",cname:a,sid:c,token:l,uid:d,cid:h,vid:p?Number(p):0},Kn)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new J(P.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(t){t.on(Ro.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(ce.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,n),e===Js.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new J(P.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Ro.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(e){ei(e,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new J(P.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,v.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return v.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){cl(t,"enabled"),Be("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Dt(Ct.prototype,"leave",[b2],Object.getOwnPropertyDescriptor(Ct.prototype,"leave"),Ct.prototype),Dt(Ct.prototype,"publish",[A2],Object.getOwnPropertyDescriptor(Ct.prototype,"publish"),Ct.prototype),Dt(Ct.prototype,"unpublish",[I2],Object.getOwnPropertyDescriptor(Ct.prototype,"unpublish"),Ct.prototype),Dt(Ct.prototype,"subscribe",[w2],Object.getOwnPropertyDescriptor(Ct.prototype,"subscribe"),Ct.prototype),Dt(Ct.prototype,"presubscribe",[O2],Object.getOwnPropertyDescriptor(Ct.prototype,"presubscribe"),Ct.prototype),Dt(Ct.prototype,"massSubscribe",[N2],Object.getOwnPropertyDescriptor(Ct.prototype,"massSubscribe"),Ct.prototype),Dt(Ct.prototype,"unsubscribe",[D2],Object.getOwnPropertyDescriptor(Ct.prototype,"unsubscribe"),Ct.prototype),Dt(Ct.prototype,"massUnsubscribe",[L2],Object.getOwnPropertyDescriptor(Ct.prototype,"massUnsubscribe"),Ct.prototype),Dt(Ct.prototype,"setLowStreamParameter",[P2],Object.getOwnPropertyDescriptor(Ct.prototype,"setLowStreamParameter"),Ct.prototype),Dt(Ct.prototype,"enableDualStream",[k2],Object.getOwnPropertyDescriptor(Ct.prototype,"enableDualStream"),Ct.prototype),Dt(Ct.prototype,"disableDualStream",[M2],Object.getOwnPropertyDescriptor(Ct.prototype,"disableDualStream"),Ct.prototype),Dt(Ct.prototype,"setClientRole",[U2],Object.getOwnPropertyDescriptor(Ct.prototype,"setClientRole"),Ct.prototype),Dt(Ct.prototype,"_setClientRoleOptions",[x2],Object.getOwnPropertyDescriptor(Ct.prototype,"_setClientRoleOptions"),Ct.prototype),Dt(Ct.prototype,"setProxyServer",[V2],Object.getOwnPropertyDescriptor(Ct.prototype,"setProxyServer"),Ct.prototype),Dt(Ct.prototype,"setTurnServer",[B2],Object.getOwnPropertyDescriptor(Ct.prototype,"setTurnServer"),Ct.prototype),Dt(Ct.prototype,"setLicense",[F2],Object.getOwnPropertyDescriptor(Ct.prototype,"setLicense"),Ct.prototype),Dt(Ct.prototype,"startProxyServer",[j2],Object.getOwnPropertyDescriptor(Ct.prototype,"startProxyServer"),Ct.prototype),Dt(Ct.prototype,"stopProxyServer",[G2],Object.getOwnPropertyDescriptor(Ct.prototype,"stopProxyServer"),Ct.prototype),Dt(Ct.prototype,"setLocalAccessPointsV2",[H2],Object.getOwnPropertyDescriptor(Ct.prototype,"setLocalAccessPointsV2"),Ct.prototype),Dt(Ct.prototype,"setLocalAccessPoints",[W2],Object.getOwnPropertyDescriptor(Ct.prototype,"setLocalAccessPoints"),Ct.prototype),Dt(Ct.prototype,"setRemoteDefaultVideoStreamType",[K2],Object.getOwnPropertyDescriptor(Ct.prototype,"setRemoteDefaultVideoStreamType"),Ct.prototype),Dt(Ct.prototype,"setRemoteVideoStreamType",[Y2],Object.getOwnPropertyDescriptor(Ct.prototype,"setRemoteVideoStreamType"),Ct.prototype),Dt(Ct.prototype,"setStreamFallbackOption",[q2],Object.getOwnPropertyDescriptor(Ct.prototype,"setStreamFallbackOption"),Ct.prototype),Dt(Ct.prototype,"setEncryptionConfig",[z2],Object.getOwnPropertyDescriptor(Ct.prototype,"setEncryptionConfig"),Ct.prototype),Dt(Ct.prototype,"renewToken",[X2],Object.getOwnPropertyDescriptor(Ct.prototype,"renewToken"),Ct.prototype),Dt(Ct.prototype,"enableAudioVolumeIndicator",[J2],Object.getOwnPropertyDescriptor(Ct.prototype,"enableAudioVolumeIndicator"),Ct.prototype),Dt(Ct.prototype,"startLiveStreaming",[Q2],Object.getOwnPropertyDescriptor(Ct.prototype,"startLiveStreaming"),Ct.prototype),Dt(Ct.prototype,"setLiveTranscoding",[Z2],Object.getOwnPropertyDescriptor(Ct.prototype,"setLiveTranscoding"),Ct.prototype),Dt(Ct.prototype,"stopLiveStreaming",[$2],Object.getOwnPropertyDescriptor(Ct.prototype,"stopLiveStreaming"),Ct.prototype),Dt(Ct.prototype,"startChannelMediaRelay",[tx],Object.getOwnPropertyDescriptor(Ct.prototype,"startChannelMediaRelay"),Ct.prototype),Dt(Ct.prototype,"updateChannelMediaRelay",[ex],Object.getOwnPropertyDescriptor(Ct.prototype,"updateChannelMediaRelay"),Ct.prototype),Dt(Ct.prototype,"stopChannelMediaRelay",[nx],Object.getOwnPropertyDescriptor(Ct.prototype,"stopChannelMediaRelay"),Ct.prototype),Dt(Ct.prototype,"sendCustomReportMessage",[ix],Object.getOwnPropertyDescriptor(Ct.prototype,"sendCustomReportMessage"),Ct.prototype),Dt(Ct.prototype,"pickSVCLayer",[rx],Object.getOwnPropertyDescriptor(Ct.prototype,"pickSVCLayer"),Ct.prototype),Dt(Ct.prototype,"setRTMConfig",[sx],Object.getOwnPropertyDescriptor(Ct.prototype,"setRTMConfig"),Ct.prototype),Dt(Ct.prototype,"enableContentInspect",[ax],Object.getOwnPropertyDescriptor(Ct.prototype,"enableContentInspect"),Ct.prototype),Dt(Ct.prototype,"disableContentInspect",[ox],Object.getOwnPropertyDescriptor(Ct.prototype,"disableContentInspect"),Ct.prototype),Dt(Ct.prototype,"setImageModeration",[cx],Object.getOwnPropertyDescriptor(Ct.prototype,"setImageModeration"),Ct.prototype),Dt(Ct.prototype,"setP2PTransport",[lx],Object.getOwnPropertyDescriptor(Ct.prototype,"setP2PTransport"),Ct.prototype),Dt(Ct.prototype,"getJoinChannelServiceRecords",[ux],Object.getOwnPropertyDescriptor(Ct.prototype,"getJoinChannelServiceRecords"),Ct.prototype),Dt(Ct.prototype,"setPublishAudioFilterEnabled",[dx],Object.getOwnPropertyDescriptor(Ct.prototype,"setPublishAudioFilterEnabled"),Ct.prototype),Ct);class Bg{constructor(e,n){N(this,"id",0),N(this,"element",void 0),N(this,"peerPair",void 0),N(this,"context",void 0),N(this,"audioPlayerElement",void 0),N(this,"audioTrack",void 0),Bg.count+=1,this.id=Bg.count,this.element=e,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const n=document.createElement("audio");n.srcObject=new MediaStream([e.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const e=async(i,r)=>{const a=r==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(a),i.iceGatheringState==="complete"?i.localDescription:new Et(c=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&c(i.localDescription)}})},n=async(i,r)=>await i.setRemoteDescription(r);try{const i=await e(this.peerPair[0],"offer");await n(this.peerPair[1],i);const r=await e(this.peerPair[1],"answer");await n(this.peerPair[0],r)}catch(i){throw new J(P.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(n)}catch(r){throw new J(P.LOCAL_AEC_ERROR,r.toString()).print()}if(!n)throw new J(P.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,n=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){v.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var px,Vv;N(Bg,"count",0);const bW=window.AudioContext||window.webkitAudioContext,AW=new(px=Wt({report:kt}),Dt((Vv=class{constructor(){N(this,"units",[]),N(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return v.debug("the system does not need to process local aec"),-1;this.context||(this.context=new bW);let e=this.units.find(n=>n&&n.getElement()===t);return e||(e=new Bg(t,this.context),this.units.push(e)),e.startEchoCancellation(),v.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return Re().name!==Oe.SAFARI}}).prototype,"processExternalMediaAEC",[px],Object.getOwnPropertyDescriptor(Vv.prototype,"processExternalMediaAEC"),Vv.prototype),Vv);function fx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function mx(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?fx(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const eO=window||document;function _x(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!eO)return;const n=Yn._cspEventHandlerPointer;if(n&&e)return void console.error(n,e);const i=r=>{if(!(r&&r.blockedURI&&(Yn.onSecurityPolicyViolation||Yn.getListeners(oc.SECURITY_POLICY_VIOLATION).length>0)))return;const a=r.blockedURI;U("CSP_DETECTED_HOSTNAME_LIST").some(c=>_t(a).call(a,c))&&(Yn.onSecurityPolicyViolation&&typeof Yn.onSecurityPolicyViolation=="function"&&Yn.onSecurityPolicyViolation(r),Yn.getListeners(oc.SECURITY_POLICY_VIOLATION).length>0&&Yn.safeEmit(oc.SECURITY_POLICY_VIOLATION,r))};n&&eO.removeEventListener("securitypolicyviolation",n),(e||t&&typeof t=="function"||Yn.getListeners(oc.SECURITY_POLICY_VIOLATION).length>0)&&eO.addEventListener("securitypolicyviolation",i),Yn._cspEventHandlerPointer=i}var IW=ht,wW=$L,Ex=RegExp.prototype,OW=function(t){return t===Ex||IW(Ex,t)?wW(t):t.flags},tr=w(OW);function cm(t){let e=t.length;for(;--e>=0;)t[e]=0}const nO=256,gx=286,Fg=30,jg=15,iO=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Bv=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),NW=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Sx=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gl=new Array(576);cm(gl);const Gg=new Array(60);cm(Gg);const Hg=new Array(512);cm(Hg);const Wg=new Array(256);cm(Wg);const rO=new Array(29);cm(rO);const Fv=new Array(Fg);function sO(t,e,n,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}let Tx,Rx,yx;function aO(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}cm(Fv);const vx=t=>t<256?Hg[t]:Hg[256+(t>>>7)],Kg=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Ns=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,Kg(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},hc=(t,e,n)=>{Ns(t,n[2*e],n[2*e+1])},Cx=(t,e)=>{let n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1},bx=(t,e,n)=>{const i=new Array(16);let r,a,c=0;for(r=1;r<=jg;r++)c=c+n[r-1]<<1,i[r]=c;for(a=0;a<=e;a++){let l=t[2*a+1];l!==0&&(t[2*a]=Cx(i[l]++,l))}},Ax=t=>{let e;for(e=0;e<gx;e++)t.dyn_ltree[2*e]=0;for(e=0;e<Fg;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Ix=t=>{t.bi_valid>8?Kg(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},wx=(t,e,n,i)=>{const r=2*e,a=2*n;return t[r]<t[a]||t[r]===t[a]&&i[e]<=i[n]},oO=(t,e,n)=>{const i=t.heap[n];let r=n<<1;for(;r<=t.heap_len&&(r<t.heap_len&&wx(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!wx(e,i,t.heap[r],t.depth));)t.heap[n]=t.heap[r],n=r,r<<=1;t.heap[n]=i},Ox=(t,e,n)=>{let i,r,a,c,l=0;if(t.sym_next!==0)do i=255&t.pending_buf[t.sym_buf+l++],i+=(255&t.pending_buf[t.sym_buf+l++])<<8,r=t.pending_buf[t.sym_buf+l++],i===0?hc(t,r,e):(a=Wg[r],hc(t,a+nO+1,e),c=iO[a],c!==0&&(r-=rO[a],Ns(t,r,c)),i--,a=vx(i),hc(t,a,n),c=Bv[a],c!==0&&(i-=Fv[a],Ns(t,i,c)));while(l<t.sym_next);hc(t,256,e)},cO=(t,e)=>{const n=e.dyn_tree,i=e.stat_desc.static_tree,r=e.stat_desc.has_stree,a=e.stat_desc.elems;let c,l,d,h=-1;for(t.heap_len=0,t.heap_max=573,c=0;c<a;c++)n[2*c]!==0?(t.heap[++t.heap_len]=h=c,t.depth[c]=0):n[2*c+1]=0;for(;t.heap_len<2;)d=t.heap[++t.heap_len]=h<2?++h:0,n[2*d]=1,t.depth[d]=0,t.opt_len--,r&&(t.static_len-=i[2*d+1]);for(e.max_code=h,c=t.heap_len>>1;c>=1;c--)oO(t,n,c);d=a;do c=t.heap[1],t.heap[1]=t.heap[t.heap_len--],oO(t,n,1),l=t.heap[1],t.heap[--t.heap_max]=c,t.heap[--t.heap_max]=l,n[2*d]=n[2*c]+n[2*l],t.depth[d]=(t.depth[c]>=t.depth[l]?t.depth[c]:t.depth[l])+1,n[2*c+1]=n[2*l+1]=d,t.heap[1]=d++,oO(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((p,m)=>{const S=m.dyn_tree,R=m.max_code,O=m.stat_desc.static_tree,A=m.stat_desc.has_stree,I=m.stat_desc.extra_bits,D=m.stat_desc.extra_base,L=m.stat_desc.max_length;let V,W,K,G,Q,lt,Tt=0;for(G=0;G<=jg;G++)p.bl_count[G]=0;for(S[2*p.heap[p.heap_max]+1]=0,V=p.heap_max+1;V<573;V++)W=p.heap[V],G=S[2*S[2*W+1]+1]+1,G>L&&(G=L,Tt++),S[2*W+1]=G,W>R||(p.bl_count[G]++,Q=0,W>=D&&(Q=I[W-D]),lt=S[2*W],p.opt_len+=lt*(G+Q),A&&(p.static_len+=lt*(O[2*W+1]+Q)));if(Tt!==0){do{for(G=L-1;p.bl_count[G]===0;)G--;p.bl_count[G]--,p.bl_count[G+1]+=2,p.bl_count[L]--,Tt-=2}while(Tt>0);for(G=L;G!==0;G--)for(W=p.bl_count[G];W!==0;)K=p.heap[--V],K>R||(S[2*K+1]!==G&&(p.opt_len+=(G-S[2*K+1])*S[2*K],S[2*K+1]=G),W--)}})(t,e),bx(n,h,t.bl_count)},Nx=(t,e,n)=>{let i,r,a=-1,c=e[1],l=0,d=7,h=4;for(c===0&&(d=138,h=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)r=c,c=e[2*(i+1)+1],++l<d&&r===c||(l<h?t.bl_tree[2*r]+=l:r!==0?(r!==a&&t.bl_tree[2*r]++,t.bl_tree[32]++):l<=10?t.bl_tree[34]++:t.bl_tree[36]++,l=0,a=r,c===0?(d=138,h=3):r===c?(d=6,h=3):(d=7,h=4))},Dx=(t,e,n)=>{let i,r,a=-1,c=e[1],l=0,d=7,h=4;for(c===0&&(d=138,h=3),i=0;i<=n;i++)if(r=c,c=e[2*(i+1)+1],!(++l<d&&r===c)){if(l<h)do hc(t,r,t.bl_tree);while(--l!=0);else r!==0?(r!==a&&(hc(t,r,t.bl_tree),l--),hc(t,16,t.bl_tree),Ns(t,l-3,2)):l<=10?(hc(t,17,t.bl_tree),Ns(t,l-3,3)):(hc(t,18,t.bl_tree),Ns(t,l-11,7));l=0,a=r,c===0?(d=138,h=3):r===c?(d=6,h=3):(d=7,h=4)}};let Lx=!1;const Px=(t,e,n,i)=>{Ns(t,0+(i?1:0),3),Ix(t),Kg(t,n),Kg(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var DW=t=>{Lx||((()=>{let e,n,i,r,a;const c=new Array(16);for(i=0,r=0;r<28;r++)for(rO[r]=i,e=0;e<1<<iO[r];e++)Wg[i++]=r;for(Wg[i-1]=r,a=0,r=0;r<16;r++)for(Fv[r]=a,e=0;e<1<<Bv[r];e++)Hg[a++]=r;for(a>>=7;r<Fg;r++)for(Fv[r]=a<<7,e=0;e<1<<Bv[r]-7;e++)Hg[256+a++]=r;for(n=0;n<=jg;n++)c[n]=0;for(e=0;e<=143;)gl[2*e+1]=8,e++,c[8]++;for(;e<=255;)gl[2*e+1]=9,e++,c[9]++;for(;e<=279;)gl[2*e+1]=7,e++,c[7]++;for(;e<=287;)gl[2*e+1]=8,e++,c[8]++;for(bx(gl,287,c),e=0;e<Fg;e++)Gg[2*e+1]=5,Gg[2*e]=Cx(e,5);Tx=new sO(gl,iO,257,gx,jg),Rx=new sO(Gg,Bv,0,Fg,jg),yx=new sO(new Array(0),NW,0,19,7)})(),Lx=!0),t.l_desc=new aO(t.dyn_ltree,Tx),t.d_desc=new aO(t.dyn_dtree,Rx),t.bl_desc=new aO(t.bl_tree,yx),t.bi_buf=0,t.bi_valid=0,Ax(t)},LW=(t,e,n,i)=>{let r,a,c=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(l=>{let d,h=4093624447;for(d=0;d<=31;d++,h>>>=1)if(1&h&&l.dyn_ltree[2*d]!==0)return 0;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return 1;for(d=32;d<nO;d++)if(l.dyn_ltree[2*d]!==0)return 1;return 0})(t)),cO(t,t.l_desc),cO(t,t.d_desc),c=(l=>{let d;for(Nx(l,l.dyn_ltree,l.l_desc.max_code),Nx(l,l.dyn_dtree,l.d_desc.max_code),cO(l,l.bl_desc),d=18;d>=3&&l.bl_tree[2*Sx[d]+1]===0;d--);return l.opt_len+=3*(d+1)+5+5+4,d})(t),r=t.opt_len+3+7>>>3,a=t.static_len+3+7>>>3,a<=r&&(r=a)):r=a=n+5,n+4<=r&&e!==-1?Px(t,e,n,i):t.strategy===4||a===r?(Ns(t,2+(i?1:0),3),Ox(t,gl,Gg)):(Ns(t,4+(i?1:0),3),((l,d,h,p)=>{let m;for(Ns(l,d-257,5),Ns(l,h-1,5),Ns(l,p-4,4),m=0;m<p;m++)Ns(l,l.bl_tree[2*Sx[m]+1],3);Dx(l,l.dyn_ltree,d-1),Dx(l,l.dyn_dtree,h-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,c+1),Ox(t,t.dyn_ltree,t.dyn_dtree)),Ax(t),i&&Ix(t)},PW=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(Wg[n]+nO+1)]++,t.dyn_dtree[2*vx(e)]++),t.sym_next===t.sym_end),kW=t=>{Ns(t,2,3),hc(t,256,gl),(e=>{e.bi_valid===16?(Kg(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(t)},MW={_tr_init:DW,_tr_stored_block:Px,_tr_flush_block:LW,_tr_tally:PW,_tr_align:kW},Yg=(t,e,n,i)=>{let r=65535&t|0,a=t>>>16&65535|0,c=0;for(;n!==0;){c=n>2e3?2e3:n,n-=c;do r=r+e[i++]|0,a=a+r|0;while(--c);r%=65521,a%=65521}return r|a<<16|0};const UW=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var mr=(t,e,n,i)=>{const r=UW,a=i+n;t^=-1;for(let c=i;c<a;c++)t=t>>>8^r[255&(t^e[c])];return-1^t},Rh={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},jv={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:xW,_tr_stored_block:lO,_tr_flush_block:VW,_tr_tally:Pu,_tr_align:BW}=MW,{Z_NO_FLUSH:ku,Z_PARTIAL_FLUSH:FW,Z_FULL_FLUSH:jW,Z_FINISH:Da,Z_BLOCK:kx,Z_OK:wr,Z_STREAM_END:Mx,Z_STREAM_ERROR:pc,Z_DATA_ERROR:GW,Z_BUF_ERROR:uO,Z_DEFAULT_COMPRESSION:HW,Z_FILTERED:WW,Z_HUFFMAN_ONLY:Gv,Z_RLE:KW,Z_FIXED:YW,Z_DEFAULT_STRATEGY:qW,Z_UNKNOWN:zW,Z_DEFLATED:Hv}=jv,dO=286,XW=30,JW=19,QW=2*dO+1,ZW=15,yh=258,fc=262,lm=42,vh=113,qg=666,Ch=(t,e)=>(t.msg=Rh[e],e),Ux=t=>2*t-(t>4?9:0),Mu=t=>{let e=t.length;for(;--e>=0;)t[e]=0},$W=t=>{let e,n,i,r=t.w_size;e=t.hash_size,i=e;do n=t.head[--i],t.head[i]=n>=r?n-r:0;while(--e);e=r,i=e;do n=t.prev[--i],t.prev[i]=n>=r?n-r:0;while(--e)};let Uu=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const Zs=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},$s=(t,e)=>{VW(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Zs(t.strm)},Dn=(t,e)=>{t.pending_buf[t.pending++]=e},zg=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},hO=(t,e,n,i)=>{let r=t.avail_in;return r>i&&(r=i),r===0?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),n),t.state.wrap===1?t.adler=Yg(t.adler,e,r,n):t.state.wrap===2&&(t.adler=mr(t.adler,e,r,n)),t.next_in+=r,t.total_in+=r,r)},xx=(t,e)=>{let n,i,r=t.max_chain_length,a=t.strstart,c=t.prev_length,l=t.nice_match;const d=t.strstart>t.w_size-fc?t.strstart-(t.w_size-fc):0,h=t.window,p=t.w_mask,m=t.prev,S=t.strstart+yh;let R=h[a+c-1],O=h[a+c];t.prev_length>=t.good_match&&(r>>=2),l>t.lookahead&&(l=t.lookahead);do if(n=e,h[n+c]===O&&h[n+c-1]===R&&h[n]===h[a]&&h[++n]===h[a+1]){a+=2,n++;do;while(h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&a<S);if(i=yh-(S-a),a=S-yh,i>c){if(t.match_start=e,c=i,i>=l)break;R=h[a+c-1],O=h[a+c]}}while((e=m[e&p])>d&&--r!=0);return c<=t.lookahead?c:t.lookahead},um=t=>{const e=t.w_size;let n,i,r;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-fc)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),$W(t),i+=e),t.strm.avail_in===0)break;if(n=hO(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=n,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=Uu(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=Uu(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<fc&&t.strm.avail_in!==0)},Vx=(t,e)=>{let n,i,r,a=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,c=0,l=t.strm.avail_in;do{if(n=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r||(r=t.strm.avail_out-r,i=t.strstart-t.block_start,n>i+t.strm.avail_in&&(n=i+t.strm.avail_in),n>r&&(n=r),n<a&&(n===0&&e!==Da||e===ku||n!==i+t.strm.avail_in)))break;c=e===Da&&n===i+t.strm.avail_in?1:0,lO(t,0,0,c),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,Zs(t.strm),i&&(i>n&&(i=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,n-=i),n&&(hO(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(c===0);return l-=t.strm.avail_in,l&&(l>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=l&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-l,t.strm.next_in),t.strstart),t.strstart+=l,t.insert+=l>t.w_size-t.insert?t.w_size-t.insert:l),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),c?4:e!==ku&&e!==Da&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&(hO(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,a=r>t.w_size?t.w_size:r,i=t.strstart-t.block_start,(i>=a||(i||e===Da)&&e!==ku&&t.strm.avail_in===0&&i<=r)&&(n=i>r?r:i,c=e===Da&&t.strm.avail_in===0&&n===i?1:0,lO(t,t.block_start,n,c),t.block_start+=n,Zs(t.strm)),c?3:1)},pO=(t,e)=>{let n,i;for(;;){if(t.lookahead<fc){if(um(t),t.lookahead<fc&&e===ku)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=Uu(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-fc&&(t.match_length=xx(t,n)),t.match_length>=3)if(i=Pu(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=Uu(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Uu(t,t.ins_h,t.window[t.strstart+1]);else i=Pu(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&($s(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,e===Da?($s(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&($s(t,!1),t.strm.avail_out===0)?1:2},dm=(t,e)=>{let n,i,r;for(;;){if(t.lookahead<fc){if(um(t),t.lookahead<fc&&e===ku)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=Uu(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-fc&&(t.match_length=xx(t,n),t.match_length<=5&&(t.strategy===WW||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,i=Pu(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=r&&(t.ins_h=Uu(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,i&&($s(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(i=Pu(t,0,t.window[t.strstart-1]),i&&$s(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=Pu(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===Da?($s(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&($s(t,!1),t.strm.avail_out===0)?1:2};function mc(t,e,n,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=r}const Xg=[new mc(0,0,0,0,Vx),new mc(4,4,8,4,pO),new mc(4,5,16,8,pO),new mc(4,6,32,32,pO),new mc(4,4,16,16,dm),new mc(8,16,32,32,dm),new mc(8,16,128,128,dm),new mc(8,32,128,256,dm),new mc(32,128,258,1024,dm),new mc(32,258,258,4096,dm)];function t8(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Hv,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*QW),this.dyn_dtree=new Uint16Array(2*(2*XW+1)),this.bl_tree=new Uint16Array(2*(2*JW+1)),Mu(this.dyn_ltree),Mu(this.dyn_dtree),Mu(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(ZW+1),this.heap=new Uint16Array(2*dO+1),Mu(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*dO+1),Mu(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Jg=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==lm&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==vh&&e.status!==qg?1:0},Bx=t=>{if(Jg(t))return Ch(t,pc);t.total_in=t.total_out=0,t.data_type=zW;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?lm:vh,t.adler=e.wrap===2?0:1,e.last_flush=-2,xW(e),wr},Fx=t=>{const e=Bx(t);return e===wr&&(n=>{n.window_size=2*n.w_size,Mu(n.head),n.max_lazy_match=Xg[n.level].max_lazy,n.good_match=Xg[n.level].good_length,n.nice_match=Xg[n.level].nice_length,n.max_chain_length=Xg[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(t.state),e},jx=(t,e,n,i,r,a)=>{if(!t)return pc;let c=1;if(e===HW&&(e=6),i<0?(c=0,i=-i):i>15&&(c=2,i-=16),r<1||r>9||n!==Hv||i<8||i>15||e<0||e>9||a<0||a>YW||i===8&&c!==1)return Ch(t,pc);i===8&&(i=9);const l=new t8;return t.state=l,l.strm=t,l.status=lm,l.wrap=c,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=e,l.strategy=a,l.method=n,Fx(t)};var e8=(t,e)=>{if(Jg(t)||e>kx||e<0)return t?Ch(t,pc):pc;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===qg&&e!==Da)return Ch(t,t.avail_out===0?uO:pc);const i=n.last_flush;if(n.last_flush=e,n.pending!==0){if(Zs(t),t.avail_out===0)return n.last_flush=-1,wr}else if(t.avail_in===0&&Ux(e)<=Ux(i)&&e!==Da)return Ch(t,uO);if(n.status===qg&&t.avail_in!==0)return Ch(t,uO);if(n.status===lm&&n.wrap===0&&(n.status=vh),n.status===lm){let r=Hv+(n.w_bits-8<<4)<<8,a=-1;if(a=n.strategy>=Gv||n.level<2?0:n.level<6?1:n.level===6?2:3,r|=a<<6,n.strstart!==0&&(r|=32),r+=31-r%31,zg(n,r),n.strstart!==0&&(zg(n,t.adler>>>16),zg(n,65535&t.adler)),t.adler=1,n.status=vh,Zs(t),n.pending!==0)return n.last_flush=-1,wr}if(n.status===57){if(t.adler=0,Dn(n,31),Dn(n,139),Dn(n,8),n.gzhead)Dn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Dn(n,255&n.gzhead.time),Dn(n,n.gzhead.time>>8&255),Dn(n,n.gzhead.time>>16&255),Dn(n,n.gzhead.time>>24&255),Dn(n,n.level===9?2:n.strategy>=Gv||n.level<2?4:0),Dn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Dn(n,255&n.gzhead.extra.length),Dn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=mr(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Dn(n,0),Dn(n,0),Dn(n,0),Dn(n,0),Dn(n,0),Dn(n,n.level===9?2:n.strategy>=Gv||n.level<2?4:0),Dn(n,3),n.status=vh,Zs(t),n.pending!==0)return n.last_flush=-1,wr}if(n.status===69){if(n.gzhead.extra){let r=n.pending,a=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+a>n.pending_buf_size;){let l=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>r&&(t.adler=mr(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex+=l,Zs(t),n.pending!==0)return n.last_flush=-1,wr;r=0,a-=l}let c=new Uint8Array(n.gzhead.extra);n.pending_buf.set(c.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending+=a,n.gzhead.hcrc&&n.pending>r&&(t.adler=mr(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let r,a=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>a&&(t.adler=mr(t.adler,n.pending_buf,n.pending-a,a)),Zs(t),n.pending!==0)return n.last_flush=-1,wr;a=0}r=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Dn(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>a&&(t.adler=mr(t.adler,n.pending_buf,n.pending-a,a)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let r,a=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>a&&(t.adler=mr(t.adler,n.pending_buf,n.pending-a,a)),Zs(t),n.pending!==0)return n.last_flush=-1,wr;a=0}r=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Dn(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>a&&(t.adler=mr(t.adler,n.pending_buf,n.pending-a,a))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Zs(t),n.pending!==0))return n.last_flush=-1,wr;Dn(n,255&t.adler),Dn(n,t.adler>>8&255),t.adler=0}if(n.status=vh,Zs(t),n.pending!==0)return n.last_flush=-1,wr}if(t.avail_in!==0||n.lookahead!==0||e!==ku&&n.status!==qg){let r=n.level===0?Vx(n,e):n.strategy===Gv?((a,c)=>{let l;for(;;){if(a.lookahead===0&&(um(a),a.lookahead===0)){if(c===ku)return 1;break}if(a.match_length=0,l=Pu(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,l&&($s(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,c===Da?($s(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&($s(a,!1),a.strm.avail_out===0)?1:2})(n,e):n.strategy===KW?((a,c)=>{let l,d,h,p;const m=a.window;for(;;){if(a.lookahead<=yh){if(um(a),a.lookahead<=yh&&c===ku)return 1;if(a.lookahead===0)break}if(a.match_length=0,a.lookahead>=3&&a.strstart>0&&(h=a.strstart-1,d=m[h],d===m[++h]&&d===m[++h]&&d===m[++h])){p=a.strstart+yh;do;while(d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&h<p);a.match_length=yh-(p-h),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=3?(l=Pu(a,1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(l=Pu(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),l&&($s(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,c===Da?($s(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&($s(a,!1),a.strm.avail_out===0)?1:2})(n,e):Xg[n.level].func(n,e);if(r!==3&&r!==4||(n.status=qg),r===1||r===3)return t.avail_out===0&&(n.last_flush=-1),wr;if(r===2&&(e===FW?BW(n):e!==kx&&(lO(n,0,0,!1),e===jW&&(Mu(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),Zs(t),t.avail_out===0))return n.last_flush=-1,wr}return e!==Da?wr:n.wrap<=0?Mx:(n.wrap===2?(Dn(n,255&t.adler),Dn(n,t.adler>>8&255),Dn(n,t.adler>>16&255),Dn(n,t.adler>>24&255),Dn(n,255&t.total_in),Dn(n,t.total_in>>8&255),Dn(n,t.total_in>>16&255),Dn(n,t.total_in>>24&255)):(zg(n,t.adler>>>16),zg(n,65535&t.adler)),Zs(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?wr:Mx)},n8=(t,e)=>{let n=e.length;if(Jg(t))return pc;const i=t.state,r=i.wrap;if(r===2||r===1&&i.status!==lm||i.lookahead)return pc;if(r===1&&(t.adler=Yg(t.adler,e,n,0)),i.wrap=0,n>=i.w_size){r===0&&(Mu(i.head),i.strstart=0,i.block_start=0,i.insert=0);let d=new Uint8Array(i.w_size);d.set(e.subarray(n-i.w_size,n),0),e=d,n=i.w_size}const a=t.avail_in,c=t.next_in,l=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,um(i);i.lookahead>=3;){let d=i.strstart,h=i.lookahead-2;do i.ins_h=Uu(i,i.ins_h,i.window[d+3-1]),i.prev[d&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=d,d++;while(--h);i.strstart=d,i.lookahead=2,um(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=c,t.input=l,t.avail_in=a,i.wrap=r,wr},Qg={deflateInit:(t,e)=>jx(t,e,Hv,15,8,qW),deflateInit2:jx,deflateReset:Fx,deflateResetKeep:Bx,deflateSetHeader:(t,e)=>Jg(t)||t.state.wrap!==2?pc:(t.state.gzhead=e,wr),deflate:e8,deflateEnd:t=>{if(Jg(t))return pc;const e=t.state.status;return t.state=null,e===vh?Ch(t,GW):wr},deflateSetDictionary:n8,deflateInfo:"pako deflate (from Nodeca project)"};const i8=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Wv={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)i8(n,i)&&(t[i]=n[i])}}return t},flattenChunks:t=>{let e=0;for(let i=0,r=t.length;i<r;i++)e+=t[i].length;const n=new Uint8Array(e);for(let i=0,r=0,a=t.length;i<a;i++){let c=t[i];n.set(c,r),r+=c.length}return n}};let Gx=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Gx=!1}const Zg=new Uint8Array(256);for(let t=0;t<256;t++)Zg[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Zg[254]=Zg[254]=1;var $g={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,i,r,a,c=t.length,l=0;for(r=0;r<c;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(l),a=0,r=0;a<l;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|63&n):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e},buf2string:(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let i,r;const a=new Array(2*n);for(r=0,i=0;i<n;){let c=t[i++];if(c<128){a[r++]=c;continue}let l=Zg[c];if(l>4)a[r++]=65533,i+=l-1;else{for(c&=l===2?31:l===3?15:7;l>1&&i<n;)c=c<<6|63&t[i++],l--;l>1?a[r++]=65533:c<65536?a[r++]=c:(c-=65536,a[r++]=55296|c>>10&1023,a[r++]=56320|1023&c)}}return((c,l)=>{if(l<65534&&c.subarray&&Gx)return String.fromCharCode.apply(null,c.length===l?c:c.subarray(0,l));let d="";for(let h=0;h<l;h++)d+=String.fromCharCode(c[h]);return d})(a,r)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(192&t[n])==128;)n--;return n<0||n===0?e:n+Zg[t[n]]>e?n:e}},Hx=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Wx=Object.prototype.toString,{Z_NO_FLUSH:r8,Z_SYNC_FLUSH:s8,Z_FULL_FLUSH:a8,Z_FINISH:o8,Z_OK:Kv,Z_STREAM_END:c8,Z_DEFAULT_COMPRESSION:l8,Z_DEFAULT_STRATEGY:u8,Z_DEFLATED:d8}=jv;function Yv(t){this.options=Wv.assign({level:l8,method:d8,chunkSize:16384,windowBits:15,memLevel:8,strategy:u8},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Hx,this.strm.avail_out=0;let n=Qg.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==Kv)throw new Error(Rh[n]);if(e.header&&Qg.deflateSetHeader(this.strm,e.header),e.dictionary){let i;if(i=typeof e.dictionary=="string"?$g.string2buf(e.dictionary):Wx.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,n=Qg.deflateSetDictionary(this.strm,i),n!==Kv)throw new Error(Rh[n]);this._dict_set=!0}}function h8(t,e){const n=new Yv(e);if(n.push(t,!0),n.err)throw n.msg||Rh[n.err];return n.result}Yv.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize;let r,a;if(this.ended)return!1;for(a=e===~~e?e:e===!0?o8:r8,typeof t=="string"?n.input=$g.string2buf(t):Wx.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(a===s8||a===a8)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=Qg.deflate(n,a),r===c8)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=Qg.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Kv;if(n.avail_out!==0){if(a>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},Yv.prototype.onData=function(t){this.chunks.push(t)},Yv.prototype.onEnd=function(t){t===Kv&&(this.result=Wv.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var p8={deflate:h8};const qv=16209;var f8=function(t,e){let n,i,r,a,c,l,d,h,p,m,S,R,O,A,I,D,L,V,W,K,G,Q,lt,Tt;const At=t.state;n=t.next_in,lt=t.input,i=n+(t.avail_in-5),r=t.next_out,Tt=t.output,a=r-(e-t.avail_out),c=r+(t.avail_out-257),l=At.dmax,d=At.wsize,h=At.whave,p=At.wnext,m=At.window,S=At.hold,R=At.bits,O=At.lencode,A=At.distcode,I=(1<<At.lenbits)-1,D=(1<<At.distbits)-1;t:do{R<15&&(S+=lt[n++]<<R,R+=8,S+=lt[n++]<<R,R+=8),L=O[S&I];e:for(;;){if(V=L>>>24,S>>>=V,R-=V,V=L>>>16&255,V===0)Tt[r++]=65535&L;else{if(!(16&V)){if((64&V)==0){L=O[(65535&L)+(S&(1<<V)-1)];continue e}if(32&V){At.mode=16191;break t}t.msg="invalid literal/length code",At.mode=qv;break t}W=65535&L,V&=15,V&&(R<V&&(S+=lt[n++]<<R,R+=8),W+=S&(1<<V)-1,S>>>=V,R-=V),R<15&&(S+=lt[n++]<<R,R+=8,S+=lt[n++]<<R,R+=8),L=A[S&D];n:for(;;){if(V=L>>>24,S>>>=V,R-=V,V=L>>>16&255,!(16&V)){if((64&V)==0){L=A[(65535&L)+(S&(1<<V)-1)];continue n}t.msg="invalid distance code",At.mode=qv;break t}if(K=65535&L,V&=15,R<V&&(S+=lt[n++]<<R,R+=8,R<V&&(S+=lt[n++]<<R,R+=8)),K+=S&(1<<V)-1,K>l){t.msg="invalid distance too far back",At.mode=qv;break t}if(S>>>=V,R-=V,V=r-a,K>V){if(V=K-V,V>h&&At.sane){t.msg="invalid distance too far back",At.mode=qv;break t}if(G=0,Q=m,p===0){if(G+=d-V,V<W){W-=V;do Tt[r++]=m[G++];while(--V);G=r-K,Q=Tt}}else if(p<V){if(G+=d+p-V,V-=p,V<W){W-=V;do Tt[r++]=m[G++];while(--V);if(G=0,p<W){V=p,W-=V;do Tt[r++]=m[G++];while(--V);G=r-K,Q=Tt}}}else if(G+=p-V,V<W){W-=V;do Tt[r++]=m[G++];while(--V);G=r-K,Q=Tt}for(;W>2;)Tt[r++]=Q[G++],Tt[r++]=Q[G++],Tt[r++]=Q[G++],W-=3;W&&(Tt[r++]=Q[G++],W>1&&(Tt[r++]=Q[G++]))}else{G=r-K;do Tt[r++]=Tt[G++],Tt[r++]=Tt[G++],Tt[r++]=Tt[G++],W-=3;while(W>2);W&&(Tt[r++]=Tt[G++],W>1&&(Tt[r++]=Tt[G++]))}break}}break}}while(n<i&&r<c);W=R>>3,n-=W,R-=W<<3,S&=(1<<R)-1,t.next_in=n,t.next_out=r,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=r<c?c-r+257:257-(r-c),At.hold=S,At.bits=R};const zv=15,m8=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),_8=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),E8=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),g8=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var tS=(t,e,n,i,r,a,c,l)=>{const d=l.bits;let h,p,m,S,R,O,A=0,I=0,D=0,L=0,V=0,W=0,K=0,G=0,Q=0,lt=0,Tt=null;const At=new Uint16Array(16),de=new Uint16Array(16);let he,Ze,Mn,An=null;for(A=0;A<=zv;A++)At[A]=0;for(I=0;I<i;I++)At[e[n+I]]++;for(V=d,L=zv;L>=1&&At[L]===0;L--);if(V>L&&(V=L),L===0)return r[a++]=20971520,r[a++]=20971520,l.bits=1,0;for(D=1;D<L&&At[D]===0;D++);for(V<D&&(V=D),G=1,A=1;A<=zv;A++)if(G<<=1,G-=At[A],G<0)return-1;if(G>0&&(t===0||L!==1))return-1;for(de[1]=0,A=1;A<zv;A++)de[A+1]=de[A]+At[A];for(I=0;I<i;I++)e[n+I]!==0&&(c[de[e[n+I]]++]=I);if(t===0?(Tt=An=c,O=20):t===1?(Tt=m8,An=_8,O=257):(Tt=E8,An=g8,O=0),lt=0,I=0,A=D,R=a,W=V,K=0,m=-1,Q=1<<V,S=Q-1,t===1&&Q>852||t===2&&Q>592)return 1;for(;;){he=A-K,c[I]+1<O?(Ze=0,Mn=c[I]):c[I]>=O?(Ze=An[c[I]-O],Mn=Tt[c[I]-O]):(Ze=96,Mn=0),h=1<<A-K,p=1<<W,D=p;do p-=h,r[R+(lt>>K)+p]=he<<24|Ze<<16|Mn|0;while(p!==0);for(h=1<<A-1;lt&h;)h>>=1;if(h!==0?(lt&=h-1,lt+=h):lt=0,I++,--At[A]==0){if(A===L)break;A=e[n+c[I]]}if(A>V&&(lt&S)!==m){for(K===0&&(K=V),R+=D,W=A-K,G=1<<W;W+K<L&&(G-=At[W+K],!(G<=0));)W++,G<<=1;if(Q+=1<<W,t===1&&Q>852||t===2&&Q>592)return 1;m=lt&S,r[m]=V<<24|W<<16|R-a|0}}return lt!==0&&(r[R+lt]=A-K<<24|64<<16|0),l.bits=V,0};const{Z_FINISH:Kx,Z_BLOCK:S8,Z_TREES:Xv,Z_OK:bh,Z_STREAM_END:T8,Z_NEED_DICT:R8,Z_STREAM_ERROR:La,Z_DATA_ERROR:Yx,Z_MEM_ERROR:qx,Z_BUF_ERROR:y8,Z_DEFLATED:zx}=jv,Jv=16180,Qv=16190,Sl=16191,fO=16192,mO=16194,Zv=16199,$v=16200,_O=16206,_i=16209,Xx=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function v8(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ah=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Jv||e.mode>16211?1:0},Jx=t=>{if(Ah(t))return La;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Jv,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,bh},Qx=t=>{if(Ah(t))return La;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Jx(t)},Zx=(t,e)=>{let n;if(Ah(t))return La;const i=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?La:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,Qx(t))},$x=(t,e)=>{if(!t)return La;const n=new v8;t.state=n,n.strm=t,n.window=null,n.mode=Jv;const i=Zx(t,e);return i!==bh&&(t.state=null),i};let EO,gO,tV=!0;const C8=t=>{if(tV){EO=new Int32Array(512),gO=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(tS(1,t.lens,0,288,EO,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;tS(2,t.lens,0,32,gO,0,t.work,{bits:5}),tV=!1}t.lencode=EO,t.lenbits=9,t.distcode=gO,t.distbits=5},eV=(t,e,n,i)=>{let r;const a=t.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(e.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(r=a.wsize-a.wnext,r>i&&(r=i),a.window.set(e.subarray(n-i,n-i+r),a.wnext),(i-=r)?(a.window.set(e.subarray(n-i,n),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0};var b8=(t,e)=>{let n,i,r,a,c,l,d,h,p,m,S,R,O,A,I,D,L,V,W,K,G,Q,lt=0;const Tt=new Uint8Array(4);let At,de;const he=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ah(t)||!t.output||!t.input&&t.avail_in!==0)return La;n=t.state,n.mode===Sl&&(n.mode=fO),c=t.next_out,r=t.output,d=t.avail_out,a=t.next_in,i=t.input,l=t.avail_in,h=n.hold,p=n.bits,m=l,S=d,Q=bh;t:for(;;)switch(n.mode){case Jv:if(n.wrap===0){n.mode=fO;break}for(;p<16;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if(2&n.wrap&&h===35615){n.wbits===0&&(n.wbits=15),n.check=0,Tt[0]=255&h,Tt[1]=h>>>8&255,n.check=mr(n.check,Tt,2,0),h=0,p=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",n.mode=_i;break}if((15&h)!==zx){t.msg="unknown compression method",n.mode=_i;break}if(h>>>=4,p-=4,G=8+(15&h),n.wbits===0&&(n.wbits=G),G>15||G>n.wbits){t.msg="invalid window size",n.mode=_i;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&h?16189:Sl,h=0,p=0;break;case 16181:for(;p<16;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if(n.flags=h,(255&tr(n))!==zx){t.msg="unknown compression method",n.mode=_i;break}if(57344&tr(n)){t.msg="unknown header flags set",n.mode=_i;break}n.head&&(n.head.text=h>>8&1),512&tr(n)&&4&n.wrap&&(Tt[0]=255&h,Tt[1]=h>>>8&255,n.check=mr(n.check,Tt,2,0)),h=0,p=0,n.mode=16182;case 16182:for(;p<32;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}n.head&&(n.head.time=h),512&tr(n)&&4&n.wrap&&(Tt[0]=255&h,Tt[1]=h>>>8&255,Tt[2]=h>>>16&255,Tt[3]=h>>>24&255,n.check=mr(n.check,Tt,4,0)),h=0,p=0,n.mode=16183;case 16183:for(;p<16;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&tr(n)&&4&n.wrap&&(Tt[0]=255&h,Tt[1]=h>>>8&255,n.check=mr(n.check,Tt,2,0)),h=0,p=0,n.mode=16184;case 16184:if(1024&tr(n)){for(;p<16;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}n.length=h,n.head&&(n.head.extra_len=h),512&tr(n)&&4&n.wrap&&(Tt[0]=255&h,Tt[1]=h>>>8&255,n.check=mr(n.check,Tt,2,0)),h=0,p=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&tr(n)&&(R=n.length,R>l&&(R=l),R&&(n.head&&(G=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(a,a+R),G)),512&tr(n)&&4&n.wrap&&(n.check=mr(n.check,i,R,a)),l-=R,a+=R,n.length-=R),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&tr(n)){if(l===0)break t;R=0;do G=i[a+R++],n.head&&G&&n.length<65536&&(n.head.name+=String.fromCharCode(G));while(G&&R<l);if(512&tr(n)&&4&n.wrap&&(n.check=mr(n.check,i,R,a)),l-=R,a+=R,G)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&tr(n)){if(l===0)break t;R=0;do G=i[a+R++],n.head&&G&&n.length<65536&&(n.head.comment+=String.fromCharCode(G));while(G&&R<l);if(512&tr(n)&&4&n.wrap&&(n.check=mr(n.check,i,R,a)),l-=R,a+=R,G)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&tr(n)){for(;p<16;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if(4&n.wrap&&h!==(65535&n.check)){t.msg="header crc mismatch",n.mode=_i;break}h=0,p=0}n.head&&(n.head.hcrc=tr(n)>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Sl;break;case 16189:for(;p<32;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}t.adler=n.check=Xx(h),h=0,p=0,n.mode=Qv;case Qv:if(n.havedict===0)return t.next_out=c,t.avail_out=d,t.next_in=a,t.avail_in=l,n.hold=h,n.bits=p,R8;t.adler=n.check=1,n.mode=Sl;case Sl:if(e===S8||e===Xv)break t;case fO:if(n.last){h>>>=7&p,p-=7&p,n.mode=_O;break}for(;p<3;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}switch(n.last=1&h,h>>>=1,p-=1,3&h){case 0:n.mode=16193;break;case 1:if(C8(n),n.mode=Zv,e===Xv){h>>>=2,p-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=_i}h>>>=2,p-=2;break;case 16193:for(h>>>=7&p,p-=7&p;p<32;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",n.mode=_i;break}if(n.length=65535&h,h=0,p=0,n.mode=mO,e===Xv)break t;case mO:n.mode=16195;case 16195:if(R=n.length,R){if(R>l&&(R=l),R>d&&(R=d),R===0)break t;r.set(i.subarray(a,a+R),c),l-=R,a+=R,d-=R,c+=R,n.length-=R;break}n.mode=Sl;break;case 16196:for(;p<14;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if(n.nlen=257+(31&h),h>>>=5,p-=5,n.ndist=1+(31&h),h>>>=5,p-=5,n.ncode=4+(15&h),h>>>=4,p-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=_i;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;p<3;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}n.lens[he[n.have++]]=7&h,h>>>=3,p-=3}for(;n.have<19;)n.lens[he[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,At={bits:n.lenbits},Q=tS(0,n.lens,0,19,n.lencode,0,n.work,At),n.lenbits=At.bits,Q){t.msg="invalid code lengths set",n.mode=_i;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;lt=n.lencode[h&(1<<n.lenbits)-1],I=lt>>>24,D=lt>>>16&255,L=65535&lt,!(I<=p);){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if(L<16)h>>>=I,p-=I,n.lens[n.have++]=L;else{if(L===16){for(de=I+2;p<de;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if(h>>>=I,p-=I,n.have===0){t.msg="invalid bit length repeat",n.mode=_i;break}G=n.lens[n.have-1],R=3+(3&h),h>>>=2,p-=2}else if(L===17){for(de=I+3;p<de;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}h>>>=I,p-=I,G=0,R=3+(7&h),h>>>=3,p-=3}else{for(de=I+7;p<de;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}h>>>=I,p-=I,G=0,R=11+(127&h),h>>>=7,p-=7}if(n.have+R>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=_i;break}for(;R--;)n.lens[n.have++]=G}}if(n.mode===_i)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=_i;break}if(n.lenbits=9,At={bits:n.lenbits},Q=tS(1,n.lens,0,n.nlen,n.lencode,0,n.work,At),n.lenbits=At.bits,Q){t.msg="invalid literal/lengths set",n.mode=_i;break}if(n.distbits=6,n.distcode=n.distdyn,At={bits:n.distbits},Q=tS(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,At),n.distbits=At.bits,Q){t.msg="invalid distances set",n.mode=_i;break}if(n.mode=Zv,e===Xv)break t;case Zv:n.mode=$v;case $v:if(l>=6&&d>=258){t.next_out=c,t.avail_out=d,t.next_in=a,t.avail_in=l,n.hold=h,n.bits=p,f8(t,S),c=t.next_out,r=t.output,d=t.avail_out,a=t.next_in,i=t.input,l=t.avail_in,h=n.hold,p=n.bits,n.mode===Sl&&(n.back=-1);break}for(n.back=0;lt=n.lencode[h&(1<<n.lenbits)-1],I=lt>>>24,D=lt>>>16&255,L=65535&lt,!(I<=p);){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if(D&&(240&D)==0){for(V=I,W=D,K=L;lt=n.lencode[K+((h&(1<<V+W)-1)>>V)],I=lt>>>24,D=lt>>>16&255,L=65535&lt,!(V+I<=p);){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}h>>>=V,p-=V,n.back+=V}if(h>>>=I,p-=I,n.back+=I,n.length=L,D===0){n.mode=16205;break}if(32&D){n.back=-1,n.mode=Sl;break}if(64&D){t.msg="invalid literal/length code",n.mode=_i;break}n.extra=15&D,n.mode=16201;case 16201:if(n.extra){for(de=n.extra;p<de;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;lt=n.distcode[h&(1<<n.distbits)-1],I=lt>>>24,D=lt>>>16&255,L=65535&lt,!(I<=p);){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if((240&D)==0){for(V=I,W=D,K=L;lt=n.distcode[K+((h&(1<<V+W)-1)>>V)],I=lt>>>24,D=lt>>>16&255,L=65535&lt,!(V+I<=p);){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}h>>>=V,p-=V,n.back+=V}if(h>>>=I,p-=I,n.back+=I,64&D){t.msg="invalid distance code",n.mode=_i;break}n.offset=L,n.extra=15&D,n.mode=16203;case 16203:if(n.extra){for(de=n.extra;p<de;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=_i;break}n.mode=16204;case 16204:if(d===0)break t;if(R=S-d,n.offset>R){if(R=n.offset-R,R>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=_i;break}R>n.wnext?(R-=n.wnext,O=n.wsize-R):O=n.wnext-R,R>n.length&&(R=n.length),A=n.window}else A=r,O=c-n.offset,R=n.length;R>d&&(R=d),d-=R,n.length-=R;do r[c++]=A[O++];while(--R);n.length===0&&(n.mode=$v);break;case 16205:if(d===0)break t;r[c++]=n.length,d--,n.mode=$v;break;case _O:if(n.wrap){for(;p<32;){if(l===0)break t;l--,h|=i[a++]<<p,p+=8}if(S-=d,t.total_out+=S,n.total+=S,4&n.wrap&&S&&(t.adler=n.check=tr(n)?mr(n.check,r,S,c-S):Yg(n.check,r,S,c-S)),S=d,4&n.wrap&&(tr(n)?h:Xx(h))!==n.check){t.msg="incorrect data check",n.mode=_i;break}h=0,p=0}n.mode=16207;case 16207:if(n.wrap&&tr(n)){for(;p<32;){if(l===0)break t;l--,h+=i[a++]<<p,p+=8}if(4&n.wrap&&h!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=_i;break}h=0,p=0}n.mode=16208;case 16208:Q=T8;break t;case _i:Q=Yx;break t;case 16210:return qx;default:return La}return t.next_out=c,t.avail_out=d,t.next_in=a,t.avail_in=l,n.hold=h,n.bits=p,(n.wsize||S!==t.avail_out&&n.mode<_i&&(n.mode<_O||e!==Kx))&&eV(t,t.output,t.next_out,S-t.avail_out),m-=t.avail_in,S-=t.avail_out,t.total_in+=m,t.total_out+=S,n.total+=S,4&n.wrap&&S&&(t.adler=n.check=tr(n)?mr(n.check,r,S,t.next_out-S):Yg(n.check,r,S,t.next_out-S)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Sl?128:0)+(n.mode===Zv||n.mode===mO?256:0),(m===0&&S===0||e===Kx)&&Q===bh&&(Q=y8),Q},Tl={inflateReset:Qx,inflateReset2:Zx,inflateResetKeep:Jx,inflateInit:t=>$x(t,15),inflateInit2:$x,inflate:b8,inflateEnd:t=>{if(Ah(t))return La;let e=t.state;return e.window&&(e.window=null),t.state=null,bh},inflateGetHeader:(t,e)=>{if(Ah(t))return La;const n=t.state;return(2&n.wrap)==0?La:(n.head=e,e.done=!1,bh)},inflateSetDictionary:(t,e)=>{const n=e.length;let i,r,a;return Ah(t)?La:(i=t.state,i.wrap!==0&&i.mode!==Qv?La:i.mode===Qv&&(r=1,r=Yg(r,e,n,0),r!==i.check)?Yx:(a=eV(t,e,n,n),a?(i.mode=16210,qx):(i.havedict=1,bh)))},inflateInfo:"pako inflate (from Nodeca project)"},A8=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const nV=Object.prototype.toString,{Z_NO_FLUSH:I8,Z_FINISH:w8,Z_OK:eS,Z_STREAM_END:SO,Z_NEED_DICT:TO,Z_STREAM_ERROR:O8,Z_DATA_ERROR:iV,Z_MEM_ERROR:N8}=jv;function tC(t){this.options=Wv.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Hx,this.strm.avail_out=0;let n=Tl.inflateInit2(this.strm,e.windowBits);if(n!==eS)throw new Error(Rh[n]);if(this.header=new A8,Tl.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=$g.string2buf(e.dictionary):nV.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Tl.inflateSetDictionary(this.strm,e.dictionary),n!==eS)))throw new Error(Rh[n])}function D8(t,e){const n=new tC(e);if(n.push(t),n.err)throw n.msg||Rh[n.err];return n.result}tC.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let a,c,l;if(this.ended)return!1;for(c=e===~~e?e:e===!0?w8:I8,nV.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),a=Tl.inflate(n,c),a===TO&&r&&(a=Tl.inflateSetDictionary(n,r),a===eS?a=Tl.inflate(n,c):a===iV&&(a=TO));n.avail_in>0&&a===SO&&n.state.wrap>0&&t[n.next_in]!==0;)Tl.inflateReset(n),a=Tl.inflate(n,c);switch(a){case O8:case iV:case TO:case N8:return this.onEnd(a),this.ended=!0,!1}if(l=n.avail_out,n.next_out&&(n.avail_out===0||a===SO))if(this.options.to==="string"){let d=$g.utf8border(n.output,n.next_out),h=n.next_out-d,p=$g.buf2string(n.output,d);n.next_out=h,n.avail_out=i-h,h&&n.output.set(n.output.subarray(d,d+h),0),this.onData(p)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(a!==eS||l!==0){if(a===SO)return a=Tl.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},tC.prototype.onData=function(t){this.chunks.push(t)},tC.prototype.onEnd=function(t){t===eS&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Wv.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var L8={inflate:D8};const{deflate:P8}=p8,{inflate:k8}=L8;var M8=P8,U8=k8,rV=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(rV||{});class x8{constructor(){N(this,"_sequence",0),N(this,"_startTime",Date.now()),N(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const l=new Uint8Array(4);l.set([1,0,0,0]);const d={id:0,length:4,data:l.buffer},h={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[d]};n.commonPacketHeader.extension=1,n.extension=h,n.payload=this.compress(e),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;U("SHOW_DATASTREAM2_LOG")&&v.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),r=new Uint8Array(i),a=new DataView(i);let c=0;if(a.setUint16(c,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),c+=2,a.setUint32(c,n.commonPacketHeader.sequence,!0),c+=4,a.setUint16(c,n.commonStreamHeader,!0),c+=2,n.extension){const l=this.serializeExtension(n.extension);r.set(new Uint8Array(l),c),c+=l.byteLength}if(r.set(new Uint8Array(n.payload),c),c+=n.payload.byteLength,c!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const n=new DataView(e);let i=0;const r=n.getUint16(i,!0);i+=2;const a={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let c,l;if(i+=4,U("SHOW_DATASTREAM2_LOG")&&v.debug("receive data header: ".concat(JSON.stringify(a))),n.getUint16(i,!0),i+=2,a.extension){l=this.deserializeExtension(e.slice(i)),i+=2+l.length,c=e.slice(i);let d=!1;if(l.datas.length>0){const h=l.datas.find(p=>p.id===0);h&&(d=(1&new DataView(h.data).getUint32(0,!0))==1)}c=d?this.decompress(c):c}else c=e.slice(8);return c}serializeExtension(e){const{profile:n,length:i,datas:r}=e,a=new ArrayBuffer(i+2),c=new Uint8Array(a),l=new DataView(a);let d=0;if(l.setUint8(d++,n),l.setUint8(d++,i),r.forEach(h=>{n?(l.setUint8(d++,h.id),l.setUint8(d++,h.length),c.set(new Uint8Array(h.data),d),d+=h.data.byteLength):(l.setUint8(d++,h.id|h.length<<4),c.set(new Uint8Array(h.data),d),d+=h.data.byteLength)}),d!==i+2)throw Error("serialize extension error, is ".concat(d,"!==").concat(i+2));return a}deserializeExtension(e){const n=new DataView(e);let i=0;const r=n.getUint8(i);i++;const a=n.getUint8(i);i++;const c=r===rV.TWO_BYTE,l=[],d=new DataView(e,2);let h=0;for(;h<a;){let p=0,m=0,S=new ArrayBuffer(0);c?(p=d.getUint8(h),h++,m=d.getUint8(h),h++):(p=15&d.getUint8(h),m=d.getUint8(h)>>4,h++),m>0&&(S=d.buffer.slice(h+2,h+2+m),h+=S.byteLength),l.push({id:p,length:m,data:S})}if(h!==a)throw Error("parse error");return{profile:r,length:a,datas:l}}decompress(e){return U8(new Uint8Array(e))}compress(e){return M8(new Uint8Array(e))}}const V8={name:"DataStream",create:(t,e)=>{const n=e?new KH(t):new YH(t);return n.useDataStream(new x8),n}};class B8 extends _n{constructor(e,n,i){super(),N(this,"ws",void 0),N(this,"requestId",1),N(this,"heartBeatTimer",void 0),N(this,"joinInfo",void 0),N(this,"clientId",void 0),N(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),N(this,"onClose",r=>{this.emit("close"),this.dispose()}),N(this,"onMessage",r=>{const a=JSON.parse(r.data);if(!a||a.command!=="serverResponse"||!a.requestId)return a&&a.command==="serverStatus"&&a.serverStatus&&a.serverStatus.command?(this.emit("status",a.serverStatus),void this.emit(a.serverStatus.command,a.serverStatus)):void 0;this.emit("req_".concat(a.requestId),a)}),this.joinInfo=e,this.clientId=n,this.ws=new Ig("cross-channel-".concat(this.clientId),i),this.ws.on(te.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(te.CONNECTED,this.onOpen),this.ws.on(te.ON_MESSAGE,this.onMessage),this.ws.on(te.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const n=this.requestId++;return e.requestId=n,e.seq=n,this.ws.sendMessage(e),n}waitStatus(e){return new Et((n,i)=>{const r=window.setTimeout(()=>{i(new J(P.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,a=>{window.clearTimeout(r),a.state&&a.state!==0?i(new J(P.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),i(new J(P.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new J(P.WS_DISCONNECT);const n=()=>new Et((c,l)=>{this.ws.once(te.CLOSED,()=>l(new J(P.WS_ABORT))),this.ws.once(te.CONNECTED,c)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(e),r=new Et((c,l)=>{const d=()=>{l(new J(P.WS_ABORT))};this.ws.once(te.RECONNECTING,d),this.ws.once(te.CLOSED,d),this.once("req_".concat(i),c),Ti(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(te.RECONNECTING,d),this.ws.off(te.CLOSED,d),l(new J(P.TIMEOUT,"cross channel ws request timeout"))})}),a=await r;if(!a||a.code!==200)throw new J(P.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(a)));return a}async connect(e){this.ws.removeAllListeners(te.REQUEST_NEW_URLS),this.ws.on(te.REQUEST_NEW_URLS,n=>{n(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const n=this.requestId++;return e.requestId=n,this.ws.sendMessage(e),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class F8 extends _n{set state(e){e!==this._state&&(e!==Fr.RELAY_STATE_FAILURE&&(this.errorCode=Xf.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,n,i,r,a){super(),N(this,"joinInfo",void 0),N(this,"sid",void 0),N(this,"clientId",void 0),N(this,"cancelToken",vr.CancelToken.source()),N(this,"workerToken",void 0),N(this,"requestId",0),N(this,"signal",void 0),N(this,"prevChannelMediaConfig",void 0),N(this,"httpRetryConfig",void 0),N(this,"_resolution",void 0),N(this,"_state",Fr.RELAY_STATE_IDLE),N(this,"errorCode",Xf.RELAY_OK),N(this,"onStatus",c=>{v.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",pl.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",pl.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Xf.SRC_TOKEN_EXPIRED,this.state=Fr.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Xf.DEST_TOKEN_EXPIRED,this.state=Fr.RELAY_STATE_FAILURE))}),N(this,"onReconnect",async()=>{v.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",pl.NETWORK_DISCONNECTED),this.state=Fr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==Fr.RELAY_STATE_IDLE&&(v.error("auto restart channel media relay failed",c.toString()),this.errorCode=Xf.SERVER_CONNECTION_LOST,this.state=Fr.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=n,this.sid=rh(),this.signal=new B8(this.joinInfo,this.clientId,i),this.httpRetryConfig=r,this._resolution=a}async startChannelMediaRelay(e){if(this.state!==Fr.RELAY_STATE_IDLE)throw new J(P.INVALID_OPERATION);this.state=Fr.RELAY_STATE_CONNECTING,await this.connect(),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new J(P.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new J(P.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new J(P.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Fr.RELAY_STATE_RUNNING)throw new J(P.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Fr.RELAY_STATE_RUNNING)throw new J(P.INVALID_OPERATION);const n=this.genMessage(fr.SetVideoProfile);await this.signal.request(n),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),v.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Fr.RELAY_STATE_IDLE,this.dispose()}dispose(){v.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=vr.CancelToken.source(),this.state=Fr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await J6(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",pl.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const n=this.genMessage(fr.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(fr.SetSdkProfile,e);await this.signal.request(i),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(fr.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",pl.PACKET_JOINED_SRC_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const a=this.genMessage(fr.SetSourceUserId,e);await this.signal.request(a),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(fr.SetDestChannel,e);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",pl.PACKET_JOINED_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const l=this.genMessage(fr.StartPacketTransfer,e);await this.signal.request(l),this.emit("event",pl.PACKET_SENT_TO_DEST_CHANNEL),this.state=Fr.RELAY_STATE_RUNNING,v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const n=this.genMessage(fr.UpdateDestChannel,e);await this.signal.request(n),this.emit("event",pl.PACKET_UPDATE_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(fr.StopPacketTransfer);await this.signal.request(e),v.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,n){const i=[],r=[],a=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:qs,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.23.2"&&(c.sdkVersion="0.0.1");let l=null,d=null;switch(e){case fr.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case fr.SetSourceChannel:if(d=n&&n.getSrcChannelMediaInfo(),!d)throw new J(P.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:d.channelName,token:d.token||this.joinInfo.appId},c;case fr.SetSourceUserId:if(d=n&&n.getSrcChannelMediaInfo(),!d)throw new J(P.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:d.uid+""},c;case fr.SetDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new J(P.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{i.push(h.channelName),r.push(h.uid+""),a.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:i,uid:r,token:a},c;case fr.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case fr.Reconnect:return c.clientRequest={command:"Reconnect"},c;case fr.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case fr.UpdateDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new J(P.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{i.push(h.channelName),r.push(h.uid+""),a.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:i,uid:r,token:a},c;case fr.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}const j8={name:"ChannelMediaRelay",create:function(t){return new F8(t.joinInfo,t.clientId,t.websocketRetryConfig||Kn,t.httpRetryConfig||Kn,t.resolution)}};function sV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function nS(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?sV(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):sV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class G8 extends _n{constructor(e,n,i,r){super(),N(this,"spec",void 0),N(this,"token",void 0),N(this,"websocket",void 0),N(this,"pingpongTimer",void 0),N(this,"reconnectMode","retry"),N(this,"serviceMode",void 0),N(this,"reqId",0),N(this,"commandReqId",0),N(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),N(this,"handleWebSocketMessage",a=>{if(!a.data)return;const c=JSON.parse(a.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):(kt.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===hl.TRANSCODE?1:2}),this.emit(vu.PUBLISH_STREAM_STATUS,c))}),this.spec=n,this.token=e,this.serviceMode=r,this.websocket=new Ig("live-streaming",i),this.websocket.on(te.CONNECTED,this.handleWebSocketOpen),this.websocket.on(te.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(te.REQUEST_NEW_URLS,(a,c)=>{Li(this,vu.REQUEST_NEW_ADDRESS).then(a).catch(c)}),this.websocket.on(te.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,n,i,r){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const a=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new J(P.UNEXPECTED_ERROR);const l=nS({command:e,sdkVersion:qs==="4.23.2"?"0.0.1":qs,seq:c,requestId:c,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new J(P.WS_DISCONNECT);const d=()=>new Et((S,R)=>{this.websocket.once(te.CLOSED,()=>R(new J(P.WS_ABORT))),this.websocket.once(te.CONNECTED,S)});this.websocket.state!=="connected"&&await d(),l.clientRequest&&(l.clientRequest.workerToken=this.token);const h=new Et((S,R)=>{const O=()=>{R(new J(P.WS_ABORT))};this.websocket.once(te.RECONNECTING,O),this.websocket.once(te.CLOSED,O),this.once("@".concat(c,"-").concat(this.spec.sid),A=>{S(A)})});r&&kt.workerEvent(this.spec.sid,nS(nS({},r),{},{requestId:a,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const p=Date.now();this.websocket.sendMessage(l);let m=null;try{m=await h}catch(S){if(this.websocket.state==="closed")throw S;return await d(),await this.request(e,n,i)}return r&&kt.workerEvent(this.spec.sid,nS(nS({},r),{},{requestId:a,actionType:"response",payload:JSON.stringify(m.serverResponse),serverCode:m.code,success:m.code===200,responseTime:Date.now()-p})),m.code!==200&&this.handleResponseError(m),m}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=qs==="4.23.2"?"0.0.1":qs;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Jn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void v.warning("live stream response already exists stream");case Jn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Jn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Jn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new J(P.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Jn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new J(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Jn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new J(P.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Jn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new J(P.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(vu.WARNING,n,e.serverResponse.url)}case Jn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new J(P.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(vu.WARNING,n,e.serverResponse.url)}case Jn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new J(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Jn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new J(P.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Jn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new J(P.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(vu.WARNING,n,e.serverResponse.url)}case Jn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new J(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Jn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new J(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Jn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Jn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new J(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Jn.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new J(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new J(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Jn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new J(P.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(jy)},6e3)}}function aV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function jr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?aV(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):aV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class H8 extends _n{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kn,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Kn;super(),N(this,"onLiveStreamWarning",void 0),N(this,"onLiveStreamError",void 0),N(this,"spec",void 0),N(this,"retryTimeout",1e4),N(this,"connection",void 0),N(this,"httpRetryConfig",void 0),N(this,"wsRetryConfig",void 0),N(this,"streamingTasks",new Map),N(this,"isStartingStreamingTask",!1),N(this,"taskMutex",new xi("live-streaming")),N(this,"cancelToken",vr.CancelToken.source()),N(this,"transcodingConfig",void 0),N(this,"uapResponse",void 0),N(this,"lastTaskId",1),N(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(e){const n=jr(jr({},O6),e);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(v.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(c=>jr(jr(jr({},w6),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),function(c){Tn(c.width)||He(c.width,"config.width",0,1e4),Tn(c.height)||He(c.height,"config.height",0,1e4),Tn(c.videoBitrate)||He(c.videoBitrate,"config.videoBitrate",1,1e6),Tn(c.videoFrameRate)||He(c.videoFrameRate,"config.videoFrameRate"),Tn(c.lowLatency)||cl(c.lowLatency,"config.lowLatency"),Tn(c.audioSampleRate)||ei(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Tn(c.audioBitrate)||He(c.audioBitrate,"config.audioBitrate",1,128),Tn(c.audioChannels)||ei(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),Tn(c.videoGop)||He(c.videoGop,"config.videoGop"),Tn(c.videoCodecProfile)||ei(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Tn(c.userCount)||He(c.userCount,"config.userCount",0,17),Tn(c.backgroundColor)||He(c.backgroundColor,"config.backgroundColor",0,16777215),Tn(c.userConfigExtraInfo)||Si(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!Tn(c.transcodingUsers)&&(ll(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((l,d)=>{dv(l.uid),Tn(l.x)||He(l.x,"transcodingUser[".concat(d,"].x"),0,1e4),Tn(l.y)||He(l.y,"transcodingUser[".concat(d,"].y"),0,1e4),Tn(l.width)||He(l.width,"transcodingUser[".concat(d,"].width"),0,1e4),Tn(l.height)||He(l.height,"transcodingUser[".concat(d,"].height"),0,1e4),Tn(l.zOrder)||He(l.zOrder-1,"transcodingUser[".concat(d,"].zOrder"),0,100),Tn(l.alpha)||He(l.alpha,"transcodingUser[".concat(d,"].alpha"),0,1,!1)})),Tn(c.watermark)||yw(c.watermark,"watermark"),Tn(c.backgroundImage)||yw(c.backgroundImage,"backgroundImage"),c.images&&!Tn(c.images)&&(ll(c.images,"config.images"),c.images.forEach((l,d)=>{yw(l,"images[".concat(d,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(c=>jr(jr(jr({},Rw),c),{},{zOrder:255}))),n.backgroundImage&&(i.push(jr(jr(jr({},Rw),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(jr(jr(jr({},Rw),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(c=>jr({},c)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const r=(n.userConfigs||[]).map(c=>typeof c.uid=="number"?Et.resolve(c.uid):wU(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Et.all(r)).forEach((c,l)=>{n.userConfigs&&n.userConfigs[l]&&(n.userConfigs[l].uid=c)}),this.transcodingConfig=n,this.connection)try{var a;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(gi(a=this.streamingTasks).call(a)).map(l=>l.taskId).join("#")});v.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{v.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,c).then(()=>{v.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(d=>{v.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)})})}}async startLiveStreamingTask(e,n,i){if(!this.transcodingConfig&&n===hl.TRANSCODE)throw new J(P.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};v.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(n));const a=await this.taskMutex.lock();if(!this.connection&&i)return void a();if(this.streamingTasks.get(e)&&!i)return a(),new J(P.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(l){throw a(),l}switch(n){case hl.TRANSCODE:r.transcodingConfig=jr({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const c=this.lastTaskId++;try{const l=new Et((h,p)=>{Ti(this.retryTimeout).then(()=>{if(i)return p(i);const m=this.statusError.get(e);return m?(this.statusError.delete(e),p(m)):void 0})}),d=await Et.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:n===hl.TRANSCODE?1:2,requestByUser:!i,tid:c.toString()}),l]);this.isStartingStreamingTask=!1,v.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(d.code)),this.streamingTasks.set(e,{clientRequest:r,mode:n,url:e,taskId:c}),a()}catch(l){if(a(),this.isStartingStreamingTask=!1,!l.data||!l.data.retry||i)throw l;return l.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,n,l)):await this.startLiveStreamingTask(e,n,l)}}stopLiveStreamingTask(e){return new Et((n,i)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new J(P.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const a=r.mode;r.abortTask=()=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:a===hl.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var e;const n=Array.from(gi(e=this.streamingTasks).call(e));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(r=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,r)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=vr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new J(P.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Li(this,vw.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=n,this.connection=new G8(n.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(vu.WARNING,(i,r)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(r,i)),this.connection.on(vu.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(vu.REQUEST_NEW_ADDRESS,(i,r)=>{if(!this.connection)return r(new J(P.UNEXPECTED_ERROR,"can not get new live streaming address list"));Li(this,vw.REQUEST_WORKER_MANAGER_LIST,e).then(a=>{this.uapResponse=a,i(a.addressList)}).catch(r)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(e){const n=e.serverStatus&&e.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),r=e.reason;switch(e.code){case Jn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new J(P.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(i)return v.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,c);if(!this.isStartingStreamingTask)return;this.statusError.set(n,c)}case Jn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new J(P.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,c)}case Jn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Jn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var a;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(gi(a=this.streamingTasks).call(a));for(const l of c)l.abortTask?l.abortTask():(v.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new J(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{v.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(d=>{v.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const W8={name:"LiveStreaming",create:function(t){return new H8(t.joinInfo,t.websocketRetryConfig||Kn,t.httpRetryConfig||Kn)}};function K8(t){let e=lV();return function(n,i){let r=n.appId;r!==void 0&&(xe(i,10),_c(i,r));let a=n.cid;a!==void 0&&(xe(i,16),xe(i,a));let c=n.cname;c!==void 0&&(xe(i,26),_c(i,c));let l=n.deviceId;l!==void 0&&(xe(i,34),_c(i,l));let d=n.elapse;d!==void 0&&(xe(i,40),xu(i,d));let h=n.fileSize;h!==void 0&&(xe(i,48),xu(i,hm(h)));let p=n.height;p!==void 0&&(xe(i,56),xu(i,hm(p)));let m=n.jpg;m!==void 0&&(xe(i,66),xe(i,m.length),function(Or,it){let ft=pm(Or,it.length);Or.bytes.set(it,ft)}(i,m));let S=n.networkType;S!==void 0&&(xe(i,72),xu(i,hm(S)));let R=n.osType;R!==void 0&&(xe(i,80),xu(i,hm(R)));let O=n.requestId;O!==void 0&&(xe(i,90),_c(i,O));let A=n.sdkVersion;A!==void 0&&(xe(i,98),_c(i,A));let I=n.sequence;I!==void 0&&(xe(i,104),xu(i,hm(I)));let D=n.sid;D!==void 0&&(xe(i,114),_c(i,D));let L=n.timestamp;L!==void 0&&(xe(i,120),xu(i,L));let V=n.uid;V!==void 0&&(xe(i,128),xe(i,V));let W=n.vid;W!==void 0&&(xe(i,136),xe(i,W));let K=n.width;K!==void 0&&(xe(i,144),xu(i,hm(K)));let G=n.service;G!==void 0&&(xe(i,152),xe(i,G));let Q=n.callbackData;Q!==void 0&&(xe(i,162),_c(i,Q));let lt=n.jpgEncryption;lt!==void 0&&(xe(i,168),xe(i,lt));let Tt=n.requestType;Tt!==void 0&&(xe(i,176),xe(i,Tt));let At=n.scorePorn;At!==void 0&&(xe(i,185),bO(i,At));let de=n.scoreSexy;de!==void 0&&(xe(i,193),bO(i,de));let he=n.scoreNeutral;he!==void 0&&(xe(i,201),bO(i,he));let Ze=n.scene;Ze!==void 0&&(xe(i,208),xe(i,Ze));let Mn=n.ossFilePrefix;Mn!==void 0&&(xe(i,218),_c(i,Mn));let An=n.serviceVendor;if(An!==void 0)for(let Or of An){xe(i,226);let it=lV();z8(Or,it),xe(i,it.limit),Z8(i,it),Q8(it)}}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function Y8(t){return function(n){let i={};t:for(;!uV(n);){let r=Ec(n);switch(r>>>3){case 0:break t;case 1:i.code=Ec(n);break;case 2:i.msg=dV(n,Ec(n));break;case 3:{let a=X8(n);i.data=q8(n),n.limit=a;break}default:oV(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function q8(t){let e={};t:for(;!uV(t);){let n=Ec(t);switch(n>>>3){case 0:break t;case 1:e.requestId=dV(t,Ec(t));break;case 2:e.requestType=Ec(t)>>>0;break;case 3:e.scorePorn=CO(t);break;case 4:e.scoreSexy=CO(t);break;case 5:e.scoreNeutral=CO(t);break;case 6:e.requestScene=Ec(t)>>>0;break;case 7:e.scene=Ec(t)>>>0;break;default:oV(t,7&n)}}return e}function z8(t,e){let n=t.service;n!==void 0&&(xe(e,8),xe(e,n));let i=t.vendor;i!==void 0&&(xe(e,16),xe(e,i));let r=t.token;r!==void 0&&(xe(e,26),_c(e,r));let a=t.callbackUrl;a!==void 0&&(xe(e,34),_c(e,a))}function X8(t){let e=Ec(t),n=t.limit;return t.limit=t.offset+e,n}function oV(t,e){switch(e){case 0:for(;128&hV(t););break;case 2:yO(t,Ec(t));break;case 5:yO(t,4);break;case 1:yO(t,8);break;default:throw new Error("Unimplemented type: "+e)}}let J8=new Float32Array(1);new Uint8Array(J8.buffer);let RO=new Float64Array(1),Gr=new Uint8Array(RO.buffer);function hm(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let cV=[];function lV(){const t=cV.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function Q8(t){cV.push(t)}function yO(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function uV(t){return t.offset>=t.limit}function pm(t,e){let n=t.bytes,i=t.offset,r=t.limit,a=i+e;if(a>n.length){let c=new Uint8Array(2*a);c.set(n),t.bytes=c}return t.offset=a,a>r&&(t.limit=a),i}function vO(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function dV(t,e){let n=vO(t,e),i=String.fromCharCode,r=t.bytes,a="",c="";for(let l=0;l<e;l++){let d,h,p,m,S=r[l+n];(128&S)==0?c+=i(S):(224&S)==192?l+1>=e?c+=a:(d=r[l+n+1],(192&d)!=128?c+=a:(m=(31&S)<<6|63&d,m<128?c+=a:(c+=i(m),l++))):(240&S)==224?l+2>=e?c+=a:(d=r[l+n+1],h=r[l+n+2],(49344&(d|h<<8))!=32896?c+=a:(m=(15&S)<<12|(63&d)<<6|63&h,m<2048||m>=55296&&m<=57343?c+=a:(c+=i(m),l+=2))):(248&S)==240?l+3>=e?c+=a:(d=r[l+n+1],h=r[l+n+2],p=r[l+n+3],(12632256&(d|h<<8|p<<16))!=8421504?c+=a:(m=(7&S)<<18|(63&d)<<12|(63&h)<<6|63&p,m<65536||m>1114111?c+=a:(m-=65536,c+=i(55296+(m>>10),56320+(1023&m)),l+=3))):c+=a}return c}function _c(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}xe(t,i);let r=pm(t,i),a=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?a[r++]=l:(l<2048?a[r++]=l>>6&31|192:(l<65536?a[r++]=l>>12&15|224:(a[r++]=l>>18&7|240,a[r++]=l>>12&63|128),a[r++]=l>>6&63|128),a[r++]=63&l|128)}}function Z8(t,e){let n=pm(t,e.limit),i=t.bytes,r=e.bytes;for(let a=0,c=e.limit;a<c;a++)i[a+n]=r[a]}function hV(t){return t.bytes[vO(t,1)]}function pV(t,e){let n=pm(t,1);t.bytes[n]=e}function CO(t){let e=vO(t,8),n=t.bytes;return Gr[0]=n[e++],Gr[1]=n[e++],Gr[2]=n[e++],Gr[3]=n[e++],Gr[4]=n[e++],Gr[5]=n[e++],Gr[6]=n[e++],Gr[7]=n[e++],RO[0]}function bO(t,e){let n=pm(t,8),i=t.bytes;RO[0]=e,i[n++]=Gr[0],i[n++]=Gr[1],i[n++]=Gr[2],i[n++]=Gr[3],i[n++]=Gr[4],i[n++]=Gr[5],i[n++]=Gr[6],i[n++]=Gr[7]}function Ec(t){let e,n=0,i=0;do e=hV(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function xe(t,e){for(e>>>=0;e>=128;)pV(t,127&e|128),e>>>=7;pV(t,e)}function xu(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,a=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=pm(t,a),l=t.bytes;switch(a){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=a!==9?128|r:127&r;case 8:l[c+7]=a!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=a!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=a!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=a!==5?128|i:127&i;case 4:l[c+3]=a!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=a!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=a!==2?n>>>7|128:n>>>7&127;case 1:l[c]=a!==1?128|n:127&n}}function fV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const $8=new Map([["moderation",1],["supervise",2]]);class tK extends _n{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(mi.CONNECTION_STATE_CHANGE,n,e)}get inspectType(){return this._inspectType}set inspectType(e){var n;this._inspectMode=ds(n=e.map(i=>$8.get(i)||0)).call(n,(i,r)=>i+r),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),N(this,"name","AgoraRTCVideoContentInspect"),N(this,"_connectionState",Aa.CONNECTING),N(this,"_innerConnectionState",void 0),N(this,"sequence",0),N(this,"inspectStartTime",void 0),N(this,"workerManagerConnection",void 0),N(this,"workerConnection",void 0),N(this,"workerMessageLengthLimit",void 0),N(this,"inspectIntervalMinimum",void 0),N(this,"qualityRatio",void 0),N(this,"_connectInfo",void 0),N(this,"_cancelTokenSource",vr.CancelToken.source()),N(this,"_retryConfig",void 0),N(this,"wmSequence",0),N(this,"inspectInterval",void 0),N(this,"inspectTimer",null),N(this,"ossFilePrefix",void 0),N(this,"extraInfo",void 0),N(this,"_inspectType",void 0),N(this,"_inspectMode",void 0),N(this,"_quality",1),N(this,"qualityTimer",null),N(this,"_inspectId",void 0),N(this,"_needWorkUrlOnly",!1),N(this,"inspectImage",()=>{if(this.connectionState!==Aa.CONNECTED)throw new J(P.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Aa.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Je(5,"inspect-"),this.workerMessageLengthLimit=U("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=U("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=U("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Ig("worker-manager-"+this._inspectId,Kn),this.on(mi.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,v.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ia[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Ig("worker-"+this._inspectId,Kn),this.handleWorkerEvents()}async init(e,n){this.emit(mi.STATE_CHANGE,Ia.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new Et((r,a)=>{this.on(mi.CONNECTION_STATE_CHANGE,(c,l)=>{l===Aa.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorkerManager(c)}).catch(c=>{a(c)})})}async requestAP(e,n,i){const r=U("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),a=await function(l,d,h,p){let{appId:m,areaCode:S,cname:R,sid:O,token:A,uid:I}=d;nm++;const D="image_moderation_api",L={service_name:D,json_body:JSON.stringify({appId:m,areaCode:S,cname:R,command:"allocateEdge",requestId:nm,seq:nm,sid:O,token:A,ts:Date.now(),uid:I+""})};let V,W,K=l[0];return Eo(async()=>{V=Date.now();const G=await yo(K,{data:L,cancelToken:h,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(W=Date.now()-V,G.code!==0){const At=new J(P.UNEXPECTED_RESPONSE,"image inspect ap error, code"+G.code,{retry:!0,responseTime:W});throw v.error(At.toString()),At}const Q=JSON.parse(G.json_body);if(Q.code!==200){const At=new J(P.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Q.code,", reason: ").concat(Q.reason),{code:Q.code,responseTime:W});throw v.error(At.toString()),At}if(!Q.servers||!Array.isArray(Q.servers)||Q.servers.length===0){const At=new J(P.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Q.code,responseTime:W});throw v.error(At.toString()),At}const lt=U("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Tt=U("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Q.servers.map(At=>{let{address:de,wss:he}=At;if(de&&he)return"wss://".concat(de.replace(/\./g,"-"),".").concat(lt,":").concat(Tt||he)}).filter(At=>!!At),workerToken:Q.workerToken,vid:Q.vid,responseTime:W}},(G,Q)=>(kt.apworkerEvent(O,{success:!0,sc:200,serviceName:D,responseDetail:JSON.stringify(G.addressList),firstSuccess:Q===0,responseTime:W,serverIp:l[Q%l.length]}),!1),(G,Q)=>(kt.apworkerEvent(O,{success:!1,sc:G.data&&G.data.code||200,serviceName:D,responseTime:W,serverIp:l[Q%l.length]}),!!(G.code!==P.OPERATION_ABORTED&&G.code!==P.UNEXPECTED_RESPONSE||G.data&&G.data.retry)&&(K=l[(Q+1)%l.length],!0)),p)}(r,e,n,i);this.emit(mi.STATE_CHANGE,Ia.AP_CONNECTED);const{addressList:c}=a;return this.wmSequence++,c}async connectWorkerManager(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(mi.STATE_CHANGE,Ia.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(te.CONNECTED,async()=>{this.emit(mi.STATE_CHANGE,Ia.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(te.CLOSED,()=>{this._innerConnectionState<Ia.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(te.FAILED,()=>{this._innerConnectionState<Ia.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(te.RECONNECTING,()=>{this._innerConnectionState<Ia.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(te.ON_MESSAGE,async e=>{this.emit(mi.STATE_CHANGE,Ia.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(e.data);if(i.code!==200)throw v.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new J(P.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw v.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new J(P.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const r=U("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,a=n.replace(/:\d+\/?$/,":".concat(r));this.emit(mi.STATE_CHANGE,Ia.CONNECT_WORKER,a),this._needWorkUrlOnly?this.emit(mi.REQUEST_NEW_WORKER_URL,a):await this.connectWorker(a)}}),this.workerManagerConnection.on(te.WILL_RECONNECT,(e,n,i)=>{i(e)}),this.workerManagerConnection.on(te.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}handleWorkerEvents(){this.workerConnection.on(te.CONNECTED,async()=>{this.emit(mi.STATE_CHANGE,Ia.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Aa.CONNECTED}),this.workerConnection.on(te.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const i=Y8(new Uint8Array(e.data));if(U("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&v.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(mi.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const r={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},a=ds(n=Object.keys(r)).call(n,(l,d)=>r[l]>r[d]?l:d,"porn"),c=Object.keys(r).find(l=>l===a);this.emit(mi.INSPECT_RESULT,c)}else this.emit(mi.INSPECT_RESULT,void 0,new J(P.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(mi.INSPECT_RESULT,void 0,new J(P.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else v.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(mi.INSPECT_RESULT,void 0,new J(P.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(te.CLOSED,()=>{this.connectionState=Aa.CLOSED}),this.workerConnection.on(te.FAILED,()=>{this.connectionState=Aa.CLOSED}),this.workerConnection.on(te.RECONNECTING,()=>{this.connectionState=this.connectionState===Aa.CONNECTED?Aa.RECONNECTING:Aa.CONNECTING}),this.workerConnection.on(te.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this.workerConnection.on(te.REQUEST_NEW_URLS,(e,n)=>{this.workerManagerConnection.close(),this.once(mi.REQUEST_NEW_WORKER_URL,i=>{e([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const e=Ts(this,mi.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(mi.INSPECT_RESULT,void 0,new J(P.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(e,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(mi.INSPECT_RESULT,void 0,new J(P.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,n){let{appId:i,cname:r,cid:a,vid:c,sid:l,uid:d}=n;const h=Date.now(),p=await e.getCurrentFrameImage("image/jpeg",this.quality),m=await Xk(p,i,r),S=this.sequence+"-"+a+"-"+d+"-"+h+"-"+Je(12,""),R={appId:i,cid:a,cname:r,deviceId:"",elapse:(O=Number(h-this.inspectStartTime),{low:O|=0,high:O>>31,unsigned:O>=0}),fileSize:m.byteLength,jpgEncryption:2,height:p.height,width:p.width,jpg:m,networkType:6,osType:7,requestId:S,sdkVersion:"4.23.2",sequence:this.sequence,sid:l,timestamp:y2(h),uid:d,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var O;this.extraInfo===void 0&&delete R.callbackData,this.ossFilePrefix===void 0&&delete R.ossFilePrefix;const A=K8(R);if(A.byteLength<this.workerMessageLengthLimit){if(U("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const I=function(D){for(var L=1;L<arguments.length;L++){var V=arguments[L]!=null?arguments[L]:{};L%2?fV(Object(V),!0).forEach(function(W){N(D,W,V[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(D,Object.getOwnPropertyDescriptors(V)):fV(Object(V)).forEach(function(W){Object.defineProperty(D,W,Object.getOwnPropertyDescriptor(V,W))})}return D}({},R);delete I.jpg,v.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(I))}return A}{const I=this.quality*this.qualityRatio;return this.quality=I,await this.generateRequestData(e,{appId:i,cname:r,cid:a,vid:c,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=vr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Aa.CLOSED,this.emit(mi.STATE_CHANGE,Ia.CLOSED)}}const eK={name:"ContentInspect",create:function(t){let{config:e}=t;return function(n){if(!n)throw new J(P.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new J(P.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(r=>{var a;if(!_t(a=["supervise","moderation"]).call(a,r))throw new J(P.INVALID_PARAMS,"".concat(r," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new J(P.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(e),new tK(e)}};var mV=w(zr.Object.getOwnPropertySymbols),nK=Ue,iK=Nc.indexOf,rK=Ha,AO=Zt([].indexOf),_V=!!AO&&1/AO([1],1,-0)<0;nK({target:"Array",proto:!0,forced:_V||!rK("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return _V?AO(this,t,e)||0:iK(this,t,e)}});var sK=Sr("Array").indexOf,aK=ht,oK=sK,IO=Array.prototype,cK=function(t){var e=t.indexOf;return t===IO||aK(IO,t)&&e===IO.indexOf?oK:e},EV=w(cK);function lK(t,e){if(t==null)return{};var n,i,r=function(c,l){if(c==null)return{};var d,h,p={},m=x1(c);for(h=0;h<m.length;h++)d=m[h],EV(l).call(l,d)>=0||(p[d]=c[d]);return p}(t,e);if(mV){var a=mV(t);for(i=0;i<a.length;i++)n=a[i],EV(e).call(e,n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}let gV=class{get localCapabilities(){return yn(this._localCapabilities)}get rtpCapabilities(){return yn(this._rtpCapabilities)}get candidates(){return yn(this._candidates)}get iceParameters(){return yn(this._iceParameters)}get dtlsParameters(){return yn(this._dtlsParameters)}constructor(t){N(this,"sessionDesc",void 0),N(this,"_localCapabilities",void 0),N(this,"_rtpCapabilities",void 0),N(this,"_candidates",void 0),N(this,"_iceParameters",void 0),N(this,"_dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname","o/i14u9pJrxRKAsu"),N(this,"firefoxSsrcMidMap",new Map),t=yn(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:r,localCapabilities:a,direction:c,setup:l,videoCodec:d,audioCodec:h}=t;let p;this.setup=l,p=c===pr.RECEIVE_ONLY?Br(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Br(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=r,this._candidates=i,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=a;const m=c===pr.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,S=c===pr.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,R=c===pr.RECEIVE_ONLY?r.send.videoCodecs:Ng(wt.VIDEO,m,S,d),O=c===pr.RECEIVE_ONLY?r.send.audioCodecs:Ng(wt.AUDIO,m,S,h);for(const A of p.mediaDescriptions)A.attributes.iceUfrag=e.iceUfrag,A.attributes.icePwd=e.icePwd,A.attributes.fingerprints=n.fingerprints,A.attributes.candidates=i,A.attributes.setup=this.setup,A.media.mediaType==="application"&&(A.attributes.sctpPort="5000"),A.media.mediaType==="video"&&(A.media.fmts=R.map(I=>I.payloadType.toString(10)),A.attributes.payloads=R,A.attributes.extmaps=m.videoExtensions),A.media.mediaType==="audio"&&(A.media.fmts=O.map(I=>I.payloadType.toString(10)),A.attributes.payloads=O,A.attributes.extmaps=m.audioExtensions,em(A));this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return yu(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===t)}send(t,e,n,i,r){n=n.replace(/ /g,"-");const{ssrcs:a,ssrcGroups:c}=ph(e,this.cname,U("SYNC_GROUP")?n:void 0),l=this.findPreloadMediaDesc(a);if(l){if(Sn()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,l.attributes.mid),r&&(r.twcc||r.remb)){const d=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(l,r),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const d=this.findAvailableMediaIndex(t,a,i);let h;return d===-1?(h=this.createOrRecycleSendMedia(t,a,c,"sendonly",i,r),this.updateBundleMids()):(h=yn(this.sessionDesc.mediaDescriptions[d]),h.attributes.direction="sendonly",h.attributes.ssrcs=a,h.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(h,r)),Sn()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,h.attributes.mid),{needExchangeSDP:!0,mid:h.attributes.mid}}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,e,n){const i=[];return t.forEach(r=>{const a=r._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(a);let l,d=!1;c===-1?(d=!0,l=this.createOrRecycleRecvMedia(r,[],"recvonly",e,n),this.updateBundleMids()):(l=yn(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="recvonly"),i.push({mid:l.attributes.mid,needCreateTransceiver:d})}),i}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:e,protocol:n,address:i,port:r,type:a,relatedAddress:c,relatedPort:l,priority:d}=new RTCIceCandidate(t),h={foundation:e??"",componentId:"1",transport:n??"",priority:d?d+"":"",connectionAddress:i??"",port:r?r+"":"",type:a?a+"":"",relAddr:c??"",relPort:l?l+"":"",extension:{}};this.candidates.some(p=>p.priority===h.priority&&p.connectionAddress===h.connectionAddress&&p.port===h.port)||(this._candidates.push(h),this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,e,n,i,r){const a=t._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,l=Ng(a,c,this.localCapabilities.send,a===wt.AUDIO?r:i),d=a===wt.VIDEO?c.videoExtensions:c.audioExtensions,h="".concat(++this.currentMidIndex);let p={media:{mediaType:a,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};p=this.mungRecvMediaDsec(p,t);const m=this.findFirstClosedMedia(a);if(m){const S=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[S]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>_t(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>_t(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(t,e,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const r=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Sn()){if(r){const a=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(a||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!a||a!==i.attributes.mid)}return!1}return r&&i.attributes.mid===n})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const n=e.media.mediaType===t&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&n})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}restartICE(t){t=yn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,e,n,i,r,a){const c=this.rtpCapabilities.send,l=t===wt.VIDEO?c.videoCodecs:c.audioCodecs,d=t===wt.VIDEO?c.videoExtensions:c.audioExtensions;Sn()&&(r="".concat(++this.currentMidIndex));let h={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:r}};h=this.mungSendMediaDesc(h,a);const p=this.findFirstClosedMedia(t);if(p){const m=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[m]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}mungRecvMediaDsec(t,e,n){const i=yn(t);return ww(i),tm(i,e),Ow(i,e),cU(i),gv(i,n,this.localCapabilities.send),i}mungSendMediaDesc(t,e){const n=yn(t);return gv(n,e,this.localCapabilities.recv),em(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>Sn()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}};const uK=["sdp"];var rn;function SV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Vu(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?SV(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):SV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let TV=(rn=class fm extends H1{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,n,i){super(e,n),N(this,"direction",void 0),N(this,"name",void 0),N(this,"store",void 0),N(this,"spec",void 0),N(this,"peerConnection",void 0),N(this,"initialOffer",void 0),N(this,"transport",void 0),N(this,"statsFilter",void 0),N(this,"localCandidateCount",0),N(this,"_isInRestartIce",!1),N(this,"mutex",void 0),N(this,"onLocalCandidate",void 0),N(this,"remoteSDP",void 0),N(this,"pendingCandidates",[]),N(this,"localCapabilities",void 0),N(this,"isReady",!1),N(this,"restartCnt",0),N(this,"curTurnServerIndex",0),this.store=n,this.spec=e,this.mutex=new xi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(fm.resolvePCConfiguration(e,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??pr.SEND_ONLY,this.name=this.direction===pr.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=GI(this.peerConnection,U("STATS_UPDATE_INTERVAL"),void 0,Sn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const n=await uU();if(this.localCapabilities=Sv(n),e){const{sdp:i}=e,r=lK(e,uK),a=function(){const p={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},m=Og(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(wa(m,p,"videoExtensions",S,R,O),wa(m,p,"videoCodecs",S,R,O),wa(m,p,"audioExtensions",S,R,O),wa(m,p,"audioCodecs",S,R,O),U("RAISE_H264_BASELINE_PRIORITY")){const A=O.videoCodecs.findIndex(I=>I.rtpMap&&I.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&I.fmtp&&I.fmtp.parameters["profile-level-id"]==="42001f");if(A!==-1){const I=O.videoCodecs.findIndex(D=>D.rtpMap&&D.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(I<A){v.debug("raising H264 baseline profile priority");const D=O.videoCodecs[A];O.videoCodecs.splice(A,1),O.videoCodecs.splice(I,0,D)}I!==-1&&U("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(D=>!(D.rtpMap&&D.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&D.fmtp&&D.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:S,recv:R,sendrecv:O}}({},{},i);this.remoteSDP=new gV({remoteIceParameters:r.iceParameters,remoteDtlsParameters:r.dtlsParameters,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const l=Iu(c.sdp);await this.peerConnection.setLocalDescription(c);const d=await dU({},{},c.sdp);this.localCapabilities=Sv(d);const h=this.peerConnection.getTransceivers()[0];return h!=null&&h.receiver&&h.receiver.transport&&this.tryBindTransportEvents(h.receiver.transport),Vu(Vu({},l),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Iu(i.sdp);return this.initialOffer=i,Vu(Vu({},r),{},{sdp:i.sdp})}}catch(n){throw new Z(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:r}=e,a=await dU({},{},n);this.remoteSDP=new gV({remoteIceParameters:i,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:a,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new Z(P.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return Ys(function*(){const a=yield Te(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=r.remoteSDP.receive(e,n,i);e.forEach((I,D)=>{if(l[D].needCreateTransceiver){const L=r.peerConnection.addTransceiver(I._mediaStreamTrack,{direction:"sendonly"});c.push(L),I._updateRtpTransceiver(L)}else{const L=r.peerConnection.getTransceivers().find(V=>V.mid===l[D].mid);if(!L)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(l[D].mid));c.push(L),I._updateRtpTransceiver(L)}}),Sn()&&U("SIMULCAST")===!0&&(yield Te(r.applySimulcastForFirefox(c,e)));const d=l.map(I=>I.mid),h=yield Te(r.peerConnection.createOffer()),p=r.mungSendOfferSDP(h.sdp,e,d),m=Br(p),S=d.map(I=>{const D=m.mediaDescriptions.find(L=>L.attributes.mid===I);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return sU(D,U("USE_PUB_RTX"))}),R=c.map((I,D)=>{const L=d[D];return{localSSRC:S[D],id:L}});yield Te(r.peerConnection.setLocalDescription({type:"offer",sdp:p}));try{yield R}catch(I){const D=r.remoteSDP.toString();throw yield Te(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Te(r.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield Te(r.stopSending(d,!0)),I}yield Te(r.applySimulcastEncodings(c,e)),yield Te(r.applySendEncodings(c,e));const O=r.remoteSDP.toString(),A=r.logSDPExchange(p,"offer","local","send");return A==null||A(O),yield Te(r.setRemoteDescription({type:"answer",sdp:O})),c.map((I,D)=>{const L=d[D];return{localSSRC:S[D],id:L}})}catch(c){throw c instanceof Z?c:new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(d=>e.indexOf(d.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length (".concat(r.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));r.map(d=>{var h;d.direction="inactive",(h=d.stop)===null||h===void 0||h.call(d)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const d=this.remoteSDP.toString(),h=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});const p=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(p.sdp,a,e);h==null||h(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(d=>d.mid===a);if(!l||l.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,mid:l.mid,transceiver:l}}catch(a){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async mockReceive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const l=this.remoteSDP.toString(),d=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const h=await this.peerConnection.createAnswer(),p=this.mungReceiveAnswerSDP(h.sdp,a,e);d==null||d(p||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:p}),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(a){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===sh.Auto&&(this.store.p2pTransport=sh.SdRtn,Ae().supportPCSetConfiguration&&this.peerConnection.setConfiguration(fm.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ae().supportPCSetConfiguration&&this.peerConnection.setConfiguration(fm.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=Iu(n.sdp);return this.store.descriptionStart(),this.direction===pr.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===pr.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=Iu(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const a=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new Z(P.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?Sn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:Vu(Vu({},ic),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Vu(Vu({},ic),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,n;_t(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var n;e.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r={iceServers:[]};var a;return e.iceServers?r.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(_g(e.turnServer.servers)?r.iceServers=e.turnServer.servers:(r.iceServers&&r.iceServers.push(...fm.turnServerConfigToIceServers(e.turnServer.servers,n,i)),U("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&e.turnServer.serversFromGateway&&r.iceServers.push(...fm.turnServerConfigToIceServers(e.turnServer.serversFromGateway,n,i)),_t(a=[sh.Relay,sh.SdRtn]).call(a,n)&&(r.iceTransportPolicy="relay"),U("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(r.iceTransportPolicy="relay")}))),U("ENABLE_ENCODED_TRANSFORM")&&Ae().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),v.debug("P2PConnection p2pTransport is ".concat(n)),r}static turnServerConfigToIceServers(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=[],a=e.filter(l=>l.tcpport);v.debug("P2PConnection turnServers is ".concat(a,", current index is ").concat(i));const c=a.length>i?a[i]:a[0];switch(n){case sh.SdRtn:const l=e.filter(h=>{var p;return _t(p=h.username).call(p,"glb:")&&h.turnServerURL==h.turnServerURL}),d=l.length>i?l[i]:l[0];d&&(r.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(bu(d.turnServerURL),":").concat(d.tcpport,"?transport=udp")}),r.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(bu(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;case sh.Relay:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(bu(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(bu(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var i;e!=null&&e.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,e.state))},e.onerror=i=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in i?i.error:i)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const i=e==null?void 0:e.iceTransport.state;var r;i&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:r}=n.getSelectedCandidatePair();v.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(p=>p.track===e._mediaStreamTrack)),!n)return v.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return v.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ae().supportSetRtpSenderParameters)return v.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},a={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var c;const{bitrateMax:p,frameRate:m,scaleResolutionDownBy:S}=e._encoderConfig;p&&(a.maxBitrate=1e3*p),_t(c=e._hints).call(c,Qe.LOW_STREAM)&&(m&&(a.maxFramerate=as(m)),S&&S>=1&&(a.scaleResolutionDownBy=S))}if(U("DSCP_TYPE")&&ol()){var l;const p=U("DSCP_TYPE");_t(l=["very-low","low","medium","high"]).call(l,p)&&(a.networkPriority=p)}const d=n.getParameters(),h=(i=d.encodings)===null||i===void 0?void 0:i[0];Sn()&&!h&&(r.encodings=[a]),h&&Object.assign(h,a),Object.assign(d,r),v.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await n.setParameters(d)}async applySendEncodings(e,n){try{if(!Ae().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],a=n[i];a instanceof cn&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,r.sender)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=Br(e);return n.forEach((a,c)=>{const l=i[c],d=r.mediaDescriptions.find(h=>h.attributes.mid===l);d&&(tm(d,a),lU(d,a,this.store.codec))}),yu(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let d=0;d<e.length;d++){var i,r,a,c,l;const h=e[d],p=n[d];if(p instanceof cn&&!_t(i=p._hints).call(i,Qe.LOW_STREAM)&&(r=p._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((a=p._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},S={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const R=h.sender.getParameters();await h.sender.setParameters(Object.assign(R,m))}}}async applySimulcastEncodings(e,n){if(!Sn()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof cn&&this.isVP8Simulcast(r)){const a=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const d=a.sender.getParameters();await a.sender.setParameters(Object.assign(d,c))}}}isVP8Simulcast(e){var n,i,r,a,c;return!!(e instanceof cn&&U("SIMULCAST")&&this.store.codec==="vp8"&&!_t(n=e._hints).call(n,Qe.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(a=e._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(U("SDP_LOGGING"))return v.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const a=this.remoteSDP.toString();r==null||r(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async c=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);const a=this.remoteSDP.toString();r==null||r(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(e,n){var i,r;if(n=(i=n)!==null&&i!==void 0?i:(r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp){var a;const c=(a=Br(n).mediaDescriptions.find(l=>l.attributes.mid===e))===null||a===void 0?void 0:a.attributes.ssrcs;return c==null?void 0:c[0].ssrcId}}async setRemoteDescription(e){var n;await this.peerConnection.setRemoteDescription(e),_t(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,n,i){const r=Br(e),a=r.mediaDescriptions.find(c=>c.attributes.mid===n);return a&&i===wt.AUDIO&&a.media.mediaType==="audio"&&em(a),yu(r)}},Dt(rn.prototype,"establish",[Pa],Object.getOwnPropertyDescriptor(rn.prototype,"establish"),rn.prototype),Dt(rn.prototype,"connect",[Pa],Object.getOwnPropertyDescriptor(rn.prototype,"connect"),rn.prototype),Dt(rn.prototype,"receive",[Pa],Object.getOwnPropertyDescriptor(rn.prototype,"receive"),rn.prototype),Dt(rn.prototype,"mockReceive",[Pa],Object.getOwnPropertyDescriptor(rn.prototype,"mockReceive"),rn.prototype),Dt(rn.prototype,"stopReceiving",[Pa],Object.getOwnPropertyDescriptor(rn.prototype,"stopReceiving"),rn.prototype),Dt(rn.prototype,"restartICE",[Pa],Object.getOwnPropertyDescriptor(rn.prototype,"restartICE"),rn.prototype),Dt(rn.prototype,"close",[Pa],Object.getOwnPropertyDescriptor(rn.prototype,"close"),rn.prototype),Dt(rn.prototype,"updateEncoderConfig",[Pa],Object.getOwnPropertyDescriptor(rn.prototype,"updateEncoderConfig"),rn.prototype),Dt(rn.prototype,"updateSendParameters",[Pa],Object.getOwnPropertyDescriptor(rn.prototype,"updateSendParameters"),rn.prototype),Dt(rn.prototype,"replaceTrack",[Pa],Object.getOwnPropertyDescriptor(rn.prototype,"replaceTrack"),rn.prototype),Dt(rn.prototype,"muteLocal",[Pa],Object.getOwnPropertyDescriptor(rn.prototype,"muteLocal"),rn.prototype),Dt(rn.prototype,"unmuteLocal",[Pa],Object.getOwnPropertyDescriptor(rn.prototype,"unmuteLocal"),rn.prototype),rn);function Pa(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,a=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{a()}},n}let Co=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var RV,yV,vV,CV,bV,AV,IV,wV,OV,NV,DV,hn;function LV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function eC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?LV(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):LV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let dK=(RV=bo(Co.SEND_ONLY),yV=bo(Co.SEND_ONLY),vV=bo(),CV=bo(Co.RECEIVE_ONLY),bV=bo(Co.RECEIVE_ONLY),AV=bo(Co.RECEIVE_ONLY),IV=bo(Co.RECEIVE_ONLY),wV=bo(Co.RECEIVE_ONLY),OV=bo(Co.RECEIVE_ONLY),NV=bo(),DV=bo(Co.RECEIVE_ONLY),hn=class extends _n{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(jt.StateChange,e,this._state)}constructor(t,e){super(),N(this,"isPlanB",!1),N(this,"store",void 0),N(this,"statsUploader",void 0),N(this,"sendConnection",void 0),N(this,"recvConnection",void 0),N(this,"localTrackMap",new Map),N(this,"remoteUserMap",new Map),N(this,"localDataChannels",[]),N(this,"pendingLocalTracks",[]),N(this,"pendingRemoteTracks",[]),N(this,"statsCollector",void 0),N(this,"dtlsFailedCount",0),N(this,"sendMutex",void 0),N(this,"recvMutex",void 0),N(this,"_state",ke.Disconnected),N(this,"_restartStates",["disconnected","failed"]),N(this,"reconnectInterval",void 0),N(this,"uploadUnplinkStarted",!1),N(this,"uploadDownlinkStarted",!1),N(this,"uplinkStateUploadInterval",void 0),N(this,"downlinkStatsUploadInterval",void 0),N(this,"handleMuteLocalTrack",async(n,i,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==ke.Connected)return void r(new Z(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const d=this.filterTobeMutedTracks(n);if(d.length===0)return void i();const h=d.find(R=>R[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(d.map(R=>{let[,{id:O}]=R;return O}));let p=!1;var c,l;n.trackMediaType==="video"?p=!((c=this.localTrackMap.get(ct.LocalAudioTrack))===null||c===void 0||!c.track._muted):p=((l=this.localTrackMap.get(ct.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;const m=this.createMuteMessage(d);await Xe(this,jt.RequestMuteLocal,m);const S=n.trackMediaType==="video"?Cu.MUTE_LOCAL_VIDEO:Cu.MUTE_LOCAL_AUDIO;await Xe(this,jt.RequestP2PMuteLocal,{action:S,message:m,isMuteAll:p}),i()}catch(d){r(d)}finally{a()}}),N(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==ke.Connected)return void r(new Z(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();await this.sendConnection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const l=this.createUnmuteMessage(c),d=n.trackMediaType==="video"?Cu.UNMUTE_LOCAL_VIDEO:Cu.UNMUTE_LOCAL_AUDIO;await Xe(this,jt.RequestP2PMuteLocal,{action:d,message:l}),i()}catch(c){r(c)}finally{a()}}),N(this,"handleUpdateVideoEncoder",async(n,i,r,a)=>{let c;typeof a=="boolean"&&a||(c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(ct.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==n||this.state!==ke.Connected)return void i();const{id:h,track:p}=d;h&&(await this.sendConnection.updateSendParameters(h,p),await this.sendConnection.updateEncoderConfig(h,p),this.emit(jt.UpdateVideoEncoder,p)),i()}catch(d){r(d)}finally{var l;(l=c)===null||l===void 0||l()}}),N(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const a=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(ct.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==n||this.state!==ke.Connected)return void i();const{id:l,track:d}=c;l&&await this.sendConnection.updateSendParameters(l,d),i()}catch(c){r(c)}finally{a()}}),N(this,"handleReplaceTrack",async(n,i,r,a)=>{let c;v.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof a=="boolean"&&a||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:m}]=p;return n===m});if(!this.sendConnection||!h||h[1].id===void 0||this.state!==ke.Connected)return void i();if(await((l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(n,h[1].id)),h[0]===ct.LocalVideoTrack&&Ae().supportDualStreamEncoding){const p=this.localTrackMap.get(ct.LocalVideoLowTrack);if(p){const m=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m,await new Et((S,R)=>{this.handleReplaceTrack(p.track,S,R,!0)})}}i()}catch(h){r(h)}finally{var d;(d=c)===null||d===void 0||d()}}),N(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),N(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),N(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),N(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new JU(t),this.bindStatsUploaderEvents(),this.sendMutex=new xi("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new xi("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},U("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,e){throw new Z(P.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new Z(P.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){let n;try{if(e){this.recvConnection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new TV(t,this.store,pr.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(e);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=ke.New,this.sendConnection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new TV(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(t){if(!this.sendConnection)throw new Z(P.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ke.Connected}async addRemoteCandidate(t,e){if(e===pr.RECEIVE_ONLY){if(!this.sendConnection)throw new Z(P.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new Z(P.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,e,n){var i=this;return Ys(function*(){const r=yield Te(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==ke.Connected){i.throwIfTrackTypeNotMatch(t);const h=t.filter(p=>i.pendingLocalTracks.indexOf(p)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(h))}i.store.pubId=i.store.pubId+1,Fi.markPublishStart(i.store.clientId,i.store.pubId);const a=i.filterTobePublishedTracks(t,e,n);if(a.length===0)return void(yield Te(i.tryToUnmuteAudio(t)));a.forEach(h=>{let{track:p,type:m}=h;const S=Date.now();i.store.publish(p.getTrackId(),m===ct.LocalAudioTrack?"audio":"video",S)}),i.bindLocalTrackEvents(a);const c=yield Te(i.sendConnection.send(a.map(h=>{let{track:p}=h;return p}),i.store.codec,i.store.audioCodec)),l=(yield Te(c.next())).value,d=i.createGatewayPublishMessage(a,l);try{yield d}catch(h){throw c.throw(h),(h==null?void 0:h.code)===P.WS_ABORT&&a.forEach(p=>{let{track:m}=p;i.pendingLocalTracks.indexOf(m)===-1&&i.pendingLocalTracks.push(m)}),i.unbindLocalTrackEvents(a),h}yield Te(c.next()),a.forEach(h=>{let{type:p}=h;i.statsCollector.addLocalStats(p)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(a,l),a.forEach(h=>{let{track:p,type:m}=h;const S=Date.now();i.store.publish(p.getTrackId(),m===ct.LocalAudioTrack?"audio":"video",void 0,S)}),i.startUploadUplinkState()}finally{r()}})()}async unpublish(t){if(!this.sendConnection||this.state!==ke.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(r=>!_t(t).call(t,r)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(r=>r[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(r=>{let[,{id:a}]=r;return a})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(r=>{let[a,{track:c}]=r;return{type:a,track:c}})),e.forEach(r=>{let[a]=r;this.statsCollector.removeLocalStats(a)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===ke.Connected)return n&&n[1].track.close(),i;t.forEach(r=>{const a=this.pendingLocalTracks.indexOf(r);a!==-1&&this.pendingLocalTracks.splice(a,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const e=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:a,ssrcs:c}]=i;const l={stream_type:nW(a,r),ssrcs:c};a._muted||!a._enabled?e.push(l):n.push(l)}),e.length>0&&e.forEach(i=>{Xe(this,jt.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{Xe(this,jt.RequestUnmuteLocal,[i])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Ys(function*(){throw new Z(P.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(v.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Li(this,jt.RequestRePublish,this.pendingLocalTracks),this.emit(jt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Z(P.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,e,n,i){var r;if(!this.recvConnection)throw new Z(P.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((r=this.remoteUserMap.get(t))!==null&&r!==void 0&&r.has(e))return;const{track:a,mid:c,transceiver:l}=await this.recvConnection.receive(e,[{ssrcId:n}],String(t.uid),i);e===wt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(a):(t._audioTrack=new Yf(a,t.uid,t._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),l&&t._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=n,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(a):(t._videoTrack=new Kf(a,t.uid,t._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),l&&t._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._videoTrack));const d=this.remoteUserMap.get(t);d?d.set(e,c):this.remoteUserMap.set(t,new Map([[e,c]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const h=this.pendingRemoteTracks.findIndex(p=>{let{user:m,kind:S}=p;return m.uid===t.uid&&e===S});h!==-1&&(this.pendingRemoteTracks.splice(h,1),this.emit(jt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,e,n,i){if(!this.recvConnection)throw new Z(P.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:n}],String(t.uid),i)}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(a=>{let{user:c,kind:l}=a;return e!==void 0?c.uid===t.uid&&e===l:c.uid===t.uid});if(i.forEach(a=>{const c=this.pendingRemoteTracks.indexOf(a);this.pendingRemoteTracks.splice(c,1)}),this.recvConnection||n||i.forEach(a=>{let{kind:c}=a;var l;if(c===wt.AUDIO)(l=t._audioTrack)===null||l===void 0||l._destroy(),t._audioTrack=void 0;else if(c===wt.VIDEO){var d;(d=t._videoTrack)===null||d===void 0||d._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const r=this.filterTobeUnSubscribedTracks(t,e);r.length!==0&&(await this.recvConnection.stopReceiving(r.map(a=>{let[,{id:c}]=a;return c})),this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),r.forEach(a=>{let[c,{kind:l}]=a;var d,h;if(l===wt.VIDEO&&c._videoSSRC&&((d=this.recvConnection)===null||d===void 0||d.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===wt.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0);else if(l===wt.AUDIO){var p;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((p=c._audioTrack)===null||p===void 0||p._destroy(),c._audioTrack=void 0)}}),r.forEach(a=>{let[,{kind:c}]=a;Xe(this,jt.RequestP2PMuteRemote,c)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,n]=e;[wt.VIDEO,wt.AUDIO].forEach(i=>{n.has(i)?Xe(this,jt.RequestP2PUnmuteRemote,i):Xe(this,jt.RequestP2PMuteRemote,i)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new Z(P.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new Z(P.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new Z(P.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new Z(P.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===wt.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void v.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||v.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(ct.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Xn){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==ct.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===ct.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===ct.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(ct.LocalAudioTrack),l=i?this.localTrackMap.get(ct.LocalVideoLowTrack):this.localTrackMap.get(ct.LocalVideoTrack);kt.publish(this.store.sessionId,{eventElapse:Fi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Qe.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var a;n||(n=[]);const c=n.find(d=>d instanceof bn),l=i?(a=this.localTrackMap.get(ct.LocalVideoTrack))===null||a===void 0?void 0:a.track:n.find(d=>d instanceof cn);kt.publish(this.store.sessionId,{eventElapse:Fi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Qe.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===wt.VIDEO?n._videoSSRC:n._audioSSRC;r&&kt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===wt.VIDEO,audio:i===wt.AUDIO,peerid:n.uid,subscribeRequestid:i===wt.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Fi.measureFromSubscribeStart(this.store.clientId,r)})}reset(){v.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new xi("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new xi("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(ct.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Xn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=ke.Disconnected}getStats(t){var e,n;return t?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(ct.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(ct.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof cn||e&&e.track instanceof bn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(ys(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(ct.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=tg(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(v.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=ke.Reconnecting,U("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case ct.LocalVideoTrack:_t(e=i._hints).call(e,Qe.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ct.LocalAudioTrack:i instanceof Xn?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ct.LocalVideoLowTrack:}}),this.emit(jt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(ys(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(jt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),v.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof Ou?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t,e){let n,i;if(t===pr.SEND_ONLY){if(!this.sendConnection)throw new Z(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new Z(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(e){const r=await i.restartICE(e);return i.isInRestartIce=!1,r}{const r=await i.restartICE();if(r){const a=await Li(this,jt.RequestP2PRestartICE,{direction:pr.RECEIVE_ONLY,iceParameter:r});await i.restartICE(a),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(ct.LocalVideoTrack),n=this.localTrackMap.get(ct.LocalAudioTrack),i=t.videoSend.find(R=>{var O;return R.ssrc===(e==null||(O=e.ssrcs)===null||O===void 0?void 0:O[0].ssrcId)}),r=t.audioSend.find(R=>{var O;return R.ssrc===(n==null||(O=n.ssrcs)===null||O===void 0?void 0:O[0].ssrcId)});if(!i||!r)return 1;const a=Ts(this,jt.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,d=c&&l?(c+l)/2:c||l,h=(d&&a?(d+a)/2:d||a)||0,p=100*t.sendPacketLossRate*.7/50+.3*h/1500,m=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,S=e==null?void 0:e.track;if(S&&S._encoderConfig&&S._hints.indexOf(Qe.SCREEN_TRACK)===-1){const R=S._encoderConfig.bitrateMax,O=t.bitrate.actualEncoded;if(R&&O){const A=(1e3*R-O)/(1e3*R);return k1[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,a=i._videoSSRC,c=t.audioRecv.find(O=>O.ssrc===r),l=t.videoRecv.find(O=>O.ssrc===a);if(!c&&!l)return void(e+=1);const d=Ts(this,jt.NeedSignalRTT),h=t.rtt,p=(h&&d?(h+d)/2:h||d)||0,m=c?c.jitterMs:void 0,S=t.recvPacketLossRate;let R=.7*S*100/50+.3*p/1500;m&&(R=.6*S*100/50+.2*p/1500+.2*m/400),e+=R<.1?1:R<.17?2:R<.36?3:R<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new Et((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}filterTobePublishedTracks(t,e,n){const i=[],r=Ae(),a=this.getAllTracks();t=Lf(t=t.filter(d=>a.indexOf(d)===-1));let c=!1,l=!1;for(const d of t){if(d instanceof cn&&(this.localTrackMap.has(ct.LocalVideoTrack)||c?new Z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:d,type:ct.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(d,n);i.push({track:h,type:ct.LocalVideoLowTrack})}if(d instanceof bn){const h=this.localTrackMap.get(ct.LocalAudioTrack);if(h){if(!(h.track instanceof Xn))throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0)}else if(l){const p=i.find(m=>{let{type:S}=m;return S===ct.LocalAudioTrack});if(!(p.track instanceof Xn))throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(d)}else{if(!r.webAudioMediaStreamDest||d instanceof Xn||d._bypassWebAudio)i.push({track:d,type:ct.LocalAudioTrack});else{const p=new Xn;p.addAudioTrack(d),i.push({track:p,type:ct.LocalAudioTrack})}l=!0}}}return i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=Lf(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof bn){const r=this.localTrackMap.get(ct.LocalAudioTrack);if(!r)continue;r.track instanceof Xn?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([ct.LocalAudioTrack,r]),r.track.close())):e.push([ct.LocalAudioTrack,r])}if(i instanceof cn){const r=this.localTrackMap.get(ct.LocalVideoTrack);if(!r)continue;e.push([ct.LocalVideoTrack,r]);const a=this.localTrackMap.get(ct.LocalVideoLowTrack);a&&e.push([ct.LocalVideoLowTrack,a])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case ct.LocalVideoTrack:n.addListener(Ot.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Ot.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ot.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ot.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Ot.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Ot.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Ot.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ot.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ct.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ct.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof Xn?t.trackList.forEach(n=>{n.addListener(Ot.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Ot.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Ot.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Ot.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Ot.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Ot.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Ot.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Ot.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Ot.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Ot.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(Ot.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case ct.LocalVideoTrack:n.off(Ot.GET_STATS,this.handleGetLocalVideoStats),n.off(Ot.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Ot.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Ot.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Ot.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Ot.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Ot.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Ot.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ct.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ct.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Xn?t.trackList.forEach(e=>{e.off(Ot.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ot.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ot.GET_STATS,this.handleGetLocalAudioStats),e.off(Ot.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ot.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Ot.GET_STATS,this.handleGetLocalAudioStats),t.off(Ot.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ot.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ot.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Ot.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ot.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof Kf&&e.addListener(Ot.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof Yf&&e.addListener(Ot.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Ot.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(wt.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(wt.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let a,{track:c,type:l}=n;switch(l){case ct.LocalAudioTrack:a=Me.Audio;break;case ct.LocalVideoTrack:a=_t(r=c._hints).call(r,Qe.SCREEN_TRACK)?Me.Screen:Me.High;break;case ct.LocalVideoLowTrack:a=Me.Low}return{kind:l===ct.LocalAudioTrack?wt.AUDIO:wt.VIDEO,stream_type:a,mid:e[i].id,ssrcs:e[i].localSSRC,isMuted:c.muted||!c.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case ct.LocalVideoTrack:i=_t(n=a._hints).call(n,Qe.SCREEN_TRACK)?Me.Screen:Me.High;break;case ct.LocalAudioTrack:i=Me.Audio;break;case ct.LocalVideoLowTrack:i=Me.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:a}=n;this.localTrackMap.set(a,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(e,")")),this.emit(jt.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(t.isInRestartIce=!1),_t(n=this._restartStates).call(n,e)&&!t.isInRestartIce&&(e==="disconnected"&&await Ti(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),kt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Rn.TRACER}).onSuccess(),this.emit(jt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(ys(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(Ff.FIRST_FRAME_DECODED),kt.firstRemoteFrame(this.store.sessionId,si.FIRST_AUDIO_DECODE,un.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Fi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(ys(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&kt.firstRemoteFrame(this.store.sessionId,si.FIRST_AUDIO_RECEIVED,un.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Fi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(ys(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&kt.firstRemoteFrame(this.store.sessionId,si.FIRST_VIDEO_RECEIVED,un.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Fi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(jt.ConnectionTypeChange,i),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Au(n))," -> ").concat(JSON.stringify(Au(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Au(n))," -> ").concat(JSON.stringify(Au(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(jt.LocalCandidate,{candidate:e,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const e=t===pr.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,v.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),t===pr.SEND_ONLY?this.restartICE(t):Li(this,jt.RequestP2PRestartICE,{direction:pr.SEND_ONLY}))}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(ct.LocalAudioTrack);if(t instanceof bn&&(n==null?void 0:n.track)instanceof Xn)return n.track.isActive||e.push([ct.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return t===a});if(i&&(e.push(i),i[0]===ct.LocalVideoTrack)){const r=this.localTrackMap.get(ct.LocalVideoLowTrack);r&&e.push([ct.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(ct.LocalAudioTrack);if(t instanceof bn&&(n==null?void 0:n.track)instanceof Xn)return n.track.isActive&&e.push([ct.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:a}]=r;return t===a});if(i)if(i[0]===ct.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(ct.LocalVideoLowTrack);r&&e.push([ct.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case ct.LocalAudioTrack:i=Me.Audio;break;case ct.LocalVideoTrack:i=_t(n=a._hints).call(n,Qe.SCREEN_TRACK)?Me.Screen:Me.High;break;case ct.LocalVideoLowTrack:i=Me.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:a,ssrcs:c,id:l}]=e;switch(r){case ct.LocalAudioTrack:i=Me.Audio;break;case ct.LocalVideoTrack:i=_t(n=a._hints).call(n,Qe.SCREEN_TRACK)?Me.Screen:Me.High;break;case ct.LocalVideoLowTrack:i=Me.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[a,c]=r;n.push([t,{kind:a,id:c}])});return n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:a}]=n;switch(r){case wt.VIDEO:return void(i._videoSSRC&&e.push({stream_type:wt.VIDEO,ssrcId:i._videoSSRC}));case wt.AUDIO:return void(i._audioSSRC&&e.push({stream_type:wt.AUDIO,ssrcId:i._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(ct.LocalVideoTrack),n=this.localTrackMap.get(ct.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new Et((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new Et((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof bn){const n=this.filterTobeUnmutedTracks(t[e]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await Xe(this,jt.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(jt.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(jt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ti(UI(this.dtlsFailedCount,Kn)),this.emit(jt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ct.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof cn)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof cn).length>1)throw new Z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof bn).length>1&&(t.some(e=>e instanceof bn&&e._bypassWebAudio)||!Ae().webAudioMediaStreamDest))throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof cn&&this.pendingLocalTracks.some(n=>n instanceof cn))throw new Z(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof bn&&this.pendingLocalTracks.some(n=>n instanceof bn)&&(!Ae().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof bn&&n._bypassWebAudio)))throw new Z(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!U("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ae().supportDualStreamEncoding,i=eC(eC({},{width:160,height:120,framerate:15,bitrate:50}),e);let r;r=n?t._mediaStreamTrack.clone():Kw(t,i);const a=Je(8,"track-low-"),c=new cn(r,eC(eC({},n&&{scaleResolutionDownBy:Iw(i,t)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return c.on(ah.TRANSCEIVER_UPDATED,l=>{t._updateRtpTransceiver(l,Vf.LOW_STREAM)}),c._hints.push(Qe.LOW_STREAM),t.addListener(Ot.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,n,i){var r;const a=Array.from(ys(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(a){i||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(d=>d.userId===a.uid&&d.type==="video");kt.firstRemoteVideoDecode(this.store.sessionId,si.FIRST_VIDEO_DECODE,un.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:e,videoheight:n,subscribeElapse:Fi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const a=await this.recvConnection.getRemoteSSRC(r);return a!==void 0&&a!==n}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new Z(P.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new Z(P.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new Z(P.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new Z(P.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new Z(P.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new Z(P.NOT_SUPPORTED)}async preConnect(t){throw new Z(P.NOT_SUPPORTED)}getEstablishParams(){throw new Z(P.NOT_SUPPORTED)}async reSubscribe(t){throw new Z(P.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new Z(P.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===ct.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Vf.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Dt(hn.prototype,"p2pConnect",[RV],Object.getOwnPropertyDescriptor(hn.prototype,"p2pConnect"),hn.prototype),Dt(hn.prototype,"unpublish",[yV],Object.getOwnPropertyDescriptor(hn.prototype,"unpublish"),hn.prototype),Dt(hn.prototype,"unpublishLowStream",[vV],Object.getOwnPropertyDescriptor(hn.prototype,"unpublishLowStream"),hn.prototype),Dt(hn.prototype,"subscribe",[CV],Object.getOwnPropertyDescriptor(hn.prototype,"subscribe"),hn.prototype),Dt(hn.prototype,"mockSubscribe",[bV],Object.getOwnPropertyDescriptor(hn.prototype,"mockSubscribe"),hn.prototype),Dt(hn.prototype,"unsubscribe",[AV],Object.getOwnPropertyDescriptor(hn.prototype,"unsubscribe"),hn.prototype),Dt(hn.prototype,"muteRemote",[IV],Object.getOwnPropertyDescriptor(hn.prototype,"muteRemote"),hn.prototype),Dt(hn.prototype,"unmuteRemote",[wV],Object.getOwnPropertyDescriptor(hn.prototype,"unmuteRemote"),hn.prototype),Dt(hn.prototype,"hasRemoteMediaWithLock",[OV],Object.getOwnPropertyDescriptor(hn.prototype,"hasRemoteMediaWithLock"),hn.prototype),Dt(hn.prototype,"disconnectForReconnect",[NV],Object.getOwnPropertyDescriptor(hn.prototype,"disconnectForReconnect"),hn.prototype),Dt(hn.prototype,"remoteMediaSsrcChanged",[DV],Object.getOwnPropertyDescriptor(hn.prototype,"remoteMediaSsrcChanged"),hn.prototype),hn);function bo(t){return function(e,n,i){const r=e[n];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];switch(t){case Co.SEND_ONLY:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d()}}case Co.RECEIVE_ONLY:{const d=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d()}}default:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(n)),h=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d(),h()}}}},i}}class Ih extends _n{constructor(e,n){super(),N(this,"signal",void 0),N(this,"token",void 0),N(this,"tokenTimeout",void 0),N(this,"tokenInterval",void 0),N(this,"_sequence",0),N(this,"userMap",new Map),N(this,"encoder",new TextEncoder),this.signal=e,this.token=n;const i=()=>{this.signal.connectionState===nn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*U("P2P_TOKEN_INTERVAL"))};i()}async send(e,n,i,r,a){var c,l,d;if(this.userMap.size===0)return;const h=Array.from(gi(c=this.userMap).call(c))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),r=(l=r)!==null&&l!==void 0?l:Je(6,""),a=(d=a)!==null&&d!==void 0?d:this._sequence++;const p={_id:r,_type:e,_seq:a,_message:n,token:"".concat(this.token,"_").concat(h)};U("SHOW_P2P_LOG")&&v.debug("send message",p,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(p)).forEach(S=>{this.signal.request(Yt.DATA_STREAM,{payload:Ru(this.encoder.encode(S))})});const m=new Et((S,R)=>{const O=window.setTimeout(()=>{this.off("res-@".concat(r,"_ack"),A),this.off("res-@".concat(r),D),this.off(Qf.ABORT,I),v.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),this.userMap.size===0?R(new Z(P.INVALID_REMOTE_USER)):R(new Z(P.TIMEOUT))},U("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),A=()=>{O&&window.clearTimeout(O),this.off(Qf.ABORT,I),i&&S()},I=()=>{O&&window.clearTimeout(O),this.off("res-@".concat(r,"_ack"),A),this.off("res-@".concat(r),D),R(new Z(P.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(Qf.ABORT,I),this.once("res-@".concat(r,"_ack"),A);const D=(V,W)=>{L=!0,O&&window.clearTimeout(O),this.off("res-@".concat(r,"_ack"),A),this.off(Qf.ABORT,I),V==="success"?S(W):R(new Z(P.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))};let L=!1;i||(this.once("res-@".concat(r),D),Ti(U("SIGNAL_REQUEST_TIMEOUT")).then(()=>{L||v.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(p))}))});try{return await m}catch(S){if(S.code===P.TIMEOUT)return await this.send(e,n,i,r,a);throw S}}onMessage(e){var n;const{_uid:i}=e;let r,a=this.userMap.get(i);if(a)r=a.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==kn.CHECK)return;const{token:h}=e;r=new Map,a={uid:i,isStart:!0,token:h,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,a),this.signal.emit(ue.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in e&&"total"in e){var c;const{id:h,total:p}=e,m=(c=r.get(h))!==null&&c!==void 0?c:[];if(m.push(e),r.has(h)||r.set(h,m),m.length!==p)return;{const S=tg(m).call(m,(R,O)=>R.index-O.index).map(R=>R.payload).join("");r.delete(h),(e=JSON.parse(S))._uid=i}}const{_type:l,token:d}=e;if(_t(n=[kn.ACK,kn.CHECK]).call(n,l))return l===kn.CHECK&&this.handleCheckToken(a,d),void this.receiveMessage(e);d==="".concat(a.token,"_").concat(this.token)?this.handleReceivedMessage(e):v.debug('Receive unexpected message", '.concat(d,", cur_token: ").concat(a.token,"_").concat(this.token),e)}check(){const e={_id:Je(6,""),token:this.token,_type:kn.CHECK};U("SHOW_P2P_LOG")&&v.debug("send message",e),this.signal.request(Yt.DATA_STREAM,{payload:Ru(this.encoder.encode(JSON.stringify(e)))})}ack(e){const n={_id:e,_type:kn.ACK,token:this.token};U("SHOW_P2P_LOG")&&v.debug("send message",n),this.signal.request(Yt.DATA_STREAM,{payload:Ru(this.encoder.encode(JSON.stringify(n)))})}response(e,n,i){this.send(kn.RESPONSE,JSON.stringify({success:!i,message:n}),!0,e)}handleReceivedMessage(e){const n=()=>{this.userMap.forEach(h=>{const{receivedMessagesMap:p,nextExpectedSequenceNumber:m}=h;for(;p.has(m);){const S=p.get(m);p.delete(m),this.receiveMessage(S),h.nextExpectedSequenceNumber++}})};if(!e)return void n();const{_uid:i,_seq:r}=e,a=this.userMap.get(i),{receivedMessagesMap:c,isStart:l,nextExpectedSequenceNumber:d}=a;if(r<d)return this.ack(e._id),void v.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));c.set(r,e),l&&r===d&&(this.receiveMessage(e),c.delete(d),a.nextExpectedSequenceNumber++,n())}receiveMessage(e){const{_id:n,_type:i,_message:r,_uid:a}=e;if(U("SHOW_P2P_LOG")&&v.debug("receive message",e),n){let c;switch(e._type!==kn.ACK&&(r&&(c=JSON.parse(r)),this.ack(e._id)),e._type){case kn.CANDIDATE:case kn.CONTROL:this.signal.emit(i,c,a);break;case kn.PUBLISH:case kn.UNPUBLISH:case kn.RESTART_ICE:case kn.CALL:c.uid=a,Li(this.signal,i,c).then(l=>{this.response(e._id,l)}).catch(()=>{this.response(e._id,void 0,!0)});break;case kn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case kn.RESPONSE:{const{success:l,message:d}=c;this.emit("res-@".concat(n),l?"success":"failed",d);break}}}}splitMessage(e){if(e.length<Ih.MAX_MESSAGE_SIZE)return[e];const n=[],{remoteToken:i}=JSON.parse(e),r=Je(6,"");let a=0,c=800;const l=Math.ceil(e.length/c);for(;e.length>0;){a++;const d={id:r,index:a,total:l,payload:e.slice(0,c),token:"".concat(this.token,"_").concat(i)};JSON.stringify(d).length>Ih.MAX_MESSAGE_SIZE?c-=50:(n.push(d),e=e.slice(c))}return n.map(d=>JSON.stringify(d))}handleCheckToken(e,n){return e.token!==n?(v.debug("token changed, from ".concat(e.token," to ").concat(n)),this.reset(e.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{v.debug("token timeout, ".concat(n)),this.reset(e.uid)},U("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await Li(this.signal,kn.CALL,void 0),n=await this.send(kn.CALL,e);this.signal.emit(qt.P2P_CONNECTION,n,!0)}async reset(e,n){const i=this.userMap.get(e);i&&(this.emit(Qf.ABORT),this.signal.emit(ue.ON_USER_OFFLINE,{uid:i.uid,reason:N6.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(v.debug("change local token from ".concat(n," to ").concat(n)),this.token=Je(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Qf.ABORT)}}N(Ih,"MAX_SIZE",1),N(Ih,"MAX_MESSAGE_SIZE",1024);class hK extends _n{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===nn.CONNECTED?this.emit(qt.WS_CONNECTED):e===nn.RECONNECTING?this.emit(qt.WS_RECONNECTING,this._websocketReconnectReason):e===nn.CLOSED&&this.emit(qt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),N(this,"_disconnectedReason",void 0),N(this,"_websocketReconnectReason",void 0),N(this,"_connectionState",nn.CLOSED),N(this,"reconnectToken",void 0),N(this,"p2pToken",void 0),N(this,"websocket",void 0),N(this,"openConnectionTime",void 0),N(this,"clientId",void 0),N(this,"lastMsgTime",Date.now()),N(this,"uploadCache",[]),N(this,"uploadCacheInterval",void 0),N(this,"rttRolling",new ck(5)),N(this,"pingpongTimer",void 0),N(this,"pingpongTimeoutCount",0),N(this,"joinResponse",void 0),N(this,"multiIpOption",void 0),N(this,"initError",void 0),N(this,"spec",void 0),N(this,"store",void 0),N(this,"_external_signal",void 0),N(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(qt.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const a="res-@".concat(r._id);this.emit(a,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){switch(r._type){case ue.ON_DATA_STREAM:return void this.handleDataStream(r._message);case ue.MUTE_AUDIO:case ue.MUTE_VIDEO:case ue.ON_P2P_LOST:case ue.ON_USER_ONLINE:return;case ue.ON_USER_OFFLINE:const{uid:a}=r._message;return v.debug("[".concat(this.clientId,"] user-offline uid: ").concat(a)),void this._external_signal.reset(a)}if(this.emit(r._type,r._message),r._type===ue.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===ue.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Pe.UID_BANNED);break;case 15:this.close(Pe.IP_BANNED);break;case 16:this.close(Pe.CHANNEL_BANNED)}if(r._type===ue.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case Ht.ERR_LICENSE_MISSING:this.close(Pe.LICENSE_MISSING);break;case Ht.ERR_LICENSE_EXPIRED:this.close(Pe.LICENSE_EXPIRED);break;case Ht.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Pe.LICENSE_MINUTES_EXCEEDED);break;case Ht.ERR_LICENSE_PERIOD_INVALID:this.close(Pe.LICENSE_PERIOD_INVALID);break;case Ht.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Pe.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ht.ERR_LICENSE_ILLEGAL:this.close(Pe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new bw("gateway-".concat(this.clientId),this.spec.retryConfig,!0,U("JOIN_GATEWAY_USE_DUAL_DOMAIN"),U("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===nn.CONNECTED&&this.reconnect("retry",Di.OFFLINE)}),this.p2pToken=Je(6,""),this._external_signal=new Ih(this,this.p2pToken)}async request(e,n,i,r){const a=Je(6,""),c={_id:a,_type:e,_message:n},l=this.websocket.connectionID,d=()=>new Et((O,A)=>{if(this.connectionState===nn.CONNECTED)return O();const I=()=>{this.off(qt.WS_CLOSED,D),O()},D=()=>{this.off(qt.WS_CONNECTED,I),A(new Z(P.WS_ABORT))};this.once(qt.WS_CONNECTED,I),this.once(qt.WS_CLOSED,D)});if(this.connectionState!==nn.CONNECTING&&this.connectionState!==nn.RECONNECTING||e===Yt.JOIN||e===Yt.REJOIN||await d(),this.websocket.sendMessage(c,!0),r)return;const h=new Et((O,A)=>{let I=!1;const D=(V,W)=>{I=!0,O({isSuccess:V==="success",message:W||{}}),this.off(qt.WS_CLOSED,L),this.off(qt.WS_RECONNECTING,L),this.emit(qt.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(a),D);const L=()=>{A(new Z(P.WS_ABORT,"type: ".concat(e))),this.off(qt.WS_CLOSED,L),this.off(qt.WS_RECONNECTING,L),this.off("res-@".concat(a),D)};this.once(qt.WS_CLOSED,L),this.once(qt.WS_RECONNECTING,L),Ti(U("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||I||(v.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(qt.REQUEST_TIMEOUT,e,n))})});let p=null;try{p=await h}catch(O){if(this.connectionState===nn.CLOSED||e===Yt.LEAVE)throw new Z(P.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?O.throw():e===Yt.JOIN||e===Yt.REJOIN?null:(await d(),await this.request(e,n))}if(p.isSuccess)return p.message;const m=Number(p.message.error_code||p.message.code),S=Ag(m),R=new Z(P.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(p.message.error_str),{code:m,data:p.message,desc:S.desc});return S.action==="success"?p.message:(v.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(m,", message: ").concat(S.desc,", action: ").concat(S.action)),m===Ht.ERR_TOO_MANY_BROADCASTERS?((e===Yt.JOIN||e===Yt.REJOIN)&&(this.initError=R,this.close()),R.throw()):S.action==="failed"?R.throw():S.action==="quit"?(this.initError=R,this.close(),R.throw()):(m===Ht.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Di.MULTI_IP)):this.reconnect(S.action,Di.SERVER_ERROR),e===Yt.JOIN||e===Yt.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new Et(i=>{const r=a=>{(!n||n(a))&&(this.off(e,r),i(a))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void v.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Cg.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const a=U("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==nn.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},U("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(e,n,i){return await this._external_signal.send(e,n,i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Et((n,i)=>{this.once(qt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(qt.WS_CLOSED,()=>i(this.initError||new Z(P.WS_ABORT))),this.connectionState=nn.CONNECTING,this.websocket.init(e).catch(i)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||Pe.LEAVE,this.connectionState=nn.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Je(6,""),this._external_signal.clear(),this._external_signal=new Ih(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(qt.ABORT_P2P_EXECUTION);const e=await Li(this,qt.REQUEST_JOIN_INFO),n=await this.request(Yt.JOIN,e);if(!n)return this.emit(qt.REPORT_JOIN_GATEWAY,P.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(qt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=nn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleDataStream(e){try{var n;const i=ih(e.payload),r=new TextDecoder().decode(i),a=JSON.parse(r);"total"in a&&"id"in a||_t(n=Object.values(kn)).call(n,a._type)?(a._uid=e.uid,this._external_signal.onMessage(a)):this.emit(ue.ON_DATA_STREAM,e)}catch{this.emit(ue.ON_DATA_STREAM,e)}}handleNotification(e){v.debug("[".concat(this.clientId,"] receive notification: "),e);const n=Ag(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Pe.UID_BANNED),void this.close()):void this.reconnect(n.action,Di.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=U("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(v.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>U("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Di.TIMEOUT):this.request(Yt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),U("REPORT_STATS")&&this.send(Yt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(te.RECONNECT_CREATE_CONNECTION,e=>{this.emit(qt.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(te.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(te.CLOSED,()=>{this.connectionState=nn.CLOSED}),this.websocket.on(te.FAILED,()=>{this._disconnectedReason=Pe.NETWORK_ERROR,this.connectionState=nn.CLOSED}),this.websocket.on(te.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===nn.CONNECTED?this.connectionState=nn.RECONNECTING:this.connectionState=nn.CONNECTING}),this.websocket.on(te.WILL_RECONNECT,(e,n,i)=>{e!=="retry"?(v.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):v.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(e)}),this.websocket.on(te.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(qt.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof Z&&e.code===P.UNEXPECTED_RESPONSE&&e.data.code===Ht.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Di.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Di.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(te.REQUEST_NEW_URLS,(e,n)=>{Li(this,qt.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(te.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const pK={name:"P2PChannel",create:function(t){let{store:e,statsCollector:n}=t;return new dK(e,n)},createSubmodule:function(t){let{store:e,spec:n}=t;return new hK(n,e)}};function PV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function kV(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?PV(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):PV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class fK{constructor(e){N(this,"sessionDesc",void 0),N(this,"localCapabilities",void 0),N(this,"rtpCapabilities",void 0),N(this,"candidates",void 0),N(this,"_originCandidates",void 0),N(this,"iceParameters",void 0),N(this,"dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname",void 0),e=yn(e);const{iceParameters:n,dtlsParameters:i,candidates:r,rtpCapabilities:a,setup:c,localCapabilities:l,sdkCodec:d,cname:h}=e,p=Br(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=a,this.candidates=r,this._originCandidates=yn(r),this.iceParameters=n,this.dtlsParameters=i,this.setup=c,this.localCapabilities=l,this.cname=h;for(let m=0;m<p.mediaDescriptions.length;m++){const S=p.mediaDescriptions[m];if(S.attributes.iceUfrag=n.iceUfrag,S.attributes.icePwd=n.icePwd,S.attributes.fingerprints=i.fingerprints,S.attributes.candidates=r,S.attributes.setup=c,S.media.mediaType==="video"){S.media.fmts=a.videoCodecs.map(O=>O.payloadType.toString(10));let R=a.videoCodecs.filter(O=>{var A,I;return(A=O.rtpMap)===null||A===void 0?void 0:_t(I=A.encodingName.toLowerCase()).call(I,d)});R.length===0&&(R=a.videoCodecs),S.attributes.payloads=R,S.attributes.extmaps=a.videoExtensions}S.media.mediaType==="audio"&&(S.media.fmts=a.audioCodecs.map(R=>R.payloadType.toString(10)),S.attributes.payloads=a.audioCodecs,S.attributes.extmaps=a.audioExtensions),p.mediaDescriptions[m]=this.mungMediaDesc(S)}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return yu(this.sessionDesc)}send(e,n,i){const{ssrcs:r,ssrcGroups:a}=ph(n,this.cname),c=this.sessionDesc.mediaDescriptions.find(h=>e===wt.VIDEO?h.media.mediaType==="video":h.media.mediaType==="audio"),l=r[0].attributes.label,d=r[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(r),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(a),{id:l,mslabel:d}}batchSend(e){return e.map(n=>{let{kind:i,ssrcMsg:r}=n;return this.send(i,r,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],r=[],a=[];n.attributes.ssrcs.forEach(c=>{_t(e).call(e,c.attributes.label||"")?a.push(c):i.push(c)}),n.attributes.ssrcGroups.forEach(c=>{var l;_t(l=a.map(d=>d.ssrcId)).call(l,c.ssrcIds[0])||r.push(c)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=r})}mute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(e,n,i){e.forEach((r,a)=>{const c=r._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(h=>h.attributes.mid===c.kind),d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],r);this.sessionDesc.mediaDescriptions[l]=d})}stopReceiving(e){}updateCandidates(e){const n=this._originCandidates.filter(r=>r.transport==="udp"),i=[];if(n.forEach(r=>{i.push(kV(kV({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),n.length!==0){switch(e){case Bi.TCP_RELAY:this.candidates=i;break;case Bi.UDP_TCP_RELAY:case Bi.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(e){e=yn(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const n=[];for(let i=0;i<e;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(e,n){const i=yn(e);return tm(i,n),Ow(i,n),i}updateRecvMedia(e,n){const i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(i!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=r}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,n,i){const r=this.sessionDesc.mediaDescriptions.find(c=>e===wt.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(r){const c=r.attributes.ssrcs.find(l=>l.attributes.label===n);var a;c&&(c.attributes.label=i,(a=c.attributes.msid)===null||a===void 0||a.replace(n,i))}}mungMediaDesc(e){const n=yn(e);return ww(n),function(i){const r=i.attributes.extmaps.find(a=>Ev(a.extensionName));r&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(r),1),i.attributes.payloads.forEach(a=>{const c=a.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&a.rtcpFeedbacks.splice(c,1)})}(n),n}getSSRC(e){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===e)return[i]}}var Ye;function MV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function nC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?MV(Object(n),!0).forEach(function(i){N(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):MV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let mK=(Ye=class uS extends W1{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return _t(n=Object.keys(Yy)).call(n,e)}))]}constructor(e,n){super(e,n),N(this,"store",void 0),N(this,"peerConnection",void 0),N(this,"remoteSDP",void 0),N(this,"initialOffer",void 0),N(this,"statsFilter",void 0),N(this,"useRTX",!1),N(this,"localCapabilities",void 0),N(this,"localCandidateCount",0),N(this,"allCandidatesReceived",!1),N(this,"establishPromise",void 0),N(this,"mutex",void 0),this.store=n,this.mutex=new xi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(uS.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=GI(this.peerConnection,U("STATS_UPDATE_INTERVAL"),void 0,Sn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Iu(e.sdp),i=Og(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:U("FILTER_VIDEO_FEC"),filterAudioFec:U("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=e,nC(nC({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:e.sdp})}catch(e){throw new Z(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new fK(nC(nC({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(e,n){throw new Z(P.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,n){var i=this;return Ys(function*(){const r=yield Te(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=e.map(S=>i.peerConnection.addTrack(S._mediaStreamTrack)),c=yield Te(i.peerConnection.createOffer()),l=Br(c.sdp),d=e.map(S=>{const R=S._mediaStreamTrack,O=l.mediaDescriptions.find(A=>A.attributes.mid===R.kind);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return function(A,I,D){const L=A.attributes.ssrcs.filter(W=>W.attributes.label===I),V=A.attributes.ssrcGroups;if(L.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(V&&L.length>1){const W=V.find(K=>K.ssrcIds.indexOf(L[0].ssrcId)!==-1);return W?[{ssrcId:W.ssrcIds[0],rtx:D?W.ssrcIds[1]:void 0}]:[{ssrcId:L[0].ssrcId}]}return[{ssrcId:L[0].ssrcId}]}(O,R.id,i.useRTX)});let h;try{h=yield d}catch(S){throw a.forEach(R=>{Ni()&&R.replaceTrack(null),i.peerConnection.removeTrack(R)}),S}const p=i.mungSendOfferSDP(c.sdp,e);i.remoteSDP.receive(e,n,h);const m=i.remoteSDP.toString();return yield Te(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Te(i.applySendEncodings(a,e)),yield Te(i.peerConnection.setRemoteDescription({type:"answer",sdp:m})),e.map((S,R)=>{const O=S._mediaStreamTrack.id;return{localSSRC:d[R],id:O}})}catch(a){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{r()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(a=>{var c;return e.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(a=>{Ni()&&a.replaceTrack(null),this.peerConnection.removeTrack(a)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:a,mslabel:c}=this.remoteSDP.send(e,n,r),l=new Et((p,m)=>{const S=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(a)))},1e4),R=O=>{const A=Re();if((A.name==="Safari"&&Number(A.version)===11||ur())&&O.track.id!==a&&O.streams[0].id===c){var I;const D=O.streams[0].getTracks()[0];return(I=this.remoteSDP)===null||I===void 0||I.updateTrackLabel(e,a,O.track.id),this.peerConnection.removeEventListener("track",R),clearTimeout(S),void p(D)}if(O.track.id===a)return this.peerConnection.removeEventListener("track",R),clearTimeout(S),void p(O.track)};this.peerConnection.addEventListener("track",R)}),d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(h),{track:await l,id:a}}catch(a){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var r;return e.indexOf(((r=i.track)===null||r===void 0?void 0:r.id)||"")!==-1});if(n.length!==e.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(Ni()&&i.track)i.track.enabled=!1;else{const r=i.getParameters();r.encodings.forEach(a=>a.active=!1),i.setParameters(r)}})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(a=>{var c;return e.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async a=>{if(Ni()&&a.track)a.track.enabled=!0;else{const c=a.getParameters();c.encodings.forEach(l=>l.active=!0),await a.setParameters(c)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Ys(function*(){const i=yield Te(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=Ae().supportPCSetConfiguration;if(e===Bi.RELAY&&!r)return;if(r){const h=n.peerConnection.getConfiguration(),p=e===Bi.RELAY?"relay":"all";h.iceTransportPolicy!==p&&(v.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(p,"]")),h.iceTransportPolicy=p,n.peerConnection.setConfiguration(h))}e!==Bi.RELAY&&n.remoteSDP.updateCandidates(e);const a=yield Te(n.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=Iu(a.sdp),{remoteIceParameters:l}=yield c.iceParameters;n.remoteSDP.restartICE(l);const d=n.remoteSDP.toString();yield Te(n.peerConnection.setLocalDescription(a)),yield Te(n.peerConnection.setRemoteDescription({type:"answer",sdp:d}))}catch(r){v.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const a=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new Z(P.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getSenders().filter(r=>{var a;return((a=r.track)===null||a===void 0?void 0:a.id)===e});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getSenders().find(r=>{var a;return((a=r.track)===null||a===void 0?void 0:a.id)===n});i&&await i.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,n){throw new Z(P.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new Z(P.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},U("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(_g(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...uS.turnServerConfigToIceServers(e.turnServer.servers)),U("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...uS.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(h=>{var p;return((p=h.track)===null||p===void 0?void 0:p.id)===e._mediaStreamTrack.id})),!n)return v.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!Ae().supportSetRtpSenderParameters)return v.warn("Browser not support set rtp-sender parameters");const r={},a={};if(e instanceof cn)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(U("DSCP_TYPE")&&ol()){var c;const h=U("DSCP_TYPE");_t(c=["very-low","low","medium","high"]).call(c,h)&&(a.networkPriority=h)}const l=n.getParameters(),d=(i=l.encodings)===null||i===void 0?void 0:i[0];d&&Object.assign(d,a),Object.assign(l,r),v.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await n.setParameters(l)}async applySendEncodings(e,n){try{if(!Ae().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],a=n[i];r&&a&&await this.updateRtpSenderEncodings(a,r)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n){const i=Br(e);return n.forEach((r,a)=>{const c=r._mediaStreamTrack,l=i.mediaDescriptions.find(d=>d.attributes.mid===c.kind);l&&tm(l,r)}),yu(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(e).map((a,c)=>{let{id:l,mslabel:d}=a;const{kind:h}=e[c];return new Et((p,m)=>{const S=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(l)))},1e4),R=O=>{const A=Re();if(A.name==="Safari"&&Number(A.version)===11&&O.track.id!==l&&O.streams[0].id===d){var I;const D=O.streams[0].getTracks()[0];return(I=this.remoteSDP)===null||I===void 0||I.updateTrackLabel(h,l,O.track.id),this.peerConnection.removeEventListener("track",R),clearTimeout(S),void p({track:D,id:l})}if(O.track.id===l)return this.peerConnection.removeEventListener("track",R),clearTimeout(S),void p({track:O.track,id:l})};this.peerConnection.addEventListener("track",R)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await Et.all(n)}catch(n){throw new Z(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(Ae().supportPCSetConfiguration){const n=uS.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Dt(Ye.prototype,"connect",[ta],Object.getOwnPropertyDescriptor(Ye.prototype,"connect"),Ye.prototype),Dt(Ye.prototype,"stopSending",[ta],Object.getOwnPropertyDescriptor(Ye.prototype,"stopSending"),Ye.prototype),Dt(Ye.prototype,"receive",[ta],Object.getOwnPropertyDescriptor(Ye.prototype,"receive"),Ye.prototype),Dt(Ye.prototype,"stopReceiving",[ta],Object.getOwnPropertyDescriptor(Ye.prototype,"stopReceiving"),Ye.prototype),Dt(Ye.prototype,"muteRemote",[ta],Object.getOwnPropertyDescriptor(Ye.prototype,"muteRemote"),Ye.prototype),Dt(Ye.prototype,"unmuteRemote",[ta],Object.getOwnPropertyDescriptor(Ye.prototype,"unmuteRemote"),Ye.prototype),Dt(Ye.prototype,"muteLocal",[ta],Object.getOwnPropertyDescriptor(Ye.prototype,"muteLocal"),Ye.prototype),Dt(Ye.prototype,"unmuteLocal",[ta],Object.getOwnPropertyDescriptor(Ye.prototype,"unmuteLocal"),Ye.prototype),Dt(Ye.prototype,"close",[ta],Object.getOwnPropertyDescriptor(Ye.prototype,"close"),Ye.prototype),Dt(Ye.prototype,"updateEncoderConfig",[ta],Object.getOwnPropertyDescriptor(Ye.prototype,"updateEncoderConfig"),Ye.prototype),Dt(Ye.prototype,"updateSendParameters",[ta],Object.getOwnPropertyDescriptor(Ye.prototype,"updateSendParameters"),Ye.prototype),Dt(Ye.prototype,"replaceTrack",[ta],Object.getOwnPropertyDescriptor(Ye.prototype,"replaceTrack"),Ye.prototype),Dt(Ye.prototype,"getRemoteSSRC",[ta],Object.getOwnPropertyDescriptor(Ye.prototype,"getRemoteSSRC"),Ye.prototype),Ye);function ta(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,a=await r.lock("Locking from P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{a()}},n}const _K={name:"PlanBConnection",create:function(t){let{store:e,spec:n}=t;return new mK(n,e)}},EK={interceptLocalAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ae().supportWebRTCEncodedTransform)return void v.warning("browser not support audio encoded transform");if(ev.has(t)||!t.track)return;const n={track:t.track};if(al()){if(!t.createEncodedStreams)return void v.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void v.error("create audio-encoded-streams error",c&&c.message)}const a=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(v.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const d=e.metadata&&e.metadata();d?function(h,p){const{chunk:m,controller:S}=p,R=U("ENABLE_AUDIO_PTS_METADATA")?dl.AUDIO_64_BIT_PTS:dl.METADATA;m.data=function(O,A,I){const D=I.byteLength,L=D+hw+w1,V=uw+dw+L,W=new ArrayBuffer(O.byteLength+V),K=new DataView(W);K.setUint8(0,I1),K.setUint16(1,L),K.setUint8(3,A),K.setUint16(4,D);for(let Q=0;Q<D;Q++)K.setUint8(6+Q,I[Q]);const G=new Uint8Array(K.buffer);return G.set(new Uint8Array(O),V),G.buffer}(m.data,R,h),S.enqueue(m)}(d,{chunk:c,controller:l}):l.enqueue(c)}});r.readable.pipeThrough(a).pipeTo(r.writable)}else if(Ni()){if(typeof RTCRtpScriptTransform>"u")return void v.warning("browser not support RTCRtpScriptTransform");const r=tv(),a=new MessageChannel;await new Et(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"audio-metadata-tx",port:a.port2},[a.port2]);t.transform=c,await new Et(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),a.port1.onmessage=l=>{var d;if(l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id)v.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i);else if(l.data.getMetadata){const h=e.metadata&&e.metadata();h&&a.port1.postMessage({metadata:h})}},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=ev.get(t);if(r){ev.delete(t);try{var a,c;(a=r.controller)===null||a===void 0||a.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){v.warning(l&&l.message)}}}ev.set(t,n),t.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ae().supportWebRTCEncodedTransform)return void v.warning("browser not support audio encoded transform");if(ov.has(t))return;const n={track:t.track,onMetadata:e.onMetadata};if(al()){if(!t.createEncodedStreams)return void v.warning("browser not support createEncodedStreams() API");CI(Oe.CHROME,87,116)||(e.enableTopn=!1);let r=null;try{r=t.createEncodedStreams()}catch(c){return void v.error("create audio-encoded-streams error",c&&c.message)}const a=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(v.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)),e.enableTopn?function(d,h,p){var m;const S=O1(new DataView(h.data));if(!S)return p.enqueue(h);const R=d.track.id;QH.set(R,d.track);const O=(m=S.tlv.find(W=>W.tag===dl.AUDIO_LEVEL))===null||m===void 0?void 0:m.value;let A=0;typeof O=="number"&&(A=127-O);const I=Math.round(Math.pow(10,A/60)-1),{selected:D,speaker:L}=function(W,K){let G=qf.get(W);if(G||(G=function(Q){const lt=new D1;return qf.set(Q,lt),So||(So=new XH(U("TOPN_SILENCE_THRESHOLD")||500),So.on("ActiveSpeakerChanged",Tt=>{Tt!=null&&(rv=Tt)})),So.addSpeakers([lt]),lt}(W)),qf.size<=L1)return{selected:!0,speaker:G};if(!So)throw new Error("no active speaker detector");return So.levelChanged(G.id,K),uh=So.loudest.map(Q=>Q.id),rv&&!_t(uh).call(uh,rv)&&uh.length>=L1&&uh.pop(),{selected:_t(uh).call(uh,G.id)||G.id===rv,speaker:G}}(d,I),V=function(W,K,G){const Q=To.get(W)||new JH(W,K);return Q.score=G,To.set(W,Q),function(lt){if(sv.set(lt,!0),!av)return void(av=Date.now());const Tt=Date.now();Tt-av>1e3&&(sv.get(lt)?sv.set(lt,!1):(P1(lt),sv.delete(lt)),av=Tt)}(W),Q}(R,d.track,L.energyScore);V.addSample(D),V.active&&(h.data=S.frame.buffer,p.enqueue(h))}(t,c,l):e.enableMetadata?function(d,h,p){const m=O1(new DataView(d.data));if(!m)return h.enqueue(d);const S=m.tlv.find(R=>R.tag===dl.METADATA||R.tag===dl.AUDIO_64_BIT_PTS);S&&p&&S.value instanceof Uint8Array&&p(S.value),d.data=m.frame.buffer,h.enqueue(d)}(c,l,e.onMetadata):l.enqueue(c)}});r.readable.pipeThrough(a).pipeTo(r.writable)}else if(Ni()){if(typeof RTCRtpScriptTransform>"u")return void v.warning("browser not support RTCRtpScriptTransform");const r=tv(),a=new MessageChannel;await new Et(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"audio-metadata-rx",port:a.port2},[a.port2]);t.transform=c,await new Et(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),a.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id?(v.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):l.data.metadata&&n.onMetadata&&n.onMetadata(l.data.metadata)},n.worker=r}function i(){t.track.removeEventListener("ended",i),function(r){const a=ov.get(r);if(a){(function(d){const h=qf.get(d);h&&(qf.delete(d),So&&(So.removeSpeakers([h]),qf.size===0&&(So.destroy(),So=null)))})(r),P1(r.track.id),ov.delete(r);try{var c,l;(c=a.controller)===null||c===void 0||c.terminate(),(l=a.worker)===null||l===void 0||l.terminate()}catch(d){v.warning(d&&d.message)}}}(t)}ov.set(t,n),t.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(t,e){if(!Ae().supportWebRTCEncodedTransform)return void v.warning("browser not support video encoded transform");if(cv.has(t)||!t.track)return;const n={track:t.track};if(al()){if(!t.createEncodedStreams)return void v.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(l){return void v.error("create video-encoded-streams error",l&&l.message)}const a=[];e.on("sei-to-send",l=>{a.push(l)});const c=new TransformStream({transform(l,d){n.controller||(n.controller=d),t.track&&t.track.id!==n.track.id&&(v.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const h=a.shift();h&&(l.data=function(p,m){const S=function(L){const V=L.length;let W=[],K=0;for(;K<V;)K+2<V&&L[K]===0&&L[K+1]===0&&(L[K+2]===0||L[K+2]===1||L[K+2]===2||L[K+2]===3)?(W.push(L[K],L[K+1],3,L[K+2]),K+=3):(W.push(L[K]),K++);return new Uint8Array(W)}(m),R=S.length,O=Math.floor(R/255),A=R%255,I=new Uint8Array(6+O+1+R+p.byteLength);I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=6,I[5]=101;let D=0;for(;D<O;)I[6+D]=255,D++;return I[6+D]=A,D++,I.set(S,6+D),I.set(new Uint8Array(p),6+D+R),I.buffer}(l.data,h)),d.enqueue(l)}});r.readable.pipeThrough(c).pipeTo(r.writable)}else{if(!Ni())return;{if(typeof RTCRtpScriptTransform>"u")return void v.warning("browser not support RTCRtpScriptTransform");const r=tv(),a=new MessageChannel;await new Et(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"sei-tx",port:a.port2},[a.port2]);t.transform=c,await new Et(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),e.on("sei-to-send",l=>{a.port1.postMessage({sei:l})}),a.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id&&(v.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i))},n.worker=r}}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=cv.get(t);if(r){cv.delete(t);try{var a,c;(a=r.controller)===null||a===void 0||a.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){v.warning(l&&l.message)}}}cv.set(t,n),t.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ae().supportWebRTCEncodedTransform)return void v.warning("browser not support video encoded transform");if(!t.track)return;if(vg.has(t)){const r=vg.get(t);return void(r&&(r.onSei=e.onSei))}const n={track:t.track,onSei:e.onSei};if(al()){if(!t.createEncodedStreams)return void v.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void v.error("create video-encoded-streams error",c&&c.message)}const a=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(v.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const d=function(h){const p=new DataView(h.data);let m=0;for(;m+4<h.data.byteLength;){if(p.getUint8(m+0)===0&&p.getUint8(m+1)===0&&p.getUint8(m+2)===0&&p.getUint8(m+3)===1&&p.getUint8(m+4)===6){let S=m+6,R=0,O=0;for(;(O=p.getUint8(S++))===255;)R+=255;R+=O;const A=ZH(h.data,S,R);return new Uint8Array(A)}m++}return null}(c);d&&n.onSei&&n.onSei(d),l.enqueue(c)}});r.readable.pipeThrough(a).pipeTo(r.writable)}else if(Ni()){if(typeof RTCRtpScriptTransform>"u")return void v.warning("browser not support RTCRtpScriptTransform");const r=tv(),a=new MessageChannel;await new Et(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"sei-rx",port:a.port2},[a.port2]);t.transform=c,await new Et(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),a.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id?(v.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):l.data.sei&&n.onSei&&n.onSei(l.data.sei)},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}(function(r){const a=vg.get(r);if(a){vg.delete(r);try{var c,l;(c=a.controller)===null||c===void 0||c.terminate(),(l=a.worker)===null||l===void 0||l.terminate()}catch(d){v.warning(d&&d.message)}}})(t)}vg.set(t,n),t.track.addEventListener("ended",i)}},gK={name:"InterceptFrame",create:()=>EK};HI(),Be("PROCESS_ID","process-".concat(Je(8,""),"-").concat(Je(4,""),"-").concat(Je(4,""),"-").concat(Je(4,""),"-").concat(Je(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void v.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();v.debug("Loading global parameters from cache",e),Object.keys(e).forEach(i=>{if(Object.prototype.hasOwnProperty.call(on,i)){const{value:r,expires:a}=e[i];if(a&&a<=n)return;go[i]=r,on[i]=r}})}catch(e){v.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(go.AREAS)&&go.AREAS.length>0&&kw(go.AREAS,!0);const UV=(t,e,n)=>{v.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),Be(t,e,n)};wu(j8,!1),wu(W8,!1),wu(vW,!1),wu(eK,!1),wu(V8,!1),wu(pK,!1),wu(_K,!1),wu(gK,!1);const Yn=function(t){const e=new _n,n=t,i={getListeners:e.getListeners.bind(e),on:(r,a)=>(function(c,l){c===oc.SECURITY_POLICY_VIOLATION&&_x(l,!0)}(r,a),e.on.bind(e)(r,a)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return mx(mx({},n),i)}({__TRACK_LIST__:xf,VERSION:qs,BUILD:YI,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:UV,getParameter:U,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;const n=await async function(i){let r;return Ae().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),r=(await i.createOffer()).sdp):r=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,r}(e);if(!n)return t;e.close(),e=null,t=function(i){const r={video:[],audio:[]};return i.match(/ VP8/i)&&r.video.push("VP8"),i.match(/ VP9/i)&&r.video.push("VP9"),i.match(/ AV1/i)&&r.video.push("AV1"),i.match(/ H264/i)&&r.video.push("H264"),i.match(/ H265/i)&&r.video.push("H265"),i.match(/ opus/i)&&r.audio.push("OPUS"),i.match(/ PCMU/i)&&r.audio.push("PCMU"),i.match(/ PCMA/i)&&r.audio.push("PCMA"),i.match(/ G722/i)&&r.audio.push("G722"),r}(n)}catch(e){throw new J(P.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=kt.reportApiInvoke(null,{name:Wn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Rn.TRACER});let e=!1;try{const a=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;e=!!(a&&c&&l),e&&wI()&&xP(75)&&new a().close()}catch(a){return v.error("check system requirement failed: ",a),!1}let n=!1;const i=Re();i.name===Oe.CHROME&&Number(i.version)>=58&&(_o.engine.name!=="WebKit"||function(){const a=Re();if(xy()){if(a.os===ri.MAC_OS)return!0;if(a.os===ri.IOS){const c=_o.os.version&&_o.os.version.split(".");if(c&&Number(c[0])===14&&c[1]&&Number(c[1])>=3||c&&Number(c[0])>14)return!0}}return!1}())&&(n=!0),(i.name===Oe.FIREFOX&&Number(i.version)>=56||i.name===Oe.OPERA&&Number(i.version)>=45||i.name===Oe.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(ur()||ya())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||HP()||Re().name===Oe.QQ)&&(n=!0),v.debug("checkSystemRequirements, api:",e,"browser",n);const r=e&&n;return t.onSuccess(r),r},getDevices:function(t){return Is.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return Is.getRecordingDevices(t)},getCameras:function(t){return Is.getCamerasDevices(t)},getElectronScreenSources:xk,getPlaybackDevices:function(t){return Is.getSpeakers(t)},createClient:function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Je(5,"client-"),i=kt.reportApiInvoke(null,{id:n,name:Wn.CREATE_CLIENT,options:[e],tag:Rn.TRACER});try{(function(r){ei(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),ei(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&ei(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&Si(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&QP(r.turnServer),r.httpRetryConfig!==void 0&&JP(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&JP(r.websocketRetryConfig)})(e)}catch(r){throw i.onError(r),r}return(BP(16,0)||FP(16,0,!0))&&(e.codec==="vp9"&&(e.codec="vp8",v.debug("browser not support vp9, force use vp8")),Be("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),i.onSuccess(),new CW(Na(Na({forceWaitGatewayResponse:!0},e),{},{role:_t(t=["rtc","p2p"]).call(t,e.mode)?"host":e.role||"audience"}),n)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=U("CAMERA_CAPTURE_CONFIG"),n=Je(8,"track-cam-"),i=kt.reportApiInvoke(null,{id:n,tag:Rn.TRACER,name:Wn.CREATE_CAM_VIDEO_TRACK,options:[dn({},t),e]});e&&(t.encoderConfig=e);const r=Zy(t);let a=null;v.info("start create camera video track with config",JSON.stringify(t),"trackId",n);try{a=(await As({video:r},n)).getVideoTracks()[0]||null}catch(l){throw i.onError(l),l}if(!a){const l=new Z(P.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(l),l.throw(v)}t.optimizationMode&&lw(n,a,t,rc(t.encoderConfig));const c=new cw(a,t,r,t.scalabiltyMode?zy(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,n);return i.onSuccess(c.getTrackId()),v.info("create camera video success, trackId:",n),c},createCustomVideoTrack:function(t){const e=Je(8,"track-cus-"),n=kt.reportApiInvoke(null,{id:e,tag:Rn.TRACER,name:Wn.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),i=new cn(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?zy(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,e,[Qe.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),v.info("create custom video track success with config",t,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof e=="object"?function(S){return qk(S)}(e):void 0;n&&(e="auto");const i=Je(8,"track-scr-v-"),r=kt.reportApiInvoke(null,{id:i,tag:Rn.TRACER,name:Wn.CREATE_SCREEN_VIDEO_TRACK,options:[dn({},t),e]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const a=function(S){const R={};S.screenSourceType&&(R.mediaSource=S.screenSourceType),S.extensionId&&al()&&(R.extensionId=S.extensionId);const{displaySurface:O,selfBrowserSurface:A,surfaceSwitching:I,systemAudio:D,preferCurrentTab:L}=S;(hg(107)||bI(107)||AI(93))&&(O&&(ei(O,"displaySurface",["browser","window","monitor"]),R.displaySurface=O),A?(ei(A,"selfBrowserSurface",["exclude","include"]),R.selfBrowserSurface=A):R.selfBrowserSurface="include",I&&(ei(I,"surfaceSwitching",["exclude","include"]),R.surfaceSwitching=I)),(hg(105)||bI(105)||AI(91))&&D&&(ei(D,"systemAudio",["exclude","include"]),R.systemAudio=D),(hg(94)||bI(94)||AI(80))&&L&&(R.preferCurrentTab=!0),S.electronScreenSourceId&&(R.sourceId=S.electronScreenSourceId);const V=S.encoderConfig?QI(S.encoderConfig):null;return R.mandatory={chromeMediaSource:"desktop",maxWidth:V?V.width:void 0,maxHeight:V?V.height:void 0},V&&(V.frameRate&&(typeof V.frameRate=="number"?(R.mandatory.maxFrameRate=V.frameRate,R.mandatory.minFrameRate=V.frameRate):(R.mandatory.maxFrameRate=V.frameRate.max||V.frameRate.ideal||V.frameRate.exact||void 0,R.mandatory.minFrameRate=V.frameRate.min||V.frameRate.ideal||V.frameRate.exact||void 0),R.frameRate=V.frameRate),V.width&&(R.width=V.width),V.height&&(R.height=V.height)),R}(t);let c=null,l=null;const d=Ae();if(!d.supportShareAudio&&e==="enable"){const S=new Z(P.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(S),S.throw(v)}v.info("start create screen video track with config",t,"withAudio",e,"trackId",i);const h=d.supportShareAudio&&e!=="disable";try{const S=await As({screen:a,screenAudio:h?n||!0:void 0},i);c=S.getVideoTracks()[0]||null,l=S.getAudioTracks()[0]||null}catch(S){throw r.onError(S),S}if(!c){const S=new Z(P.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(S),S.throw(v)}if(!l&&e==="enable"){c&&c.stop();const S=new Z(P.SHARE_AUDIO_NOT_ALLOWED);return r.onError(S),S.throw(v)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(lw(i,c,t,t.encoderConfig&&QI(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const p=new cn(c,t.encoderConfig?QI(t.encoderConfig):{},t.scalabiltyMode?zy(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i,[Qe.SCREEN_TRACK]);if(!l)return r.onSuccess(p.getTrackId()),v.info("create screen video track success","video:",p.getTrackId()),p;const m=new bn(l,void 0,Je(8,"track-scr-a-"),!1);return r.onSuccess([p.getTrackId(),m.getTrackId()]),v.info("create screen video track success","video:",p.getTrackId(),"audio:",m.getTrackId()),[p,m]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=U("CAMERA_CAPTURE_CONFIG"),i=Je(8,"track-mic-"),r=Je(8,"track-cam-"),a=kt.reportApiInvoke(null,{id:"".concat(i,"-").concat(r),tag:Rn.TRACER,name:Wn.CREATE_MIC_AND_CAM_TRACKS,options:[t,e,n]});n&&(e.encoderConfig=n);const c=Zy(e),l=zk(t);let d=null,h=null;v.info("start create camera video track(".concat(r,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const S=await As({audio:l,video:c},"".concat(i,"-").concat(r));d=S.getAudioTracks()[0],h=S.getVideoTracks()[0]}catch(S){throw a.onError(S),S}if(!d||!h){const S=new Z(P.UNEXPECTED_ERROR,"can not find tracks in media stream");return a.onError(S),S.throw(v)}e.optimizationMode&&lw(r,h,e,rc(e.encoderConfig));const p=new $y(d,t,l,i),m=new cw(h,e,c,e.scalabiltyMode?zy(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return a.onSuccess([p.getTrackId(),m.getTrackId()]),v.info("create camera video track(".concat(r,") and microphone audio track(").concat(i,") success")),[p,m]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Je(8,"track-mic-"),n=kt.reportApiInvoke(null,{id:e,tag:Rn.TRACER,name:Wn.CREATE_MIC_AUDIO_TRACK,options:[t]}),i=zk(t);let r=null;v.info("start create microphone audio track with config",JSON.stringify(t),"trackId",e);try{r=(await As({audio:i},e)).getAudioTracks()[0]||null}catch(c){throw n.onError(c),c}if(!r){const c=new Z(P.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(c),c.throw(v)}const a=new $y(r,t,i,e);return n.onSuccess(a.getTrackId()),v.info("create microphone audio track success, trackId:",e),a},createCustomAudioTrack:function(t){const e=Je(8,"track-cus-"),n=kt.reportApiInvoke(null,{id:e,tag:Rn.TRACER,name:Wn.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),i=new bn(t.mediaStreamTrack,t.encoderConfig?Xy(t.encoderConfig):{},e,!1);return v.info("create custom audio track success with config",t,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:n,encoderConfig:i}=t;let{source:r}=t;const a={source:r instanceof AudioBuffer?"AudioBuffer":r instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":r,cacheOnlineFile:n,encoderConfig:i},c=Je(8,"track-buf-"),l=kt.reportApiInvoke(null,{id:c,tag:Rn.TRACER,name:Wn.CREATE_BUFFER_AUDIO_TRACK,options:[a]});if(U("DISABLE_WEBAUDIO"))throw new Z(P.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");v.info("start create buffer source audio track with config",JSON.stringify(a),"trackId",c);const d=r;if(!(r instanceof AudioBuffer))try{r=await async function(m,S){let R=null;if(typeof m=="string"){const A=kM.get(m);if(A)return v.debug("use cached audio resource: ",m),A;try{R=(await Eo(()=>vr.get(m,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(I){throw new Z(P.FETCH_AUDIO_FILE_FAILED,I.toString())}}else R=await new Et((I,D)=>{const L=new FileReader;L.onload=V=>{V.target?I(V.target.result):D(new Z(P.READ_LOCAL_AUDIO_FILE_ERROR))},L.onerror=()=>{D(new Z(P.READ_LOCAL_AUDIO_FILE_ERROR))},L.readAsArrayBuffer(m)});const O=await function(A){const I=Hf();return new Et((D,L)=>{I.decodeAudioData(A,V=>{D(V)},V=>{L(new Z(P.DECODE_AUDIO_FILE_FAILED,V.toString()))})})}(R);return typeof m=="string"&&S&&kM.set(m,O),O}(r,n)}catch(m){return l.onError(m),m.throw(v)}const h=new WH(r),p=new HH(d,h,i?Xy(i):{},c);return v.info("create buffer source audio track success, trackId:",c),l.onSuccess(p.getTrackId()),p},setAppType:function(t){if(v.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw v.debug("Invalid appType"),new J(P.INVALID_PARAMS,"invalid app type",t);Be("APP_TYPE",Math.floor(t))},setLogLevel:function(t){v.setLogLevel(t)},enableLogUpload:function(){U("USE_NEW_LOG")?Be("UPLOAD_LOG",!0):v.enableLogUpload()},disableLogUpload:function(){U("USE_NEW_LOG")?Be("UPLOAD_LOG",!1):v.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new kU},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=kt.reportApiInvoke(null,{tag:Rn.TRACER,name:Wn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof bn||t instanceof Yf)){const d=new J(P.INVALID_TRACK,"the parameter is not a audio track");return n.onError(d),d.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof bn?t.getTrackLabel():"remote_track",r=t.getVolumeLevel();let a=r,c=r;const l=Date.now();return new Et(d=>{const h=setInterval(()=>{const p=t.getVolumeLevel();a=p>a?p:a,c=p<c?p:c;const m=a-c>1e-4,S=Date.now()-l;if(m||S>e){clearInterval(h);const R=m,O={duration:S,deviceLabel:i,maxVolumeLevel:a,result:R};v.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(O))),n.onSuccess(O),d(R)}},200)})},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=kt.reportApiInvoke(null,{tag:Rn.TRACER,name:Wn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof cn||t instanceof Kf)){const m=new J(P.INVALID_TRACK,"the parameter is not a video track");return n.onError(m),m.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof cn?t.getTrackLabel():"remote_track",r=t.getMediaStreamTrack(!0),a=document.createElement("video");a.style.width="1px",a.style.height="1px",a.setAttribute("muted",""),a.muted=!0,a.setAttribute("playsinline",""),a.controls=!1,(Ni()||xy())&&(a.style.opacity="0.01",a.style.position="fixed",a.style.left="0",a.style.top="0",document.body.appendChild(a)),a.srcObject=new MediaStream([r]),a.play();const c=document.createElement("canvas");c.width=160,c.height=120;let l=0,d=0;try{const m=Date.now();l=await function(S,R,O,A){let I,D=0,L=null;return new Et((V,W)=>{function K(){D>A&&I&&(I(),V(D));const G=O.getContext("2d");if(!G){const Tt=new J(P.UNEXPECTED_ERROR,"can not get canvas 2d context.");return v.error(Tt.toString()),void W(Tt)}G.drawImage(S,0,0,160,120);const Q=G.getImageData(0,0,O.width,O.height),lt=Math.floor(Q.data.length/3);if(L){for(let Tt=0;Tt<lt;Tt+=3)if(Q.data[Tt]!==L[Tt])return D+=1,void(L=Q.data);L=Q.data}else L=Q.data}setTimeout(()=>{I&&(I(),V(D))},R),I=nw(()=>{K()},30)})}(a,e,c,4),d=Date.now()-m}catch(m){throw n.onError(m),m}lW===Oe.SAFARI&&(a.pause(),a.remove()),a.srcObject=null;const h=l>4,p={duration:d,changedPicNum:l,deviceLabel:i,result:h};return v.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(p))),n.onSuccess(p),h},setArea:kw,audioElementPlayCenter:Cr,resumeAudioContext:function(){Cr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){AW.processExternalMediaAEC(t)},registerExtensions:function(t){const e=U("PLUGIN_INFO")||[];t.forEach(n=>{"name"in n&&!_t(e).call(e,n.name)&&e.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=v.extLog,i.reporter.hookApiInvoke=kt.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(r=>{i.parameters[r]=U(r)})}),UV("PLUGIN_INFO",e)},ChannelMediaRelayError:Xf,ChannelMediaRelayEvent:pl,ChannelMediaRelayState:Fr,RemoteStreamFallbackType:UH,RemoteStreamType:MH,ConnectionDisconnectedReason:Pe,AudienceLatencyLevelType:hH,AREAS:Ne,preload:async function(t,e,n,i){return o2(t,e,n,i)}});return Object.defineProperties(Yn,{onAudioAutoplayFailed:{get:()=>ws.onAudioAutoplayFailed,set:t=>{ws.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>ws.onAutoplayFailed,set:t=>{ws.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Yn._onSecurityPolicyViolation,set(t){Yn._onSecurityPolicyViolation=t,_x(t)}},__CLIENT_LIST__:{get:()=>U("SHOW_GLOBAL_CLIENT_LIST")?dh:[]}}),Is.on(oh.CAMERA_DEVICE_CHANGED,t=>{v.info("camera device changed",JSON.stringify(t)),Yn.onCameraChanged&&Yn.onCameraChanged(t),Yn.safeEmit(oc.CAMERA_CHANGED,t)}),Is.on(oh.RECORDING_DEVICE_CHANGED,t=>{v.info("microphone device changed",JSON.stringify(t)),Yn.onMicrophoneChanged&&Yn.onMicrophoneChanged(t),Yn.safeEmit(oc.MICROPHONE_CHANGED,t)}),Is.on(oh.PLAYOUT_DEVICE_CHANGED,t=>{v.debug("playout device changed",JSON.stringify(t)),Yn.onPlaybackDeviceChanged&&Yn.onPlaybackDeviceChanged(t),Yn.safeEmit(oc.PLAYBACK_DEVICE_CHANGED,t)}),Cr.onAutoplayFailed=()=>{v.info("detect audio element autoplay failed"),ws.onAudioAutoplayFailed&&ws.onAudioAutoplayFailed()},Fe.on("autoplay-failed",()=>{v.info("detect webaudio autoplay failed"),ws.onAudioAutoplayFailed&&ws.onAudioAutoplayFailed(),Yn.safeEmit(oc.AUTOPLAY_FAILED)}),Fe.on(yi.STATE_CHANGE,(t,e)=>{v.info("audio context state changed: ".concat(e," => ").concat(t)),Yn.onAudioContextStateChanged&&Yn.onAudioContextStateChanged(t,e),Yn.safeEmit(oc.AUDIO_CONTEXT_STATE_CHANGED,t,e)}),xn.on(Df.NETWORK_STATE_CHANGE,(t,e)=>{v.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))}),window&&(window.__ARTC__=Yn),Yn})}(uC)),uC.exports}var eq=tq();const TC=SK(eq);function FB(E,_){return function(){return E.apply(_,arguments)}}const{toString:nq}=Object.prototype,{getPrototypeOf:h0}=Object,bC=(E=>_=>{const T=nq.call(_);return E[T]||(E[T]=T.slice(8,-1).toLowerCase())})(Object.create(null)),wo=E=>(E=E.toLowerCase(),_=>bC(_)===E),AC=E=>_=>typeof _===E,{isArray:gm}=Array,pS=AC("undefined");function iq(E){return E!==null&&!pS(E)&&E.constructor!==null&&!pS(E.constructor)&&na(E.constructor.isBuffer)&&E.constructor.isBuffer(E)}const jB=wo("ArrayBuffer");function rq(E){let _;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?_=ArrayBuffer.isView(E):_=E&&E.buffer&&jB(E.buffer),_}const sq=AC("string"),na=AC("function"),GB=AC("number"),IC=E=>E!==null&&typeof E=="object",aq=E=>E===!0||E===!1,dC=E=>{if(bC(E)!=="object")return!1;const _=h0(E);return(_===null||_===Object.prototype||Object.getPrototypeOf(_)===null)&&!(Symbol.toStringTag in E)&&!(Symbol.iterator in E)},oq=wo("Date"),cq=wo("File"),lq=wo("Blob"),uq=wo("FileList"),dq=E=>IC(E)&&na(E.pipe),hq=E=>{let _;return E&&(typeof FormData=="function"&&E instanceof FormData||na(E.append)&&((_=bC(E))==="formdata"||_==="object"&&na(E.toString)&&E.toString()==="[object FormData]"))},pq=wo("URLSearchParams"),[fq,mq,_q,Eq]=["ReadableStream","Request","Response","Headers"].map(wo),gq=E=>E.trim?E.trim():E.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ES(E,_,{allOwnKeys:T=!1}={}){if(E===null||typeof E>"u")return;let y,w;if(typeof E!="object"&&(E=[E]),gm(E))for(y=0,w=E.length;y<w;y++)_.call(null,E[y],y,E);else{const M=T?Object.getOwnPropertyNames(E):Object.keys(E),B=M.length;let q;for(y=0;y<B;y++)q=M[y],_.call(null,E[q],q,E)}}function HB(E,_){_=_.toLowerCase();const T=Object.keys(E);let y=T.length,w;for(;y-- >0;)if(w=T[y],_===w.toLowerCase())return w;return null}const Dh=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,WB=E=>!pS(E)&&E!==Dh;function zO(){const{caseless:E}=WB(this)&&this||{},_={},T=(y,w)=>{const M=E&&HB(_,w)||w;dC(_[M])&&dC(y)?_[M]=zO(_[M],y):dC(y)?_[M]=zO({},y):gm(y)?_[M]=y.slice():_[M]=y};for(let y=0,w=arguments.length;y<w;y++)arguments[y]&&ES(arguments[y],T);return _}const Sq=(E,_,T,{allOwnKeys:y}={})=>(ES(_,(w,M)=>{T&&na(w)?E[M]=FB(w,T):E[M]=w},{allOwnKeys:y}),E),Tq=E=>(E.charCodeAt(0)===65279&&(E=E.slice(1)),E),Rq=(E,_,T,y)=>{E.prototype=Object.create(_.prototype,y),E.prototype.constructor=E,Object.defineProperty(E,"super",{value:_.prototype}),T&&Object.assign(E.prototype,T)},yq=(E,_,T,y)=>{let w,M,B;const q={};if(_=_||{},E==null)return _;do{for(w=Object.getOwnPropertyNames(E),M=w.length;M-- >0;)B=w[M],(!y||y(B,E,_))&&!q[B]&&(_[B]=E[B],q[B]=!0);E=T!==!1&&h0(E)}while(E&&(!T||T(E,_))&&E!==Object.prototype);return _},vq=(E,_,T)=>{E=String(E),(T===void 0||T>E.length)&&(T=E.length),T-=_.length;const y=E.indexOf(_,T);return y!==-1&&y===T},Cq=E=>{if(!E)return null;if(gm(E))return E;let _=E.length;if(!GB(_))return null;const T=new Array(_);for(;_-- >0;)T[_]=E[_];return T},bq=(E=>_=>E&&_ instanceof E)(typeof Uint8Array<"u"&&h0(Uint8Array)),Aq=(E,_)=>{const y=(E&&E[Symbol.iterator]).call(E);let w;for(;(w=y.next())&&!w.done;){const M=w.value;_.call(E,M[0],M[1])}},Iq=(E,_)=>{let T;const y=[];for(;(T=E.exec(_))!==null;)y.push(T);return y},wq=wo("HTMLFormElement"),Oq=E=>E.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(T,y,w){return y.toUpperCase()+w}),eB=(({hasOwnProperty:E})=>(_,T)=>E.call(_,T))(Object.prototype),Nq=wo("RegExp"),KB=(E,_)=>{const T=Object.getOwnPropertyDescriptors(E),y={};ES(T,(w,M)=>{let B;(B=_(w,M,E))!==!1&&(y[M]=B||w)}),Object.defineProperties(E,y)},Dq=E=>{KB(E,(_,T)=>{if(na(E)&&["arguments","caller","callee"].indexOf(T)!==-1)return!1;const y=E[T];if(na(y)){if(_.enumerable=!1,"writable"in _){_.writable=!1;return}_.set||(_.set=()=>{throw Error("Can not rewrite read-only method '"+T+"'")})}})},Lq=(E,_)=>{const T={},y=w=>{w.forEach(M=>{T[M]=!0})};return gm(E)?y(E):y(String(E).split(_)),T},Pq=()=>{},kq=(E,_)=>E!=null&&Number.isFinite(E=+E)?E:_,xO="abcdefghijklmnopqrstuvwxyz",nB="0123456789",YB={DIGIT:nB,ALPHA:xO,ALPHA_DIGIT:xO+xO.toUpperCase()+nB},Mq=(E=16,_=YB.ALPHA_DIGIT)=>{let T="";const{length:y}=_;for(;E--;)T+=_[Math.random()*y|0];return T};function Uq(E){return!!(E&&na(E.append)&&E[Symbol.toStringTag]==="FormData"&&E[Symbol.iterator])}const xq=E=>{const _=new Array(10),T=(y,w)=>{if(IC(y)){if(_.indexOf(y)>=0)return;if(!("toJSON"in y)){_[w]=y;const M=gm(y)?[]:{};return ES(y,(B,q)=>{const Y=T(B,w+1);!pS(Y)&&(M[q]=Y)}),_[w]=void 0,M}}return y};return T(E,0)},Vq=wo("AsyncFunction"),Bq=E=>E&&(IC(E)||na(E))&&na(E.then)&&na(E.catch),qB=((E,_)=>E?setImmediate:_?((T,y)=>(Dh.addEventListener("message",({source:w,data:M})=>{w===Dh&&M===T&&y.length&&y.shift()()},!1),w=>{y.push(w),Dh.postMessage(T,"*")}))(`axios@${Math.random()}`,[]):T=>setTimeout(T))(typeof setImmediate=="function",na(Dh.postMessage)),Fq=typeof queueMicrotask<"u"?queueMicrotask.bind(Dh):typeof process<"u"&&process.nextTick||qB,Rt={isArray:gm,isArrayBuffer:jB,isBuffer:iq,isFormData:hq,isArrayBufferView:rq,isString:sq,isNumber:GB,isBoolean:aq,isObject:IC,isPlainObject:dC,isReadableStream:fq,isRequest:mq,isResponse:_q,isHeaders:Eq,isUndefined:pS,isDate:oq,isFile:cq,isBlob:lq,isRegExp:Nq,isFunction:na,isStream:dq,isURLSearchParams:pq,isTypedArray:bq,isFileList:uq,forEach:ES,merge:zO,extend:Sq,trim:gq,stripBOM:Tq,inherits:Rq,toFlatObject:yq,kindOf:bC,kindOfTest:wo,endsWith:vq,toArray:Cq,forEachEntry:Aq,matchAll:Iq,isHTMLForm:wq,hasOwnProperty:eB,hasOwnProp:eB,reduceDescriptors:KB,freezeMethods:Dq,toObjectSet:Lq,toCamelCase:Oq,noop:Pq,toFiniteNumber:kq,findKey:HB,global:Dh,isContextDefined:WB,ALPHABET:YB,generateString:Mq,isSpecCompliantForm:Uq,toJSONObject:xq,isAsyncFn:Vq,isThenable:Bq,setImmediate:qB,asap:Fq};function Ke(E,_,T,y,w){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=E,this.name="AxiosError",_&&(this.code=_),T&&(this.config=T),y&&(this.request=y),w&&(this.response=w,this.status=w.status?w.status:null)}Rt.inherits(Ke,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Rt.toJSONObject(this.config),code:this.code,status:this.status}}});const zB=Ke.prototype,XB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(E=>{XB[E]={value:E}});Object.defineProperties(Ke,XB);Object.defineProperty(zB,"isAxiosError",{value:!0});Ke.from=(E,_,T,y,w,M)=>{const B=Object.create(zB);return Rt.toFlatObject(E,B,function(Y){return Y!==Error.prototype},q=>q!=="isAxiosError"),Ke.call(B,E.message,_,T,y,w),B.cause=E,B.name=E.name,M&&Object.assign(B,M),B};const jq=null;function XO(E){return Rt.isPlainObject(E)||Rt.isArray(E)}function JB(E){return Rt.endsWith(E,"[]")?E.slice(0,-2):E}function iB(E,_,T){return E?E.concat(_).map(function(w,M){return w=JB(w),!T&&M?"["+w+"]":w}).join(T?".":""):_}function Gq(E){return Rt.isArray(E)&&!E.some(XO)}const Hq=Rt.toFlatObject(Rt,{},null,function(_){return/^is[A-Z]/.test(_)});function wC(E,_,T){if(!Rt.isObject(E))throw new TypeError("target must be an object");_=_||new FormData,T=Rt.toFlatObject(T,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Ut,mt){return!Rt.isUndefined(mt[Ut])});const y=T.metaTokens,w=T.visitor||tt,M=T.dots,B=T.indexes,Y=(T.Blob||typeof Blob<"u"&&Blob)&&Rt.isSpecCompliantForm(_);if(!Rt.isFunction(w))throw new TypeError("visitor must be a function");function H(st){if(st===null)return"";if(Rt.isDate(st))return st.toISOString();if(!Y&&Rt.isBlob(st))throw new Ke("Blob is not supported. Use a Buffer instead.");return Rt.isArrayBuffer(st)||Rt.isTypedArray(st)?Y&&typeof Blob=="function"?new Blob([st]):Buffer.from(st):st}function tt(st,Ut,mt){let vt=st;if(st&&!mt&&typeof st=="object"){if(Rt.endsWith(Ut,"{}"))Ut=y?Ut:Ut.slice(0,-2),st=JSON.stringify(st);else if(Rt.isArray(st)&&Gq(st)||(Rt.isFileList(st)||Rt.endsWith(Ut,"[]"))&&(vt=Rt.toArray(st)))return Ut=JB(Ut),vt.forEach(function(Vt,Ce){!(Rt.isUndefined(Vt)||Vt===null)&&_.append(B===!0?iB([Ut],Ce,M):B===null?Ut:Ut+"[]",H(Vt))}),!1}return XO(st)?!0:(_.append(iB(mt,Ut,M),H(st)),!1)}const rt=[],ht=Object.assign(Hq,{defaultVisitor:tt,convertValue:H,isVisitable:XO});function Mt(st,Ut){if(!Rt.isUndefined(st)){if(rt.indexOf(st)!==-1)throw Error("Circular reference detected in "+Ut.join("."));rt.push(st),Rt.forEach(st,function(vt,Gt){(!(Rt.isUndefined(vt)||vt===null)&&w.call(_,vt,Rt.isString(Gt)?Gt.trim():Gt,Ut,ht))===!0&&Mt(vt,Ut?Ut.concat(Gt):[Gt])}),rt.pop()}}if(!Rt.isObject(E))throw new TypeError("data must be an object");return Mt(E),_}function rB(E){const _={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(E).replace(/[!'()~]|%20|%00/g,function(y){return _[y]})}function p0(E,_){this._pairs=[],E&&wC(E,this,_)}const QB=p0.prototype;QB.append=function(_,T){this._pairs.push([_,T])};QB.toString=function(_){const T=_?function(y){return _.call(this,y,rB)}:rB;return this._pairs.map(function(w){return T(w[0])+"="+T(w[1])},"").join("&")};function Wq(E){return encodeURIComponent(E).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ZB(E,_,T){if(!_)return E;const y=T&&T.encode||Wq;Rt.isFunction(T)&&(T={serialize:T});const w=T&&T.serialize;let M;if(w?M=w(_,T):M=Rt.isURLSearchParams(_)?_.toString():new p0(_,T).toString(y),M){const B=E.indexOf("#");B!==-1&&(E=E.slice(0,B)),E+=(E.indexOf("?")===-1?"?":"&")+M}return E}class sB{constructor(){this.handlers=[]}use(_,T,y){return this.handlers.push({fulfilled:_,rejected:T,synchronous:y?y.synchronous:!1,runWhen:y?y.runWhen:null}),this.handlers.length-1}eject(_){this.handlers[_]&&(this.handlers[_]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(_){Rt.forEach(this.handlers,function(y){y!==null&&_(y)})}}const $B={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Kq=typeof URLSearchParams<"u"?URLSearchParams:p0,Yq=typeof FormData<"u"?FormData:null,qq=typeof Blob<"u"?Blob:null,zq={isBrowser:!0,classes:{URLSearchParams:Kq,FormData:Yq,Blob:qq},protocols:["http","https","file","blob","url","data"]},f0=typeof window<"u"&&typeof document<"u",JO=typeof navigator=="object"&&navigator||void 0,Xq=f0&&(!JO||["ReactNative","NativeScript","NS"].indexOf(JO.product)<0),Jq=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Qq=f0&&window.location.href||"http://localhost",Zq=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:f0,hasStandardBrowserEnv:Xq,hasStandardBrowserWebWorkerEnv:Jq,navigator:JO,origin:Qq},Symbol.toStringTag,{value:"Module"})),Yr={...Zq,...zq};function $q(E,_){return wC(E,new Yr.classes.URLSearchParams,Object.assign({visitor:function(T,y,w,M){return Yr.isNode&&Rt.isBuffer(T)?(this.append(y,T.toString("base64")),!1):M.defaultVisitor.apply(this,arguments)}},_))}function tz(E){return Rt.matchAll(/\w+|\[(\w*)]/g,E).map(_=>_[0]==="[]"?"":_[1]||_[0])}function ez(E){const _={},T=Object.keys(E);let y;const w=T.length;let M;for(y=0;y<w;y++)M=T[y],_[M]=E[M];return _}function tF(E){function _(T,y,w,M){let B=T[M++];if(B==="__proto__")return!0;const q=Number.isFinite(+B),Y=M>=T.length;return B=!B&&Rt.isArray(w)?w.length:B,Y?(Rt.hasOwnProp(w,B)?w[B]=[w[B],y]:w[B]=y,!q):((!w[B]||!Rt.isObject(w[B]))&&(w[B]=[]),_(T,y,w[B],M)&&Rt.isArray(w[B])&&(w[B]=ez(w[B])),!q)}if(Rt.isFormData(E)&&Rt.isFunction(E.entries)){const T={};return Rt.forEachEntry(E,(y,w)=>{_(tz(y),w,T,0)}),T}return null}function nz(E,_,T){if(Rt.isString(E))try{return(_||JSON.parse)(E),Rt.trim(E)}catch(y){if(y.name!=="SyntaxError")throw y}return(T||JSON.stringify)(E)}const gS={transitional:$B,adapter:["xhr","http","fetch"],transformRequest:[function(_,T){const y=T.getContentType()||"",w=y.indexOf("application/json")>-1,M=Rt.isObject(_);if(M&&Rt.isHTMLForm(_)&&(_=new FormData(_)),Rt.isFormData(_))return w?JSON.stringify(tF(_)):_;if(Rt.isArrayBuffer(_)||Rt.isBuffer(_)||Rt.isStream(_)||Rt.isFile(_)||Rt.isBlob(_)||Rt.isReadableStream(_))return _;if(Rt.isArrayBufferView(_))return _.buffer;if(Rt.isURLSearchParams(_))return T.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),_.toString();let q;if(M){if(y.indexOf("application/x-www-form-urlencoded")>-1)return $q(_,this.formSerializer).toString();if((q=Rt.isFileList(_))||y.indexOf("multipart/form-data")>-1){const Y=this.env&&this.env.FormData;return wC(q?{"files[]":_}:_,Y&&new Y,this.formSerializer)}}return M||w?(T.setContentType("application/json",!1),nz(_)):_}],transformResponse:[function(_){const T=this.transitional||gS.transitional,y=T&&T.forcedJSONParsing,w=this.responseType==="json";if(Rt.isResponse(_)||Rt.isReadableStream(_))return _;if(_&&Rt.isString(_)&&(y&&!this.responseType||w)){const B=!(T&&T.silentJSONParsing)&&w;try{return JSON.parse(_)}catch(q){if(B)throw q.name==="SyntaxError"?Ke.from(q,Ke.ERR_BAD_RESPONSE,this,null,this.response):q}}return _}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Yr.classes.FormData,Blob:Yr.classes.Blob},validateStatus:function(_){return _>=200&&_<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Rt.forEach(["delete","get","head","post","put","patch"],E=>{gS.headers[E]={}});const iz=Rt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),rz=E=>{const _={};let T,y,w;return E&&E.split(`
`).forEach(function(B){w=B.indexOf(":"),T=B.substring(0,w).trim().toLowerCase(),y=B.substring(w+1).trim(),!(!T||_[T]&&iz[T])&&(T==="set-cookie"?_[T]?_[T].push(y):_[T]=[y]:_[T]=_[T]?_[T]+", "+y:y)}),_},aB=Symbol("internals");function cS(E){return E&&String(E).trim().toLowerCase()}function hC(E){return E===!1||E==null?E:Rt.isArray(E)?E.map(hC):String(E)}function sz(E){const _=Object.create(null),T=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let y;for(;y=T.exec(E);)_[y[1]]=y[2];return _}const az=E=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(E.trim());function VO(E,_,T,y,w){if(Rt.isFunction(y))return y.call(this,_,T);if(w&&(_=T),!!Rt.isString(_)){if(Rt.isString(y))return _.indexOf(y)!==-1;if(Rt.isRegExp(y))return y.test(_)}}function oz(E){return E.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(_,T,y)=>T.toUpperCase()+y)}function cz(E,_){const T=Rt.toCamelCase(" "+_);["get","set","has"].forEach(y=>{Object.defineProperty(E,y+T,{value:function(w,M,B){return this[y].call(this,_,w,M,B)},configurable:!0})})}let Ds=class{constructor(_){_&&this.set(_)}set(_,T,y){const w=this;function M(q,Y,H){const tt=cS(Y);if(!tt)throw new Error("header name must be a non-empty string");const rt=Rt.findKey(w,tt);(!rt||w[rt]===void 0||H===!0||H===void 0&&w[rt]!==!1)&&(w[rt||Y]=hC(q))}const B=(q,Y)=>Rt.forEach(q,(H,tt)=>M(H,tt,Y));if(Rt.isPlainObject(_)||_ instanceof this.constructor)B(_,T);else if(Rt.isString(_)&&(_=_.trim())&&!az(_))B(rz(_),T);else if(Rt.isHeaders(_))for(const[q,Y]of _.entries())M(Y,q,y);else _!=null&&M(T,_,y);return this}get(_,T){if(_=cS(_),_){const y=Rt.findKey(this,_);if(y){const w=this[y];if(!T)return w;if(T===!0)return sz(w);if(Rt.isFunction(T))return T.call(this,w,y);if(Rt.isRegExp(T))return T.exec(w);throw new TypeError("parser must be boolean|regexp|function")}}}has(_,T){if(_=cS(_),_){const y=Rt.findKey(this,_);return!!(y&&this[y]!==void 0&&(!T||VO(this,this[y],y,T)))}return!1}delete(_,T){const y=this;let w=!1;function M(B){if(B=cS(B),B){const q=Rt.findKey(y,B);q&&(!T||VO(y,y[q],q,T))&&(delete y[q],w=!0)}}return Rt.isArray(_)?_.forEach(M):M(_),w}clear(_){const T=Object.keys(this);let y=T.length,w=!1;for(;y--;){const M=T[y];(!_||VO(this,this[M],M,_,!0))&&(delete this[M],w=!0)}return w}normalize(_){const T=this,y={};return Rt.forEach(this,(w,M)=>{const B=Rt.findKey(y,M);if(B){T[B]=hC(w),delete T[M];return}const q=_?oz(M):String(M).trim();q!==M&&delete T[M],T[q]=hC(w),y[q]=!0}),this}concat(..._){return this.constructor.concat(this,..._)}toJSON(_){const T=Object.create(null);return Rt.forEach(this,(y,w)=>{y!=null&&y!==!1&&(T[w]=_&&Rt.isArray(y)?y.join(", "):y)}),T}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([_,T])=>_+": "+T).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(_){return _ instanceof this?_:new this(_)}static concat(_,...T){const y=new this(_);return T.forEach(w=>y.set(w)),y}static accessor(_){const y=(this[aB]=this[aB]={accessors:{}}).accessors,w=this.prototype;function M(B){const q=cS(B);y[q]||(cz(w,B),y[q]=!0)}return Rt.isArray(_)?_.forEach(M):M(_),this}};Ds.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Rt.reduceDescriptors(Ds.prototype,({value:E},_)=>{let T=_[0].toUpperCase()+_.slice(1);return{get:()=>E,set(y){this[T]=y}}});Rt.freezeMethods(Ds);function BO(E,_){const T=this||gS,y=_||T,w=Ds.from(y.headers);let M=y.data;return Rt.forEach(E,function(q){M=q.call(T,M,w.normalize(),_?_.status:void 0)}),w.normalize(),M}function eF(E){return!!(E&&E.__CANCEL__)}function Sm(E,_,T){Ke.call(this,E??"canceled",Ke.ERR_CANCELED,_,T),this.name="CanceledError"}Rt.inherits(Sm,Ke,{__CANCEL__:!0});function nF(E,_,T){const y=T.config.validateStatus;!T.status||!y||y(T.status)?E(T):_(new Ke("Request failed with status code "+T.status,[Ke.ERR_BAD_REQUEST,Ke.ERR_BAD_RESPONSE][Math.floor(T.status/100)-4],T.config,T.request,T))}function lz(E){const _=/^([-+\w]{1,25})(:?\/\/|:)/.exec(E);return _&&_[1]||""}function uz(E,_){E=E||10;const T=new Array(E),y=new Array(E);let w=0,M=0,B;return _=_!==void 0?_:1e3,function(Y){const H=Date.now(),tt=y[M];B||(B=H),T[w]=Y,y[w]=H;let rt=M,ht=0;for(;rt!==w;)ht+=T[rt++],rt=rt%E;if(w=(w+1)%E,w===M&&(M=(M+1)%E),H-B<_)return;const Mt=tt&&H-tt;return Mt?Math.round(ht*1e3/Mt):void 0}}function dz(E,_){let T=0,y=1e3/_,w,M;const B=(H,tt=Date.now())=>{T=tt,w=null,M&&(clearTimeout(M),M=null),E.apply(null,H)};return[(...H)=>{const tt=Date.now(),rt=tt-T;rt>=y?B(H,tt):(w=H,M||(M=setTimeout(()=>{M=null,B(w)},y-rt)))},()=>w&&B(w)]}const RC=(E,_,T=3)=>{let y=0;const w=uz(50,250);return dz(M=>{const B=M.loaded,q=M.lengthComputable?M.total:void 0,Y=B-y,H=w(Y),tt=B<=q;y=B;const rt={loaded:B,total:q,progress:q?B/q:void 0,bytes:Y,rate:H||void 0,estimated:H&&q&&tt?(q-B)/H:void 0,event:M,lengthComputable:q!=null,[_?"download":"upload"]:!0};E(rt)},T)},oB=(E,_)=>{const T=E!=null;return[y=>_[0]({lengthComputable:T,total:E,loaded:y}),_[1]]},cB=E=>(..._)=>Rt.asap(()=>E(..._)),hz=Yr.hasStandardBrowserEnv?((E,_)=>T=>(T=new URL(T,Yr.origin),E.protocol===T.protocol&&E.host===T.host&&(_||E.port===T.port)))(new URL(Yr.origin),Yr.navigator&&/(msie|trident)/i.test(Yr.navigator.userAgent)):()=>!0,pz=Yr.hasStandardBrowserEnv?{write(E,_,T,y,w,M){const B=[E+"="+encodeURIComponent(_)];Rt.isNumber(T)&&B.push("expires="+new Date(T).toGMTString()),Rt.isString(y)&&B.push("path="+y),Rt.isString(w)&&B.push("domain="+w),M===!0&&B.push("secure"),document.cookie=B.join("; ")},read(E){const _=document.cookie.match(new RegExp("(^|;\\s*)("+E+")=([^;]*)"));return _?decodeURIComponent(_[3]):null},remove(E){this.write(E,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function fz(E){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(E)}function mz(E,_){return _?E.replace(/\/?\/$/,"")+"/"+_.replace(/^\/+/,""):E}function iF(E,_){return E&&!fz(_)?mz(E,_):_}const lB=E=>E instanceof Ds?{...E}:E;function Ph(E,_){_=_||{};const T={};function y(H,tt,rt,ht){return Rt.isPlainObject(H)&&Rt.isPlainObject(tt)?Rt.merge.call({caseless:ht},H,tt):Rt.isPlainObject(tt)?Rt.merge({},tt):Rt.isArray(tt)?tt.slice():tt}function w(H,tt,rt,ht){if(Rt.isUndefined(tt)){if(!Rt.isUndefined(H))return y(void 0,H,rt,ht)}else return y(H,tt,rt,ht)}function M(H,tt){if(!Rt.isUndefined(tt))return y(void 0,tt)}function B(H,tt){if(Rt.isUndefined(tt)){if(!Rt.isUndefined(H))return y(void 0,H)}else return y(void 0,tt)}function q(H,tt,rt){if(rt in _)return y(H,tt);if(rt in E)return y(void 0,H)}const Y={url:M,method:M,data:M,baseURL:B,transformRequest:B,transformResponse:B,paramsSerializer:B,timeout:B,timeoutMessage:B,withCredentials:B,withXSRFToken:B,adapter:B,responseType:B,xsrfCookieName:B,xsrfHeaderName:B,onUploadProgress:B,onDownloadProgress:B,decompress:B,maxContentLength:B,maxBodyLength:B,beforeRedirect:B,transport:B,httpAgent:B,httpsAgent:B,cancelToken:B,socketPath:B,responseEncoding:B,validateStatus:q,headers:(H,tt,rt)=>w(lB(H),lB(tt),rt,!0)};return Rt.forEach(Object.keys(Object.assign({},E,_)),function(tt){const rt=Y[tt]||w,ht=rt(E[tt],_[tt],tt);Rt.isUndefined(ht)&&rt!==q||(T[tt]=ht)}),T}const rF=E=>{const _=Ph({},E);let{data:T,withXSRFToken:y,xsrfHeaderName:w,xsrfCookieName:M,headers:B,auth:q}=_;_.headers=B=Ds.from(B),_.url=ZB(iF(_.baseURL,_.url),E.params,E.paramsSerializer),q&&B.set("Authorization","Basic "+btoa((q.username||"")+":"+(q.password?unescape(encodeURIComponent(q.password)):"")));let Y;if(Rt.isFormData(T)){if(Yr.hasStandardBrowserEnv||Yr.hasStandardBrowserWebWorkerEnv)B.setContentType(void 0);else if((Y=B.getContentType())!==!1){const[H,...tt]=Y?Y.split(";").map(rt=>rt.trim()).filter(Boolean):[];B.setContentType([H||"multipart/form-data",...tt].join("; "))}}if(Yr.hasStandardBrowserEnv&&(y&&Rt.isFunction(y)&&(y=y(_)),y||y!==!1&&hz(_.url))){const H=w&&M&&pz.read(M);H&&B.set(w,H)}return _},_z=typeof XMLHttpRequest<"u",Ez=_z&&function(E){return new Promise(function(T,y){const w=rF(E);let M=w.data;const B=Ds.from(w.headers).normalize();let{responseType:q,onUploadProgress:Y,onDownloadProgress:H}=w,tt,rt,ht,Mt,st;function Ut(){Mt&&Mt(),st&&st(),w.cancelToken&&w.cancelToken.unsubscribe(tt),w.signal&&w.signal.removeEventListener("abort",tt)}let mt=new XMLHttpRequest;mt.open(w.method.toUpperCase(),w.url,!0),mt.timeout=w.timeout;function vt(){if(!mt)return;const Vt=Ds.from("getAllResponseHeaders"in mt&&mt.getAllResponseHeaders()),Jt={data:!q||q==="text"||q==="json"?mt.responseText:mt.response,status:mt.status,statusText:mt.statusText,headers:Vt,config:E,request:mt};nF(function(je){T(je),Ut()},function(je){y(je),Ut()},Jt),mt=null}"onloadend"in mt?mt.onloadend=vt:mt.onreadystatechange=function(){!mt||mt.readyState!==4||mt.status===0&&!(mt.responseURL&&mt.responseURL.indexOf("file:")===0)||setTimeout(vt)},mt.onabort=function(){mt&&(y(new Ke("Request aborted",Ke.ECONNABORTED,E,mt)),mt=null)},mt.onerror=function(){y(new Ke("Network Error",Ke.ERR_NETWORK,E,mt)),mt=null},mt.ontimeout=function(){let Ce=w.timeout?"timeout of "+w.timeout+"ms exceeded":"timeout exceeded";const Jt=w.transitional||$B;w.timeoutErrorMessage&&(Ce=w.timeoutErrorMessage),y(new Ke(Ce,Jt.clarifyTimeoutError?Ke.ETIMEDOUT:Ke.ECONNABORTED,E,mt)),mt=null},M===void 0&&B.setContentType(null),"setRequestHeader"in mt&&Rt.forEach(B.toJSON(),function(Ce,Jt){mt.setRequestHeader(Jt,Ce)}),Rt.isUndefined(w.withCredentials)||(mt.withCredentials=!!w.withCredentials),q&&q!=="json"&&(mt.responseType=w.responseType),H&&([ht,st]=RC(H,!0),mt.addEventListener("progress",ht)),Y&&mt.upload&&([rt,Mt]=RC(Y),mt.upload.addEventListener("progress",rt),mt.upload.addEventListener("loadend",Mt)),(w.cancelToken||w.signal)&&(tt=Vt=>{mt&&(y(!Vt||Vt.type?new Sm(null,E,mt):Vt),mt.abort(),mt=null)},w.cancelToken&&w.cancelToken.subscribe(tt),w.signal&&(w.signal.aborted?tt():w.signal.addEventListener("abort",tt)));const Gt=lz(w.url);if(Gt&&Yr.protocols.indexOf(Gt)===-1){y(new Ke("Unsupported protocol "+Gt+":",Ke.ERR_BAD_REQUEST,E));return}mt.send(M||null)})},gz=(E,_)=>{const{length:T}=E=E?E.filter(Boolean):[];if(_||T){let y=new AbortController,w;const M=function(H){if(!w){w=!0,q();const tt=H instanceof Error?H:this.reason;y.abort(tt instanceof Ke?tt:new Sm(tt instanceof Error?tt.message:tt))}};let B=_&&setTimeout(()=>{B=null,M(new Ke(`timeout ${_} of ms exceeded`,Ke.ETIMEDOUT))},_);const q=()=>{E&&(B&&clearTimeout(B),B=null,E.forEach(H=>{H.unsubscribe?H.unsubscribe(M):H.removeEventListener("abort",M)}),E=null)};E.forEach(H=>H.addEventListener("abort",M));const{signal:Y}=y;return Y.unsubscribe=()=>Rt.asap(q),Y}},Sz=function*(E,_){let T=E.byteLength;if(T<_){yield E;return}let y=0,w;for(;y<T;)w=y+_,yield E.slice(y,w),y=w},Tz=async function*(E,_){for await(const T of Rz(E))yield*Sz(T,_)},Rz=async function*(E){if(E[Symbol.asyncIterator]){yield*E;return}const _=E.getReader();try{for(;;){const{done:T,value:y}=await _.read();if(T)break;yield y}}finally{await _.cancel()}},uB=(E,_,T,y)=>{const w=Tz(E,_);let M=0,B,q=Y=>{B||(B=!0,y&&y(Y))};return new ReadableStream({async pull(Y){try{const{done:H,value:tt}=await w.next();if(H){q(),Y.close();return}let rt=tt.byteLength;if(T){let ht=M+=rt;T(ht)}Y.enqueue(new Uint8Array(tt))}catch(H){throw q(H),H}},cancel(Y){return q(Y),w.return()}},{highWaterMark:2})},OC=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",sF=OC&&typeof ReadableStream=="function",yz=OC&&(typeof TextEncoder=="function"?(E=>_=>E.encode(_))(new TextEncoder):async E=>new Uint8Array(await new Response(E).arrayBuffer())),aF=(E,..._)=>{try{return!!E(..._)}catch{return!1}},vz=sF&&aF(()=>{let E=!1;const _=new Request(Yr.origin,{body:new ReadableStream,method:"POST",get duplex(){return E=!0,"half"}}).headers.has("Content-Type");return E&&!_}),dB=64*1024,QO=sF&&aF(()=>Rt.isReadableStream(new Response("").body)),yC={stream:QO&&(E=>E.body)};OC&&(E=>{["text","arrayBuffer","blob","formData","stream"].forEach(_=>{!yC[_]&&(yC[_]=Rt.isFunction(E[_])?T=>T[_]():(T,y)=>{throw new Ke(`Response type '${_}' is not supported`,Ke.ERR_NOT_SUPPORT,y)})})})(new Response);const Cz=async E=>{if(E==null)return 0;if(Rt.isBlob(E))return E.size;if(Rt.isSpecCompliantForm(E))return(await new Request(Yr.origin,{method:"POST",body:E}).arrayBuffer()).byteLength;if(Rt.isArrayBufferView(E)||Rt.isArrayBuffer(E))return E.byteLength;if(Rt.isURLSearchParams(E)&&(E=E+""),Rt.isString(E))return(await yz(E)).byteLength},bz=async(E,_)=>{const T=Rt.toFiniteNumber(E.getContentLength());return T??Cz(_)},Az=OC&&(async E=>{let{url:_,method:T,data:y,signal:w,cancelToken:M,timeout:B,onDownloadProgress:q,onUploadProgress:Y,responseType:H,headers:tt,withCredentials:rt="same-origin",fetchOptions:ht}=rF(E);H=H?(H+"").toLowerCase():"text";let Mt=gz([w,M&&M.toAbortSignal()],B),st;const Ut=Mt&&Mt.unsubscribe&&(()=>{Mt.unsubscribe()});let mt;try{if(Y&&vz&&T!=="get"&&T!=="head"&&(mt=await bz(tt,y))!==0){let Jt=new Request(_,{method:"POST",body:y,duplex:"half"}),$e;if(Rt.isFormData(y)&&($e=Jt.headers.get("content-type"))&&tt.setContentType($e),Jt.body){const[je,Gn]=oB(mt,RC(cB(Y)));y=uB(Jt.body,dB,je,Gn)}}Rt.isString(rt)||(rt=rt?"include":"omit");const vt="credentials"in Request.prototype;st=new Request(_,{...ht,signal:Mt,method:T.toUpperCase(),headers:tt.normalize().toJSON(),body:y,duplex:"half",credentials:vt?rt:void 0});let Gt=await fetch(st);const Vt=QO&&(H==="stream"||H==="response");if(QO&&(q||Vt&&Ut)){const Jt={};["status","statusText","headers"].forEach(Pt=>{Jt[Pt]=Gt[Pt]});const $e=Rt.toFiniteNumber(Gt.headers.get("content-length")),[je,Gn]=q&&oB($e,RC(cB(q),!0))||[];Gt=new Response(uB(Gt.body,dB,je,()=>{Gn&&Gn(),Ut&&Ut()}),Jt)}H=H||"text";let Ce=await yC[Rt.findKey(yC,H)||"text"](Gt,E);return!Vt&&Ut&&Ut(),await new Promise((Jt,$e)=>{nF(Jt,$e,{data:Ce,headers:Ds.from(Gt.headers),status:Gt.status,statusText:Gt.statusText,config:E,request:st})})}catch(vt){throw Ut&&Ut(),vt&&vt.name==="TypeError"&&/fetch/i.test(vt.message)?Object.assign(new Ke("Network Error",Ke.ERR_NETWORK,E,st),{cause:vt.cause||vt}):Ke.from(vt,vt&&vt.code,E,st)}}),ZO={http:jq,xhr:Ez,fetch:Az};Rt.forEach(ZO,(E,_)=>{if(E){try{Object.defineProperty(E,"name",{value:_})}catch{}Object.defineProperty(E,"adapterName",{value:_})}});const hB=E=>`- ${E}`,Iz=E=>Rt.isFunction(E)||E===null||E===!1,oF={getAdapter:E=>{E=Rt.isArray(E)?E:[E];const{length:_}=E;let T,y;const w={};for(let M=0;M<_;M++){T=E[M];let B;if(y=T,!Iz(T)&&(y=ZO[(B=String(T)).toLowerCase()],y===void 0))throw new Ke(`Unknown adapter '${B}'`);if(y)break;w[B||"#"+M]=y}if(!y){const M=Object.entries(w).map(([q,Y])=>`adapter ${q} `+(Y===!1?"is not supported by the environment":"is not available in the build"));let B=_?M.length>1?`since :
`+M.map(hB).join(`
`):" "+hB(M[0]):"as no adapter specified";throw new Ke("There is no suitable adapter to dispatch the request "+B,"ERR_NOT_SUPPORT")}return y},adapters:ZO};function FO(E){if(E.cancelToken&&E.cancelToken.throwIfRequested(),E.signal&&E.signal.aborted)throw new Sm(null,E)}function pB(E){return FO(E),E.headers=Ds.from(E.headers),E.data=BO.call(E,E.transformRequest),["post","put","patch"].indexOf(E.method)!==-1&&E.headers.setContentType("application/x-www-form-urlencoded",!1),oF.getAdapter(E.adapter||gS.adapter)(E).then(function(y){return FO(E),y.data=BO.call(E,E.transformResponse,y),y.headers=Ds.from(y.headers),y},function(y){return eF(y)||(FO(E),y&&y.response&&(y.response.data=BO.call(E,E.transformResponse,y.response),y.response.headers=Ds.from(y.response.headers))),Promise.reject(y)})}const cF="1.7.9",NC={};["object","boolean","number","function","string","symbol"].forEach((E,_)=>{NC[E]=function(y){return typeof y===E||"a"+(_<1?"n ":" ")+E}});const fB={};NC.transitional=function(_,T,y){function w(M,B){return"[Axios v"+cF+"] Transitional option '"+M+"'"+B+(y?". "+y:"")}return(M,B,q)=>{if(_===!1)throw new Ke(w(B," has been removed"+(T?" in "+T:"")),Ke.ERR_DEPRECATED);return T&&!fB[B]&&(fB[B]=!0,console.warn(w(B," has been deprecated since v"+T+" and will be removed in the near future"))),_?_(M,B,q):!0}};NC.spelling=function(_){return(T,y)=>(console.warn(`${y} is likely a misspelling of ${_}`),!0)};function wz(E,_,T){if(typeof E!="object")throw new Ke("options must be an object",Ke.ERR_BAD_OPTION_VALUE);const y=Object.keys(E);let w=y.length;for(;w-- >0;){const M=y[w],B=_[M];if(B){const q=E[M],Y=q===void 0||B(q,M,E);if(Y!==!0)throw new Ke("option "+M+" must be "+Y,Ke.ERR_BAD_OPTION_VALUE);continue}if(T!==!0)throw new Ke("Unknown option "+M,Ke.ERR_BAD_OPTION)}}const pC={assertOptions:wz,validators:NC},Sc=pC.validators;let Lh=class{constructor(_){this.defaults=_,this.interceptors={request:new sB,response:new sB}}async request(_,T){try{return await this._request(_,T)}catch(y){if(y instanceof Error){let w={};Error.captureStackTrace?Error.captureStackTrace(w):w=new Error;const M=w.stack?w.stack.replace(/^.+\n/,""):"";try{y.stack?M&&!String(y.stack).endsWith(M.replace(/^.+\n.+\n/,""))&&(y.stack+=`
`+M):y.stack=M}catch{}}throw y}}_request(_,T){typeof _=="string"?(T=T||{},T.url=_):T=_||{},T=Ph(this.defaults,T);const{transitional:y,paramsSerializer:w,headers:M}=T;y!==void 0&&pC.assertOptions(y,{silentJSONParsing:Sc.transitional(Sc.boolean),forcedJSONParsing:Sc.transitional(Sc.boolean),clarifyTimeoutError:Sc.transitional(Sc.boolean)},!1),w!=null&&(Rt.isFunction(w)?T.paramsSerializer={serialize:w}:pC.assertOptions(w,{encode:Sc.function,serialize:Sc.function},!0)),pC.assertOptions(T,{baseUrl:Sc.spelling("baseURL"),withXsrfToken:Sc.spelling("withXSRFToken")},!0),T.method=(T.method||this.defaults.method||"get").toLowerCase();let B=M&&Rt.merge(M.common,M[T.method]);M&&Rt.forEach(["delete","get","head","post","put","patch","common"],st=>{delete M[st]}),T.headers=Ds.concat(B,M);const q=[];let Y=!0;this.interceptors.request.forEach(function(Ut){typeof Ut.runWhen=="function"&&Ut.runWhen(T)===!1||(Y=Y&&Ut.synchronous,q.unshift(Ut.fulfilled,Ut.rejected))});const H=[];this.interceptors.response.forEach(function(Ut){H.push(Ut.fulfilled,Ut.rejected)});let tt,rt=0,ht;if(!Y){const st=[pB.bind(this),void 0];for(st.unshift.apply(st,q),st.push.apply(st,H),ht=st.length,tt=Promise.resolve(T);rt<ht;)tt=tt.then(st[rt++],st[rt++]);return tt}ht=q.length;let Mt=T;for(rt=0;rt<ht;){const st=q[rt++],Ut=q[rt++];try{Mt=st(Mt)}catch(mt){Ut.call(this,mt);break}}try{tt=pB.call(this,Mt)}catch(st){return Promise.reject(st)}for(rt=0,ht=H.length;rt<ht;)tt=tt.then(H[rt++],H[rt++]);return tt}getUri(_){_=Ph(this.defaults,_);const T=iF(_.baseURL,_.url);return ZB(T,_.params,_.paramsSerializer)}};Rt.forEach(["delete","get","head","options"],function(_){Lh.prototype[_]=function(T,y){return this.request(Ph(y||{},{method:_,url:T,data:(y||{}).data}))}});Rt.forEach(["post","put","patch"],function(_){function T(y){return function(M,B,q){return this.request(Ph(q||{},{method:_,headers:y?{"Content-Type":"multipart/form-data"}:{},url:M,data:B}))}}Lh.prototype[_]=T(),Lh.prototype[_+"Form"]=T(!0)});let Oz=class lF{constructor(_){if(typeof _!="function")throw new TypeError("executor must be a function.");let T;this.promise=new Promise(function(M){T=M});const y=this;this.promise.then(w=>{if(!y._listeners)return;let M=y._listeners.length;for(;M-- >0;)y._listeners[M](w);y._listeners=null}),this.promise.then=w=>{let M;const B=new Promise(q=>{y.subscribe(q),M=q}).then(w);return B.cancel=function(){y.unsubscribe(M)},B},_(function(M,B,q){y.reason||(y.reason=new Sm(M,B,q),T(y.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(_){if(this.reason){_(this.reason);return}this._listeners?this._listeners.push(_):this._listeners=[_]}unsubscribe(_){if(!this._listeners)return;const T=this._listeners.indexOf(_);T!==-1&&this._listeners.splice(T,1)}toAbortSignal(){const _=new AbortController,T=y=>{_.abort(y)};return this.subscribe(T),_.signal.unsubscribe=()=>this.unsubscribe(T),_.signal}static source(){let _;return{token:new lF(function(w){_=w}),cancel:_}}};function Nz(E){return function(T){return E.apply(null,T)}}function Dz(E){return Rt.isObject(E)&&E.isAxiosError===!0}const $O={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries($O).forEach(([E,_])=>{$O[_]=E});function uF(E){const _=new Lh(E),T=FB(Lh.prototype.request,_);return Rt.extend(T,Lh.prototype,_,{allOwnKeys:!0}),Rt.extend(T,_,null,{allOwnKeys:!0}),T.create=function(w){return uF(Ph(E,w))},T}const li=uF(gS);li.Axios=Lh;li.CanceledError=Sm;li.CancelToken=Oz;li.isCancel=eF;li.VERSION=cF;li.toFormData=wC;li.AxiosError=Ke;li.Cancel=li.CanceledError;li.all=function(_){return Promise.all(_)};li.spread=Nz;li.isAxiosError=Dz;li.mergeConfig=Ph;li.AxiosHeaders=Ds;li.formToJSON=E=>tF(Rt.isHTMLForm(E)?new FormData(E):E);li.getAdapter=oF.getAdapter;li.HttpStatusCode=$O;li.default=li;const{Axios:L7,AxiosError:P7,CanceledError:k7,isCancel:M7,CancelToken:U7,VERSION:x7,all:V7,Cancel:B7,isAxiosError:F7,spread:j7,toFormData:G7,AxiosHeaders:H7,HttpStatusCode:W7,formToJSON:K7,getAdapter:Y7,mergeConfig:q7}=li,Lz="e9d4b556259a45f18121742537c185ad",jO="https://agoraapi.nishantpunde.tech",Pz=()=>{const[E,_]=gt.useState(!1),[T,y]=gt.useState(!1),[w,M]=gt.useState([]),[B,q]=gt.useState(""),[Y,H]=gt.useState(""),[tt,rt]=gt.useState(!1),[ht,Mt]=gt.useState(""),[st,Ut]=gt.useState({}),mt=gt.useRef(null),vt=gt.useRef(null);gt.useEffect(()=>(mt.current=TC.createClient({mode:"rtc",codec:"vp8"}),mt.current.on("user-published",Gt),mt.current.on("user-left",Vt),()=>{$e(),mt.current.off("user-published",Gt),mt.current.off("user-left",Vt)}),[]);const Gt=async(Pt,Zt)=>{await mt.current.subscribe(Pt,Zt),Zt==="audio"&&Pt.audioTrack.play(),console.log("User published:",Pt.uid),M(Ie=>Ie.some(Qn=>Qn.uid===Pt.uid)?Ie:[...Ie,{uid:Pt.uid,name:`Team Member ${Pt.uid}`,isSpeaking:!1,isMuted:!1}])},Vt=Pt=>{console.log("User left:",Pt.uid),M(Zt=>Zt.filter(Ie=>Ie.uid!==Pt.uid)),Ut(Zt=>{const Ie={...Zt};return delete Ie[Pt.uid],Ie})},Ce=async()=>{var Pt,Zt;if(!B.trim()){Mt("Please enter a meeting name");return}rt(!0),Mt("");try{const Ie=await li.post(`${jO}/meetings/create`,{meetingName:B,adminName:"Admin User"}),{channelName:Qn,token:qi,adminUid:tn}=Ie.data;H(Qn),console.log("Meeting created:",Qn),console.log("Using token:",qi),console.log("Admin UID:",tn),await mt.current.join(Lz,Qn,qi,tn),vt.current=await TC.createMicrophoneAudioTrack(),await mt.current.publish([vt.current]),M([{uid:tn,name:"Admin (You)",isLocal:!0,isAdmin:!0,isSpeaking:!1,isMuted:!1}]),_(!0),Jt()}catch(Ie){console.error("Error starting meeting:",Ie),Mt(((Zt=(Pt=Ie.response)==null?void 0:Pt.data)==null?void 0:Zt.error)||Ie.message||"Failed to start meeting")}finally{rt(!1)}},Jt=()=>{vt.current&&setInterval(()=>{vt.current.getVolumeLevel()>.2?M(Zt=>Zt.map(Ie=>Ie.isLocal?{...Ie,isSpeaking:!0}:Ie)):M(Zt=>Zt.map(Ie=>Ie.isLocal?{...Ie,isSpeaking:!1}:Ie))},200)},$e=async()=>{if(vt.current&&(vt.current.stop(),vt.current.close()),mt.current&&E&&(await mt.current.leave(),Y))try{await li.post(`${jO}/meetings/update`,{isActive:!1,channelName:Y})}catch(Pt){console.error("Error updating meeting status:",Pt)}_(!1),M([]),H(""),Ut({})},je=async()=>{vt.current&&(T?await vt.current.setMuted(!1):await vt.current.setMuted(!0),y(!T))},Gn=async Pt=>{if(!(Pt.isLocal||Pt.isAdmin))try{const Zt=st[Pt.uid]?!st[Pt.uid].muted:!0;await li.post(`${jO}/meetings/mute-member`,{channelName:Y,memberUid:Pt.uid,mute:Zt}),Ut(Ie=>({...Ie,[Pt.uid]:{muted:Zt,pending:!0}})),M(Ie=>Ie.map(Qn=>Qn.uid===Pt.uid?{...Qn,isMuted:Zt}:Qn)),console.log(`Requested to ${Zt?"mute":"unmute"} user ${Pt.uid}`)}catch(Zt){console.error("Error toggling mute for team member:",Zt)}};return ee.jsxs("div",{className:"p-6 max-w-lg mx-auto bg-white rounded-lg shadow-md",children:[ee.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Admin Meeting Panel"}),E?ee.jsxs("div",{className:"space-y-4",children:[ee.jsxs("div",{className:"bg-green-100 p-3 rounded mb-4",children:[ee.jsxs("p",{className:"font-bold text-green-800",children:["Meeting Active: ",B]}),ee.jsx("p",{className:"text-sm text-green-700",children:"Team members can now join your meeting"})]}),ee.jsxs("div",{className:"flex space-x-2 mb-4",children:[ee.jsx("button",{onClick:$e,className:"bg-red-500 text-white py-2 px-4 rounded hover:bg-red-600",children:"End Meeting"}),ee.jsx("button",{onClick:je,className:`py-2 px-4 rounded ${T?"bg-yellow-500 hover:bg-yellow-600":"bg-gray-500 hover:bg-gray-600"} text-white`,children:T?"Unmute":"Mute"})]}),ee.jsxs("div",{className:"mt-4",children:[ee.jsxs("h3",{className:"text-lg font-bold mb-2",children:["Participants (",w.length,")"]}),ee.jsx("div",{className:"bg-gray-100 p-3 rounded max-h-60 overflow-y-auto",children:w.length>0?ee.jsx("ul",{children:w.map(Pt=>ee.jsxs("li",{className:"flex items-center justify-between py-2 border-b last:border-0",children:[ee.jsxs("div",{className:"flex items-center",children:[ee.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${Pt.isSpeaking&&!Pt.isMuted?"bg-green-500":"bg-gray-300"}`}),ee.jsxs("span",{children:[Pt.name,Pt.isMuted&&" (Muted)"]})]}),ee.jsxs("div",{className:"flex items-center space-x-2",children:[!Pt.isLocal&&!Pt.isAdmin&&ee.jsx("button",{onClick:()=>Gn(Pt),className:`text-xs px-2 py-1 rounded ${Pt.isMuted?"bg-blue-100 text-blue-800 hover:bg-blue-200":"bg-red-100 text-red-800 hover:bg-red-200"}`,children:Pt.isMuted?"Unmute":"Mute"}),Pt.isAdmin&&ee.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded",children:"Admin"})]})]},Pt.uid))}):ee.jsx("p",{className:"text-gray-500",children:"No participants have joined yet"})})]})]}):ee.jsxs("div",{className:"space-y-4",children:[ee.jsxs("div",{children:[ee.jsx("label",{className:"block mb-2 font-medium",children:"Meeting Name:"}),ee.jsx("input",{type:"text",value:B,onChange:Pt=>q(Pt.target.value),className:"w-full p-2 border rounded",placeholder:"Enter meeting name"})]}),ht&&ee.jsx("p",{className:"text-red-500",children:ht}),ee.jsx("button",{onClick:Ce,className:"w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 disabled:bg-blue-300",disabled:tt||!B,children:tt?"Starting...":"Start Team Meeting"}),ee.jsx("p",{className:"text-sm text-gray-500",children:"When you start a meeting, all team members will be notified and can join."})]})]})},Rc=Object.create(null);Rc.open="0";Rc.close="1";Rc.ping="2";Rc.pong="3";Rc.message="4";Rc.upgrade="5";Rc.noop="6";const fC=Object.create(null);Object.keys(Rc).forEach(E=>{fC[Rc[E]]=E});const t0={type:"error",data:"parser error"},dF=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",hF=typeof ArrayBuffer=="function",pF=E=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(E):E&&E.buffer instanceof ArrayBuffer,m0=({type:E,data:_},T,y)=>dF&&_ instanceof Blob?T?y(_):mB(_,y):hF&&(_ instanceof ArrayBuffer||pF(_))?T?y(_):mB(new Blob([_]),y):y(Rc[E]+(_||"")),mB=(E,_)=>{const T=new FileReader;return T.onload=function(){const y=T.result.split(",")[1];_("b"+(y||""))},T.readAsDataURL(E)};function _B(E){return E instanceof Uint8Array?E:E instanceof ArrayBuffer?new Uint8Array(E):new Uint8Array(E.buffer,E.byteOffset,E.byteLength)}let GO;function kz(E,_){if(dF&&E.data instanceof Blob)return E.data.arrayBuffer().then(_B).then(_);if(hF&&(E.data instanceof ArrayBuffer||pF(E.data)))return _(_B(E.data));m0(E,!1,T=>{GO||(GO=new TextEncoder),_(GO.encode(T))})}const EB="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",dS=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let E=0;E<EB.length;E++)dS[EB.charCodeAt(E)]=E;const Mz=E=>{let _=E.length*.75,T=E.length,y,w=0,M,B,q,Y;E[E.length-1]==="="&&(_--,E[E.length-2]==="="&&_--);const H=new ArrayBuffer(_),tt=new Uint8Array(H);for(y=0;y<T;y+=4)M=dS[E.charCodeAt(y)],B=dS[E.charCodeAt(y+1)],q=dS[E.charCodeAt(y+2)],Y=dS[E.charCodeAt(y+3)],tt[w++]=M<<2|B>>4,tt[w++]=(B&15)<<4|q>>2,tt[w++]=(q&3)<<6|Y&63;return H},Uz=typeof ArrayBuffer=="function",_0=(E,_)=>{if(typeof E!="string")return{type:"message",data:fF(E,_)};const T=E.charAt(0);return T==="b"?{type:"message",data:xz(E.substring(1),_)}:fC[T]?E.length>1?{type:fC[T],data:E.substring(1)}:{type:fC[T]}:t0},xz=(E,_)=>{if(Uz){const T=Mz(E);return fF(T,_)}else return{base64:!0,data:E}},fF=(E,_)=>{switch(_){case"blob":return E instanceof Blob?E:new Blob([E]);case"arraybuffer":default:return E instanceof ArrayBuffer?E:E.buffer}},mF="",Vz=(E,_)=>{const T=E.length,y=new Array(T);let w=0;E.forEach((M,B)=>{m0(M,!1,q=>{y[B]=q,++w===T&&_(y.join(mF))})})},Bz=(E,_)=>{const T=E.split(mF),y=[];for(let w=0;w<T.length;w++){const M=_0(T[w],_);if(y.push(M),M.type==="error")break}return y};function Fz(){return new TransformStream({transform(E,_){kz(E,T=>{const y=T.length;let w;if(y<126)w=new Uint8Array(1),new DataView(w.buffer).setUint8(0,y);else if(y<65536){w=new Uint8Array(3);const M=new DataView(w.buffer);M.setUint8(0,126),M.setUint16(1,y)}else{w=new Uint8Array(9);const M=new DataView(w.buffer);M.setUint8(0,127),M.setBigUint64(1,BigInt(y))}E.data&&typeof E.data!="string"&&(w[0]|=128),_.enqueue(w),_.enqueue(T)})}})}let HO;function aC(E){return E.reduce((_,T)=>_+T.length,0)}function oC(E,_){if(E[0].length===_)return E.shift();const T=new Uint8Array(_);let y=0;for(let w=0;w<_;w++)T[w]=E[0][y++],y===E[0].length&&(E.shift(),y=0);return E.length&&y<E[0].length&&(E[0]=E[0].slice(y)),T}function jz(E,_){HO||(HO=new TextDecoder);const T=[];let y=0,w=-1,M=!1;return new TransformStream({transform(B,q){for(T.push(B);;){if(y===0){if(aC(T)<1)break;const Y=oC(T,1);M=(Y[0]&128)===128,w=Y[0]&127,w<126?y=3:w===126?y=1:y=2}else if(y===1){if(aC(T)<2)break;const Y=oC(T,2);w=new DataView(Y.buffer,Y.byteOffset,Y.length).getUint16(0),y=3}else if(y===2){if(aC(T)<8)break;const Y=oC(T,8),H=new DataView(Y.buffer,Y.byteOffset,Y.length),tt=H.getUint32(0);if(tt>Math.pow(2,21)-1){q.enqueue(t0);break}w=tt*Math.pow(2,32)+H.getUint32(4),y=3}else{if(aC(T)<w)break;const Y=oC(T,w);q.enqueue(_0(M?Y:HO.decode(Y),_)),y=0}if(w===0||w>E){q.enqueue(t0);break}}}})}const _F=4;function Yi(E){if(E)return Gz(E)}function Gz(E){for(var _ in Yi.prototype)E[_]=Yi.prototype[_];return E}Yi.prototype.on=Yi.prototype.addEventListener=function(E,_){return this._callbacks=this._callbacks||{},(this._callbacks["$"+E]=this._callbacks["$"+E]||[]).push(_),this};Yi.prototype.once=function(E,_){function T(){this.off(E,T),_.apply(this,arguments)}return T.fn=_,this.on(E,T),this};Yi.prototype.off=Yi.prototype.removeListener=Yi.prototype.removeAllListeners=Yi.prototype.removeEventListener=function(E,_){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var T=this._callbacks["$"+E];if(!T)return this;if(arguments.length==1)return delete this._callbacks["$"+E],this;for(var y,w=0;w<T.length;w++)if(y=T[w],y===_||y.fn===_){T.splice(w,1);break}return T.length===0&&delete this._callbacks["$"+E],this};Yi.prototype.emit=function(E){this._callbacks=this._callbacks||{};for(var _=new Array(arguments.length-1),T=this._callbacks["$"+E],y=1;y<arguments.length;y++)_[y-1]=arguments[y];if(T){T=T.slice(0);for(var y=0,w=T.length;y<w;++y)T[y].apply(this,_)}return this};Yi.prototype.emitReserved=Yi.prototype.emit;Yi.prototype.listeners=function(E){return this._callbacks=this._callbacks||{},this._callbacks["$"+E]||[]};Yi.prototype.hasListeners=function(E){return!!this.listeners(E).length};const DC=typeof Promise=="function"&&typeof Promise.resolve=="function"?_=>Promise.resolve().then(_):(_,T)=>T(_,0),ka=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Hz="arraybuffer";function EF(E,..._){return _.reduce((T,y)=>(E.hasOwnProperty(y)&&(T[y]=E[y]),T),{})}const Wz=ka.setTimeout,Kz=ka.clearTimeout;function LC(E,_){_.useNativeTimers?(E.setTimeoutFn=Wz.bind(ka),E.clearTimeoutFn=Kz.bind(ka)):(E.setTimeoutFn=ka.setTimeout.bind(ka),E.clearTimeoutFn=ka.clearTimeout.bind(ka))}const Yz=1.33;function qz(E){return typeof E=="string"?zz(E):Math.ceil((E.byteLength||E.size)*Yz)}function zz(E){let _=0,T=0;for(let y=0,w=E.length;y<w;y++)_=E.charCodeAt(y),_<128?T+=1:_<2048?T+=2:_<55296||_>=57344?T+=3:(y++,T+=4);return T}function gF(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Xz(E){let _="";for(let T in E)E.hasOwnProperty(T)&&(_.length&&(_+="&"),_+=encodeURIComponent(T)+"="+encodeURIComponent(E[T]));return _}function Jz(E){let _={},T=E.split("&");for(let y=0,w=T.length;y<w;y++){let M=T[y].split("=");_[decodeURIComponent(M[0])]=decodeURIComponent(M[1])}return _}class Qz extends Error{constructor(_,T,y){super(_),this.description=T,this.context=y,this.type="TransportError"}}class E0 extends Yi{constructor(_){super(),this.writable=!1,LC(this,_),this.opts=_,this.query=_.query,this.socket=_.socket,this.supportsBinary=!_.forceBase64}onError(_,T,y){return super.emitReserved("error",new Qz(_,T,y)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(_){this.readyState==="open"&&this.write(_)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(_){const T=_0(_,this.socket.binaryType);this.onPacket(T)}onPacket(_){super.emitReserved("packet",_)}onClose(_){this.readyState="closed",super.emitReserved("close",_)}pause(_){}createUri(_,T={}){return _+"://"+this._hostname()+this._port()+this.opts.path+this._query(T)}_hostname(){const _=this.opts.hostname;return _.indexOf(":")===-1?_:"["+_+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(_){const T=Xz(_);return T.length?"?"+T:""}}class Zz extends E0{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(_){this.readyState="pausing";const T=()=>{this.readyState="paused",_()};if(this._polling||!this.writable){let y=0;this._polling&&(y++,this.once("pollComplete",function(){--y||T()})),this.writable||(y++,this.once("drain",function(){--y||T()}))}else T()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(_){const T=y=>{if(this.readyState==="opening"&&y.type==="open"&&this.onOpen(),y.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(y)};Bz(_,this.socket.binaryType).forEach(T),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const _=()=>{this.write([{type:"close"}])};this.readyState==="open"?_():this.once("open",_)}write(_){this.writable=!1,Vz(_,T=>{this.doWrite(T,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const _=this.opts.secure?"https":"http",T=this.query||{};return this.opts.timestampRequests!==!1&&(T[this.opts.timestampParam]=gF()),!this.supportsBinary&&!T.sid&&(T.b64=1),this.createUri(_,T)}}let SF=!1;try{SF=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const $z=SF;function t7(){}class e7 extends Zz{constructor(_){if(super(_),typeof location<"u"){const T=location.protocol==="https:";let y=location.port;y||(y=T?"443":"80"),this.xd=typeof location<"u"&&_.hostname!==location.hostname||y!==_.port}}doWrite(_,T){const y=this.request({method:"POST",data:_});y.on("success",T),y.on("error",(w,M)=>{this.onError("xhr post error",w,M)})}doPoll(){const _=this.request();_.on("data",this.onData.bind(this)),_.on("error",(T,y)=>{this.onError("xhr poll error",T,y)}),this.pollXhr=_}}let mm=class mC extends Yi{constructor(_,T,y){super(),this.createRequest=_,LC(this,y),this._opts=y,this._method=y.method||"GET",this._uri=T,this._data=y.data!==void 0?y.data:null,this._create()}_create(){var _;const T=EF(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");T.xdomain=!!this._opts.xd;const y=this._xhr=this.createRequest(T);try{y.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){y.setDisableHeaderCheck&&y.setDisableHeaderCheck(!0);for(let w in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(w)&&y.setRequestHeader(w,this._opts.extraHeaders[w])}}catch{}if(this._method==="POST")try{y.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{y.setRequestHeader("Accept","*/*")}catch{}(_=this._opts.cookieJar)===null||_===void 0||_.addCookies(y),"withCredentials"in y&&(y.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(y.timeout=this._opts.requestTimeout),y.onreadystatechange=()=>{var w;y.readyState===3&&((w=this._opts.cookieJar)===null||w===void 0||w.parseCookies(y.getResponseHeader("set-cookie"))),y.readyState===4&&(y.status===200||y.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof y.status=="number"?y.status:0)},0))},y.send(this._data)}catch(w){this.setTimeoutFn(()=>{this._onError(w)},0);return}typeof document<"u"&&(this._index=mC.requestsCount++,mC.requests[this._index]=this)}_onError(_){this.emitReserved("error",_,this._xhr),this._cleanup(!0)}_cleanup(_){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=t7,_)try{this._xhr.abort()}catch{}typeof document<"u"&&delete mC.requests[this._index],this._xhr=null}}_onLoad(){const _=this._xhr.responseText;_!==null&&(this.emitReserved("data",_),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};mm.requestsCount=0;mm.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",gB);else if(typeof addEventListener=="function"){const E="onpagehide"in ka?"pagehide":"unload";addEventListener(E,gB,!1)}}function gB(){for(let E in mm.requests)mm.requests.hasOwnProperty(E)&&mm.requests[E].abort()}const n7=function(){const E=TF({xdomain:!1});return E&&E.responseType!==null}();class i7 extends e7{constructor(_){super(_);const T=_&&_.forceBase64;this.supportsBinary=n7&&!T}request(_={}){return Object.assign(_,{xd:this.xd},this.opts),new mm(TF,this.uri(),_)}}function TF(E){const _=E.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!_||$z))return new XMLHttpRequest}catch{}if(!_)try{return new ka[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const RF=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class r7 extends E0{get name(){return"websocket"}doOpen(){const _=this.uri(),T=this.opts.protocols,y=RF?{}:EF(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(y.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(_,T,y)}catch(w){return this.emitReserved("error",w)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=_=>this.onClose({description:"websocket connection closed",context:_}),this.ws.onmessage=_=>this.onData(_.data),this.ws.onerror=_=>this.onError("websocket error",_)}write(_){this.writable=!1;for(let T=0;T<_.length;T++){const y=_[T],w=T===_.length-1;m0(y,this.supportsBinary,M=>{try{this.doWrite(y,M)}catch{}w&&DC(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const _=this.opts.secure?"wss":"ws",T=this.query||{};return this.opts.timestampRequests&&(T[this.opts.timestampParam]=gF()),this.supportsBinary||(T.b64=1),this.createUri(_,T)}}const WO=ka.WebSocket||ka.MozWebSocket;class s7 extends r7{createSocket(_,T,y){return RF?new WO(_,T,y):T?new WO(_,T):new WO(_)}doWrite(_,T){this.ws.send(T)}}class a7 extends E0{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(_){return this.emitReserved("error",_)}this._transport.closed.then(()=>{this.onClose()}).catch(_=>{this.onError("webtransport error",_)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(_=>{const T=jz(Number.MAX_SAFE_INTEGER,this.socket.binaryType),y=_.readable.pipeThrough(T).getReader(),w=Fz();w.readable.pipeTo(_.writable),this._writer=w.writable.getWriter();const M=()=>{y.read().then(({done:q,value:Y})=>{q||(this.onPacket(Y),M())}).catch(q=>{})};M();const B={type:"open"};this.query.sid&&(B.data=`{"sid":"${this.query.sid}"}`),this._writer.write(B).then(()=>this.onOpen())})})}write(_){this.writable=!1;for(let T=0;T<_.length;T++){const y=_[T],w=T===_.length-1;this._writer.write(y).then(()=>{w&&DC(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var _;(_=this._transport)===null||_===void 0||_.close()}}const o7={websocket:s7,webtransport:a7,polling:i7},c7=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,l7=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function e0(E){if(E.length>8e3)throw"URI too long";const _=E,T=E.indexOf("["),y=E.indexOf("]");T!=-1&&y!=-1&&(E=E.substring(0,T)+E.substring(T,y).replace(/:/g,";")+E.substring(y,E.length));let w=c7.exec(E||""),M={},B=14;for(;B--;)M[l7[B]]=w[B]||"";return T!=-1&&y!=-1&&(M.source=_,M.host=M.host.substring(1,M.host.length-1).replace(/;/g,":"),M.authority=M.authority.replace("[","").replace("]","").replace(/;/g,":"),M.ipv6uri=!0),M.pathNames=u7(M,M.path),M.queryKey=d7(M,M.query),M}function u7(E,_){const T=/\/{2,9}/g,y=_.replace(T,"/").split("/");return(_.slice(0,1)=="/"||_.length===0)&&y.splice(0,1),_.slice(-1)=="/"&&y.splice(y.length-1,1),y}function d7(E,_){const T={};return _.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(y,w,M){w&&(T[w]=M)}),T}const n0=typeof addEventListener=="function"&&typeof removeEventListener=="function",_C=[];n0&&addEventListener("offline",()=>{_C.forEach(E=>E())},!1);class ju extends Yi{constructor(_,T){if(super(),this.binaryType=Hz,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,_&&typeof _=="object"&&(T=_,_=null),_){const y=e0(_);T.hostname=y.host,T.secure=y.protocol==="https"||y.protocol==="wss",T.port=y.port,y.query&&(T.query=y.query)}else T.host&&(T.hostname=e0(T.host).host);LC(this,T),this.secure=T.secure!=null?T.secure:typeof location<"u"&&location.protocol==="https:",T.hostname&&!T.port&&(T.port=this.secure?"443":"80"),this.hostname=T.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=T.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},T.transports.forEach(y=>{const w=y.prototype.name;this.transports.push(w),this._transportsByName[w]=y}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},T),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Jz(this.opts.query)),n0&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},_C.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(_){const T=Object.assign({},this.opts.query);T.EIO=_F,T.transport=_,this.id&&(T.sid=this.id);const y=Object.assign({},this.opts,{query:T,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[_]);return new this._transportsByName[_](y)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const _=this.opts.rememberUpgrade&&ju.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const T=this.createTransport(_);T.open(),this.setTransport(T)}setTransport(_){this.transport&&this.transport.removeAllListeners(),this.transport=_,_.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",T=>this._onClose("transport close",T))}onOpen(){this.readyState="open",ju.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(_){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",_),this.emitReserved("heartbeat"),_.type){case"open":this.onHandshake(JSON.parse(_.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const T=new Error("server error");T.code=_.data,this._onError(T);break;case"message":this.emitReserved("data",_.data),this.emitReserved("message",_.data);break}}onHandshake(_){this.emitReserved("handshake",_),this.id=_.sid,this.transport.query.sid=_.sid,this._pingInterval=_.pingInterval,this._pingTimeout=_.pingTimeout,this._maxPayload=_.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const _=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+_,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},_),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const _=this._getWritablePackets();this.transport.send(_),this._prevBufferLen=_.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let T=1;for(let y=0;y<this.writeBuffer.length;y++){const w=this.writeBuffer[y].data;if(w&&(T+=qz(w)),y>0&&T>this._maxPayload)return this.writeBuffer.slice(0,y);T+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const _=Date.now()>this._pingTimeoutTime;return _&&(this._pingTimeoutTime=0,DC(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),_}write(_,T,y){return this._sendPacket("message",_,T,y),this}send(_,T,y){return this._sendPacket("message",_,T,y),this}_sendPacket(_,T,y,w){if(typeof T=="function"&&(w=T,T=void 0),typeof y=="function"&&(w=y,y=null),this.readyState==="closing"||this.readyState==="closed")return;y=y||{},y.compress=y.compress!==!1;const M={type:_,data:T,options:y};this.emitReserved("packetCreate",M),this.writeBuffer.push(M),w&&this.once("flush",w),this.flush()}close(){const _=()=>{this._onClose("forced close"),this.transport.close()},T=()=>{this.off("upgrade",T),this.off("upgradeError",T),_()},y=()=>{this.once("upgrade",T),this.once("upgradeError",T)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?y():_()}):this.upgrading?y():_()),this}_onError(_){if(ju.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",_),this._onClose("transport error",_)}_onClose(_,T){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),n0&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const y=_C.indexOf(this._offlineEventListener);y!==-1&&_C.splice(y,1)}this.readyState="closed",this.id=null,this.emitReserved("close",_,T),this.writeBuffer=[],this._prevBufferLen=0}}}ju.protocol=_F;class h7 extends ju{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let _=0;_<this._upgrades.length;_++)this._probe(this._upgrades[_])}_probe(_){let T=this.createTransport(_),y=!1;ju.priorWebsocketSuccess=!1;const w=()=>{y||(T.send([{type:"ping",data:"probe"}]),T.once("packet",rt=>{if(!y)if(rt.type==="pong"&&rt.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",T),!T)return;ju.priorWebsocketSuccess=T.name==="websocket",this.transport.pause(()=>{y||this.readyState!=="closed"&&(tt(),this.setTransport(T),T.send([{type:"upgrade"}]),this.emitReserved("upgrade",T),T=null,this.upgrading=!1,this.flush())})}else{const ht=new Error("probe error");ht.transport=T.name,this.emitReserved("upgradeError",ht)}}))};function M(){y||(y=!0,tt(),T.close(),T=null)}const B=rt=>{const ht=new Error("probe error: "+rt);ht.transport=T.name,M(),this.emitReserved("upgradeError",ht)};function q(){B("transport closed")}function Y(){B("socket closed")}function H(rt){T&&rt.name!==T.name&&M()}const tt=()=>{T.removeListener("open",w),T.removeListener("error",B),T.removeListener("close",q),this.off("close",Y),this.off("upgrading",H)};T.once("open",w),T.once("error",B),T.once("close",q),this.once("close",Y),this.once("upgrading",H),this._upgrades.indexOf("webtransport")!==-1&&_!=="webtransport"?this.setTimeoutFn(()=>{y||T.open()},200):T.open()}onHandshake(_){this._upgrades=this._filterUpgrades(_.upgrades),super.onHandshake(_)}_filterUpgrades(_){const T=[];for(let y=0;y<_.length;y++)~this.transports.indexOf(_[y])&&T.push(_[y]);return T}}let p7=class extends h7{constructor(_,T={}){const y=typeof _=="object"?_:T;(!y.transports||y.transports&&typeof y.transports[0]=="string")&&(y.transports=(y.transports||["polling","websocket","webtransport"]).map(w=>o7[w]).filter(w=>!!w)),super(_,y)}};function f7(E,_="",T){let y=E;T=T||typeof location<"u"&&location,E==null&&(E=T.protocol+"//"+T.host),typeof E=="string"&&(E.charAt(0)==="/"&&(E.charAt(1)==="/"?E=T.protocol+E:E=T.host+E),/^(https?|wss?):\/\//.test(E)||(typeof T<"u"?E=T.protocol+"//"+E:E="https://"+E),y=e0(E)),y.port||(/^(http|ws)$/.test(y.protocol)?y.port="80":/^(http|ws)s$/.test(y.protocol)&&(y.port="443")),y.path=y.path||"/";const M=y.host.indexOf(":")!==-1?"["+y.host+"]":y.host;return y.id=y.protocol+"://"+M+":"+y.port+_,y.href=y.protocol+"://"+M+(T&&T.port===y.port?"":":"+y.port),y}const m7=typeof ArrayBuffer=="function",_7=E=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(E):E.buffer instanceof ArrayBuffer,yF=Object.prototype.toString,E7=typeof Blob=="function"||typeof Blob<"u"&&yF.call(Blob)==="[object BlobConstructor]",g7=typeof File=="function"||typeof File<"u"&&yF.call(File)==="[object FileConstructor]";function g0(E){return m7&&(E instanceof ArrayBuffer||_7(E))||E7&&E instanceof Blob||g7&&E instanceof File}function EC(E,_){if(!E||typeof E!="object")return!1;if(Array.isArray(E)){for(let T=0,y=E.length;T<y;T++)if(EC(E[T]))return!0;return!1}if(g0(E))return!0;if(E.toJSON&&typeof E.toJSON=="function"&&arguments.length===1)return EC(E.toJSON(),!0);for(const T in E)if(Object.prototype.hasOwnProperty.call(E,T)&&EC(E[T]))return!0;return!1}function S7(E){const _=[],T=E.data,y=E;return y.data=i0(T,_),y.attachments=_.length,{packet:y,buffers:_}}function i0(E,_){if(!E)return E;if(g0(E)){const T={_placeholder:!0,num:_.length};return _.push(E),T}else if(Array.isArray(E)){const T=new Array(E.length);for(let y=0;y<E.length;y++)T[y]=i0(E[y],_);return T}else if(typeof E=="object"&&!(E instanceof Date)){const T={};for(const y in E)Object.prototype.hasOwnProperty.call(E,y)&&(T[y]=i0(E[y],_));return T}return E}function T7(E,_){return E.data=r0(E.data,_),delete E.attachments,E}function r0(E,_){if(!E)return E;if(E&&E._placeholder===!0){if(typeof E.num=="number"&&E.num>=0&&E.num<_.length)return _[E.num];throw new Error("illegal attachments")}else if(Array.isArray(E))for(let T=0;T<E.length;T++)E[T]=r0(E[T],_);else if(typeof E=="object")for(const T in E)Object.prototype.hasOwnProperty.call(E,T)&&(E[T]=r0(E[T],_));return E}const R7=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],y7=5;var pn;(function(E){E[E.CONNECT=0]="CONNECT",E[E.DISCONNECT=1]="DISCONNECT",E[E.EVENT=2]="EVENT",E[E.ACK=3]="ACK",E[E.CONNECT_ERROR=4]="CONNECT_ERROR",E[E.BINARY_EVENT=5]="BINARY_EVENT",E[E.BINARY_ACK=6]="BINARY_ACK"})(pn||(pn={}));class v7{constructor(_){this.replacer=_}encode(_){return(_.type===pn.EVENT||_.type===pn.ACK)&&EC(_)?this.encodeAsBinary({type:_.type===pn.EVENT?pn.BINARY_EVENT:pn.BINARY_ACK,nsp:_.nsp,data:_.data,id:_.id}):[this.encodeAsString(_)]}encodeAsString(_){let T=""+_.type;return(_.type===pn.BINARY_EVENT||_.type===pn.BINARY_ACK)&&(T+=_.attachments+"-"),_.nsp&&_.nsp!=="/"&&(T+=_.nsp+","),_.id!=null&&(T+=_.id),_.data!=null&&(T+=JSON.stringify(_.data,this.replacer)),T}encodeAsBinary(_){const T=S7(_),y=this.encodeAsString(T.packet),w=T.buffers;return w.unshift(y),w}}function SB(E){return Object.prototype.toString.call(E)==="[object Object]"}class S0 extends Yi{constructor(_){super(),this.reviver=_}add(_){let T;if(typeof _=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");T=this.decodeString(_);const y=T.type===pn.BINARY_EVENT;y||T.type===pn.BINARY_ACK?(T.type=y?pn.EVENT:pn.ACK,this.reconstructor=new C7(T),T.attachments===0&&super.emitReserved("decoded",T)):super.emitReserved("decoded",T)}else if(g0(_)||_.base64)if(this.reconstructor)T=this.reconstructor.takeBinaryData(_),T&&(this.reconstructor=null,super.emitReserved("decoded",T));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+_)}decodeString(_){let T=0;const y={type:Number(_.charAt(0))};if(pn[y.type]===void 0)throw new Error("unknown packet type "+y.type);if(y.type===pn.BINARY_EVENT||y.type===pn.BINARY_ACK){const M=T+1;for(;_.charAt(++T)!=="-"&&T!=_.length;);const B=_.substring(M,T);if(B!=Number(B)||_.charAt(T)!=="-")throw new Error("Illegal attachments");y.attachments=Number(B)}if(_.charAt(T+1)==="/"){const M=T+1;for(;++T&&!(_.charAt(T)===","||T===_.length););y.nsp=_.substring(M,T)}else y.nsp="/";const w=_.charAt(T+1);if(w!==""&&Number(w)==w){const M=T+1;for(;++T;){const B=_.charAt(T);if(B==null||Number(B)!=B){--T;break}if(T===_.length)break}y.id=Number(_.substring(M,T+1))}if(_.charAt(++T)){const M=this.tryParse(_.substr(T));if(S0.isPayloadValid(y.type,M))y.data=M;else throw new Error("invalid payload")}return y}tryParse(_){try{return JSON.parse(_,this.reviver)}catch{return!1}}static isPayloadValid(_,T){switch(_){case pn.CONNECT:return SB(T);case pn.DISCONNECT:return T===void 0;case pn.CONNECT_ERROR:return typeof T=="string"||SB(T);case pn.EVENT:case pn.BINARY_EVENT:return Array.isArray(T)&&(typeof T[0]=="number"||typeof T[0]=="string"&&R7.indexOf(T[0])===-1);case pn.ACK:case pn.BINARY_ACK:return Array.isArray(T)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class C7{constructor(_){this.packet=_,this.buffers=[],this.reconPack=_}takeBinaryData(_){if(this.buffers.push(_),this.buffers.length===this.reconPack.attachments){const T=T7(this.reconPack,this.buffers);return this.finishedReconstruction(),T}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const b7=Object.freeze(Object.defineProperty({__proto__:null,Decoder:S0,Encoder:v7,get PacketType(){return pn},protocol:y7},Symbol.toStringTag,{value:"Module"}));function Io(E,_,T){return E.on(_,T),function(){E.off(_,T)}}const A7=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class vF extends Yi{constructor(_,T,y){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=_,this.nsp=T,y&&y.auth&&(this.auth=y.auth),this._opts=Object.assign({},y),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const _=this.io;this.subs=[Io(_,"open",this.onopen.bind(this)),Io(_,"packet",this.onpacket.bind(this)),Io(_,"error",this.onerror.bind(this)),Io(_,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(..._){return _.unshift("message"),this.emit.apply(this,_),this}emit(_,...T){var y,w,M;if(A7.hasOwnProperty(_))throw new Error('"'+_.toString()+'" is a reserved event name');if(T.unshift(_),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(T),this;const B={type:pn.EVENT,data:T};if(B.options={},B.options.compress=this.flags.compress!==!1,typeof T[T.length-1]=="function"){const tt=this.ids++,rt=T.pop();this._registerAckCallback(tt,rt),B.id=tt}const q=(w=(y=this.io.engine)===null||y===void 0?void 0:y.transport)===null||w===void 0?void 0:w.writable,Y=this.connected&&!(!((M=this.io.engine)===null||M===void 0)&&M._hasPingExpired());return this.flags.volatile&&!q||(Y?(this.notifyOutgoingListeners(B),this.packet(B)):this.sendBuffer.push(B)),this.flags={},this}_registerAckCallback(_,T){var y;const w=(y=this.flags.timeout)!==null&&y!==void 0?y:this._opts.ackTimeout;if(w===void 0){this.acks[_]=T;return}const M=this.io.setTimeoutFn(()=>{delete this.acks[_];for(let q=0;q<this.sendBuffer.length;q++)this.sendBuffer[q].id===_&&this.sendBuffer.splice(q,1);T.call(this,new Error("operation has timed out"))},w),B=(...q)=>{this.io.clearTimeoutFn(M),T.apply(this,q)};B.withError=!0,this.acks[_]=B}emitWithAck(_,...T){return new Promise((y,w)=>{const M=(B,q)=>B?w(B):y(q);M.withError=!0,T.push(M),this.emit(_,...T)})}_addToQueue(_){let T;typeof _[_.length-1]=="function"&&(T=_.pop());const y={id:this._queueSeq++,tryCount:0,pending:!1,args:_,flags:Object.assign({fromQueue:!0},this.flags)};_.push((w,...M)=>y!==this._queue[0]?void 0:(w!==null?y.tryCount>this._opts.retries&&(this._queue.shift(),T&&T(w)):(this._queue.shift(),T&&T(null,...M)),y.pending=!1,this._drainQueue())),this._queue.push(y),this._drainQueue()}_drainQueue(_=!1){if(!this.connected||this._queue.length===0)return;const T=this._queue[0];T.pending&&!_||(T.pending=!0,T.tryCount++,this.flags=T.flags,this.emit.apply(this,T.args))}packet(_){_.nsp=this.nsp,this.io._packet(_)}onopen(){typeof this.auth=="function"?this.auth(_=>{this._sendConnectPacket(_)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(_){this.packet({type:pn.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},_):_})}onerror(_){this.connected||this.emitReserved("connect_error",_)}onclose(_,T){this.connected=!1,delete this.id,this.emitReserved("disconnect",_,T),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(_=>{if(!this.sendBuffer.some(y=>String(y.id)===_)){const y=this.acks[_];delete this.acks[_],y.withError&&y.call(this,new Error("socket has been disconnected"))}})}onpacket(_){if(_.nsp===this.nsp)switch(_.type){case pn.CONNECT:_.data&&_.data.sid?this.onconnect(_.data.sid,_.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case pn.EVENT:case pn.BINARY_EVENT:this.onevent(_);break;case pn.ACK:case pn.BINARY_ACK:this.onack(_);break;case pn.DISCONNECT:this.ondisconnect();break;case pn.CONNECT_ERROR:this.destroy();const y=new Error(_.data.message);y.data=_.data.data,this.emitReserved("connect_error",y);break}}onevent(_){const T=_.data||[];_.id!=null&&T.push(this.ack(_.id)),this.connected?this.emitEvent(T):this.receiveBuffer.push(Object.freeze(T))}emitEvent(_){if(this._anyListeners&&this._anyListeners.length){const T=this._anyListeners.slice();for(const y of T)y.apply(this,_)}super.emit.apply(this,_),this._pid&&_.length&&typeof _[_.length-1]=="string"&&(this._lastOffset=_[_.length-1])}ack(_){const T=this;let y=!1;return function(...w){y||(y=!0,T.packet({type:pn.ACK,id:_,data:w}))}}onack(_){const T=this.acks[_.id];typeof T=="function"&&(delete this.acks[_.id],T.withError&&_.data.unshift(null),T.apply(this,_.data))}onconnect(_,T){this.id=_,this.recovered=T&&this._pid===T,this._pid=T,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(_=>this.emitEvent(_)),this.receiveBuffer=[],this.sendBuffer.forEach(_=>{this.notifyOutgoingListeners(_),this.packet(_)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(_=>_()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:pn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(_){return this.flags.compress=_,this}get volatile(){return this.flags.volatile=!0,this}timeout(_){return this.flags.timeout=_,this}onAny(_){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(_),this}prependAny(_){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(_),this}offAny(_){if(!this._anyListeners)return this;if(_){const T=this._anyListeners;for(let y=0;y<T.length;y++)if(_===T[y])return T.splice(y,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(_){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(_),this}prependAnyOutgoing(_){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(_),this}offAnyOutgoing(_){if(!this._anyOutgoingListeners)return this;if(_){const T=this._anyOutgoingListeners;for(let y=0;y<T.length;y++)if(_===T[y])return T.splice(y,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(_){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const T=this._anyOutgoingListeners.slice();for(const y of T)y.apply(this,_.data)}}}function Tm(E){E=E||{},this.ms=E.min||100,this.max=E.max||1e4,this.factor=E.factor||2,this.jitter=E.jitter>0&&E.jitter<=1?E.jitter:0,this.attempts=0}Tm.prototype.duration=function(){var E=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var _=Math.random(),T=Math.floor(_*this.jitter*E);E=(Math.floor(_*10)&1)==0?E-T:E+T}return Math.min(E,this.max)|0};Tm.prototype.reset=function(){this.attempts=0};Tm.prototype.setMin=function(E){this.ms=E};Tm.prototype.setMax=function(E){this.max=E};Tm.prototype.setJitter=function(E){this.jitter=E};class s0 extends Yi{constructor(_,T){var y;super(),this.nsps={},this.subs=[],_&&typeof _=="object"&&(T=_,_=void 0),T=T||{},T.path=T.path||"/socket.io",this.opts=T,LC(this,T),this.reconnection(T.reconnection!==!1),this.reconnectionAttempts(T.reconnectionAttempts||1/0),this.reconnectionDelay(T.reconnectionDelay||1e3),this.reconnectionDelayMax(T.reconnectionDelayMax||5e3),this.randomizationFactor((y=T.randomizationFactor)!==null&&y!==void 0?y:.5),this.backoff=new Tm({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(T.timeout==null?2e4:T.timeout),this._readyState="closed",this.uri=_;const w=T.parser||b7;this.encoder=new w.Encoder,this.decoder=new w.Decoder,this._autoConnect=T.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(_){return arguments.length?(this._reconnection=!!_,_||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(_){return _===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=_,this)}reconnectionDelay(_){var T;return _===void 0?this._reconnectionDelay:(this._reconnectionDelay=_,(T=this.backoff)===null||T===void 0||T.setMin(_),this)}randomizationFactor(_){var T;return _===void 0?this._randomizationFactor:(this._randomizationFactor=_,(T=this.backoff)===null||T===void 0||T.setJitter(_),this)}reconnectionDelayMax(_){var T;return _===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=_,(T=this.backoff)===null||T===void 0||T.setMax(_),this)}timeout(_){return arguments.length?(this._timeout=_,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(_){if(~this._readyState.indexOf("open"))return this;this.engine=new p7(this.uri,this.opts);const T=this.engine,y=this;this._readyState="opening",this.skipReconnect=!1;const w=Io(T,"open",function(){y.onopen(),_&&_()}),M=q=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",q),_?_(q):this.maybeReconnectOnOpen()},B=Io(T,"error",M);if(this._timeout!==!1){const q=this._timeout,Y=this.setTimeoutFn(()=>{w(),M(new Error("timeout")),T.close()},q);this.opts.autoUnref&&Y.unref(),this.subs.push(()=>{this.clearTimeoutFn(Y)})}return this.subs.push(w),this.subs.push(B),this}connect(_){return this.open(_)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const _=this.engine;this.subs.push(Io(_,"ping",this.onping.bind(this)),Io(_,"data",this.ondata.bind(this)),Io(_,"error",this.onerror.bind(this)),Io(_,"close",this.onclose.bind(this)),Io(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(_){try{this.decoder.add(_)}catch(T){this.onclose("parse error",T)}}ondecoded(_){DC(()=>{this.emitReserved("packet",_)},this.setTimeoutFn)}onerror(_){this.emitReserved("error",_)}socket(_,T){let y=this.nsps[_];return y?this._autoConnect&&!y.active&&y.connect():(y=new vF(this,_,T),this.nsps[_]=y),y}_destroy(_){const T=Object.keys(this.nsps);for(const y of T)if(this.nsps[y].active)return;this._close()}_packet(_){const T=this.encoder.encode(_);for(let y=0;y<T.length;y++)this.engine.write(T[y],_.options)}cleanup(){this.subs.forEach(_=>_()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(_,T){var y;this.cleanup(),(y=this.engine)===null||y===void 0||y.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",_,T),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const _=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const T=this.backoff.duration();this._reconnecting=!0;const y=this.setTimeoutFn(()=>{_.skipReconnect||(this.emitReserved("reconnect_attempt",_.backoff.attempts),!_.skipReconnect&&_.open(w=>{w?(_._reconnecting=!1,_.reconnect(),this.emitReserved("reconnect_error",w)):_.onreconnect()}))},T);this.opts.autoUnref&&y.unref(),this.subs.push(()=>{this.clearTimeoutFn(y)})}}onreconnect(){const _=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",_)}}const lS={};function gC(E,_){typeof E=="object"&&(_=E,E=void 0),_=_||{};const T=f7(E,_.path||"/socket.io"),y=T.source,w=T.id,M=T.path,B=lS[w]&&M in lS[w].nsps,q=_.forceNew||_["force new connection"]||_.multiplex===!1||B;let Y;return q?Y=new s0(y,_):(lS[w]||(lS[w]=new s0(y,_)),Y=lS[w]),T.query&&!_.query&&(_.query=T.queryKey),Y.socket(T.path,_)}Object.assign(gC,{Manager:s0,Socket:vF,io:gC,connect:gC});const I7="e9d4b556259a45f18121742537c185ad",KO="https://agoraapi.nishantpunde.tech",w7=()=>{const[E,_]=gt.useState(!1),[T,y]=gt.useState(!1),[w,M]=gt.useState(!1),[B,q]=gt.useState(""),[Y,H]=gt.useState([]),[tt,rt]=gt.useState([]),[ht,Mt]=gt.useState(null),[st,Ut]=gt.useState(!1),[mt,vt]=gt.useState(""),Gt=gt.useRef(null),Vt=gt.useRef(null),Ce=gt.useRef(null),Jt=gt.useRef(null),$e=gt.useRef(null),je=async()=>{try{const be=await li.get(`${KO}/meetings/active`);H(be.data)}catch(be){console.error("Error fetching meetings:",be)}};gt.useEffect(()=>(Gt.current=TC.createClient({mode:"rtc",codec:"vp8"}),Gt.current.on("user-published",Pt),Gt.current.on("user-left",Zt),Jt.current=gC(KO),Jt.current.on("connect",()=>{console.log("Connected to Socket.IO server")}),Jt.current.on("mute-command",Gn),je(),Ce.current=setInterval(je,5e3),()=>{qi(),clearInterval(Ce.current),Gt.current.off("user-published",Pt),Gt.current.off("user-left",Zt),Jt.current&&(Jt.current.off("mute-command",Gn),Jt.current.disconnect())}),[]);const Gn=async be=>{console.log("Received mute command:",be);const{uid:Bt,mute:$t}=be;Bt===$e.current&&(console.log(`Admin ${$t?"muted":"unmuted"} you`),M($t),Vt.current&&(await Vt.current.setMuted($t),y($t)),alert($t?"The admin has muted you":"The admin has unmuted you"))},Pt=async(be,Bt)=>{await Gt.current.subscribe(be,Bt),Bt==="audio"&&be.audioTrack.play(),console.log("User published:",be.uid),rt($t=>{const re=be.uid<2e3;return $t.some(pe=>pe.uid===be.uid)?$t:[...$t,{uid:be.uid,name:re?"Admin":`Team Member ${be.uid%1e3}`,isAdmin:re,isSpeaking:!1}]})},Zt=be=>{console.log("User left:",be.uid);const Bt=tt.some($t=>$t.uid===be.uid&&$t.isAdmin);rt($t=>$t.filter(re=>re.uid!==be.uid)),Bt&&(alert("The admin has ended the meeting."),qi())},Ie=async be=>{var Bt,$t;if(!B.trim()){vt("Please enter your name to join");return}Ut(!0),vt("");try{const re=await li.post(`${KO}/meetings/join`,{meetingId:be.id,userName:B}),{token:pe,uid:$,channelName:Ft}=re.data.meeting;$e.current=$,console.log("Joining meeting:",Ft),console.log("Using token:",pe),console.log("Member UID:",$),await Gt.current.join(I7,Ft,pe,$),Vt.current=await TC.createMicrophoneAudioTrack(),await Gt.current.publish([Vt.current]),Jt.current.emit("register",{uid:$,channelName:Ft}),rt(fe=>[...fe,{uid:$,name:`${B} (You)`,isLocal:!0,isSpeaking:!1,isMuted:!1}]),_(!0),Mt(be),Qn(),clearInterval(Ce.current)}catch(re){console.error("Error joining meeting:",re),vt((($t=(Bt=re.response)==null?void 0:Bt.data)==null?void 0:$t.error)||re.message||"Failed to join meeting")}finally{Ut(!1)}},Qn=()=>{Vt.current&&setInterval(()=>{Vt.current.getVolumeLevel()>.2?rt(Bt=>Bt.map($t=>$t.isLocal?{...$t,isSpeaking:!0}:$t)):rt(Bt=>Bt.map($t=>$t.isLocal?{...$t,isSpeaking:!1}:$t))},200)},qi=async()=>{Vt.current&&(Vt.current.stop(),Vt.current.close()),Gt.current&&E&&await Gt.current.leave(),_(!1),rt([]),Mt(null),M(!1),$e.current=null,Ce.current||(Ce.current=setInterval(je,5e3))},tn=async()=>{if(w&&!T){alert("You cannot unmute yourself. The admin has muted you.");return}Vt.current&&(T?await Vt.current.setMuted(!1):await Vt.current.setMuted(!0),y(!T))};return ee.jsxs("div",{className:"p-6 max-w-lg mx-auto bg-white rounded-lg shadow-md",children:[ee.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Team Voice Call"}),E?ee.jsxs("div",{className:"space-y-4",children:[ee.jsxs("div",{className:"bg-green-100 p-3 rounded mb-4",children:[ee.jsxs("p",{className:"font-bold text-green-800",children:["Connected to: ",ht==null?void 0:ht.name]}),ee.jsxs("p",{className:"text-sm text-green-700",children:["Host: ",ht==null?void 0:ht.adminName]}),w&&ee.jsx("p",{className:"text-sm text-red-600 mt-1 font-semibold",children:"You have been muted by the admin"})]}),ee.jsxs("div",{className:"flex space-x-2 mb-4",children:[ee.jsx("button",{onClick:qi,className:"bg-red-500 text-white py-2 px-4 rounded hover:bg-red-600",children:"Leave Call"}),ee.jsx("button",{onClick:tn,className:`${T?"bg-gray-500":"bg-blue-500"} text-white py-2 px-4 rounded hover:bg-blue-600`,children:T?"Unmute":"Mute"})]})]}):ee.jsxs("div",{className:"space-y-4",children:[ee.jsxs("div",{children:[ee.jsx("label",{className:"block mb-2 font-medium",children:"Your Name:"}),ee.jsx("input",{type:"text",value:B,onChange:be=>q(be.target.value),className:"w-full p-2 border rounded",placeholder:"Enter your name"})]}),mt&&ee.jsx("p",{className:"text-red-500",children:mt}),ee.jsxs("div",{children:[ee.jsx("h3",{className:"font-bold mb-2",children:"Active Meetings"}),Y.length>0?ee.jsx("div",{className:"space-y-2",children:Y.map(be=>ee.jsxs("div",{className:"bg-gray-100 p-3 rounded flex justify-between items-center",children:[ee.jsxs("div",{children:[ee.jsx("p",{className:"font-medium",children:be.name}),ee.jsxs("p",{className:"text-sm text-gray-600",children:["Host: ",be.adminName]}),ee.jsxs("p",{className:"text-xs text-gray-500",children:["Started:"," ",new Date(be.startTime).toLocaleTimeString()]})]}),ee.jsx("button",{onClick:()=>Ie(be),className:"bg-green-500 text-white py-1 px-3 rounded hover:bg-green-600 disabled:bg-green-300",disabled:st||!B,children:st?"Joining...":"Join Now"})]},be.id))}):ee.jsxs("div",{className:"bg-gray-100 p-4 rounded text-center",children:[ee.jsx("p",{className:"text-gray-500",children:"No active meetings right now"}),ee.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Refreshing automatically..."})]})]})]})]})},O7=()=>{const[E,_]=gt.useState(null),T=y=>{_(y)};return ee.jsx(HY,{children:E?ee.jsx(TY,{children:ee.jsx(DB,{path:"/",element:E==="admin"?ee.jsx(Pz,{}):ee.jsx(w7,{})})}):ee.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100",children:ee.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full",children:[ee.jsx("h1",{className:"text-2xl font-bold mb-6 text-center",children:"Team Voice Call App"}),ee.jsx("p",{className:"mb-4 text-center",children:"Select your role to continue:"}),ee.jsxs("div",{className:"space-y-3",children:[ee.jsx("button",{onClick:()=>T("admin"),className:"w-full bg-blue-600 text-white py-3 px-4 rounded hover:bg-blue-700",children:"I'm an Admin"}),ee.jsx("button",{onClick:()=>T("member"),className:"w-full bg-green-600 text-white py-3 px-4 rounded hover:bg-green-700",children:"I'm a Team Member"})]})]})})})};OK.createRoot(document.getElementById("root")).render(ee.jsx(gt.StrictMode,{children:ee.jsx(O7,{})}));
